<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../index.css"/>

<h1>/f0c1s/blog/sec/AD/</h1>

<p>
    <a href="../../index.html">/blog</a>
    <a href="../../sec/index.html">Security</a>
    <a href="../../sec/AD/index.html">+ Active Directory</a>
</p>

<h2 id="active-directory">Active Directory</h2>
<p>This is a collection of resources available on the internet about active directory. In most cases, the text is copied and pasted verbatim. This is more of a reference page.</p>
<h2 id="resources">Resources</h2>
<ul>
    <li><a href="https://www.youtube.com/watch?v=WOHMZc0K_B8">Hacking Active Directory for OSCP and beyond</a></li>
    <li><a href="https://www.youtube.com/playlist?list=PLLKT__MCUeiwBa7d7F_vN1GUwz_2TmVQj">Zero to Hero: A Practical Network Penetration Testing Course</a></li>
    <li><a href="https://www.youtube.com/playlist?list=PLLKT__MCUeiycd-_VvfM1xI9t4uEV0g8i">Windows AD Lab Setup</a></li>
    <li><a href="https://book.hacktricks.xyz/windows/active-directory-methodology">Active Directory Methodology</a></li>
    <li><a href="https://tryhackme.com/hacktivities?tab=search">TryHackMe</a>
        <ul>
            <li>search for “Active Directory”
                <ul>
                    <li><a href="https://tryhackme.com/api/hacktivities?page=1&amp;searchTxt=&#39;active%20directory&#39;&amp;free=all&amp;order=most-popular&amp;difficulty=all&amp;type=all">search API call result</a></li>
                </ul></li>
        </ul></li>
    <li><a href="https://www.cyberseclabs.co.uk/getting-started">CyberSecLabs</a></li>
    <li><a href="https://adam-toscher.medium.com/top-five-ways-i-got-domain-admin-on-your-internal-network-before-lunch-2018-edition-82259ab73aaa">Top Five Ways I Got Domain Admin on Your Internal Network before Lunch (2018 Edition)</a></li>
    <li><a href="https://adsecurity.org/">adsecurity</a></li>
    <li><a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview">docs.microsoft</a></li>
    <li>HAUSEC
        <ul>
            <li><a href="https://hausec.com/2019/03/05/penetration-testing-active-directory-part-i/">1</a></li>
            <li><a href="https://hausec.com/2019/03/12/penetration-testing-active-directory-part-ii/">2</a></li>
            <li><a href="https://hausec.com/2018/10/08/active-directory-assessment-and-privilege-escalation-script/">escalation script 2.0</a></li>
        </ul></li>
    <li><a href="https://bloodhound.readthedocs.io/en/latest/index.html">BloodHound docs</a></li>
    <li><a href="https://cloud.google.com/managed-microsoft-ad/docs/quickstart-create-domain">Google Cloud</a></li>
    <li><a href="https://en.wikipedia.org/wiki/Active_Directory">Wiki AD</a></li>
    <li><a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">Wiki LDAP</a></li>
    <li><a href="https://www.fuzzysecurity.com/tutorials/16.html">FuzzySecurity</a></li>
    <li><a href="https://wiki.zacheller.dev/pentest/courses/beginner-network-pentesting/week-9">zacheller.dev</a></li>
    <li><a href="https://techterms.com/definition/active_directory">techterms</a></li>
    <li>Kerberos
        <ul>
            <li><a href="https://en.wikipedia.org/wiki/Kerberos_(protocol)">Wiki Kerberos</a></li>
            <li><a href="https://datatracker.ietf.org/doc/html/rfc4120">RFC, one of many</a> <a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc4120.txt.pdf">pdf</a></li>
            <li><a href="https://www.tarlogic.com/blog/how-kerberos-works/">tarlogic</a></li>
            <li><a href="https://book.hacktricks.xyz/windows/active-directory-methodology/kerberos-authentication">HackTricks</a></li>
            <li><a href="https://docs.microsoft.com/en-us/windows/win32/secauthn/microsoft-kerberos">Microsoft Kerberos</a></li>
        </ul></li>
</ul>
<p>TryHackMe Active Directory</p>
<figure>
    <img src="thm-ad.png" alt="" /><figcaption>TryHackMe Active Directory</figcaption>
</figure>
<h3 id="paid-resources">Paid resources</h3>
<ul>
    <li>HackTheBox
        <ul>
            <li>Pro Labs</li>
            <li>Retired Boxes
                <ul>
                    <li>APT</li>
                    <li>Fuse</li>
                    <li>Cascade</li>
                    <li>Monteverde</li>
                    <li>Resolute</li>
                    <li>Forest</li>
                    <li>Arkham</li>
                    <li>Active</li>
                    <li>Mantis</li>
                </ul></li>
        </ul></li>
</ul>
<h2 id="theory">Theory</h2>
<p>AD stores information about network and resources on it. It can store information about machines, humans, software etc. This makes task of managing network and users easy for an administrator.</p>
<p>Active Directory Services consist of multiple directory services. The best known is Active Directory Domain Services, commonly abbreviated as AD DS or simply AD.</p>
<p>As a directory service, an Active Directory instance consists of a database and corresponding executable code responsible for servicing requests and maintaining the database.</p>
<p>AD has a large surface area for attacks. The most important component is Domain Controller, DC.</p>
<h3 id="services">Services</h3>
<ul>
    <li>Domain Services AD DS
        <ul>
            <li>stores centralized data and manages communication between users and domains;</li>
            <li>login authentication and search functionality</li>
        </ul></li>
    <li>Lightweight Directory Services AD LDS
        <ul>
            <li>supports directory-enabled applications using the open (LDAP) protocol</li>
        </ul></li>
    <li>Certificate Services AD CS
        <ul>
            <li>creates, distributes, and manages secure certificates</li>
        </ul></li>
    <li>Federation Services AD FS
        <ul>
            <li>provides single-sign-on (SSO) to authenticate a user in multiple web applications in a single session</li>
        </ul></li>
    <li>Rights Management Services AD RMS
        <ul>
            <li>protects copyrighted information by preventing unauthorized use and distribution of digital content</li>
        </ul></li>
    <li>DNS Service
        <ul>
            <li>Used to resolve domain names.</li>
            <li>Authoritative for a given domain.</li>
        </ul></li>
</ul>
<h3 id="domains-trees-and-forests">Domains, Trees and Forests</h3>
<ul>
    <li>Domains
        <ul>
            <li>A domain is defined as a logical group of network objects (computers, users, devices) that share the same Active Directory database.</li>
        </ul></li>
    <li>Trees
        <ul>
            <li>A tree is a collection of one or more domains and domain trees in a contiguous namespace, and is linked in a transitive trust hierarchy.</li>
        </ul></li>
    <li>Forest
        <ul>
            <li>Collection of trees that share:
                <ul>
                    <li>a common global catalogue,</li>
                    <li>directory schema,</li>
                    <li>logical structure, and</li>
                    <li>directory configuration</li>
                </ul></li>
        </ul></li>
</ul>
<h2 id="enumeration">Enumeration</h2>
<ol type="1">
    <li>Either get an access to an AD machine via client side attack. or.</li>
    <li>Get credentials to machine via engagement contract.</li>
</ol>
<pre class="shell"><code>net user
net user /domain # all of the users in domain
net user USER /domain # more information about USER
net group /domain # only on domain controllers

</code></pre>
<h2 id="attacks-vulnerabilities-tools-and-techniques">Attacks, Vulnerabilities, Tools and Techniques</h2>
<ul>
    <li>Netbios and LLMNR Name Poisoning</li>
    <li>Relay attacks
        <ul>
            <li>SMB relay</li>
            <li>NTLM relay</li>
        </ul></li>
    <li>MS17-010</li>
    <li>Kerberoasting
        <ul>
            <li><a href="https://attack.mitre.org/techniques/T1558/003/">MITRE</a></li>
            <li><a href="https://www.scip.ch/en/?labs.20181011">scip.ch</a></li>
            <li><a href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1">Invoke-Kerberoast.ps1</a></li>
            <li><a href="http://www.harmj0y.net/blog/redteaming/kerberoasting-revisited/">harmj0y</a></li>
            <li><a href="https://docs.microsoft.com/en-us/advanced-threat-analytics/suspicious-activity-guide#encryption-downgrade-activity">Encryption downgrade activity</a></li>
        </ul></li>
    <li><a href="https://attack.mitre.org/techniques/T1558/001/">Golden Ticket</a>
        <ul>
            <li><a href="https://docs.microsoft.com/en-us/advanced-threat-analytics/suspicious-activity-guide#golden-ticket">Kerberos Golden Ticket activity</a></li>
        </ul></li>
    <li><a href="https://attack.mitre.org/techniques/T1558/002/">Silver Ticket</a></li>
    <li><a href="https://attack.mitre.org/techniques/T1558/004/">AS-REP Roasting</a></li>
    <li><a href="https://github.com/dirkjanm/mitm6">mitm6</a></li>
    <li><a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py">ntlmrelayx.py</a></li>
    <li><a href="https://github.com/ropnop/windapsearch">windapsearch</a></li>
    <li><a href="https://github.com/byt3bl33d3r/CrackMapExec">CrackMapExec</a></li>
    <li><a href="https://github.com/BloodHoundAD/BloodHound">BloodHound</a></li>
    <li><a href="https://github.com/gojhonny/CredCrack">CredCrack</a></li>
    <li><a href="https://github.com/ShawnDEvans/smbmap">smbmap</a></li>
    <li><a href="https://attack.mitre.org/techniques/T1087/002/">Domain Account</a></li>
    <li><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn745899(v=ws.11)">SMB Signing</a></li>
    <li><a href="https://nettools.net/download/">NetTools:The Swiss army knife of AD troubleshooting</a></li>
</ul>
