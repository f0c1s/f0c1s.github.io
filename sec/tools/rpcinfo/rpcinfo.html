<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
    <title>/f0c1s/blog/sec/tools/rpcinfo</title>
    <link rel="stylesheet" href="../../../index.css"/>
    <link rel="stylesheet" href="../../../highlight/styles/monokai.min.css"/>
    <script src="../../../highlight/highlight.min.js"></script>
    <script src="../../../setup.js"></script>
    <script>hljs.highlightAll();</script>
</head>
<body onload="setup()">

<h1>/f0c1s/blog/sec/tools/rpcinfo</h1>

<nav>
    <a href="../index.html">/blog</a>
    <a href="../../../sec/index.html">Security</a>
    <a href="../../../sec/tools/index.html">tools</a>
    <a href="../../../sec/tools/rpcinfo/rpcinfo.html">+ tool rpcinfo</a>
</nav>

<h1 id="tool-rpcinfo">tool rpcinfo</h1>
<pre class="shell"><code>rpcinfo — report RPC information</code></pre>
<p><a href="https://github.com/okirch/rpcbind/blob/master/src/rpcinfo.c">Source: https://github.com/okirch/rpcbind/blob/master/src/rpcinfo.c</a> <a href="http://git.linux-nfs.org/?p=steved/rpcbind.git;a=blob_plain;f=src/rpcinfo.c;hb=HEAD">Source: http://git.linux-nfs.org/?p=steved/rpcbind.git;a=blob_plain;f=src/rpcinfo.c;hb=HEAD</a></p>
<figure>
<img src="1.man-head.png" alt="" /><figcaption>1.man-head</figcaption>
</figure>
<h2 id="sample-usage">Sample Usage</h2>
<pre class="shell"><code>hostname -I: 192.168.42.7 192.168.56.70 
Wednesday 22 December 2021 09:34:09 AM IST 2021.12.22 09:34:09
f0c1s@kali:~/vuln-hubs/digitalworld.local/torment $
rpcinfo -p $RHOST | tee rpcinfo.txt
   program vers proto   port  service
    100000    4   tcp    111  portmapper
    100000    3   tcp    111  portmapper
    100000    2   tcp    111  portmapper
    100000    4   udp    111  portmapper
    100000    3   udp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp  59645  mountd
    100005    1   tcp  36921  mountd
    100005    2   udp  49086  mountd
    100005    2   tcp  41909  mountd
    100005    3   udp  53095  mountd
    100005    3   tcp  59577  mountd
    100003    3   tcp   2049  nfs
    100003    4   tcp   2049  nfs
    100227    3   tcp   2049
    100003    3   udp   2049  nfs
    100003    4   udp   2049  nfs
    100227    3   udp   2049
    100021    1   udp  36852  nlockmgr
    100021    3   udp  36852  nlockmgr
    100021    4   udp  36852  nlockmgr
    100021    1   tcp  33197  nlockmgr
    100021    3   tcp  33197  nlockmgr
    100021    4   tcp  33197  nlockmgr</code></pre>
<figure>
<img src="2.rpcinfo--p.png" alt="" /><figcaption>2.rpcinfo–p</figcaption>
</figure>
<pre class="shell"><code>rpcinfo -s $RHOST | tee rpcinfo.-s.txt
   program version(s) netid(s)                         service     owner
    100000  2,3,4     local,udp,tcp,udp6,tcp6          portmapper  superuser
    100005  3,2,1     tcp6,udp6,tcp,udp                mountd      superuser
    100003  4,3       udp6,tcp6,udp,tcp                nfs         superuser
    100227  3         udp6,tcp6,udp,tcp                -           superuser
    100021  4,3,1     tcp6,udp6,tcp,udp                nlockmgr    superuser
</code></pre>
<figure>
<img src="3.rpcinfo--s.png" alt="" /><figcaption>3.rpcinfo–s</figcaption>
</figure>
<pre class="shell"><code>rpcinfo -m $RHOST 
PORTMAP (version 2) statistics
NULL    SET     UNSET   GETPORT DUMP    CALLIT  
1       0/0     0/0     0/0     2       0/0     

RPCBIND (version 3) statistics
NULL    SET     UNSET   GETADDR DUMP    CALLIT  TIME    U2T     T2U     
0       12/12   3/3     0/0     2       0/0     0       0       0       

RPCBIND (version 4) statistics
NULL    SET     UNSET   GETADDR DUMP    CALLIT  TIME    U2T     T2U     
1       24/24   6/6     2/2     2       0/0     0       0       0       
VERADDR INDRECT GETLIST GETSTAT 
0       0       0       1       

RPCB_GETADDR (version 4) call statistics
prog            vers    netid     success       failure
portmapper      2       tcp       2             0
</code></pre>
<figure>
<img src="4.rpcinfo--m.png" alt="" /><figcaption>4.rpcinfo–m</figcaption>
</figure>
<h2 id="help">Help</h2>
<pre class="shell"><code>rpcinfo --help                     
rpcinfo: invalid option -- &#39;-&#39;
rpcinfo: invalid option -- &#39;h&#39;
rpcinfo: invalid option -- &#39;e&#39;
Usage: rpcinfo [-m | -s] [host]
       rpcinfo -p [host]
       rpcinfo -T netid host prognum [versnum]
       rpcinfo -l host prognum versnum
       rpcinfo [-n portnum] -u | -t host prognum [versnum]
       rpcinfo -a serv_address -T netid prognum [version]
       rpcinfo -b prognum versnum
       rpcinfo -d [-T netid] prognum versnum
</code></pre>
<h2 id="man-page">Man page</h2>
<pre class="shell"><code>RPCINFO(8)                                 BSD System Manager&#39;s Manual                                RPCINFO(8)

NAME
     rpcinfo — report RPC information

SYNOPSIS
     rpcinfo [-m | -s] [host]
     rpcinfo -p [host]
     rpcinfo -T transport host prognum [versnum]
     rpcinfo -l [-T transport] host prognum versnum
     rpcinfo [-n portnum] -u host prognum [versnum]
     rpcinfo [-n portnum] [-t] host prognum [versnum]
     rpcinfo -a serv_address -T transport prognum [versnum]
     rpcinfo -b [-T transport] prognum versnum
     rpcinfo -d [-T transport] prognum versnum

DESCRIPTION
     rpcinfo makes an RPC call to an RPC server and reports what it finds.

     In the first synopsis, rpcinfo lists all the registered RPC services with rpcbind on host.  If host is not
     specified, the local host is the default.  If -s is used, the information is displayed in a concise format.

     In the second synopsis, rpcinfo lists all the RPC services registered with rpcbind, version 2.  Also note
     that the format of the information is different in the first and the second synopsis.  This is because the
     second synopsis is an older protocol used to collect the information displayed (version 2 of the rpcbind
     protocol).

     The third synopsis makes an RPC call to procedure 0 of prognum and versnum on the specified host and re‐
     ports whether a response was received.  transport is the transport which has to be used for contacting the
     given service.  The remote address of the service is obtained by making a call to the remote rpcbind.

     The prognum argument is a number that represents an RPC program number.  If a versnum is specified, rpcinfo
     attempts to call that version of the specified prognum.  Otherwise, rpcinfo attempts to find all the regis‐
     tered version numbers for the specified prognum by calling version 0, which is presumed not to exist; if it
     does exist, rpcinfo attempts to obtain this information by calling an extremely high version number in‐
     stead, and attempts to call each registered version.  Note: the version number is required for -b and -d
     options.

OPTIONS
     -T transport
             Specify the transport on which the service is required.  If this option is not specified, rpcinfo
             uses the transport specified in the NETPATH environment variable, or if that is unset or null, the
             transport in the netconfig(5) database is used.  This is a generic option, and can be used in con‐
             junction with other options as shown in the SYNOPSIS.

     -a serv_address
             Use serv_address as the (universal) address for the service on transport to ping procedure 0 of the
             specified prognum and report whether a response was received.  The -T option is required with the
             -a option.

             If versnum is not specified, rpcinfo tries to ping all available version numbers for that program
             number.  This option avoids calls to remote rpcbind to find the address of the service.  The
             serv_address is specified in universal address format of the given transport.

     -b      Make an RPC broadcast to procedure 0 of the specified prognum and versnum and report all hosts that
             respond.  If transport is specified, it broadcasts its request only on the specified transport.  If
             broadcasting is not supported by any transport, an error message is printed.  Use of broadcasting
             should be limited because of the potential for adverse effect on other systems.

     -d      Delete registration for the RPC service of the specified prognum and versnum.  If transport is
             specified, unregister the service on only that transport, otherwise unregister the service on all
             the transports on which it was registered.  Only the owner of a service can delete a registration,
             except the super-user who can delete any service.

     -l      Display a list of entries with a given prognum and versnum on the specified host.  Entries are re‐
             turned for all transports in the same protocol family as that used to contact the remote rpcbind.

     -m      Display a table of statistics of rpcbind operations on the given host.  The table shows statistics
             for each version of rpcbind (versions 2, 3 and 4), giving the number of times each procedure was
             requested and successfully serviced, the number and type of remote call requests that were made,
             and information about RPC address lookups that were handled. This is useful for monitoring RPC ac‐
             tivities on host.

     -n portnum
             Use portnum as the port number for the -t and -u options instead of the port number given by
             rpcbind.  Use of this option avoids a call to the remote rpcbind to find out the address of the
             service. This option is made obsolete by the -a option.

     -p      Probe rpcbind on host using version 2 of the rpcbind protocol, and display a list of all registered
             RPC programs.  If host is not specified, it defaults to the local host.  Note: Version 2 of the
             rpcbind protocol was previously known as the portmapper protocol.

     -s      Display a concise list of all registered RPC programs on host.  If host is not specified, it de‐
             faults to the local host.

     -t      Make an RPC call to procedure 0 of prognum on the specified host using TCP, and report whether a
             response was received. This option is made obsolete by the -T option as shown in the third synop‐
             sis.

     -u      Make an RPC call to procedure 0 of prognum on the specified host using UDP, and report whether a
             response was received. This option is made obsolete by the -T option as shown in the third synop‐
             sis.

EXAMPLES
     To show all of the RPC services registered on the local machine use:

             example% rpcinfo

     To show all of the RPC services registered with rpcbind on the machine named klaxon use:

             example% rpcinfo klaxon

     The information displayed by the above commands can be quite lengthy.  Use the -s option to display a more
     concise list:

             example$ rpcinfo -s klaxon

     program   version   netid                     service    owner
     100000    2,3,4     local,tcp,udp,tcp6,udp6   rpcbind    super-user
     100008    1         udp,tcp,udp6,tcp6         walld      super-user
     100002    2,1       udp,udp6                  rusersd    super-user
     100001    2,3,4     udp,udp6                  rstatd     super-user
     100012    1         udp,tcp                   sprayd     super-user
     100007    3         udp,tcp                   ypbind     super-user

     To show whether the RPC service with program number prognum and version versnum is registered on the ma‐
     chine named klaxon for the transport TCP use:

             example% rpcinfo -T tcp klaxon prognum versnum

     To show all RPC services registered with version 2 of the rpcbind protocol on the local machine use:

             example% rpcinfo -p

     To delete the registration for version 1 of the walld (program number 100008 ) service for all transports
     use:

             example# rpcinfo -d 100008 1

     or

             example# rpcinfo -d walld 1

SEE ALSO
     rpc(3), netconfig(5), rpc(5), rpcbind(8)

                                                 August 18, 1992</code></pre>
<h2 id="source-code">source code</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="co"> * Copyright (c) 2009, Sun Microsystems, Inc.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="co"> * All rights reserved.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="co"> *</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="co"> * Redistribution and use in source and binary forms, with or without</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a><span class="co"> * modification, are permitted provided that the following conditions are met:</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="co"> * - Redistributions of source code must retain the above copyright notice,</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a><span class="co"> *   this list of conditions and the following disclaimer.</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a><span class="co"> * - Redistributions in binary form must reproduce the above copyright notice,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a><span class="co"> *   this list of conditions and the following disclaimer in the documentation</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a><span class="co"> *   and/or other materials provided with the distribution.</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a><span class="co"> * - Neither the name of Sun Microsystems, Inc. nor the names of its</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a><span class="co"> *   contributors may be used to endorse or promote products derived</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a><span class="co"> *   from this software without specific prior written permission.</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a><span class="co"> *</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a><span class="co"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a><span class="co"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a><span class="co"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a><span class="co"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a><span class="co"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a><span class="co"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a><span class="co"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a><span class="co"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true"></a><span class="co"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true"></a><span class="co"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true"></a><span class="co"> * POSSIBILITY OF SUCH DAMAGE.</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true"></a><span class="co"> * Copyright (c) 1986 - 1991 by Sun Microsystems, Inc.</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true"></a><span class="co"> * rpcinfo: ping a particular rpc program</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true"></a><span class="co"> *  or dump the the registered programs on the remote machine.</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true"></a><span class="co"> * We are for now defining PORTMAP here.  It doesnt even compile</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true"></a><span class="co"> * unless it is defined.</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true"></a><span class="pp">#ifndef PORTMAP</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true"></a><span class="pp">#define PORTMAP</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true"></a><span class="co"> * If PORTMAP is defined, rpcinfo will talk to both portmapper and</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true"></a><span class="co"> * rpcbind programs; else it talks only to rpcbind. In the latter case</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true"></a><span class="co"> * all the portmapper specific options such as -u, -t, -p become void.</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;sys/un.h&gt;</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;rpc/rpc.h&gt;</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;rpc/rpcb_prot.h&gt;</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;rpc/rpcent.h&gt;</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;rpc/nettype.h&gt;</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;rpc/rpc_com.h&gt;</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;err.h&gt;</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;ctype.h&gt;</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP          </span><span class="co">/* Support for version 2 portmapper */</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;netinet/in.h&gt;</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;netdb.h&gt;</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;rpc/pmap_prot.h&gt;</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;rpc/pmap_clnt.h&gt;</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true"></a><span class="pp">#define max(a,b) ((a) &gt; (b) ? (a) : (b))</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true"></a></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true"></a><span class="pp">#define MIN_VERS    ((u_long)0)</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true"></a><span class="pp">#define MAX_VERS    ((u_long)4294967295UL)</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true"></a><span class="pp">#define UNKNOWN     &quot;unknown&quot;</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true"></a><span class="co"> * Functions to be performed.</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true"></a><span class="pp">#define NONE        0   </span><span class="co">/* no function */</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true"></a><span class="pp">#define PMAPDUMP    1   </span><span class="co">/* dump portmapper registrations */</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true"></a><span class="pp">#define TCPPING     2   </span><span class="co">/* ping TCP service */</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true"></a><span class="pp">#define UDPPING     3   </span><span class="co">/* ping UDP service */</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true"></a><span class="pp">#define BROADCAST   4   </span><span class="co">/* ping broadcast service */</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true"></a><span class="pp">#define DELETES     5   </span><span class="co">/* delete registration for the service */</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true"></a><span class="pp">#define ADDRPING    6   </span><span class="co">/* pings at the given address */</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true"></a><span class="pp">#define PROGPING    7   </span><span class="co">/* pings a program on a given host */</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true"></a><span class="pp">#define RPCBDUMP    8   </span><span class="co">/* dump rpcbind registrations */</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true"></a><span class="pp">#define RPCBDUMP_SHORT  9   </span><span class="co">/* dump rpcbind registrations - short version */</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true"></a><span class="pp">#define RPCBADDRLIST    10  </span><span class="co">/* dump addr list about one prog */</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true"></a><span class="pp">#define RPCBGETSTAT 11  </span><span class="co">/* Get statistics */</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true"></a></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true"></a><span class="kw">struct</span> netidlist</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true"></a>{</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true"></a>  <span class="dt">char</span> *netid;</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true"></a>  <span class="kw">struct</span> netidlist *next;</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true"></a>};</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true"></a></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true"></a><span class="kw">struct</span> verslist</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true"></a>{</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true"></a>  <span class="dt">int</span> vers;</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true"></a>  <span class="kw">struct</span> verslist *next;</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true"></a>};</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true"></a><span class="kw">struct</span> rpcbdump_short</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true"></a>{</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true"></a>  u_long prog;</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true"></a>  <span class="kw">struct</span> verslist *vlist;</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true"></a>  <span class="kw">struct</span> netidlist *nlist;</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true"></a>  <span class="kw">struct</span> rpcbdump_short *next;</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true"></a>  <span class="dt">char</span> *owner;</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true"></a>};</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true"></a></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true"></a></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> ip_ping (u_short, <span class="dt">char</span> *, <span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> pmapdump (<span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true"></a><span class="dt">static</span> CLIENT *ip_getclient(<span class="dt">const</span> <span class="dt">char</span> *hostname, rpcprog_t prognum, rpcvers_t versnum, <span class="dt">const</span> <span class="dt">char</span> *proto);</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true"></a><span class="dt">static</span> bool_t reply_proc (<span class="dt">void</span> *, <span class="kw">struct</span> netbuf *, <span class="kw">struct</span> netconfig *);</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> brdcst (<span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> addrping (<span class="dt">char</span> *, <span class="dt">char</span> *, <span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> progping (<span class="dt">char</span> *, <span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true"></a><span class="dt">static</span> CLIENT *clnt_addr_create (<span class="dt">char</span> *, <span class="kw">struct</span> netconfig *, u_long, u_long);</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true"></a><span class="dt">static</span> CLIENT *clnt_rpcbind_create (<span class="dt">char</span> *, <span class="dt">int</span>, <span class="kw">struct</span> netbuf **);</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true"></a><span class="dt">static</span> CLIENT *getclnthandle (<span class="dt">char</span> *, <span class="kw">struct</span> netconfig *, u_long,</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true"></a>                  <span class="kw">struct</span> netbuf **);</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">int</span> pstatus (CLIENT *, u_long, u_long);</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> rpcbdump (<span class="dt">int</span>, <span class="dt">char</span> *, <span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> rpcbgetstat (<span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> rpcbaddrlist (<span class="dt">char</span> *, <span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> deletereg (<span class="dt">char</span> *, <span class="dt">int</span>, <span class="dt">char</span> **);</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> print_rmtcallstat (<span class="dt">int</span>, rpcb_stat *);</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> print_getaddrstat (<span class="dt">int</span>, rpcb_stat *);</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span> usage (<span class="dt">void</span>);</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true"></a><span class="dt">static</span> u_long getprognum (<span class="dt">char</span> *);</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true"></a><span class="dt">static</span> u_long getvers (<span class="dt">char</span> *);</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">char</span> *spaces (<span class="dt">int</span>);</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true"></a><span class="dt">static</span> bool_t add_version (<span class="kw">struct</span> rpcbdump_short *, u_long);</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true"></a><span class="dt">static</span> bool_t add_netid (<span class="kw">struct</span> rpcbdump_short *, <span class="dt">char</span> *);</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true"></a></span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true"></a><span class="dt">int</span> main (<span class="dt">int</span> argc, <span class="dt">char</span> **argv);</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true"></a></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true"></a><span class="dt">int</span></span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true"></a>main (<span class="dt">int</span> argc, <span class="dt">char</span> **argv)</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true"></a>{</span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true"></a>  <span class="dt">register</span> <span class="dt">int</span> c;</span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true"></a>  <span class="dt">int</span> errflg;</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true"></a>  <span class="dt">int</span> function;</span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true"></a>  <span class="dt">char</span> *netid = NULL;</span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true"></a>  <span class="dt">char</span> *address = NULL;</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true"></a>  <span class="dt">char</span> *strptr;</span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true"></a>  u_short portnum = <span class="dv">0</span>;</span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true"></a></span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true"></a>  function = NONE;</span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true"></a>  errflg = <span class="dv">0</span>;</span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true"></a>  <span class="cf">while</span> ((c = getopt (argc, argv, <span class="st">&quot;a:bdlmn:pstT:u&quot;</span>)) != -<span class="dv">1</span>)</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true"></a><span class="pp">#else</span></span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true"></a>  <span class="cf">while</span> ((c = getopt (argc, argv, <span class="st">&quot;a:bdlmn:sT:&quot;</span>)) != -<span class="dv">1</span>)</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true"></a>    {</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true"></a>      <span class="cf">switch</span> (c)</span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true"></a>    {</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;p&#39;</span>:</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true"></a>        function = PMAPDUMP;</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true"></a></span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;t&#39;</span>:</span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true"></a>        function = TCPPING;</span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true"></a></span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;u&#39;</span>:</span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true"></a>        function = UDPPING;</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true"></a></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;n&#39;</span>:</span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true"></a>      portnum = (u_short) strtol (optarg, &amp;strptr, <span class="dv">10</span>);</span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true"></a>      <span class="cf">if</span> (strptr == optarg || *strptr != <span class="ch">&#39;\0&#39;</span>)</span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true"></a>        {</span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true"></a>          fprintf (stderr, <span class="st">&quot;rpcinfo: %s is illegal port number</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true"></a>               optarg);</span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true"></a>          exit (<span class="dv">1</span>);</span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true"></a>        }</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true"></a></span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;a&#39;</span>:</span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true"></a>      address = optarg;</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true"></a>        function = ADDRPING;</span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true"></a></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;b&#39;</span>:</span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true"></a>        function = BROADCAST;</span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true"></a></span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;d&#39;</span>:</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true"></a>        function = DELETES;</span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true"></a></span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;l&#39;</span>:</span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true"></a>        function = RPCBADDRLIST;</span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true"></a></span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;m&#39;</span>:</span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true"></a>        function = RPCBGETSTAT;</span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true"></a></span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;s&#39;</span>:</span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true"></a>      <span class="cf">if</span> (function != NONE)</span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true"></a>        errflg = <span class="dv">1</span>;</span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true"></a>        function = RPCBDUMP_SHORT;</span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true"></a></span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;T&#39;</span>:</span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true"></a>      netid = optarg;</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true"></a>    <span class="cf">case</span> <span class="ch">&#39;?&#39;</span>:</span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true"></a>      errflg = <span class="dv">1</span>;</span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true"></a>    }</span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true"></a>    }</span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true"></a></span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true"></a>  <span class="cf">if</span> (errflg || ((function == ADDRPING) &amp;&amp; !netid))</span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true"></a>    {</span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true"></a>      <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true"></a>    }</span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true"></a></span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true"></a>  <span class="cf">if</span> (function == NONE)</span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true"></a>    {</span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true"></a>      <span class="cf">if</span> (argc - optind &gt; <span class="dv">1</span>)</span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true"></a>    function = PROGPING;</span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true"></a>    function = RPCBDUMP;</span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true"></a>    }</span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true"></a></span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true"></a>  <span class="cf">switch</span> (function)</span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true"></a>    {</span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true"></a>    <span class="cf">case</span> PMAPDUMP:</span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true"></a>      <span class="cf">if</span> (portnum != <span class="dv">0</span>)</span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true"></a>    {</span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true"></a>      <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true"></a>    }</span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true"></a>      pmapdump (argc - optind, argv + optind);</span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true"></a></span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true"></a>    <span class="cf">case</span> UDPPING:</span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true"></a>      ip_ping (portnum, <span class="st">&quot;udp&quot;</span>, argc - optind, argv + optind);</span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true"></a></span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true"></a>    <span class="cf">case</span> TCPPING:</span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true"></a>      ip_ping (portnum, <span class="st">&quot;tcp&quot;</span>, argc - optind, argv + optind);</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true"></a>    <span class="cf">case</span> BROADCAST:</span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true"></a>      brdcst (argc - optind, argv + optind);</span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true"></a>    <span class="cf">case</span> DELETES:</span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true"></a>      deletereg (netid, argc - optind, argv + optind);</span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true"></a>    <span class="cf">case</span> ADDRPING:</span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true"></a>      addrping (address, netid, argc - optind, argv + optind);</span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true"></a>    <span class="cf">case</span> PROGPING:</span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true"></a>      progping (netid, argc - optind, argv + optind);</span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true"></a>    <span class="cf">case</span> RPCBDUMP:</span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true"></a>    <span class="cf">case</span> RPCBDUMP_SHORT:</span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true"></a>      rpcbdump (function, netid, argc - optind, argv + optind);</span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true"></a>    <span class="cf">case</span> RPCBGETSTAT:</span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true"></a>      rpcbgetstat (argc - optind, argv + optind);</span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true"></a>    <span class="cf">case</span> RPCBADDRLIST:</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true"></a>      rpcbaddrlist (netid, argc - optind, argv + optind);</span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true"></a>    }</span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true"></a>  <span class="cf">return</span> (<span class="dv">0</span>);</span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true"></a>}</span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true"></a></span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true"></a><span class="dt">static</span> CLIENT *</span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true"></a>local_rpcb (rpcprog_t prog, rpcvers_t vers)</span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true"></a>{</span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true"></a><span class="pp">#if 0</span></span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true"></a><span class="co">  void *localhandle;</span></span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true"></a><span class="co">  struct netconfig *nconf;</span></span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true"></a><span class="co">  CLIENT *clnt;</span></span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true"></a></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true"></a><span class="co">  localhandle = setnetconfig();</span></span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true"></a><span class="co">  while ((nconf = getnetconfig(localhandle)) != NULL) {</span></span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true"></a><span class="co">    if (nconf-&gt;nc_protofmly != NULL &amp;&amp;</span></span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true"></a><span class="co">    strcmp(nconf-&gt;nc_protofmly, NC_LOOPBACK) == 0)</span></span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true"></a><span class="co">      break;</span></span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true"></a><span class="co">  }</span></span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true"></a><span class="co">  if (nconf == NULL) {</span></span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true"></a><span class="co">    warnx(</span><span class="st">&quot;getnetconfig: %s&quot;</span><span class="co">, nc_sperror());</span></span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true"></a><span class="co">    return (NULL);</span></span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true"></a><span class="co">  }</span></span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true"></a></span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true"></a><span class="co">  clnt = clnt_tp_create (/* &quot;localhost&quot;*/ NULL, prog, vers, nconf);</span></span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true"></a><span class="co">  endnetconfig(localhandle);</span></span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true"></a><span class="co">  return clnt;</span></span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true"></a><span class="pp">#else</span></span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true"></a>  <span class="kw">struct</span> netbuf nbuf;</span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true"></a>  <span class="kw">struct</span> sockaddr_un sun;</span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true"></a>  <span class="dt">int</span> sock;</span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true"></a></span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true"></a>  memset (&amp;sun, <span class="dv">0</span>, <span class="kw">sizeof</span> sun);</span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true"></a>  sock = socket (AF_LOCAL, SOCK_STREAM, <span class="dv">0</span>);</span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true"></a>  <span class="cf">if</span> (sock &lt; <span class="dv">0</span>)</span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true"></a>    <span class="cf">return</span> NULL;</span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true"></a></span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true"></a>  sun.sun_family = AF_LOCAL;</span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true"></a>  strcpy (sun.sun_path, _PATH_RPCBINDSOCK);</span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true"></a>  nbuf.len = SUN_LEN (&amp;sun);</span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true"></a>  nbuf.maxlen = <span class="kw">sizeof</span> (<span class="kw">struct</span> sockaddr_un);</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true"></a>  nbuf.buf = &amp;sun;</span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true"></a></span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true"></a>  <span class="cf">return</span> clnt_vc_create (sock, &amp;nbuf, prog, vers, <span class="dv">0</span>, <span class="dv">0</span>);</span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true"></a>}</span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true"></a></span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true"></a><span class="dt">static</span> <span class="kw">enum</span> clnt_stat</span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true"></a>ip_ping_one(client, vers)</span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true"></a>     CLIENT *client;</span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true"></a>     u_int32_t vers;</span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true"></a>{</span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true"></a>  <span class="kw">struct</span> timeval to = { .tv_sec = <span class="dv">10</span>, .tv_usec = <span class="dv">0</span> };</span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true"></a></span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true"></a>  (<span class="dt">void</span>) CLNT_CONTROL (client, CLSET_VERS, &amp;vers);</span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true"></a>  <span class="cf">return</span> CLNT_CALL (client, NULLPROC, (xdrproc_t) xdr_void,</span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true"></a>            (<span class="dt">char</span> *) NULL, (xdrproc_t) xdr_void, (<span class="dt">char</span> *) NULL,</span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true"></a>            to);</span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true"></a>}</span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true"></a></span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true"></a><span class="co"> * If portnum is 0, then go and get the address from portmapper, which happens</span></span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true"></a><span class="co"> * transparently through clnt*_create(); If version number is not given, it</span></span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true"></a><span class="co"> * tries to find out the version number by making a call to version 0 and if</span></span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true"></a><span class="co"> * that fails, it obtains the high order and the low order version number. If</span></span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true"></a><span class="co"> * version 0 calls succeeds, it tries for MAXVERS call and repeats the same.</span></span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true"></a>ip_ping (portnum, proto, argc, argv)</span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true"></a>     u_short portnum;</span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true"></a>     <span class="dt">char</span> *proto;</span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true"></a>{</span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true"></a>  CLIENT *client;</span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true"></a>  <span class="kw">enum</span> clnt_stat rpc_stat;</span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true"></a>  <span class="dt">const</span> <span class="dt">char</span> *hostname;</span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true"></a>  u_long prognum, vers, minvers, maxvers;</span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true"></a>  <span class="kw">struct</span> rpc_err rpcerr;</span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true"></a>  <span class="dt">int</span> failure = <span class="dv">0</span>;</span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true"></a></span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true"></a>  <span class="cf">if</span> (argc &lt; <span class="dv">2</span> || argc &gt; <span class="dv">3</span>)</span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true"></a>    {</span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true"></a>    }</span>
<span id="cb7-396"><a href="#cb7-396" aria-hidden="true"></a></span>
<span id="cb7-397"><a href="#cb7-397" aria-hidden="true"></a>  hostname = argv[<span class="dv">0</span>];</span>
<span id="cb7-398"><a href="#cb7-398" aria-hidden="true"></a>  prognum = getprognum (argv[<span class="dv">1</span>]);</span>
<span id="cb7-399"><a href="#cb7-399" aria-hidden="true"></a>  <span class="cf">if</span> (argc == <span class="dv">2</span>)</span>
<span id="cb7-400"><a href="#cb7-400" aria-hidden="true"></a>    {               <span class="co">/* Version number not known */</span></span>
<span id="cb7-401"><a href="#cb7-401" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-402"><a href="#cb7-402" aria-hidden="true"></a><span class="co">       * A call to version 0 should fail with a program/version</span></span>
<span id="cb7-403"><a href="#cb7-403" aria-hidden="true"></a><span class="co">       * mismatch, and give us the range of versions supported.</span></span>
<span id="cb7-404"><a href="#cb7-404" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-405"><a href="#cb7-405" aria-hidden="true"></a>      vers = MIN_VERS;</span>
<span id="cb7-406"><a href="#cb7-406" aria-hidden="true"></a>    }</span>
<span id="cb7-407"><a href="#cb7-407" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-408"><a href="#cb7-408" aria-hidden="true"></a>    {</span>
<span id="cb7-409"><a href="#cb7-409" aria-hidden="true"></a>      vers = getvers (argv[<span class="dv">2</span>]);</span>
<span id="cb7-410"><a href="#cb7-410" aria-hidden="true"></a>    }</span>
<span id="cb7-411"><a href="#cb7-411" aria-hidden="true"></a></span>
<span id="cb7-412"><a href="#cb7-412" aria-hidden="true"></a>  client = ip_getclient(hostname, prognum, vers, proto);</span>
<span id="cb7-413"><a href="#cb7-413" aria-hidden="true"></a></span>
<span id="cb7-414"><a href="#cb7-414" aria-hidden="true"></a>  rpc_stat = ip_ping_one(client, vers);</span>
<span id="cb7-415"><a href="#cb7-415" aria-hidden="true"></a>  <span class="cf">if</span> (argc != <span class="dv">2</span>)</span>
<span id="cb7-416"><a href="#cb7-416" aria-hidden="true"></a>    {</span>
<span id="cb7-417"><a href="#cb7-417" aria-hidden="true"></a>      <span class="co">/* Version number was known */</span></span>
<span id="cb7-418"><a href="#cb7-418" aria-hidden="true"></a>      <span class="cf">if</span> (pstatus (client, prognum, vers) &lt; <span class="dv">0</span>)</span>
<span id="cb7-419"><a href="#cb7-419" aria-hidden="true"></a>    exit (<span class="dv">1</span>);</span>
<span id="cb7-420"><a href="#cb7-420" aria-hidden="true"></a>      (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-421"><a href="#cb7-421" aria-hidden="true"></a>      <span class="cf">return</span>;</span>
<span id="cb7-422"><a href="#cb7-422" aria-hidden="true"></a>    }</span>
<span id="cb7-423"><a href="#cb7-423" aria-hidden="true"></a></span>
<span id="cb7-424"><a href="#cb7-424" aria-hidden="true"></a>  <span class="co">/* Version number not known */</span></span>
<span id="cb7-425"><a href="#cb7-425" aria-hidden="true"></a>  <span class="cf">if</span> (rpc_stat == RPC_PROGVERSMISMATCH)</span>
<span id="cb7-426"><a href="#cb7-426" aria-hidden="true"></a>    {</span>
<span id="cb7-427"><a href="#cb7-427" aria-hidden="true"></a>      clnt_geterr (client, &amp;rpcerr);</span>
<span id="cb7-428"><a href="#cb7-428" aria-hidden="true"></a>      minvers = rpcerr.re_vers.low;</span>
<span id="cb7-429"><a href="#cb7-429" aria-hidden="true"></a>      maxvers = rpcerr.re_vers.high;</span>
<span id="cb7-430"><a href="#cb7-430" aria-hidden="true"></a>    }</span>
<span id="cb7-431"><a href="#cb7-431" aria-hidden="true"></a>  <span class="cf">else</span> <span class="cf">if</span> (rpc_stat == RPC_SUCCESS)</span>
<span id="cb7-432"><a href="#cb7-432" aria-hidden="true"></a>    {</span>
<span id="cb7-433"><a href="#cb7-433" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-434"><a href="#cb7-434" aria-hidden="true"></a><span class="co">       * Oh dear, it DOES support version 0.</span></span>
<span id="cb7-435"><a href="#cb7-435" aria-hidden="true"></a><span class="co">       * Let&#39;s try version MAX_VERS.</span></span>
<span id="cb7-436"><a href="#cb7-436" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-437"><a href="#cb7-437" aria-hidden="true"></a>      rpc_stat = ip_ping_one(client, MAX_VERS);</span>
<span id="cb7-438"><a href="#cb7-438" aria-hidden="true"></a>      <span class="cf">if</span> (rpc_stat == RPC_PROGVERSMISMATCH)</span>
<span id="cb7-439"><a href="#cb7-439" aria-hidden="true"></a>    {</span>
<span id="cb7-440"><a href="#cb7-440" aria-hidden="true"></a>      clnt_geterr (client, &amp;rpcerr);</span>
<span id="cb7-441"><a href="#cb7-441" aria-hidden="true"></a>      minvers = rpcerr.re_vers.low;</span>
<span id="cb7-442"><a href="#cb7-442" aria-hidden="true"></a>      maxvers = rpcerr.re_vers.high;</span>
<span id="cb7-443"><a href="#cb7-443" aria-hidden="true"></a>    }</span>
<span id="cb7-444"><a href="#cb7-444" aria-hidden="true"></a>      <span class="cf">else</span> <span class="cf">if</span> (rpc_stat == RPC_SUCCESS)</span>
<span id="cb7-445"><a href="#cb7-445" aria-hidden="true"></a>    {</span>
<span id="cb7-446"><a href="#cb7-446" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-447"><a href="#cb7-447" aria-hidden="true"></a><span class="co">       * It also supports version MAX_VERS.</span></span>
<span id="cb7-448"><a href="#cb7-448" aria-hidden="true"></a><span class="co">       * Looks like we have a wise guy.</span></span>
<span id="cb7-449"><a href="#cb7-449" aria-hidden="true"></a><span class="co">       * OK, we give them information on all</span></span>
<span id="cb7-450"><a href="#cb7-450" aria-hidden="true"></a><span class="co">       * 4 billion versions they support...</span></span>
<span id="cb7-451"><a href="#cb7-451" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-452"><a href="#cb7-452" aria-hidden="true"></a>      minvers = <span class="dv">0</span>;</span>
<span id="cb7-453"><a href="#cb7-453" aria-hidden="true"></a>      maxvers = MAX_VERS;</span>
<span id="cb7-454"><a href="#cb7-454" aria-hidden="true"></a>    }</span>
<span id="cb7-455"><a href="#cb7-455" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-456"><a href="#cb7-456" aria-hidden="true"></a>    {</span>
<span id="cb7-457"><a href="#cb7-457" aria-hidden="true"></a>      (<span class="dt">void</span>) pstatus (client, prognum, MAX_VERS);</span>
<span id="cb7-458"><a href="#cb7-458" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-459"><a href="#cb7-459" aria-hidden="true"></a>    }</span>
<span id="cb7-460"><a href="#cb7-460" aria-hidden="true"></a>    }</span>
<span id="cb7-461"><a href="#cb7-461" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-462"><a href="#cb7-462" aria-hidden="true"></a>    {</span>
<span id="cb7-463"><a href="#cb7-463" aria-hidden="true"></a>      (<span class="dt">void</span>) pstatus (client, prognum, (u_long) <span class="dv">0</span>);</span>
<span id="cb7-464"><a href="#cb7-464" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-465"><a href="#cb7-465" aria-hidden="true"></a>    }</span>
<span id="cb7-466"><a href="#cb7-466" aria-hidden="true"></a>  <span class="cf">for</span> (vers = minvers; vers &lt;= maxvers; vers++)</span>
<span id="cb7-467"><a href="#cb7-467" aria-hidden="true"></a>    {</span>
<span id="cb7-468"><a href="#cb7-468" aria-hidden="true"></a>      rpc_stat = ip_ping_one(client, vers);</span>
<span id="cb7-469"><a href="#cb7-469" aria-hidden="true"></a>      <span class="cf">if</span> (pstatus (client, prognum, vers) &lt; <span class="dv">0</span>)</span>
<span id="cb7-470"><a href="#cb7-470" aria-hidden="true"></a>    failure = <span class="dv">1</span>;</span>
<span id="cb7-471"><a href="#cb7-471" aria-hidden="true"></a>    }</span>
<span id="cb7-472"><a href="#cb7-472" aria-hidden="true"></a>  <span class="cf">if</span> (failure)</span>
<span id="cb7-473"><a href="#cb7-473" aria-hidden="true"></a>    exit (<span class="dv">1</span>);</span>
<span id="cb7-474"><a href="#cb7-474" aria-hidden="true"></a>  (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-475"><a href="#cb7-475" aria-hidden="true"></a>  <span class="cf">return</span>;</span>
<span id="cb7-476"><a href="#cb7-476" aria-hidden="true"></a>}</span>
<span id="cb7-477"><a href="#cb7-477" aria-hidden="true"></a></span>
<span id="cb7-478"><a href="#cb7-478" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-479"><a href="#cb7-479" aria-hidden="true"></a><span class="co"> * Dump all the portmapper registerations</span></span>
<span id="cb7-480"><a href="#cb7-480" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-481"><a href="#cb7-481" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-482"><a href="#cb7-482" aria-hidden="true"></a>pmapdump (argc, argv)</span>
<span id="cb7-483"><a href="#cb7-483" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-484"><a href="#cb7-484" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-485"><a href="#cb7-485" aria-hidden="true"></a>{</span>
<span id="cb7-486"><a href="#cb7-486" aria-hidden="true"></a>  <span class="kw">struct</span> pmaplist *head = NULL;</span>
<span id="cb7-487"><a href="#cb7-487" aria-hidden="true"></a>  <span class="kw">struct</span> timeval minutetimeout;</span>
<span id="cb7-488"><a href="#cb7-488" aria-hidden="true"></a>  <span class="dt">register</span> CLIENT *client;</span>
<span id="cb7-489"><a href="#cb7-489" aria-hidden="true"></a>  <span class="kw">struct</span> rpcent *rpc;</span>
<span id="cb7-490"><a href="#cb7-490" aria-hidden="true"></a>  <span class="kw">enum</span> clnt_stat clnt_st;</span>
<span id="cb7-491"><a href="#cb7-491" aria-hidden="true"></a>  <span class="kw">struct</span> rpc_err err;</span>
<span id="cb7-492"><a href="#cb7-492" aria-hidden="true"></a>  <span class="dt">char</span> *host = NULL;</span>
<span id="cb7-493"><a href="#cb7-493" aria-hidden="true"></a></span>
<span id="cb7-494"><a href="#cb7-494" aria-hidden="true"></a>  <span class="cf">if</span> (argc &gt; <span class="dv">1</span>)</span>
<span id="cb7-495"><a href="#cb7-495" aria-hidden="true"></a>    {</span>
<span id="cb7-496"><a href="#cb7-496" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-497"><a href="#cb7-497" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-498"><a href="#cb7-498" aria-hidden="true"></a>    }</span>
<span id="cb7-499"><a href="#cb7-499" aria-hidden="true"></a>  <span class="cf">if</span> (argc == <span class="dv">1</span>)</span>
<span id="cb7-500"><a href="#cb7-500" aria-hidden="true"></a>    {</span>
<span id="cb7-501"><a href="#cb7-501" aria-hidden="true"></a>      host = argv[<span class="dv">0</span>];</span>
<span id="cb7-502"><a href="#cb7-502" aria-hidden="true"></a></span>
<span id="cb7-503"><a href="#cb7-503" aria-hidden="true"></a>      <span class="co">/* This is a little bit more complicated than it should be.</span></span>
<span id="cb7-504"><a href="#cb7-504" aria-hidden="true"></a><span class="co">       * ip_getclient will do an rpcb_getaddr call to identify the</span></span>
<span id="cb7-505"><a href="#cb7-505" aria-hidden="true"></a><span class="co">       * port of the portmapper - but it works, and it&#39;s easier than</span></span>
<span id="cb7-506"><a href="#cb7-506" aria-hidden="true"></a><span class="co">       * creating a copy of ip_getclient that avoids the getaddr call.</span></span>
<span id="cb7-507"><a href="#cb7-507" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-508"><a href="#cb7-508" aria-hidden="true"></a>      client = ip_getclient(host, PMAPPROG, PMAPVERS, <span class="st">&quot;tcp&quot;</span>);</span>
<span id="cb7-509"><a href="#cb7-509" aria-hidden="true"></a>    }</span>
<span id="cb7-510"><a href="#cb7-510" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-511"><a href="#cb7-511" aria-hidden="true"></a>    client = local_rpcb (PMAPPROG, PMAPVERS);</span>
<span id="cb7-512"><a href="#cb7-512" aria-hidden="true"></a></span>
<span id="cb7-513"><a href="#cb7-513" aria-hidden="true"></a>  <span class="cf">if</span> (client == NULL)</span>
<span id="cb7-514"><a href="#cb7-514" aria-hidden="true"></a>    {</span>
<span id="cb7-515"><a href="#cb7-515" aria-hidden="true"></a>      <span class="cf">if</span> (rpc_createerr.cf_stat == RPC_TLIERROR)</span>
<span id="cb7-516"><a href="#cb7-516" aria-hidden="true"></a>    {</span>
<span id="cb7-517"><a href="#cb7-517" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-518"><a href="#cb7-518" aria-hidden="true"></a><span class="co">       * &quot;Misc. TLI error&quot; is not too helpful. Most likely</span></span>
<span id="cb7-519"><a href="#cb7-519" aria-hidden="true"></a><span class="co">       * the connection to the remote server timed out, so</span></span>
<span id="cb7-520"><a href="#cb7-520" aria-hidden="true"></a><span class="co">       * this error is at least less perplexing.</span></span>
<span id="cb7-521"><a href="#cb7-521" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-522"><a href="#cb7-522" aria-hidden="true"></a>      rpc_createerr.cf_stat = RPC_PMAPFAILURE;</span>
<span id="cb7-523"><a href="#cb7-523" aria-hidden="true"></a>      rpc_createerr.cf_error.re_status = RPC_FAILED;</span>
<span id="cb7-524"><a href="#cb7-524" aria-hidden="true"></a>    }</span>
<span id="cb7-525"><a href="#cb7-525" aria-hidden="true"></a>      clnt_pcreateerror (<span class="st">&quot;rpcinfo: can&#39;t contact portmapper&quot;</span>);</span>
<span id="cb7-526"><a href="#cb7-526" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-527"><a href="#cb7-527" aria-hidden="true"></a>    }</span>
<span id="cb7-528"><a href="#cb7-528" aria-hidden="true"></a></span>
<span id="cb7-529"><a href="#cb7-529" aria-hidden="true"></a>  minutetimeout.tv_sec = <span class="dv">60</span>;</span>
<span id="cb7-530"><a href="#cb7-530" aria-hidden="true"></a>  minutetimeout.tv_usec = <span class="dv">0</span>;</span>
<span id="cb7-531"><a href="#cb7-531" aria-hidden="true"></a></span>
<span id="cb7-532"><a href="#cb7-532" aria-hidden="true"></a>  clnt_st = CLNT_CALL (client, PMAPPROC_DUMP, (xdrproc_t) xdr_void,</span>
<span id="cb7-533"><a href="#cb7-533" aria-hidden="true"></a>               NULL, (xdrproc_t) xdr_pmaplist_ptr, (<span class="dt">char</span> *) &amp;head,</span>
<span id="cb7-534"><a href="#cb7-534" aria-hidden="true"></a>               minutetimeout);</span>
<span id="cb7-535"><a href="#cb7-535" aria-hidden="true"></a>  <span class="cf">if</span> (clnt_st != RPC_SUCCESS)</span>
<span id="cb7-536"><a href="#cb7-536" aria-hidden="true"></a>    {</span>
<span id="cb7-537"><a href="#cb7-537" aria-hidden="true"></a>      <span class="cf">if</span> ((clnt_st == RPC_PROGVERSMISMATCH) || (clnt_st == RPC_PROGUNAVAIL))</span>
<span id="cb7-538"><a href="#cb7-538" aria-hidden="true"></a>    {</span>
<span id="cb7-539"><a href="#cb7-539" aria-hidden="true"></a>      CLNT_GETERR (client, &amp;err);</span>
<span id="cb7-540"><a href="#cb7-540" aria-hidden="true"></a>      <span class="cf">if</span> (err.re_vers.low &gt; PMAPVERS)</span>
<span id="cb7-541"><a href="#cb7-541" aria-hidden="true"></a>        fprintf (stderr,</span>
<span id="cb7-542"><a href="#cb7-542" aria-hidden="true"></a>             <span class="st">&quot;%s does not support portmapper.  Try rpcinfo %s instead</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb7-543"><a href="#cb7-543" aria-hidden="true"></a>             host, host);</span>
<span id="cb7-544"><a href="#cb7-544" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-545"><a href="#cb7-545" aria-hidden="true"></a>    }</span>
<span id="cb7-546"><a href="#cb7-546" aria-hidden="true"></a>      clnt_perror (client, <span class="st">&quot;rpcinfo: can&#39;t contact portmapper&quot;</span>);</span>
<span id="cb7-547"><a href="#cb7-547" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-548"><a href="#cb7-548" aria-hidden="true"></a>    }</span>
<span id="cb7-549"><a href="#cb7-549" aria-hidden="true"></a>  <span class="cf">if</span> (head == NULL)</span>
<span id="cb7-550"><a href="#cb7-550" aria-hidden="true"></a>    {</span>
<span id="cb7-551"><a href="#cb7-551" aria-hidden="true"></a>      printf (<span class="st">&quot;No remote programs registered.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-552"><a href="#cb7-552" aria-hidden="true"></a>    }</span>
<span id="cb7-553"><a href="#cb7-553" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-554"><a href="#cb7-554" aria-hidden="true"></a>    {</span>
<span id="cb7-555"><a href="#cb7-555" aria-hidden="true"></a>      printf (<span class="st">&quot;   program vers proto   port  service</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-556"><a href="#cb7-556" aria-hidden="true"></a>      <span class="cf">for</span> (; head != NULL; head = head-&gt;pml_next)</span>
<span id="cb7-557"><a href="#cb7-557" aria-hidden="true"></a>    {</span>
<span id="cb7-558"><a href="#cb7-558" aria-hidden="true"></a>      printf (<span class="st">&quot;%10ld%5ld&quot;</span>, head-&gt;pml_map.pm_prog, head-&gt;pml_map.pm_vers);</span>
<span id="cb7-559"><a href="#cb7-559" aria-hidden="true"></a>      <span class="cf">if</span> (head-&gt;pml_map.pm_prot == IPPROTO_UDP)</span>
<span id="cb7-560"><a href="#cb7-560" aria-hidden="true"></a>        printf (<span class="st">&quot;%6s&quot;</span>, <span class="st">&quot;udp&quot;</span>);</span>
<span id="cb7-561"><a href="#cb7-561" aria-hidden="true"></a>      <span class="cf">else</span> <span class="cf">if</span> (head-&gt;pml_map.pm_prot == IPPROTO_TCP)</span>
<span id="cb7-562"><a href="#cb7-562" aria-hidden="true"></a>        printf (<span class="st">&quot;%6s&quot;</span>, <span class="st">&quot;tcp&quot;</span>);</span>
<span id="cb7-563"><a href="#cb7-563" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-564"><a href="#cb7-564" aria-hidden="true"></a>        printf (<span class="st">&quot;%6ld&quot;</span>, head-&gt;pml_map.pm_prot);</span>
<span id="cb7-565"><a href="#cb7-565" aria-hidden="true"></a>      printf (<span class="st">&quot;%7ld&quot;</span>, head-&gt;pml_map.pm_port);</span>
<span id="cb7-566"><a href="#cb7-566" aria-hidden="true"></a>      rpc = getrpcbynumber (head-&gt;pml_map.pm_prog);</span>
<span id="cb7-567"><a href="#cb7-567" aria-hidden="true"></a>      <span class="cf">if</span> (rpc)</span>
<span id="cb7-568"><a href="#cb7-568" aria-hidden="true"></a>        printf (<span class="st">&quot;  %s</span><span class="sc">\n</span><span class="st">&quot;</span>, rpc-&gt;r_name);</span>
<span id="cb7-569"><a href="#cb7-569" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-570"><a href="#cb7-570" aria-hidden="true"></a>        printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-571"><a href="#cb7-571" aria-hidden="true"></a>    }</span>
<span id="cb7-572"><a href="#cb7-572" aria-hidden="true"></a>    }</span>
<span id="cb7-573"><a href="#cb7-573" aria-hidden="true"></a>}</span>
<span id="cb7-574"><a href="#cb7-574" aria-hidden="true"></a></span>
<span id="cb7-575"><a href="#cb7-575" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-576"><a href="#cb7-576" aria-hidden="true"></a><span class="co"> * Try to obtain the address of a given host/program/version, using the</span></span>
<span id="cb7-577"><a href="#cb7-577" aria-hidden="true"></a><span class="co"> * specified protocol (one of udp or tcp).</span></span>
<span id="cb7-578"><a href="#cb7-578" aria-hidden="true"></a><span class="co"> * This loops over all netconfig entries (according to the order given by</span></span>
<span id="cb7-579"><a href="#cb7-579" aria-hidden="true"></a><span class="co"> * netpath and the config file), and tries to resolve the hostname, and obtain</span></span>
<span id="cb7-580"><a href="#cb7-580" aria-hidden="true"></a><span class="co"> * the address using rpcb_getaddr.</span></span>
<span id="cb7-581"><a href="#cb7-581" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-582"><a href="#cb7-582" aria-hidden="true"></a>CLIENT *</span>
<span id="cb7-583"><a href="#cb7-583" aria-hidden="true"></a>ip_getclient(hostname, prognum, versnum, proto)</span>
<span id="cb7-584"><a href="#cb7-584" aria-hidden="true"></a>     <span class="dt">const</span> <span class="dt">char</span> *hostname;</span>
<span id="cb7-585"><a href="#cb7-585" aria-hidden="true"></a>     rpcprog_t prognum;</span>
<span id="cb7-586"><a href="#cb7-586" aria-hidden="true"></a>     rpcvers_t versnum;</span>
<span id="cb7-587"><a href="#cb7-587" aria-hidden="true"></a>     <span class="dt">const</span> <span class="dt">char</span> *proto;</span>
<span id="cb7-588"><a href="#cb7-588" aria-hidden="true"></a>{</span>
<span id="cb7-589"><a href="#cb7-589" aria-hidden="true"></a>  <span class="dt">void</span> *handle;</span>
<span id="cb7-590"><a href="#cb7-590" aria-hidden="true"></a>  <span class="kw">enum</span> clnt_stat saved_stat = RPC_SUCCESS;</span>
<span id="cb7-591"><a href="#cb7-591" aria-hidden="true"></a>  <span class="kw">struct</span> netconfig *nconf, *result = NULL;</span>
<span id="cb7-592"><a href="#cb7-592" aria-hidden="true"></a>  <span class="kw">struct</span> netbuf bind_address;</span>
<span id="cb7-593"><a href="#cb7-593" aria-hidden="true"></a>  <span class="kw">struct</span> sockaddr_storage __sa;</span>
<span id="cb7-594"><a href="#cb7-594" aria-hidden="true"></a>  CLIENT *client;</span>
<span id="cb7-595"><a href="#cb7-595" aria-hidden="true"></a></span>
<span id="cb7-596"><a href="#cb7-596" aria-hidden="true"></a>  memset(&amp;bind_address, <span class="dv">0</span>, <span class="kw">sizeof</span>(bind_address));</span>
<span id="cb7-597"><a href="#cb7-597" aria-hidden="true"></a>  bind_address.maxlen = <span class="kw">sizeof</span>(__sa);</span>
<span id="cb7-598"><a href="#cb7-598" aria-hidden="true"></a>  bind_address.buf = &amp;__sa;</span>
<span id="cb7-599"><a href="#cb7-599" aria-hidden="true"></a></span>
<span id="cb7-600"><a href="#cb7-600" aria-hidden="true"></a>  handle = setnetconfig();</span>
<span id="cb7-601"><a href="#cb7-601" aria-hidden="true"></a>  <span class="cf">while</span> ((nconf = getnetconfig(handle)) != NULL)</span>
<span id="cb7-602"><a href="#cb7-602" aria-hidden="true"></a>    {</span>
<span id="cb7-603"><a href="#cb7-603" aria-hidden="true"></a>      <span class="cf">if</span> (!strcmp(nconf-&gt;nc_proto, proto)) {</span>
<span id="cb7-604"><a href="#cb7-604" aria-hidden="true"></a>        <span class="cf">if</span> (rpcb_getaddr(prognum, versnum, nconf, &amp;bind_address, hostname))</span>
<span id="cb7-605"><a href="#cb7-605" aria-hidden="true"></a>          {</span>
<span id="cb7-606"><a href="#cb7-606" aria-hidden="true"></a>        result = getnetconfigent(nconf-&gt;nc_netid);</span>
<span id="cb7-607"><a href="#cb7-607" aria-hidden="true"></a>        endnetconfig(handle);</span>
<span id="cb7-608"><a href="#cb7-608" aria-hidden="true"></a>        <span class="cf">break</span>;</span>
<span id="cb7-609"><a href="#cb7-609" aria-hidden="true"></a>      }</span>
<span id="cb7-610"><a href="#cb7-610" aria-hidden="true"></a></span>
<span id="cb7-611"><a href="#cb7-611" aria-hidden="true"></a>        <span class="cf">if</span> (rpc_createerr.cf_stat != RPC_UNKNOWNHOST)</span>
<span id="cb7-612"><a href="#cb7-612" aria-hidden="true"></a>          {</span>
<span id="cb7-613"><a href="#cb7-613" aria-hidden="true"></a>            clnt_pcreateerror (hostname);</span>
<span id="cb7-614"><a href="#cb7-614" aria-hidden="true"></a>        exit (<span class="dv">1</span>);</span>
<span id="cb7-615"><a href="#cb7-615" aria-hidden="true"></a>      }</span>
<span id="cb7-616"><a href="#cb7-616" aria-hidden="true"></a></span>
<span id="cb7-617"><a href="#cb7-617" aria-hidden="true"></a>    saved_stat = rpc_createerr.cf_stat;</span>
<span id="cb7-618"><a href="#cb7-618" aria-hidden="true"></a>      }</span>
<span id="cb7-619"><a href="#cb7-619" aria-hidden="true"></a>    }</span>
<span id="cb7-620"><a href="#cb7-620" aria-hidden="true"></a></span>
<span id="cb7-621"><a href="#cb7-621" aria-hidden="true"></a>  <span class="cf">if</span> (result == NULL)</span>
<span id="cb7-622"><a href="#cb7-622" aria-hidden="true"></a>    {</span>
<span id="cb7-623"><a href="#cb7-623" aria-hidden="true"></a>      <span class="cf">if</span> (saved_stat != RPC_SUCCESS)</span>
<span id="cb7-624"><a href="#cb7-624" aria-hidden="true"></a>        {</span>
<span id="cb7-625"><a href="#cb7-625" aria-hidden="true"></a>          rpc_createerr.cf_stat = saved_stat;</span>
<span id="cb7-626"><a href="#cb7-626" aria-hidden="true"></a>          clnt_pcreateerror (hostname);</span>
<span id="cb7-627"><a href="#cb7-627" aria-hidden="true"></a>        }</span>
<span id="cb7-628"><a href="#cb7-628" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-629"><a href="#cb7-629" aria-hidden="true"></a>        fprintf (stderr, <span class="st">&quot;Cannot find suitable transport for protocol %s</span><span class="sc">\n</span><span class="st">&quot;</span>, proto);</span>
<span id="cb7-630"><a href="#cb7-630" aria-hidden="true"></a></span>
<span id="cb7-631"><a href="#cb7-631" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-632"><a href="#cb7-632" aria-hidden="true"></a>    }</span>
<span id="cb7-633"><a href="#cb7-633" aria-hidden="true"></a></span>
<span id="cb7-634"><a href="#cb7-634" aria-hidden="true"></a>  client = clnt_tli_create(RPC_ANYFD, result, &amp;bind_address, prognum, versnum, <span class="dv">0</span>, <span class="dv">0</span>);</span>
<span id="cb7-635"><a href="#cb7-635" aria-hidden="true"></a>  <span class="cf">if</span> (client == NULL)</span>
<span id="cb7-636"><a href="#cb7-636" aria-hidden="true"></a>    {</span>
<span id="cb7-637"><a href="#cb7-637" aria-hidden="true"></a>      clnt_pcreateerror(hostname);</span>
<span id="cb7-638"><a href="#cb7-638" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-639"><a href="#cb7-639" aria-hidden="true"></a>    }</span>
<span id="cb7-640"><a href="#cb7-640" aria-hidden="true"></a></span>
<span id="cb7-641"><a href="#cb7-641" aria-hidden="true"></a>  freenetconfigent(result);</span>
<span id="cb7-642"><a href="#cb7-642" aria-hidden="true"></a>  <span class="cf">return</span> client;</span>
<span id="cb7-643"><a href="#cb7-643" aria-hidden="true"></a>}</span>
<span id="cb7-644"><a href="#cb7-644" aria-hidden="true"></a><span class="pp">#endif </span><span class="co">/* PORTMAP */</span></span>
<span id="cb7-645"><a href="#cb7-645" aria-hidden="true"></a></span>
<span id="cb7-646"><a href="#cb7-646" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">int</span></span>
<span id="cb7-647"><a href="#cb7-647" aria-hidden="true"></a>sa_len(<span class="kw">struct</span> sockaddr *sa)</span>
<span id="cb7-648"><a href="#cb7-648" aria-hidden="true"></a>{</span>
<span id="cb7-649"><a href="#cb7-649" aria-hidden="true"></a>    socklen_t salen;</span>
<span id="cb7-650"><a href="#cb7-650" aria-hidden="true"></a></span>
<span id="cb7-651"><a href="#cb7-651" aria-hidden="true"></a>    <span class="cf">switch</span> (sa-&gt;sa_family)</span>
<span id="cb7-652"><a href="#cb7-652" aria-hidden="true"></a>    {</span>
<span id="cb7-653"><a href="#cb7-653" aria-hidden="true"></a>        <span class="cf">case</span> AF_LOCAL:</span>
<span id="cb7-654"><a href="#cb7-654" aria-hidden="true"></a>            salen = <span class="kw">sizeof</span> (<span class="kw">struct</span> sockaddr_un);</span>
<span id="cb7-655"><a href="#cb7-655" aria-hidden="true"></a>            <span class="cf">break</span>;</span>
<span id="cb7-656"><a href="#cb7-656" aria-hidden="true"></a>        <span class="cf">case</span> AF_INET:</span>
<span id="cb7-657"><a href="#cb7-657" aria-hidden="true"></a>            salen = <span class="kw">sizeof</span> (<span class="kw">struct</span> sockaddr_in);</span>
<span id="cb7-658"><a href="#cb7-658" aria-hidden="true"></a>            <span class="cf">break</span>;</span>
<span id="cb7-659"><a href="#cb7-659" aria-hidden="true"></a>        <span class="cf">case</span> AF_INET6:</span>
<span id="cb7-660"><a href="#cb7-660" aria-hidden="true"></a>            salen = <span class="kw">sizeof</span> (<span class="kw">struct</span> sockaddr_in6);</span>
<span id="cb7-661"><a href="#cb7-661" aria-hidden="true"></a>            <span class="cf">break</span>;</span>
<span id="cb7-662"><a href="#cb7-662" aria-hidden="true"></a>        <span class="cf">default</span>:</span>
<span id="cb7-663"><a href="#cb7-663" aria-hidden="true"></a>            salen = <span class="dv">0</span>;</span>
<span id="cb7-664"><a href="#cb7-664" aria-hidden="true"></a>            <span class="cf">break</span>;</span>
<span id="cb7-665"><a href="#cb7-665" aria-hidden="true"></a>    }</span>
<span id="cb7-666"><a href="#cb7-666" aria-hidden="true"></a>    <span class="cf">return</span> salen;</span>
<span id="cb7-667"><a href="#cb7-667" aria-hidden="true"></a>}</span>
<span id="cb7-668"><a href="#cb7-668" aria-hidden="true"></a></span>
<span id="cb7-669"><a href="#cb7-669" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-670"><a href="#cb7-670" aria-hidden="true"></a><span class="co"> * reply_proc collects replies from the broadcast.</span></span>
<span id="cb7-671"><a href="#cb7-671" aria-hidden="true"></a><span class="co"> * to get a unique list of responses the output of rpcinfo should</span></span>
<span id="cb7-672"><a href="#cb7-672" aria-hidden="true"></a><span class="co"> * be piped through sort(1) and then uniq(1).</span></span>
<span id="cb7-673"><a href="#cb7-673" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-674"><a href="#cb7-674" aria-hidden="true"></a></span>
<span id="cb7-675"><a href="#cb7-675" aria-hidden="true"></a> <span class="co">/*ARGSUSED*/</span> <span class="dt">static</span> bool_t</span>
<span id="cb7-676"><a href="#cb7-676" aria-hidden="true"></a>reply_proc (res, who, nconf)</span>
<span id="cb7-677"><a href="#cb7-677" aria-hidden="true"></a>     <span class="dt">void</span> *res;         <span class="co">/* Nothing comes back */</span></span>
<span id="cb7-678"><a href="#cb7-678" aria-hidden="true"></a>     <span class="kw">struct</span> netbuf *who;    <span class="co">/* Who sent us the reply */</span></span>
<span id="cb7-679"><a href="#cb7-679" aria-hidden="true"></a>     <span class="kw">struct</span> netconfig *nconf;   <span class="co">/* On which transport the reply came */</span></span>
<span id="cb7-680"><a href="#cb7-680" aria-hidden="true"></a>{</span>
<span id="cb7-681"><a href="#cb7-681" aria-hidden="true"></a>  <span class="dt">char</span> *uaddr;</span>
<span id="cb7-682"><a href="#cb7-682" aria-hidden="true"></a>  <span class="dt">char</span> hostbuf[NI_MAXHOST];</span>
<span id="cb7-683"><a href="#cb7-683" aria-hidden="true"></a>  <span class="dt">char</span> *hostname;</span>
<span id="cb7-684"><a href="#cb7-684" aria-hidden="true"></a>  <span class="kw">struct</span> sockaddr *sa = (<span class="kw">struct</span> sockaddr *) who-&gt;buf;</span>
<span id="cb7-685"><a href="#cb7-685" aria-hidden="true"></a></span>
<span id="cb7-686"><a href="#cb7-686" aria-hidden="true"></a>  <span class="cf">if</span> (getnameinfo (sa, sa_len (sa), hostbuf, NI_MAXHOST, NULL, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb7-687"><a href="#cb7-687" aria-hidden="true"></a>    {</span>
<span id="cb7-688"><a href="#cb7-688" aria-hidden="true"></a>      hostname = UNKNOWN;</span>
<span id="cb7-689"><a href="#cb7-689" aria-hidden="true"></a>    }</span>
<span id="cb7-690"><a href="#cb7-690" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-691"><a href="#cb7-691" aria-hidden="true"></a>    {</span>
<span id="cb7-692"><a href="#cb7-692" aria-hidden="true"></a>      hostname = hostbuf;</span>
<span id="cb7-693"><a href="#cb7-693" aria-hidden="true"></a>    }</span>
<span id="cb7-694"><a href="#cb7-694" aria-hidden="true"></a>  <span class="cf">if</span> (!(uaddr = taddr2uaddr (nconf, who)))</span>
<span id="cb7-695"><a href="#cb7-695" aria-hidden="true"></a>    {</span>
<span id="cb7-696"><a href="#cb7-696" aria-hidden="true"></a>      printf (<span class="st">&quot;%s</span><span class="sc">\t</span><span class="st">%s</span><span class="sc">\n</span><span class="st">&quot;</span>, UNKNOWN, hostname);</span>
<span id="cb7-697"><a href="#cb7-697" aria-hidden="true"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-698"><a href="#cb7-698" aria-hidden="true"></a>      printf (<span class="st">&quot;%s</span><span class="sc">\t</span><span class="st">%s</span><span class="sc">\n</span><span class="st">&quot;</span>, uaddr, hostname);</span>
<span id="cb7-699"><a href="#cb7-699" aria-hidden="true"></a>      free ((<span class="dt">char</span> *) uaddr);</span>
<span id="cb7-700"><a href="#cb7-700" aria-hidden="true"></a>    }</span>
<span id="cb7-701"><a href="#cb7-701" aria-hidden="true"></a>  <span class="cf">return</span> (FALSE);</span>
<span id="cb7-702"><a href="#cb7-702" aria-hidden="true"></a>}</span>
<span id="cb7-703"><a href="#cb7-703" aria-hidden="true"></a></span>
<span id="cb7-704"><a href="#cb7-704" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-705"><a href="#cb7-705" aria-hidden="true"></a>brdcst (argc, argv)</span>
<span id="cb7-706"><a href="#cb7-706" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-707"><a href="#cb7-707" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-708"><a href="#cb7-708" aria-hidden="true"></a>{</span>
<span id="cb7-709"><a href="#cb7-709" aria-hidden="true"></a>  <span class="kw">enum</span> clnt_stat rpc_stat;</span>
<span id="cb7-710"><a href="#cb7-710" aria-hidden="true"></a>  u_long prognum, vers;</span>
<span id="cb7-711"><a href="#cb7-711" aria-hidden="true"></a></span>
<span id="cb7-712"><a href="#cb7-712" aria-hidden="true"></a>  <span class="cf">if</span> (argc != <span class="dv">2</span>)</span>
<span id="cb7-713"><a href="#cb7-713" aria-hidden="true"></a>    {</span>
<span id="cb7-714"><a href="#cb7-714" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-715"><a href="#cb7-715" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-716"><a href="#cb7-716" aria-hidden="true"></a>    }</span>
<span id="cb7-717"><a href="#cb7-717" aria-hidden="true"></a>  prognum = getprognum (argv[<span class="dv">0</span>]);</span>
<span id="cb7-718"><a href="#cb7-718" aria-hidden="true"></a>  vers = getvers (argv[<span class="dv">1</span>]);</span>
<span id="cb7-719"><a href="#cb7-719" aria-hidden="true"></a>  rpc_stat = rpc_broadcast (prognum, vers, NULLPROC,</span>
<span id="cb7-720"><a href="#cb7-720" aria-hidden="true"></a>                (xdrproc_t) xdr_void, (<span class="dt">char</span> *) NULL,</span>
<span id="cb7-721"><a href="#cb7-721" aria-hidden="true"></a>                (xdrproc_t) xdr_void, (<span class="dt">char</span> *) NULL,</span>
<span id="cb7-722"><a href="#cb7-722" aria-hidden="true"></a>                (resultproc_t) reply_proc, NULL);</span>
<span id="cb7-723"><a href="#cb7-723" aria-hidden="true"></a>  <span class="cf">if</span> ((rpc_stat != RPC_SUCCESS) &amp;&amp; (rpc_stat != RPC_TIMEDOUT))</span>
<span id="cb7-724"><a href="#cb7-724" aria-hidden="true"></a>    {</span>
<span id="cb7-725"><a href="#cb7-725" aria-hidden="true"></a>      fprintf (stderr, <span class="st">&quot;rpcinfo: broadcast failed: %s</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb7-726"><a href="#cb7-726" aria-hidden="true"></a>           clnt_sperrno (rpc_stat));</span>
<span id="cb7-727"><a href="#cb7-727" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-728"><a href="#cb7-728" aria-hidden="true"></a>    }</span>
<span id="cb7-729"><a href="#cb7-729" aria-hidden="true"></a>  exit (<span class="dv">0</span>);</span>
<span id="cb7-730"><a href="#cb7-730" aria-hidden="true"></a>}</span>
<span id="cb7-731"><a href="#cb7-731" aria-hidden="true"></a></span>
<span id="cb7-732"><a href="#cb7-732" aria-hidden="true"></a><span class="dt">static</span> bool_t</span>
<span id="cb7-733"><a href="#cb7-733" aria-hidden="true"></a>add_version (rs, vers)</span>
<span id="cb7-734"><a href="#cb7-734" aria-hidden="true"></a>     <span class="kw">struct</span> rpcbdump_short *rs;</span>
<span id="cb7-735"><a href="#cb7-735" aria-hidden="true"></a>     u_long vers;</span>
<span id="cb7-736"><a href="#cb7-736" aria-hidden="true"></a>{</span>
<span id="cb7-737"><a href="#cb7-737" aria-hidden="true"></a>  <span class="kw">struct</span> verslist *vl;</span>
<span id="cb7-738"><a href="#cb7-738" aria-hidden="true"></a></span>
<span id="cb7-739"><a href="#cb7-739" aria-hidden="true"></a>  <span class="cf">for</span> (vl = rs-&gt;vlist; vl; vl = vl-&gt;next)</span>
<span id="cb7-740"><a href="#cb7-740" aria-hidden="true"></a>    <span class="cf">if</span> (vl-&gt;vers == vers)</span>
<span id="cb7-741"><a href="#cb7-741" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-742"><a href="#cb7-742" aria-hidden="true"></a>  <span class="cf">if</span> (vl)</span>
<span id="cb7-743"><a href="#cb7-743" aria-hidden="true"></a>    <span class="cf">return</span> (TRUE);</span>
<span id="cb7-744"><a href="#cb7-744" aria-hidden="true"></a>  vl = (<span class="kw">struct</span> verslist *) malloc (<span class="kw">sizeof</span> (<span class="kw">struct</span> verslist));</span>
<span id="cb7-745"><a href="#cb7-745" aria-hidden="true"></a>  <span class="cf">if</span> (vl == NULL)</span>
<span id="cb7-746"><a href="#cb7-746" aria-hidden="true"></a>    <span class="cf">return</span> (FALSE);</span>
<span id="cb7-747"><a href="#cb7-747" aria-hidden="true"></a>  vl-&gt;vers = vers;</span>
<span id="cb7-748"><a href="#cb7-748" aria-hidden="true"></a>  vl-&gt;next = rs-&gt;vlist;</span>
<span id="cb7-749"><a href="#cb7-749" aria-hidden="true"></a>  rs-&gt;vlist = vl;</span>
<span id="cb7-750"><a href="#cb7-750" aria-hidden="true"></a>  <span class="cf">return</span> (TRUE);</span>
<span id="cb7-751"><a href="#cb7-751" aria-hidden="true"></a>}</span>
<span id="cb7-752"><a href="#cb7-752" aria-hidden="true"></a></span>
<span id="cb7-753"><a href="#cb7-753" aria-hidden="true"></a><span class="dt">static</span> bool_t</span>
<span id="cb7-754"><a href="#cb7-754" aria-hidden="true"></a>add_netid (rs, netid)</span>
<span id="cb7-755"><a href="#cb7-755" aria-hidden="true"></a>     <span class="kw">struct</span> rpcbdump_short *rs;</span>
<span id="cb7-756"><a href="#cb7-756" aria-hidden="true"></a>     <span class="dt">char</span> *netid;</span>
<span id="cb7-757"><a href="#cb7-757" aria-hidden="true"></a>{</span>
<span id="cb7-758"><a href="#cb7-758" aria-hidden="true"></a>  <span class="kw">struct</span> netidlist *nl;</span>
<span id="cb7-759"><a href="#cb7-759" aria-hidden="true"></a></span>
<span id="cb7-760"><a href="#cb7-760" aria-hidden="true"></a>  <span class="cf">for</span> (nl = rs-&gt;nlist; nl; nl = nl-&gt;next)</span>
<span id="cb7-761"><a href="#cb7-761" aria-hidden="true"></a>    <span class="cf">if</span> (strcmp (nl-&gt;netid, netid) == <span class="dv">0</span>)</span>
<span id="cb7-762"><a href="#cb7-762" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-763"><a href="#cb7-763" aria-hidden="true"></a>  <span class="cf">if</span> (nl)</span>
<span id="cb7-764"><a href="#cb7-764" aria-hidden="true"></a>    <span class="cf">return</span> (TRUE);</span>
<span id="cb7-765"><a href="#cb7-765" aria-hidden="true"></a>  nl = (<span class="kw">struct</span> netidlist *) malloc (<span class="kw">sizeof</span> (<span class="kw">struct</span> netidlist));</span>
<span id="cb7-766"><a href="#cb7-766" aria-hidden="true"></a>  <span class="cf">if</span> (nl == NULL)</span>
<span id="cb7-767"><a href="#cb7-767" aria-hidden="true"></a>    <span class="cf">return</span> (FALSE);</span>
<span id="cb7-768"><a href="#cb7-768" aria-hidden="true"></a>  nl-&gt;netid = netid;</span>
<span id="cb7-769"><a href="#cb7-769" aria-hidden="true"></a>  nl-&gt;next = rs-&gt;nlist;</span>
<span id="cb7-770"><a href="#cb7-770" aria-hidden="true"></a>  rs-&gt;nlist = nl;</span>
<span id="cb7-771"><a href="#cb7-771" aria-hidden="true"></a>  <span class="cf">return</span> (TRUE);</span>
<span id="cb7-772"><a href="#cb7-772" aria-hidden="true"></a>}</span>
<span id="cb7-773"><a href="#cb7-773" aria-hidden="true"></a></span>
<span id="cb7-774"><a href="#cb7-774" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-775"><a href="#cb7-775" aria-hidden="true"></a>rpcbdump (dumptype, netid, argc, argv)</span>
<span id="cb7-776"><a href="#cb7-776" aria-hidden="true"></a>     <span class="dt">int</span> dumptype;</span>
<span id="cb7-777"><a href="#cb7-777" aria-hidden="true"></a>     <span class="dt">char</span> *netid;</span>
<span id="cb7-778"><a href="#cb7-778" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-779"><a href="#cb7-779" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-780"><a href="#cb7-780" aria-hidden="true"></a>{</span>
<span id="cb7-781"><a href="#cb7-781" aria-hidden="true"></a>  rpcblist_ptr head = NULL;</span>
<span id="cb7-782"><a href="#cb7-782" aria-hidden="true"></a>  <span class="kw">struct</span> timeval minutetimeout;</span>
<span id="cb7-783"><a href="#cb7-783" aria-hidden="true"></a>  <span class="dt">register</span> CLIENT *client;</span>
<span id="cb7-784"><a href="#cb7-784" aria-hidden="true"></a>  <span class="kw">struct</span> rpcent *rpc;</span>
<span id="cb7-785"><a href="#cb7-785" aria-hidden="true"></a>  <span class="dt">char</span> *host;</span>
<span id="cb7-786"><a href="#cb7-786" aria-hidden="true"></a>  <span class="kw">struct</span> netidlist *nl;</span>
<span id="cb7-787"><a href="#cb7-787" aria-hidden="true"></a>  <span class="kw">struct</span> verslist *vl;</span>
<span id="cb7-788"><a href="#cb7-788" aria-hidden="true"></a>  <span class="kw">struct</span> rpcbdump_short *rs, *rs_tail = NULL;</span>
<span id="cb7-789"><a href="#cb7-789" aria-hidden="true"></a>  <span class="dt">char</span> buf[<span class="dv">256</span>];</span>
<span id="cb7-790"><a href="#cb7-790" aria-hidden="true"></a>  <span class="kw">enum</span> clnt_stat clnt_st;</span>
<span id="cb7-791"><a href="#cb7-791" aria-hidden="true"></a>  <span class="kw">struct</span> rpc_err err;</span>
<span id="cb7-792"><a href="#cb7-792" aria-hidden="true"></a>  <span class="kw">struct</span> rpcbdump_short *rs_head = NULL;</span>
<span id="cb7-793"><a href="#cb7-793" aria-hidden="true"></a></span>
<span id="cb7-794"><a href="#cb7-794" aria-hidden="true"></a>  <span class="cf">if</span> (argc &gt; <span class="dv">1</span>)</span>
<span id="cb7-795"><a href="#cb7-795" aria-hidden="true"></a>    {</span>
<span id="cb7-796"><a href="#cb7-796" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-797"><a href="#cb7-797" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-798"><a href="#cb7-798" aria-hidden="true"></a>    }</span>
<span id="cb7-799"><a href="#cb7-799" aria-hidden="true"></a>  <span class="cf">if</span> (argc == <span class="dv">1</span>)</span>
<span id="cb7-800"><a href="#cb7-800" aria-hidden="true"></a>    {</span>
<span id="cb7-801"><a href="#cb7-801" aria-hidden="true"></a>      host = argv[<span class="dv">0</span>];</span>
<span id="cb7-802"><a href="#cb7-802" aria-hidden="true"></a>      <span class="cf">if</span> (netid == NULL)</span>
<span id="cb7-803"><a href="#cb7-803" aria-hidden="true"></a>    {</span>
<span id="cb7-804"><a href="#cb7-804" aria-hidden="true"></a>      client = clnt_rpcbind_create (host, RPCBVERS, NULL);</span>
<span id="cb7-805"><a href="#cb7-805" aria-hidden="true"></a>    }</span>
<span id="cb7-806"><a href="#cb7-806" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-807"><a href="#cb7-807" aria-hidden="true"></a>    {</span>
<span id="cb7-808"><a href="#cb7-808" aria-hidden="true"></a>      <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-809"><a href="#cb7-809" aria-hidden="true"></a></span>
<span id="cb7-810"><a href="#cb7-810" aria-hidden="true"></a>      nconf = getnetconfigent (netid);</span>
<span id="cb7-811"><a href="#cb7-811" aria-hidden="true"></a>      <span class="cf">if</span> (nconf == NULL)</span>
<span id="cb7-812"><a href="#cb7-812" aria-hidden="true"></a>        {</span>
<span id="cb7-813"><a href="#cb7-813" aria-hidden="true"></a>          nc_perror (<span class="st">&quot;rpcinfo: invalid transport&quot;</span>);</span>
<span id="cb7-814"><a href="#cb7-814" aria-hidden="true"></a>          exit (<span class="dv">1</span>);</span>
<span id="cb7-815"><a href="#cb7-815" aria-hidden="true"></a>        }</span>
<span id="cb7-816"><a href="#cb7-816" aria-hidden="true"></a>      client = getclnthandle (host, nconf, RPCBVERS, NULL);</span>
<span id="cb7-817"><a href="#cb7-817" aria-hidden="true"></a>      <span class="cf">if</span> (nconf)</span>
<span id="cb7-818"><a href="#cb7-818" aria-hidden="true"></a>        (<span class="dt">void</span>) freenetconfigent (nconf);</span>
<span id="cb7-819"><a href="#cb7-819" aria-hidden="true"></a>    }</span>
<span id="cb7-820"><a href="#cb7-820" aria-hidden="true"></a>    }</span>
<span id="cb7-821"><a href="#cb7-821" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-822"><a href="#cb7-822" aria-hidden="true"></a>    client = local_rpcb (PMAPPROG, RPCBVERS);</span>
<span id="cb7-823"><a href="#cb7-823" aria-hidden="true"></a></span>
<span id="cb7-824"><a href="#cb7-824" aria-hidden="true"></a>  <span class="cf">if</span> (client == (CLIENT *) NULL)</span>
<span id="cb7-825"><a href="#cb7-825" aria-hidden="true"></a>    {</span>
<span id="cb7-826"><a href="#cb7-826" aria-hidden="true"></a>      clnt_pcreateerror (<span class="st">&quot;rpcinfo: can&#39;t contact rpcbind&quot;</span>);</span>
<span id="cb7-827"><a href="#cb7-827" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-828"><a href="#cb7-828" aria-hidden="true"></a>    }</span>
<span id="cb7-829"><a href="#cb7-829" aria-hidden="true"></a>  minutetimeout.tv_sec = <span class="dv">60</span>;</span>
<span id="cb7-830"><a href="#cb7-830" aria-hidden="true"></a>  minutetimeout.tv_usec = <span class="dv">0</span>;</span>
<span id="cb7-831"><a href="#cb7-831" aria-hidden="true"></a>  clnt_st = CLNT_CALL (client, RPCBPROC_DUMP, (xdrproc_t) xdr_void,</span>
<span id="cb7-832"><a href="#cb7-832" aria-hidden="true"></a>               NULL, (xdrproc_t) xdr_rpcblist_ptr, (<span class="dt">char</span> *) &amp;head,</span>
<span id="cb7-833"><a href="#cb7-833" aria-hidden="true"></a>               minutetimeout);</span>
<span id="cb7-834"><a href="#cb7-834" aria-hidden="true"></a>  <span class="cf">if</span> (clnt_st != RPC_SUCCESS)</span>
<span id="cb7-835"><a href="#cb7-835" aria-hidden="true"></a>    {</span>
<span id="cb7-836"><a href="#cb7-836" aria-hidden="true"></a>      <span class="cf">if</span> ((clnt_st == RPC_PROGVERSMISMATCH) || (clnt_st == RPC_PROGUNAVAIL))</span>
<span id="cb7-837"><a href="#cb7-837" aria-hidden="true"></a>    {</span>
<span id="cb7-838"><a href="#cb7-838" aria-hidden="true"></a>      <span class="dt">int</span> vers;</span>
<span id="cb7-839"><a href="#cb7-839" aria-hidden="true"></a></span>
<span id="cb7-840"><a href="#cb7-840" aria-hidden="true"></a>      CLNT_GETERR (client, &amp;err);</span>
<span id="cb7-841"><a href="#cb7-841" aria-hidden="true"></a>      <span class="cf">if</span> (err.re_vers.low == RPCBVERS4)</span>
<span id="cb7-842"><a href="#cb7-842" aria-hidden="true"></a>        {</span>
<span id="cb7-843"><a href="#cb7-843" aria-hidden="true"></a>          vers = RPCBVERS4;</span>
<span id="cb7-844"><a href="#cb7-844" aria-hidden="true"></a>          clnt_control (client, CLSET_VERS, (<span class="dt">char</span> *) &amp;vers);</span>
<span id="cb7-845"><a href="#cb7-845" aria-hidden="true"></a>          clnt_st = CLNT_CALL (client, RPCBPROC_DUMP,</span>
<span id="cb7-846"><a href="#cb7-846" aria-hidden="true"></a>                   (xdrproc_t) xdr_void, NULL,</span>
<span id="cb7-847"><a href="#cb7-847" aria-hidden="true"></a>                   (xdrproc_t) xdr_rpcblist_ptr,</span>
<span id="cb7-848"><a href="#cb7-848" aria-hidden="true"></a>                   (<span class="dt">char</span> *) &amp;head, minutetimeout);</span>
<span id="cb7-849"><a href="#cb7-849" aria-hidden="true"></a>          <span class="cf">if</span> (clnt_st != RPC_SUCCESS)</span>
<span id="cb7-850"><a href="#cb7-850" aria-hidden="true"></a>        <span class="cf">goto</span> failed;</span>
<span id="cb7-851"><a href="#cb7-851" aria-hidden="true"></a>        }</span>
<span id="cb7-852"><a href="#cb7-852" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-853"><a href="#cb7-853" aria-hidden="true"></a>        {</span>
<span id="cb7-854"><a href="#cb7-854" aria-hidden="true"></a>          <span class="cf">if</span> (err.re_vers.high == PMAPVERS)</span>
<span id="cb7-855"><a href="#cb7-855" aria-hidden="true"></a>        {</span>
<span id="cb7-856"><a href="#cb7-856" aria-hidden="true"></a>          <span class="dt">int</span> high, low;</span>
<span id="cb7-857"><a href="#cb7-857" aria-hidden="true"></a>          <span class="kw">struct</span> pmaplist *pmaphead = NULL;</span>
<span id="cb7-858"><a href="#cb7-858" aria-hidden="true"></a>          rpcblist_ptr list, prev = NULL;</span>
<span id="cb7-859"><a href="#cb7-859" aria-hidden="true"></a></span>
<span id="cb7-860"><a href="#cb7-860" aria-hidden="true"></a>          vers = PMAPVERS;</span>
<span id="cb7-861"><a href="#cb7-861" aria-hidden="true"></a>          clnt_control (client, CLSET_VERS, (<span class="dt">char</span> *) &amp;vers);</span>
<span id="cb7-862"><a href="#cb7-862" aria-hidden="true"></a>          clnt_st = CLNT_CALL (client, PMAPPROC_DUMP,</span>
<span id="cb7-863"><a href="#cb7-863" aria-hidden="true"></a>                       (xdrproc_t) xdr_void, NULL,</span>
<span id="cb7-864"><a href="#cb7-864" aria-hidden="true"></a>                       (xdrproc_t) xdr_pmaplist_ptr,</span>
<span id="cb7-865"><a href="#cb7-865" aria-hidden="true"></a>                       (<span class="dt">char</span> *) &amp;pmaphead, minutetimeout);</span>
<span id="cb7-866"><a href="#cb7-866" aria-hidden="true"></a>          <span class="cf">if</span> (clnt_st != RPC_SUCCESS)</span>
<span id="cb7-867"><a href="#cb7-867" aria-hidden="true"></a>            <span class="cf">goto</span> failed;</span>
<span id="cb7-868"><a href="#cb7-868" aria-hidden="true"></a>          <span class="co">/*</span></span>
<span id="cb7-869"><a href="#cb7-869" aria-hidden="true"></a><span class="co">           * convert to rpcblist_ptr format</span></span>
<span id="cb7-870"><a href="#cb7-870" aria-hidden="true"></a><span class="co">           */</span></span>
<span id="cb7-871"><a href="#cb7-871" aria-hidden="true"></a>          <span class="cf">for</span> (head = NULL; pmaphead != NULL;</span>
<span id="cb7-872"><a href="#cb7-872" aria-hidden="true"></a>               pmaphead = pmaphead-&gt;pml_next)</span>
<span id="cb7-873"><a href="#cb7-873" aria-hidden="true"></a>            {</span>
<span id="cb7-874"><a href="#cb7-874" aria-hidden="true"></a>              list = (rpcblist *) malloc (<span class="kw">sizeof</span> (rpcblist));</span>
<span id="cb7-875"><a href="#cb7-875" aria-hidden="true"></a>              <span class="cf">if</span> (list == NULL)</span>
<span id="cb7-876"><a href="#cb7-876" aria-hidden="true"></a>            <span class="cf">goto</span> error;</span>
<span id="cb7-877"><a href="#cb7-877" aria-hidden="true"></a>              <span class="cf">if</span> (head == NULL)</span>
<span id="cb7-878"><a href="#cb7-878" aria-hidden="true"></a>            head = list;</span>
<span id="cb7-879"><a href="#cb7-879" aria-hidden="true"></a>              <span class="cf">else</span></span>
<span id="cb7-880"><a href="#cb7-880" aria-hidden="true"></a>            prev-&gt;rpcb_next = (rpcblist_ptr) list;</span>
<span id="cb7-881"><a href="#cb7-881" aria-hidden="true"></a></span>
<span id="cb7-882"><a href="#cb7-882" aria-hidden="true"></a>              list-&gt;rpcb_next = NULL;</span>
<span id="cb7-883"><a href="#cb7-883" aria-hidden="true"></a>              list-&gt;rpcb_map.r_prog = pmaphead-&gt;pml_map.pm_prog;</span>
<span id="cb7-884"><a href="#cb7-884" aria-hidden="true"></a>              list-&gt;rpcb_map.r_vers = pmaphead-&gt;pml_map.pm_vers;</span>
<span id="cb7-885"><a href="#cb7-885" aria-hidden="true"></a>              <span class="cf">if</span> (pmaphead-&gt;pml_map.pm_prot == IPPROTO_UDP)</span>
<span id="cb7-886"><a href="#cb7-886" aria-hidden="true"></a>            list-&gt;rpcb_map.r_netid = <span class="st">&quot;udp&quot;</span>;</span>
<span id="cb7-887"><a href="#cb7-887" aria-hidden="true"></a>              <span class="cf">else</span> <span class="cf">if</span> (pmaphead-&gt;pml_map.pm_prot == IPPROTO_TCP)</span>
<span id="cb7-888"><a href="#cb7-888" aria-hidden="true"></a>            list-&gt;rpcb_map.r_netid = <span class="st">&quot;tcp&quot;</span>;</span>
<span id="cb7-889"><a href="#cb7-889" aria-hidden="true"></a>              <span class="cf">else</span></span>
<span id="cb7-890"><a href="#cb7-890" aria-hidden="true"></a>            {</span>
<span id="cb7-891"><a href="#cb7-891" aria-hidden="true"></a><span class="pp">#define MAXLONG_AS_STRING   &quot;2147483648&quot;</span></span>
<span id="cb7-892"><a href="#cb7-892" aria-hidden="true"></a>              list-&gt;rpcb_map.r_netid =</span>
<span id="cb7-893"><a href="#cb7-893" aria-hidden="true"></a>                malloc (strlen (MAXLONG_AS_STRING) + <span class="dv">1</span>);</span>
<span id="cb7-894"><a href="#cb7-894" aria-hidden="true"></a>              <span class="cf">if</span> (list-&gt;rpcb_map.r_netid == NULL)</span>
<span id="cb7-895"><a href="#cb7-895" aria-hidden="true"></a>                <span class="cf">goto</span> error;</span>
<span id="cb7-896"><a href="#cb7-896" aria-hidden="true"></a>              sprintf (list-&gt;rpcb_map.r_netid, <span class="st">&quot;%6ld&quot;</span>,</span>
<span id="cb7-897"><a href="#cb7-897" aria-hidden="true"></a>                   pmaphead-&gt;pml_map.pm_prot);</span>
<span id="cb7-898"><a href="#cb7-898" aria-hidden="true"></a>            }</span>
<span id="cb7-899"><a href="#cb7-899" aria-hidden="true"></a>              list-&gt;rpcb_map.r_owner = UNKNOWN;</span>
<span id="cb7-900"><a href="#cb7-900" aria-hidden="true"></a>              low = pmaphead-&gt;pml_map.pm_port &amp; <span class="bn">0xff</span>;</span>
<span id="cb7-901"><a href="#cb7-901" aria-hidden="true"></a>              high = (pmaphead-&gt;pml_map.pm_port &gt;&gt; <span class="dv">8</span>) &amp; <span class="bn">0xff</span>;</span>
<span id="cb7-902"><a href="#cb7-902" aria-hidden="true"></a>              list-&gt;rpcb_map.r_addr = strdup (<span class="st">&quot;0.0.0.0.XXX.XXX&quot;</span>);</span>
<span id="cb7-903"><a href="#cb7-903" aria-hidden="true"></a>              sprintf (&amp;list-&gt;rpcb_map.r_addr[<span class="dv">8</span>], <span class="st">&quot;%d.%d&quot;</span>, high, low);</span>
<span id="cb7-904"><a href="#cb7-904" aria-hidden="true"></a>              prev = list;</span>
<span id="cb7-905"><a href="#cb7-905" aria-hidden="true"></a>            }</span>
<span id="cb7-906"><a href="#cb7-906" aria-hidden="true"></a>        }</span>
<span id="cb7-907"><a href="#cb7-907" aria-hidden="true"></a>        }</span>
<span id="cb7-908"><a href="#cb7-908" aria-hidden="true"></a>    }</span>
<span id="cb7-909"><a href="#cb7-909" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-910"><a href="#cb7-910" aria-hidden="true"></a>    {           <span class="co">/* any other error */</span></span>
<span id="cb7-911"><a href="#cb7-911" aria-hidden="true"></a>    failed:</span>
<span id="cb7-912"><a href="#cb7-912" aria-hidden="true"></a>      clnt_perror (client, <span class="st">&quot;rpcinfo: can&#39;t contact rpcbind: &quot;</span>);</span>
<span id="cb7-913"><a href="#cb7-913" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-914"><a href="#cb7-914" aria-hidden="true"></a>    }</span>
<span id="cb7-915"><a href="#cb7-915" aria-hidden="true"></a>    }</span>
<span id="cb7-916"><a href="#cb7-916" aria-hidden="true"></a>  <span class="cf">if</span> (head == NULL)</span>
<span id="cb7-917"><a href="#cb7-917" aria-hidden="true"></a>    {</span>
<span id="cb7-918"><a href="#cb7-918" aria-hidden="true"></a>      printf (<span class="st">&quot;No remote programs registered.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-919"><a href="#cb7-919" aria-hidden="true"></a>    }</span>
<span id="cb7-920"><a href="#cb7-920" aria-hidden="true"></a>  <span class="cf">else</span> <span class="cf">if</span> (dumptype == RPCBDUMP)</span>
<span id="cb7-921"><a href="#cb7-921" aria-hidden="true"></a>    {</span>
<span id="cb7-922"><a href="#cb7-922" aria-hidden="true"></a>      printf</span>
<span id="cb7-923"><a href="#cb7-923" aria-hidden="true"></a>    (<span class="st">&quot;   program version netid     address                service    owner</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-924"><a href="#cb7-924" aria-hidden="true"></a>      <span class="cf">for</span> (; head != NULL; head = head-&gt;rpcb_next)</span>
<span id="cb7-925"><a href="#cb7-925" aria-hidden="true"></a>    {</span>
<span id="cb7-926"><a href="#cb7-926" aria-hidden="true"></a>      printf (<span class="st">&quot;%10u%5u    &quot;</span>,</span>
<span id="cb7-927"><a href="#cb7-927" aria-hidden="true"></a>          head-&gt;rpcb_map.r_prog, head-&gt;rpcb_map.r_vers);</span>
<span id="cb7-928"><a href="#cb7-928" aria-hidden="true"></a>      printf (<span class="st">&quot;%-9s &quot;</span>, head-&gt;rpcb_map.r_netid);</span>
<span id="cb7-929"><a href="#cb7-929" aria-hidden="true"></a>      printf (<span class="st">&quot;%-22s&quot;</span>, head-&gt;rpcb_map.r_addr);</span>
<span id="cb7-930"><a href="#cb7-930" aria-hidden="true"></a>      rpc = getrpcbynumber (head-&gt;rpcb_map.r_prog);</span>
<span id="cb7-931"><a href="#cb7-931" aria-hidden="true"></a>      <span class="cf">if</span> (rpc)</span>
<span id="cb7-932"><a href="#cb7-932" aria-hidden="true"></a>        printf (<span class="st">&quot; %-10s&quot;</span>, rpc-&gt;r_name);</span>
<span id="cb7-933"><a href="#cb7-933" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-934"><a href="#cb7-934" aria-hidden="true"></a>        printf (<span class="st">&quot; %-10s&quot;</span>, <span class="st">&quot;-&quot;</span>);</span>
<span id="cb7-935"><a href="#cb7-935" aria-hidden="true"></a>      printf (<span class="st">&quot; %s</span><span class="sc">\n</span><span class="st">&quot;</span>, head-&gt;rpcb_map.r_owner);</span>
<span id="cb7-936"><a href="#cb7-936" aria-hidden="true"></a>    }</span>
<span id="cb7-937"><a href="#cb7-937" aria-hidden="true"></a>    }</span>
<span id="cb7-938"><a href="#cb7-938" aria-hidden="true"></a>  <span class="cf">else</span> <span class="cf">if</span> (dumptype == RPCBDUMP_SHORT)</span>
<span id="cb7-939"><a href="#cb7-939" aria-hidden="true"></a>    {</span>
<span id="cb7-940"><a href="#cb7-940" aria-hidden="true"></a>      <span class="cf">for</span> (; head != NULL; head = head-&gt;rpcb_next)</span>
<span id="cb7-941"><a href="#cb7-941" aria-hidden="true"></a>    {</span>
<span id="cb7-942"><a href="#cb7-942" aria-hidden="true"></a>      <span class="cf">for</span> (rs = rs_head; rs; rs = rs-&gt;next)</span>
<span id="cb7-943"><a href="#cb7-943" aria-hidden="true"></a>        <span class="cf">if</span> (head-&gt;rpcb_map.r_prog == rs-&gt;prog)</span>
<span id="cb7-944"><a href="#cb7-944" aria-hidden="true"></a>          <span class="cf">break</span>;</span>
<span id="cb7-945"><a href="#cb7-945" aria-hidden="true"></a>      <span class="cf">if</span> (rs == NULL)</span>
<span id="cb7-946"><a href="#cb7-946" aria-hidden="true"></a>        {</span>
<span id="cb7-947"><a href="#cb7-947" aria-hidden="true"></a>          rs = (<span class="kw">struct</span> rpcbdump_short *)</span>
<span id="cb7-948"><a href="#cb7-948" aria-hidden="true"></a>        malloc (<span class="kw">sizeof</span> (<span class="kw">struct</span> rpcbdump_short));</span>
<span id="cb7-949"><a href="#cb7-949" aria-hidden="true"></a>          <span class="cf">if</span> (rs == NULL)</span>
<span id="cb7-950"><a href="#cb7-950" aria-hidden="true"></a>        <span class="cf">goto</span> error;</span>
<span id="cb7-951"><a href="#cb7-951" aria-hidden="true"></a>          rs-&gt;next = NULL;</span>
<span id="cb7-952"><a href="#cb7-952" aria-hidden="true"></a>          <span class="cf">if</span> (rs_head == NULL)</span>
<span id="cb7-953"><a href="#cb7-953" aria-hidden="true"></a>        {</span>
<span id="cb7-954"><a href="#cb7-954" aria-hidden="true"></a>          rs_head = rs;</span>
<span id="cb7-955"><a href="#cb7-955" aria-hidden="true"></a>          rs_tail = rs;</span>
<span id="cb7-956"><a href="#cb7-956" aria-hidden="true"></a>        }</span>
<span id="cb7-957"><a href="#cb7-957" aria-hidden="true"></a>          <span class="cf">else</span></span>
<span id="cb7-958"><a href="#cb7-958" aria-hidden="true"></a>        {</span>
<span id="cb7-959"><a href="#cb7-959" aria-hidden="true"></a>          rs_tail-&gt;next = rs;</span>
<span id="cb7-960"><a href="#cb7-960" aria-hidden="true"></a>          rs_tail = rs;</span>
<span id="cb7-961"><a href="#cb7-961" aria-hidden="true"></a>        }</span>
<span id="cb7-962"><a href="#cb7-962" aria-hidden="true"></a>          rs-&gt;prog = head-&gt;rpcb_map.r_prog;</span>
<span id="cb7-963"><a href="#cb7-963" aria-hidden="true"></a>          rs-&gt;owner = head-&gt;rpcb_map.r_owner;</span>
<span id="cb7-964"><a href="#cb7-964" aria-hidden="true"></a>          rs-&gt;nlist = NULL;</span>
<span id="cb7-965"><a href="#cb7-965" aria-hidden="true"></a>          rs-&gt;vlist = NULL;</span>
<span id="cb7-966"><a href="#cb7-966" aria-hidden="true"></a>        }</span>
<span id="cb7-967"><a href="#cb7-967" aria-hidden="true"></a>      <span class="cf">if</span> (add_version (rs, head-&gt;rpcb_map.r_vers) == FALSE)</span>
<span id="cb7-968"><a href="#cb7-968" aria-hidden="true"></a>        <span class="cf">goto</span> error;</span>
<span id="cb7-969"><a href="#cb7-969" aria-hidden="true"></a>      <span class="cf">if</span> (add_netid (rs, head-&gt;rpcb_map.r_netid) == FALSE)</span>
<span id="cb7-970"><a href="#cb7-970" aria-hidden="true"></a>        <span class="cf">goto</span> error;</span>
<span id="cb7-971"><a href="#cb7-971" aria-hidden="true"></a>    }</span>
<span id="cb7-972"><a href="#cb7-972" aria-hidden="true"></a>      printf</span>
<span id="cb7-973"><a href="#cb7-973" aria-hidden="true"></a>    (<span class="st">&quot;   program version(s) netid(s)                         service     owner</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-974"><a href="#cb7-974" aria-hidden="true"></a>      <span class="cf">for</span> (rs = rs_head; rs; rs = rs-&gt;next)</span>
<span id="cb7-975"><a href="#cb7-975" aria-hidden="true"></a>    {</span>
<span id="cb7-976"><a href="#cb7-976" aria-hidden="true"></a>      <span class="dt">size_t</span> netidmax = <span class="kw">sizeof</span>(buf) - <span class="dv">1</span>;</span>
<span id="cb7-977"><a href="#cb7-977" aria-hidden="true"></a>      <span class="dt">char</span> *p = buf;</span>
<span id="cb7-978"><a href="#cb7-978" aria-hidden="true"></a></span>
<span id="cb7-979"><a href="#cb7-979" aria-hidden="true"></a>      printf (<span class="st">&quot;%10ld  &quot;</span>, rs-&gt;prog);</span>
<span id="cb7-980"><a href="#cb7-980" aria-hidden="true"></a>      <span class="cf">for</span> (vl = rs-&gt;vlist; vl; vl = vl-&gt;next)</span>
<span id="cb7-981"><a href="#cb7-981" aria-hidden="true"></a>        {</span>
<span id="cb7-982"><a href="#cb7-982" aria-hidden="true"></a>          sprintf (p, <span class="st">&quot;%d&quot;</span>, vl-&gt;vers);</span>
<span id="cb7-983"><a href="#cb7-983" aria-hidden="true"></a>          p = p + strlen (p);</span>
<span id="cb7-984"><a href="#cb7-984" aria-hidden="true"></a>          <span class="cf">if</span> (vl-&gt;next)</span>
<span id="cb7-985"><a href="#cb7-985" aria-hidden="true"></a>        sprintf (p++, <span class="st">&quot;,&quot;</span>);</span>
<span id="cb7-986"><a href="#cb7-986" aria-hidden="true"></a>        }</span>
<span id="cb7-987"><a href="#cb7-987" aria-hidden="true"></a>      printf (<span class="st">&quot;%-10s&quot;</span>, buf);</span>
<span id="cb7-988"><a href="#cb7-988" aria-hidden="true"></a>      buf[<span class="dv">0</span>] = <span class="ch">&#39;\0&#39;</span>;</span>
<span id="cb7-989"><a href="#cb7-989" aria-hidden="true"></a></span>
<span id="cb7-990"><a href="#cb7-990" aria-hidden="true"></a>          <span class="cf">for</span> (nl = rs-&gt;nlist; nl; nl = nl-&gt;next)</span>
<span id="cb7-991"><a href="#cb7-991" aria-hidden="true"></a>            {</span>
<span id="cb7-992"><a href="#cb7-992" aria-hidden="true"></a>              strncat (buf, nl-&gt;netid, netidmax);</span>
<span id="cb7-993"><a href="#cb7-993" aria-hidden="true"></a>              <span class="cf">if</span> (strlen (nl-&gt;netid) &lt; netidmax)</span>
<span id="cb7-994"><a href="#cb7-994" aria-hidden="true"></a>                netidmax -= strlen(nl-&gt;netid);</span>
<span id="cb7-995"><a href="#cb7-995" aria-hidden="true"></a>              <span class="cf">else</span></span>
<span id="cb7-996"><a href="#cb7-996" aria-hidden="true"></a>                <span class="cf">break</span>;</span>
<span id="cb7-997"><a href="#cb7-997" aria-hidden="true"></a></span>
<span id="cb7-998"><a href="#cb7-998" aria-hidden="true"></a>              <span class="cf">if</span> (nl-&gt;next &amp;&amp; netidmax &gt; <span class="dv">1</span>)</span>
<span id="cb7-999"><a href="#cb7-999" aria-hidden="true"></a>                {</span>
<span id="cb7-1000"><a href="#cb7-1000" aria-hidden="true"></a>                  strncat (buf, <span class="st">&quot;,&quot;</span>, netidmax);</span>
<span id="cb7-1001"><a href="#cb7-1001" aria-hidden="true"></a>                  netidmax --;</span>
<span id="cb7-1002"><a href="#cb7-1002" aria-hidden="true"></a>                }</span>
<span id="cb7-1003"><a href="#cb7-1003" aria-hidden="true"></a>            }</span>
<span id="cb7-1004"><a href="#cb7-1004" aria-hidden="true"></a></span>
<span id="cb7-1005"><a href="#cb7-1005" aria-hidden="true"></a>      printf (<span class="st">&quot;%-32s&quot;</span>, buf);</span>
<span id="cb7-1006"><a href="#cb7-1006" aria-hidden="true"></a>      rpc = getrpcbynumber (rs-&gt;prog);</span>
<span id="cb7-1007"><a href="#cb7-1007" aria-hidden="true"></a>      <span class="cf">if</span> (rpc)</span>
<span id="cb7-1008"><a href="#cb7-1008" aria-hidden="true"></a>        printf (<span class="st">&quot; %-11s&quot;</span>, rpc-&gt;r_name);</span>
<span id="cb7-1009"><a href="#cb7-1009" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1010"><a href="#cb7-1010" aria-hidden="true"></a>        printf (<span class="st">&quot; %-11s&quot;</span>, <span class="st">&quot;-&quot;</span>);</span>
<span id="cb7-1011"><a href="#cb7-1011" aria-hidden="true"></a>      printf (<span class="st">&quot; %s</span><span class="sc">\n</span><span class="st">&quot;</span>, rs-&gt;owner);</span>
<span id="cb7-1012"><a href="#cb7-1012" aria-hidden="true"></a>    }</span>
<span id="cb7-1013"><a href="#cb7-1013" aria-hidden="true"></a>    }</span>
<span id="cb7-1014"><a href="#cb7-1014" aria-hidden="true"></a>  clnt_destroy (client);</span>
<span id="cb7-1015"><a href="#cb7-1015" aria-hidden="true"></a>  <span class="cf">return</span>;</span>
<span id="cb7-1016"><a href="#cb7-1016" aria-hidden="true"></a>error:fprintf (stderr, <span class="st">&quot;rpcinfo: no memory</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1017"><a href="#cb7-1017" aria-hidden="true"></a>  <span class="cf">return</span>;</span>
<span id="cb7-1018"><a href="#cb7-1018" aria-hidden="true"></a>}</span>
<span id="cb7-1019"><a href="#cb7-1019" aria-hidden="true"></a></span>
<span id="cb7-1020"><a href="#cb7-1020" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">char</span> nullstring[] = <span class="st">&quot;</span><span class="sc">\000</span><span class="st">&quot;</span>;</span>
<span id="cb7-1021"><a href="#cb7-1021" aria-hidden="true"></a></span>
<span id="cb7-1022"><a href="#cb7-1022" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1023"><a href="#cb7-1023" aria-hidden="true"></a>rpcbaddrlist (netid, argc, argv)</span>
<span id="cb7-1024"><a href="#cb7-1024" aria-hidden="true"></a>     <span class="dt">char</span> *netid;</span>
<span id="cb7-1025"><a href="#cb7-1025" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-1026"><a href="#cb7-1026" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-1027"><a href="#cb7-1027" aria-hidden="true"></a>{</span>
<span id="cb7-1028"><a href="#cb7-1028" aria-hidden="true"></a>  rpcb_entry_list_ptr head = NULL;</span>
<span id="cb7-1029"><a href="#cb7-1029" aria-hidden="true"></a>  <span class="kw">struct</span> timeval minutetimeout;</span>
<span id="cb7-1030"><a href="#cb7-1030" aria-hidden="true"></a>  <span class="dt">register</span> CLIENT *client;</span>
<span id="cb7-1031"><a href="#cb7-1031" aria-hidden="true"></a>  <span class="kw">struct</span> rpcent *rpc;</span>
<span id="cb7-1032"><a href="#cb7-1032" aria-hidden="true"></a>  <span class="dt">char</span> *host;</span>
<span id="cb7-1033"><a href="#cb7-1033" aria-hidden="true"></a>  RPCB parms;</span>
<span id="cb7-1034"><a href="#cb7-1034" aria-hidden="true"></a>  <span class="kw">struct</span> netbuf *targaddr;</span>
<span id="cb7-1035"><a href="#cb7-1035" aria-hidden="true"></a></span>
<span id="cb7-1036"><a href="#cb7-1036" aria-hidden="true"></a>  <span class="cf">if</span> (argc != <span class="dv">3</span>)</span>
<span id="cb7-1037"><a href="#cb7-1037" aria-hidden="true"></a>    {</span>
<span id="cb7-1038"><a href="#cb7-1038" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-1039"><a href="#cb7-1039" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1040"><a href="#cb7-1040" aria-hidden="true"></a>    }</span>
<span id="cb7-1041"><a href="#cb7-1041" aria-hidden="true"></a>  host = argv[<span class="dv">0</span>];</span>
<span id="cb7-1042"><a href="#cb7-1042" aria-hidden="true"></a>  <span class="cf">if</span> (netid == NULL)</span>
<span id="cb7-1043"><a href="#cb7-1043" aria-hidden="true"></a>    {</span>
<span id="cb7-1044"><a href="#cb7-1044" aria-hidden="true"></a>      client = clnt_rpcbind_create (host, RPCBVERS4, &amp;targaddr);</span>
<span id="cb7-1045"><a href="#cb7-1045" aria-hidden="true"></a>    }</span>
<span id="cb7-1046"><a href="#cb7-1046" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1047"><a href="#cb7-1047" aria-hidden="true"></a>    {</span>
<span id="cb7-1048"><a href="#cb7-1048" aria-hidden="true"></a>      <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-1049"><a href="#cb7-1049" aria-hidden="true"></a></span>
<span id="cb7-1050"><a href="#cb7-1050" aria-hidden="true"></a>      nconf = getnetconfigent (netid);</span>
<span id="cb7-1051"><a href="#cb7-1051" aria-hidden="true"></a>      <span class="cf">if</span> (nconf == NULL)</span>
<span id="cb7-1052"><a href="#cb7-1052" aria-hidden="true"></a>    {</span>
<span id="cb7-1053"><a href="#cb7-1053" aria-hidden="true"></a>      nc_perror (<span class="st">&quot;rpcinfo: invalid transport&quot;</span>);</span>
<span id="cb7-1054"><a href="#cb7-1054" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1055"><a href="#cb7-1055" aria-hidden="true"></a>    }</span>
<span id="cb7-1056"><a href="#cb7-1056" aria-hidden="true"></a>      client = getclnthandle (host, nconf, RPCBVERS4, &amp;targaddr);</span>
<span id="cb7-1057"><a href="#cb7-1057" aria-hidden="true"></a>      <span class="cf">if</span> (nconf)</span>
<span id="cb7-1058"><a href="#cb7-1058" aria-hidden="true"></a>    (<span class="dt">void</span>) freenetconfigent (nconf);</span>
<span id="cb7-1059"><a href="#cb7-1059" aria-hidden="true"></a>    }</span>
<span id="cb7-1060"><a href="#cb7-1060" aria-hidden="true"></a>  <span class="cf">if</span> (client == (CLIENT *) NULL)</span>
<span id="cb7-1061"><a href="#cb7-1061" aria-hidden="true"></a>    {</span>
<span id="cb7-1062"><a href="#cb7-1062" aria-hidden="true"></a>      clnt_pcreateerror (<span class="st">&quot;rpcinfo: can&#39;t contact rpcbind&quot;</span>);</span>
<span id="cb7-1063"><a href="#cb7-1063" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1064"><a href="#cb7-1064" aria-hidden="true"></a>    }</span>
<span id="cb7-1065"><a href="#cb7-1065" aria-hidden="true"></a>  minutetimeout.tv_sec = <span class="dv">60</span>;</span>
<span id="cb7-1066"><a href="#cb7-1066" aria-hidden="true"></a>  minutetimeout.tv_usec = <span class="dv">0</span>;</span>
<span id="cb7-1067"><a href="#cb7-1067" aria-hidden="true"></a></span>
<span id="cb7-1068"><a href="#cb7-1068" aria-hidden="true"></a>  parms.r_prog = getprognum (argv[<span class="dv">1</span>]);</span>
<span id="cb7-1069"><a href="#cb7-1069" aria-hidden="true"></a>  parms.r_vers = getvers (argv[<span class="dv">2</span>]);</span>
<span id="cb7-1070"><a href="#cb7-1070" aria-hidden="true"></a>  parms.r_netid = client-&gt;cl_netid;</span>
<span id="cb7-1071"><a href="#cb7-1071" aria-hidden="true"></a>  <span class="cf">if</span> (targaddr == NULL)</span>
<span id="cb7-1072"><a href="#cb7-1072" aria-hidden="true"></a>    {</span>
<span id="cb7-1073"><a href="#cb7-1073" aria-hidden="true"></a>      parms.r_addr = nullstring;    <span class="co">/* for XDRing */</span></span>
<span id="cb7-1074"><a href="#cb7-1074" aria-hidden="true"></a>    }</span>
<span id="cb7-1075"><a href="#cb7-1075" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1076"><a href="#cb7-1076" aria-hidden="true"></a>    {</span>
<span id="cb7-1077"><a href="#cb7-1077" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1078"><a href="#cb7-1078" aria-hidden="true"></a><span class="co">       * We also send the remote system the address we</span></span>
<span id="cb7-1079"><a href="#cb7-1079" aria-hidden="true"></a><span class="co">       * used to contact it in case it can help it</span></span>
<span id="cb7-1080"><a href="#cb7-1080" aria-hidden="true"></a><span class="co">       * connect back with us</span></span>
<span id="cb7-1081"><a href="#cb7-1081" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1082"><a href="#cb7-1082" aria-hidden="true"></a>      <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-1083"><a href="#cb7-1083" aria-hidden="true"></a></span>
<span id="cb7-1084"><a href="#cb7-1084" aria-hidden="true"></a>      nconf = getnetconfigent (client-&gt;cl_netid);</span>
<span id="cb7-1085"><a href="#cb7-1085" aria-hidden="true"></a>      <span class="cf">if</span> (nconf != NULL)</span>
<span id="cb7-1086"><a href="#cb7-1086" aria-hidden="true"></a>    {</span>
<span id="cb7-1087"><a href="#cb7-1087" aria-hidden="true"></a>      parms.r_addr = taddr2uaddr (nconf, targaddr);</span>
<span id="cb7-1088"><a href="#cb7-1088" aria-hidden="true"></a>      <span class="cf">if</span> (parms.r_addr == NULL)</span>
<span id="cb7-1089"><a href="#cb7-1089" aria-hidden="true"></a>        parms.r_addr = nullstring;</span>
<span id="cb7-1090"><a href="#cb7-1090" aria-hidden="true"></a>      freenetconfigent (nconf);</span>
<span id="cb7-1091"><a href="#cb7-1091" aria-hidden="true"></a>    }</span>
<span id="cb7-1092"><a href="#cb7-1092" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1093"><a href="#cb7-1093" aria-hidden="true"></a>    {</span>
<span id="cb7-1094"><a href="#cb7-1094" aria-hidden="true"></a>      parms.r_addr = nullstring;    <span class="co">/* for XDRing */</span></span>
<span id="cb7-1095"><a href="#cb7-1095" aria-hidden="true"></a>    }</span>
<span id="cb7-1096"><a href="#cb7-1096" aria-hidden="true"></a>      free (targaddr-&gt;buf);</span>
<span id="cb7-1097"><a href="#cb7-1097" aria-hidden="true"></a>      free (targaddr);</span>
<span id="cb7-1098"><a href="#cb7-1098" aria-hidden="true"></a>    }</span>
<span id="cb7-1099"><a href="#cb7-1099" aria-hidden="true"></a>  parms.r_owner = nullstring;</span>
<span id="cb7-1100"><a href="#cb7-1100" aria-hidden="true"></a></span>
<span id="cb7-1101"><a href="#cb7-1101" aria-hidden="true"></a>  <span class="cf">if</span> (CLNT_CALL (client, RPCBPROC_GETADDRLIST, (xdrproc_t) xdr_rpcb,</span>
<span id="cb7-1102"><a href="#cb7-1102" aria-hidden="true"></a>         (<span class="dt">char</span> *) &amp;parms, (xdrproc_t) xdr_rpcb_entry_list_ptr,</span>
<span id="cb7-1103"><a href="#cb7-1103" aria-hidden="true"></a>         (<span class="dt">char</span> *) &amp;head, minutetimeout) != RPC_SUCCESS)</span>
<span id="cb7-1104"><a href="#cb7-1104" aria-hidden="true"></a>    {</span>
<span id="cb7-1105"><a href="#cb7-1105" aria-hidden="true"></a>      clnt_perror (client, <span class="st">&quot;rpcinfo: can&#39;t contact rpcbind: &quot;</span>);</span>
<span id="cb7-1106"><a href="#cb7-1106" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1107"><a href="#cb7-1107" aria-hidden="true"></a>    }</span>
<span id="cb7-1108"><a href="#cb7-1108" aria-hidden="true"></a>  <span class="cf">if</span> (head == NULL)</span>
<span id="cb7-1109"><a href="#cb7-1109" aria-hidden="true"></a>    {</span>
<span id="cb7-1110"><a href="#cb7-1110" aria-hidden="true"></a>      printf (<span class="st">&quot;No remote programs registered.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1111"><a href="#cb7-1111" aria-hidden="true"></a>    }</span>
<span id="cb7-1112"><a href="#cb7-1112" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1113"><a href="#cb7-1113" aria-hidden="true"></a>    {</span>
<span id="cb7-1114"><a href="#cb7-1114" aria-hidden="true"></a>      printf</span>
<span id="cb7-1115"><a href="#cb7-1115" aria-hidden="true"></a>    (<span class="st">&quot;   program vers  tp_family/name/class    address</span><span class="sc">\t\t</span><span class="st">  service</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1116"><a href="#cb7-1116" aria-hidden="true"></a>      <span class="cf">for</span> (; head != NULL; head = head-&gt;rpcb_entry_next)</span>
<span id="cb7-1117"><a href="#cb7-1117" aria-hidden="true"></a>    {</span>
<span id="cb7-1118"><a href="#cb7-1118" aria-hidden="true"></a>      rpcb_entry *re;</span>
<span id="cb7-1119"><a href="#cb7-1119" aria-hidden="true"></a>      <span class="dt">char</span> buf[<span class="dv">128</span>];</span>
<span id="cb7-1120"><a href="#cb7-1120" aria-hidden="true"></a></span>
<span id="cb7-1121"><a href="#cb7-1121" aria-hidden="true"></a>      re = &amp;head-&gt;rpcb_entry_map;</span>
<span id="cb7-1122"><a href="#cb7-1122" aria-hidden="true"></a>      printf (<span class="st">&quot;%10u%3u    &quot;</span>, parms.r_prog, parms.r_vers);</span>
<span id="cb7-1123"><a href="#cb7-1123" aria-hidden="true"></a>      sprintf (buf, <span class="st">&quot;%s/%s/%s &quot;</span>,</span>
<span id="cb7-1124"><a href="#cb7-1124" aria-hidden="true"></a>           re-&gt;r_nc_protofmly, re-&gt;r_nc_proto,</span>
<span id="cb7-1125"><a href="#cb7-1125" aria-hidden="true"></a>           re-&gt;r_nc_semantics == NC_TPI_CLTS ? <span class="st">&quot;clts&quot;</span> :</span>
<span id="cb7-1126"><a href="#cb7-1126" aria-hidden="true"></a>           re-&gt;r_nc_semantics == NC_TPI_COTS ? <span class="st">&quot;cots&quot;</span> : <span class="st">&quot;cots_ord&quot;</span>);</span>
<span id="cb7-1127"><a href="#cb7-1127" aria-hidden="true"></a>      printf (<span class="st">&quot;%-24s&quot;</span>, buf);</span>
<span id="cb7-1128"><a href="#cb7-1128" aria-hidden="true"></a>      printf (<span class="st">&quot;%-24s&quot;</span>, re-&gt;r_maddr);</span>
<span id="cb7-1129"><a href="#cb7-1129" aria-hidden="true"></a>      rpc = getrpcbynumber (parms.r_prog);</span>
<span id="cb7-1130"><a href="#cb7-1130" aria-hidden="true"></a>      <span class="cf">if</span> (rpc)</span>
<span id="cb7-1131"><a href="#cb7-1131" aria-hidden="true"></a>        printf (<span class="st">&quot; %-13s&quot;</span>, rpc-&gt;r_name);</span>
<span id="cb7-1132"><a href="#cb7-1132" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1133"><a href="#cb7-1133" aria-hidden="true"></a>        printf (<span class="st">&quot; %-13s&quot;</span>, <span class="st">&quot;-&quot;</span>);</span>
<span id="cb7-1134"><a href="#cb7-1134" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1135"><a href="#cb7-1135" aria-hidden="true"></a>    }</span>
<span id="cb7-1136"><a href="#cb7-1136" aria-hidden="true"></a>    }</span>
<span id="cb7-1137"><a href="#cb7-1137" aria-hidden="true"></a>  clnt_destroy (client);</span>
<span id="cb7-1138"><a href="#cb7-1138" aria-hidden="true"></a>  <span class="cf">return</span>;</span>
<span id="cb7-1139"><a href="#cb7-1139" aria-hidden="true"></a>}</span>
<span id="cb7-1140"><a href="#cb7-1140" aria-hidden="true"></a></span>
<span id="cb7-1141"><a href="#cb7-1141" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-1142"><a href="#cb7-1142" aria-hidden="true"></a><span class="co"> * monitor rpcbind</span></span>
<span id="cb7-1143"><a href="#cb7-1143" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-1144"><a href="#cb7-1144" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1145"><a href="#cb7-1145" aria-hidden="true"></a>rpcbgetstat (argc, argv)</span>
<span id="cb7-1146"><a href="#cb7-1146" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-1147"><a href="#cb7-1147" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-1148"><a href="#cb7-1148" aria-hidden="true"></a>{</span>
<span id="cb7-1149"><a href="#cb7-1149" aria-hidden="true"></a>  rpcb_stat_byvers inf;</span>
<span id="cb7-1150"><a href="#cb7-1150" aria-hidden="true"></a>  <span class="kw">struct</span> timeval minutetimeout;</span>
<span id="cb7-1151"><a href="#cb7-1151" aria-hidden="true"></a>  <span class="dt">register</span> CLIENT *client;</span>
<span id="cb7-1152"><a href="#cb7-1152" aria-hidden="true"></a>  <span class="dt">char</span> *host;</span>
<span id="cb7-1153"><a href="#cb7-1153" aria-hidden="true"></a>  <span class="dt">int</span> i, j;</span>
<span id="cb7-1154"><a href="#cb7-1154" aria-hidden="true"></a>  rpcbs_addrlist *pa;</span>
<span id="cb7-1155"><a href="#cb7-1155" aria-hidden="true"></a>  rpcbs_rmtcalllist *pr;</span>
<span id="cb7-1156"><a href="#cb7-1156" aria-hidden="true"></a>  <span class="dt">int</span> cnt, flen;</span>
<span id="cb7-1157"><a href="#cb7-1157" aria-hidden="true"></a><span class="pp">#define MAXFIELD    64</span></span>
<span id="cb7-1158"><a href="#cb7-1158" aria-hidden="true"></a>  <span class="dt">char</span> fieldbuf[MAXFIELD];</span>
<span id="cb7-1159"><a href="#cb7-1159" aria-hidden="true"></a><span class="pp">#define MAXLINE     256</span></span>
<span id="cb7-1160"><a href="#cb7-1160" aria-hidden="true"></a>  <span class="dt">char</span> linebuf[MAXLINE];</span>
<span id="cb7-1161"><a href="#cb7-1161" aria-hidden="true"></a>  <span class="dt">char</span> *cp, *lp;</span>
<span id="cb7-1162"><a href="#cb7-1162" aria-hidden="true"></a>  <span class="dt">char</span> *pmaphdr[] = {</span>
<span id="cb7-1163"><a href="#cb7-1163" aria-hidden="true"></a>    <span class="st">&quot;NULL&quot;</span>, <span class="st">&quot;SET&quot;</span>, <span class="st">&quot;UNSET&quot;</span>, <span class="st">&quot;GETPORT&quot;</span>,</span>
<span id="cb7-1164"><a href="#cb7-1164" aria-hidden="true"></a>    <span class="st">&quot;DUMP&quot;</span>, <span class="st">&quot;CALLIT&quot;</span></span>
<span id="cb7-1165"><a href="#cb7-1165" aria-hidden="true"></a>  };</span>
<span id="cb7-1166"><a href="#cb7-1166" aria-hidden="true"></a>  <span class="dt">char</span> *rpcb3hdr[] = {</span>
<span id="cb7-1167"><a href="#cb7-1167" aria-hidden="true"></a>    <span class="st">&quot;NULL&quot;</span>, <span class="st">&quot;SET&quot;</span>, <span class="st">&quot;UNSET&quot;</span>, <span class="st">&quot;GETADDR&quot;</span>, <span class="st">&quot;DUMP&quot;</span>, <span class="st">&quot;CALLIT&quot;</span>, <span class="st">&quot;TIME&quot;</span>,</span>
<span id="cb7-1168"><a href="#cb7-1168" aria-hidden="true"></a>    <span class="st">&quot;U2T&quot;</span>, <span class="st">&quot;T2U&quot;</span></span>
<span id="cb7-1169"><a href="#cb7-1169" aria-hidden="true"></a>  };</span>
<span id="cb7-1170"><a href="#cb7-1170" aria-hidden="true"></a>  <span class="dt">char</span> *rpcb4hdr[] = {</span>
<span id="cb7-1171"><a href="#cb7-1171" aria-hidden="true"></a>    <span class="st">&quot;NULL&quot;</span>, <span class="st">&quot;SET&quot;</span>, <span class="st">&quot;UNSET&quot;</span>, <span class="st">&quot;GETADDR&quot;</span>, <span class="st">&quot;DUMP&quot;</span>, <span class="st">&quot;CALLIT&quot;</span>, <span class="st">&quot;TIME&quot;</span>,</span>
<span id="cb7-1172"><a href="#cb7-1172" aria-hidden="true"></a>    <span class="st">&quot;U2T&quot;</span>, <span class="st">&quot;T2U&quot;</span>, <span class="st">&quot;VERADDR&quot;</span>, <span class="st">&quot;INDRECT&quot;</span>, <span class="st">&quot;GETLIST&quot;</span>, <span class="st">&quot;GETSTAT&quot;</span></span>
<span id="cb7-1173"><a href="#cb7-1173" aria-hidden="true"></a>  };</span>
<span id="cb7-1174"><a href="#cb7-1174" aria-hidden="true"></a></span>
<span id="cb7-1175"><a href="#cb7-1175" aria-hidden="true"></a><span class="pp">#define TABSTOP 8</span></span>
<span id="cb7-1176"><a href="#cb7-1176" aria-hidden="true"></a></span>
<span id="cb7-1177"><a href="#cb7-1177" aria-hidden="true"></a>  <span class="cf">if</span> (argc &gt;= <span class="dv">1</span>)</span>
<span id="cb7-1178"><a href="#cb7-1178" aria-hidden="true"></a>    {</span>
<span id="cb7-1179"><a href="#cb7-1179" aria-hidden="true"></a>      host = argv[<span class="dv">0</span>];</span>
<span id="cb7-1180"><a href="#cb7-1180" aria-hidden="true"></a>      client = clnt_rpcbind_create (host, RPCBVERS4, NULL);</span>
<span id="cb7-1181"><a href="#cb7-1181" aria-hidden="true"></a>    }</span>
<span id="cb7-1182"><a href="#cb7-1182" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1183"><a href="#cb7-1183" aria-hidden="true"></a>    client = local_rpcb (PMAPPROG, RPCBVERS4);</span>
<span id="cb7-1184"><a href="#cb7-1184" aria-hidden="true"></a>  <span class="cf">if</span> (client == (CLIENT *) NULL)</span>
<span id="cb7-1185"><a href="#cb7-1185" aria-hidden="true"></a>    {</span>
<span id="cb7-1186"><a href="#cb7-1186" aria-hidden="true"></a>      clnt_pcreateerror (<span class="st">&quot;rpcinfo: can&#39;t contact rpcbind&quot;</span>);</span>
<span id="cb7-1187"><a href="#cb7-1187" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1188"><a href="#cb7-1188" aria-hidden="true"></a>    }</span>
<span id="cb7-1189"><a href="#cb7-1189" aria-hidden="true"></a>  minutetimeout.tv_sec = <span class="dv">60</span>;</span>
<span id="cb7-1190"><a href="#cb7-1190" aria-hidden="true"></a>  minutetimeout.tv_usec = <span class="dv">0</span>;</span>
<span id="cb7-1191"><a href="#cb7-1191" aria-hidden="true"></a>  memset ((<span class="dt">char</span> *) &amp;inf, <span class="dv">0</span>, <span class="kw">sizeof</span> (rpcb_stat_byvers));</span>
<span id="cb7-1192"><a href="#cb7-1192" aria-hidden="true"></a>  <span class="cf">if</span> (CLNT_CALL (client, RPCBPROC_GETSTAT, (xdrproc_t) xdr_void, NULL,</span>
<span id="cb7-1193"><a href="#cb7-1193" aria-hidden="true"></a>         (xdrproc_t) xdr_rpcb_stat_byvers, (<span class="dt">char</span> *) &amp;inf,</span>
<span id="cb7-1194"><a href="#cb7-1194" aria-hidden="true"></a>         minutetimeout) != RPC_SUCCESS)</span>
<span id="cb7-1195"><a href="#cb7-1195" aria-hidden="true"></a>    {</span>
<span id="cb7-1196"><a href="#cb7-1196" aria-hidden="true"></a>      clnt_perror (client, <span class="st">&quot;rpcinfo: can&#39;t contact rpcbind: &quot;</span>);</span>
<span id="cb7-1197"><a href="#cb7-1197" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1198"><a href="#cb7-1198" aria-hidden="true"></a>    }</span>
<span id="cb7-1199"><a href="#cb7-1199" aria-hidden="true"></a>  printf (<span class="st">&quot;PORTMAP (version 2) statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1200"><a href="#cb7-1200" aria-hidden="true"></a>  lp = linebuf;</span>
<span id="cb7-1201"><a href="#cb7-1201" aria-hidden="true"></a>  <span class="cf">for</span> (i = <span class="dv">0</span>; i &lt;= rpcb_highproc_2; i++)</span>
<span id="cb7-1202"><a href="#cb7-1202" aria-hidden="true"></a>    {</span>
<span id="cb7-1203"><a href="#cb7-1203" aria-hidden="true"></a>      fieldbuf[<span class="dv">0</span>] = <span class="ch">&#39;\0&#39;</span>;</span>
<span id="cb7-1204"><a href="#cb7-1204" aria-hidden="true"></a>      <span class="cf">switch</span> (i)</span>
<span id="cb7-1205"><a href="#cb7-1205" aria-hidden="true"></a>    {</span>
<span id="cb7-1206"><a href="#cb7-1206" aria-hidden="true"></a>    <span class="cf">case</span> PMAPPROC_SET:</span>
<span id="cb7-1207"><a href="#cb7-1207" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, inf[RPCBVERS_2_STAT].setinfo);</span>
<span id="cb7-1208"><a href="#cb7-1208" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1209"><a href="#cb7-1209" aria-hidden="true"></a>    <span class="cf">case</span> PMAPPROC_UNSET:</span>
<span id="cb7-1210"><a href="#cb7-1210" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, inf[RPCBVERS_2_STAT].unsetinfo);</span>
<span id="cb7-1211"><a href="#cb7-1211" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1212"><a href="#cb7-1212" aria-hidden="true"></a>    <span class="cf">case</span> PMAPPROC_GETPORT:</span>
<span id="cb7-1213"><a href="#cb7-1213" aria-hidden="true"></a>      cnt = <span class="dv">0</span>;</span>
<span id="cb7-1214"><a href="#cb7-1214" aria-hidden="true"></a>      <span class="cf">for</span> (pa = inf[RPCBVERS_2_STAT].addrinfo; pa; pa = pa-&gt;next)</span>
<span id="cb7-1215"><a href="#cb7-1215" aria-hidden="true"></a>        cnt += pa-&gt;success;</span>
<span id="cb7-1216"><a href="#cb7-1216" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, cnt);</span>
<span id="cb7-1217"><a href="#cb7-1217" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1218"><a href="#cb7-1218" aria-hidden="true"></a>    <span class="cf">case</span> PMAPPROC_CALLIT:</span>
<span id="cb7-1219"><a href="#cb7-1219" aria-hidden="true"></a>      cnt = <span class="dv">0</span>;</span>
<span id="cb7-1220"><a href="#cb7-1220" aria-hidden="true"></a>      <span class="cf">for</span> (pr = inf[RPCBVERS_2_STAT].rmtinfo; pr; pr = pr-&gt;next)</span>
<span id="cb7-1221"><a href="#cb7-1221" aria-hidden="true"></a>        cnt += pr-&gt;success;</span>
<span id="cb7-1222"><a href="#cb7-1222" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, cnt);</span>
<span id="cb7-1223"><a href="#cb7-1223" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1224"><a href="#cb7-1224" aria-hidden="true"></a>    <span class="cf">default</span>:</span>
<span id="cb7-1225"><a href="#cb7-1225" aria-hidden="true"></a>      <span class="cf">break</span>;        <span class="co">/* For the remaining ones */</span></span>
<span id="cb7-1226"><a href="#cb7-1226" aria-hidden="true"></a>    }</span>
<span id="cb7-1227"><a href="#cb7-1227" aria-hidden="true"></a>      cp = &amp;fieldbuf[<span class="dv">0</span>] + strlen (fieldbuf);</span>
<span id="cb7-1228"><a href="#cb7-1228" aria-hidden="true"></a>      sprintf (cp, <span class="st">&quot;%d&quot;</span>, inf[RPCBVERS_2_STAT].info[i]);</span>
<span id="cb7-1229"><a href="#cb7-1229" aria-hidden="true"></a>      flen = strlen (fieldbuf);</span>
<span id="cb7-1230"><a href="#cb7-1230" aria-hidden="true"></a>      printf (<span class="st">&quot;%s%s&quot;</span>, pmaphdr[i],</span>
<span id="cb7-1231"><a href="#cb7-1231" aria-hidden="true"></a>          spaces ((TABSTOP * (<span class="dv">1</span> + flen / TABSTOP))</span>
<span id="cb7-1232"><a href="#cb7-1232" aria-hidden="true"></a>              - strlen (pmaphdr[i])));</span>
<span id="cb7-1233"><a href="#cb7-1233" aria-hidden="true"></a>      sprintf (lp, <span class="st">&quot;%s%s&quot;</span>, fieldbuf,</span>
<span id="cb7-1234"><a href="#cb7-1234" aria-hidden="true"></a>           spaces (cnt = ((TABSTOP * (<span class="dv">1</span> + flen / TABSTOP)) - flen)));</span>
<span id="cb7-1235"><a href="#cb7-1235" aria-hidden="true"></a>      lp += (flen + cnt);</span>
<span id="cb7-1236"><a href="#cb7-1236" aria-hidden="true"></a>    }</span>
<span id="cb7-1237"><a href="#cb7-1237" aria-hidden="true"></a>  printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">%s</span><span class="sc">\n\n</span><span class="st">&quot;</span>, linebuf);</span>
<span id="cb7-1238"><a href="#cb7-1238" aria-hidden="true"></a></span>
<span id="cb7-1239"><a href="#cb7-1239" aria-hidden="true"></a>  <span class="cf">if</span> (inf[RPCBVERS_2_STAT].info[PMAPPROC_CALLIT])</span>
<span id="cb7-1240"><a href="#cb7-1240" aria-hidden="true"></a>    {</span>
<span id="cb7-1241"><a href="#cb7-1241" aria-hidden="true"></a>      printf (<span class="st">&quot;PMAP_RMTCALL call statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1242"><a href="#cb7-1242" aria-hidden="true"></a>      print_rmtcallstat (RPCBVERS_2_STAT, &amp;inf[RPCBVERS_2_STAT]);</span>
<span id="cb7-1243"><a href="#cb7-1243" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1244"><a href="#cb7-1244" aria-hidden="true"></a>    }</span>
<span id="cb7-1245"><a href="#cb7-1245" aria-hidden="true"></a></span>
<span id="cb7-1246"><a href="#cb7-1246" aria-hidden="true"></a>  <span class="cf">if</span> (inf[RPCBVERS_2_STAT].info[PMAPPROC_GETPORT])</span>
<span id="cb7-1247"><a href="#cb7-1247" aria-hidden="true"></a>    {</span>
<span id="cb7-1248"><a href="#cb7-1248" aria-hidden="true"></a>      printf (<span class="st">&quot;PMAP_GETPORT call statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1249"><a href="#cb7-1249" aria-hidden="true"></a>      print_getaddrstat (RPCBVERS_2_STAT, &amp;inf[RPCBVERS_2_STAT]);</span>
<span id="cb7-1250"><a href="#cb7-1250" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1251"><a href="#cb7-1251" aria-hidden="true"></a>    }</span>
<span id="cb7-1252"><a href="#cb7-1252" aria-hidden="true"></a></span>
<span id="cb7-1253"><a href="#cb7-1253" aria-hidden="true"></a>  printf (<span class="st">&quot;RPCBIND (version 3) statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1254"><a href="#cb7-1254" aria-hidden="true"></a>  lp = linebuf;</span>
<span id="cb7-1255"><a href="#cb7-1255" aria-hidden="true"></a>  <span class="cf">for</span> (i = <span class="dv">0</span>; i &lt;= rpcb_highproc_3; i++)</span>
<span id="cb7-1256"><a href="#cb7-1256" aria-hidden="true"></a>    {</span>
<span id="cb7-1257"><a href="#cb7-1257" aria-hidden="true"></a>      fieldbuf[<span class="dv">0</span>] = <span class="ch">&#39;\0&#39;</span>;</span>
<span id="cb7-1258"><a href="#cb7-1258" aria-hidden="true"></a>      <span class="cf">switch</span> (i)</span>
<span id="cb7-1259"><a href="#cb7-1259" aria-hidden="true"></a>    {</span>
<span id="cb7-1260"><a href="#cb7-1260" aria-hidden="true"></a>    <span class="cf">case</span> RPCBPROC_SET:</span>
<span id="cb7-1261"><a href="#cb7-1261" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, inf[RPCBVERS_3_STAT].setinfo);</span>
<span id="cb7-1262"><a href="#cb7-1262" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1263"><a href="#cb7-1263" aria-hidden="true"></a>    <span class="cf">case</span> RPCBPROC_UNSET:</span>
<span id="cb7-1264"><a href="#cb7-1264" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, inf[RPCBVERS_3_STAT].unsetinfo);</span>
<span id="cb7-1265"><a href="#cb7-1265" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1266"><a href="#cb7-1266" aria-hidden="true"></a>    <span class="cf">case</span> RPCBPROC_GETADDR:</span>
<span id="cb7-1267"><a href="#cb7-1267" aria-hidden="true"></a>      cnt = <span class="dv">0</span>;</span>
<span id="cb7-1268"><a href="#cb7-1268" aria-hidden="true"></a>      <span class="cf">for</span> (pa = inf[RPCBVERS_3_STAT].addrinfo; pa; pa = pa-&gt;next)</span>
<span id="cb7-1269"><a href="#cb7-1269" aria-hidden="true"></a>        cnt += pa-&gt;success;</span>
<span id="cb7-1270"><a href="#cb7-1270" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, cnt);</span>
<span id="cb7-1271"><a href="#cb7-1271" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1272"><a href="#cb7-1272" aria-hidden="true"></a>    <span class="cf">case</span> RPCBPROC_CALLIT:</span>
<span id="cb7-1273"><a href="#cb7-1273" aria-hidden="true"></a>      cnt = <span class="dv">0</span>;</span>
<span id="cb7-1274"><a href="#cb7-1274" aria-hidden="true"></a>      <span class="cf">for</span> (pr = inf[RPCBVERS_3_STAT].rmtinfo; pr; pr = pr-&gt;next)</span>
<span id="cb7-1275"><a href="#cb7-1275" aria-hidden="true"></a>        cnt += pr-&gt;success;</span>
<span id="cb7-1276"><a href="#cb7-1276" aria-hidden="true"></a>      sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, cnt);</span>
<span id="cb7-1277"><a href="#cb7-1277" aria-hidden="true"></a>      <span class="cf">break</span>;</span>
<span id="cb7-1278"><a href="#cb7-1278" aria-hidden="true"></a>    <span class="cf">default</span>:</span>
<span id="cb7-1279"><a href="#cb7-1279" aria-hidden="true"></a>      <span class="cf">break</span>;        <span class="co">/* For the remaining ones */</span></span>
<span id="cb7-1280"><a href="#cb7-1280" aria-hidden="true"></a>    }</span>
<span id="cb7-1281"><a href="#cb7-1281" aria-hidden="true"></a>      cp = &amp;fieldbuf[<span class="dv">0</span>] + strlen (fieldbuf);</span>
<span id="cb7-1282"><a href="#cb7-1282" aria-hidden="true"></a>      sprintf (cp, <span class="st">&quot;%d&quot;</span>, inf[RPCBVERS_3_STAT].info[i]);</span>
<span id="cb7-1283"><a href="#cb7-1283" aria-hidden="true"></a>      flen = strlen (fieldbuf);</span>
<span id="cb7-1284"><a href="#cb7-1284" aria-hidden="true"></a>      printf (<span class="st">&quot;%s%s&quot;</span>, rpcb3hdr[i],</span>
<span id="cb7-1285"><a href="#cb7-1285" aria-hidden="true"></a>          spaces ((TABSTOP * (<span class="dv">1</span> + flen / TABSTOP))</span>
<span id="cb7-1286"><a href="#cb7-1286" aria-hidden="true"></a>              - strlen (rpcb3hdr[i])));</span>
<span id="cb7-1287"><a href="#cb7-1287" aria-hidden="true"></a>      sprintf (lp, <span class="st">&quot;%s%s&quot;</span>, fieldbuf,</span>
<span id="cb7-1288"><a href="#cb7-1288" aria-hidden="true"></a>           spaces (cnt = ((TABSTOP * (<span class="dv">1</span> + flen / TABSTOP)) - flen)));</span>
<span id="cb7-1289"><a href="#cb7-1289" aria-hidden="true"></a>      lp += (flen + cnt);</span>
<span id="cb7-1290"><a href="#cb7-1290" aria-hidden="true"></a>    }</span>
<span id="cb7-1291"><a href="#cb7-1291" aria-hidden="true"></a>  printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">%s</span><span class="sc">\n\n</span><span class="st">&quot;</span>, linebuf);</span>
<span id="cb7-1292"><a href="#cb7-1292" aria-hidden="true"></a></span>
<span id="cb7-1293"><a href="#cb7-1293" aria-hidden="true"></a>  <span class="cf">if</span> (inf[RPCBVERS_3_STAT].info[RPCBPROC_CALLIT])</span>
<span id="cb7-1294"><a href="#cb7-1294" aria-hidden="true"></a>    {</span>
<span id="cb7-1295"><a href="#cb7-1295" aria-hidden="true"></a>      printf (<span class="st">&quot;RPCB_RMTCALL (version 3) call statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1296"><a href="#cb7-1296" aria-hidden="true"></a>      print_rmtcallstat (RPCBVERS_3_STAT, &amp;inf[RPCBVERS_3_STAT]);</span>
<span id="cb7-1297"><a href="#cb7-1297" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1298"><a href="#cb7-1298" aria-hidden="true"></a>    }</span>
<span id="cb7-1299"><a href="#cb7-1299" aria-hidden="true"></a></span>
<span id="cb7-1300"><a href="#cb7-1300" aria-hidden="true"></a>  <span class="cf">if</span> (inf[RPCBVERS_3_STAT].info[RPCBPROC_GETADDR])</span>
<span id="cb7-1301"><a href="#cb7-1301" aria-hidden="true"></a>    {</span>
<span id="cb7-1302"><a href="#cb7-1302" aria-hidden="true"></a>      printf (<span class="st">&quot;RPCB_GETADDR (version 3) call statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1303"><a href="#cb7-1303" aria-hidden="true"></a>      print_getaddrstat (RPCBVERS_3_STAT, &amp;inf[RPCBVERS_3_STAT]);</span>
<span id="cb7-1304"><a href="#cb7-1304" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1305"><a href="#cb7-1305" aria-hidden="true"></a>    }</span>
<span id="cb7-1306"><a href="#cb7-1306" aria-hidden="true"></a></span>
<span id="cb7-1307"><a href="#cb7-1307" aria-hidden="true"></a>  printf (<span class="st">&quot;RPCBIND (version 4) statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1308"><a href="#cb7-1308" aria-hidden="true"></a></span>
<span id="cb7-1309"><a href="#cb7-1309" aria-hidden="true"></a>  <span class="cf">for</span> (j = <span class="dv">0</span>; j &lt;= <span class="dv">9</span>; j += <span class="dv">9</span>)</span>
<span id="cb7-1310"><a href="#cb7-1310" aria-hidden="true"></a>    {               <span class="co">/* Just two iterations for printing */</span></span>
<span id="cb7-1311"><a href="#cb7-1311" aria-hidden="true"></a>      lp = linebuf;</span>
<span id="cb7-1312"><a href="#cb7-1312" aria-hidden="true"></a>      <span class="cf">for</span> (i = j; i &lt;= max (<span class="dv">8</span>, rpcb_highproc_4 - <span class="dv">9</span> + j); i++)</span>
<span id="cb7-1313"><a href="#cb7-1313" aria-hidden="true"></a>    {</span>
<span id="cb7-1314"><a href="#cb7-1314" aria-hidden="true"></a>      fieldbuf[<span class="dv">0</span>] = <span class="ch">&#39;\0&#39;</span>;</span>
<span id="cb7-1315"><a href="#cb7-1315" aria-hidden="true"></a>      <span class="cf">switch</span> (i)</span>
<span id="cb7-1316"><a href="#cb7-1316" aria-hidden="true"></a>        {</span>
<span id="cb7-1317"><a href="#cb7-1317" aria-hidden="true"></a>        <span class="cf">case</span> RPCBPROC_SET:</span>
<span id="cb7-1318"><a href="#cb7-1318" aria-hidden="true"></a>          sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, inf[RPCBVERS_4_STAT].setinfo);</span>
<span id="cb7-1319"><a href="#cb7-1319" aria-hidden="true"></a>          <span class="cf">break</span>;</span>
<span id="cb7-1320"><a href="#cb7-1320" aria-hidden="true"></a>        <span class="cf">case</span> RPCBPROC_UNSET:</span>
<span id="cb7-1321"><a href="#cb7-1321" aria-hidden="true"></a>          sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, inf[RPCBVERS_4_STAT].unsetinfo);</span>
<span id="cb7-1322"><a href="#cb7-1322" aria-hidden="true"></a>          <span class="cf">break</span>;</span>
<span id="cb7-1323"><a href="#cb7-1323" aria-hidden="true"></a>        <span class="cf">case</span> RPCBPROC_GETADDR:</span>
<span id="cb7-1324"><a href="#cb7-1324" aria-hidden="true"></a>          cnt = <span class="dv">0</span>;</span>
<span id="cb7-1325"><a href="#cb7-1325" aria-hidden="true"></a>          <span class="cf">for</span> (pa = inf[RPCBVERS_4_STAT].addrinfo; pa; pa = pa-&gt;next)</span>
<span id="cb7-1326"><a href="#cb7-1326" aria-hidden="true"></a>        cnt += pa-&gt;success;</span>
<span id="cb7-1327"><a href="#cb7-1327" aria-hidden="true"></a>          sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, cnt);</span>
<span id="cb7-1328"><a href="#cb7-1328" aria-hidden="true"></a>          <span class="cf">break</span>;</span>
<span id="cb7-1329"><a href="#cb7-1329" aria-hidden="true"></a>        <span class="cf">case</span> RPCBPROC_CALLIT:</span>
<span id="cb7-1330"><a href="#cb7-1330" aria-hidden="true"></a>          cnt = <span class="dv">0</span>;</span>
<span id="cb7-1331"><a href="#cb7-1331" aria-hidden="true"></a>          <span class="cf">for</span> (pr = inf[RPCBVERS_4_STAT].rmtinfo; pr; pr = pr-&gt;next)</span>
<span id="cb7-1332"><a href="#cb7-1332" aria-hidden="true"></a>        cnt += pr-&gt;success;</span>
<span id="cb7-1333"><a href="#cb7-1333" aria-hidden="true"></a>          sprintf (fieldbuf, <span class="st">&quot;%d/&quot;</span>, cnt);</span>
<span id="cb7-1334"><a href="#cb7-1334" aria-hidden="true"></a>          <span class="cf">break</span>;</span>
<span id="cb7-1335"><a href="#cb7-1335" aria-hidden="true"></a>        <span class="cf">default</span>:</span>
<span id="cb7-1336"><a href="#cb7-1336" aria-hidden="true"></a>          <span class="cf">break</span>;        <span class="co">/* For the remaining ones */</span></span>
<span id="cb7-1337"><a href="#cb7-1337" aria-hidden="true"></a>        }</span>
<span id="cb7-1338"><a href="#cb7-1338" aria-hidden="true"></a>      cp = &amp;fieldbuf[<span class="dv">0</span>] + strlen (fieldbuf);</span>
<span id="cb7-1339"><a href="#cb7-1339" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1340"><a href="#cb7-1340" aria-hidden="true"></a><span class="co">       * XXX: We also add RPCBPROC_GETADDRLIST queries to</span></span>
<span id="cb7-1341"><a href="#cb7-1341" aria-hidden="true"></a><span class="co">       * RPCB_GETADDR because rpcbind includes the</span></span>
<span id="cb7-1342"><a href="#cb7-1342" aria-hidden="true"></a><span class="co">       * RPCB_GETADDRLIST successes in RPCB_GETADDR.</span></span>
<span id="cb7-1343"><a href="#cb7-1343" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1344"><a href="#cb7-1344" aria-hidden="true"></a>      <span class="cf">if</span> (i != RPCBPROC_GETADDR)</span>
<span id="cb7-1345"><a href="#cb7-1345" aria-hidden="true"></a>        sprintf (cp, <span class="st">&quot;%d&quot;</span>, inf[RPCBVERS_4_STAT].info[i]);</span>
<span id="cb7-1346"><a href="#cb7-1346" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1347"><a href="#cb7-1347" aria-hidden="true"></a>        sprintf (cp, <span class="st">&quot;%d&quot;</span>, inf[RPCBVERS_4_STAT].info[i] +</span>
<span id="cb7-1348"><a href="#cb7-1348" aria-hidden="true"></a>             inf[RPCBVERS_4_STAT].info[RPCBPROC_GETADDRLIST]);</span>
<span id="cb7-1349"><a href="#cb7-1349" aria-hidden="true"></a>      flen = strlen (fieldbuf);</span>
<span id="cb7-1350"><a href="#cb7-1350" aria-hidden="true"></a>      printf (<span class="st">&quot;%s%s&quot;</span>, rpcb4hdr[i],</span>
<span id="cb7-1351"><a href="#cb7-1351" aria-hidden="true"></a>          spaces ((TABSTOP * (<span class="dv">1</span> + flen / TABSTOP))</span>
<span id="cb7-1352"><a href="#cb7-1352" aria-hidden="true"></a>              - strlen (rpcb4hdr[i])));</span>
<span id="cb7-1353"><a href="#cb7-1353" aria-hidden="true"></a>      sprintf (lp, <span class="st">&quot;%s%s&quot;</span>, fieldbuf,</span>
<span id="cb7-1354"><a href="#cb7-1354" aria-hidden="true"></a>           spaces (cnt = ((TABSTOP * (<span class="dv">1</span> + flen / TABSTOP)) - flen)));</span>
<span id="cb7-1355"><a href="#cb7-1355" aria-hidden="true"></a>      lp += (flen + cnt);</span>
<span id="cb7-1356"><a href="#cb7-1356" aria-hidden="true"></a>    }</span>
<span id="cb7-1357"><a href="#cb7-1357" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">%s</span><span class="sc">\n</span><span class="st">&quot;</span>, linebuf);</span>
<span id="cb7-1358"><a href="#cb7-1358" aria-hidden="true"></a>    }</span>
<span id="cb7-1359"><a href="#cb7-1359" aria-hidden="true"></a></span>
<span id="cb7-1360"><a href="#cb7-1360" aria-hidden="true"></a>  <span class="cf">if</span> (inf[RPCBVERS_4_STAT].info[RPCBPROC_CALLIT] ||</span>
<span id="cb7-1361"><a href="#cb7-1361" aria-hidden="true"></a>      inf[RPCBVERS_4_STAT].info[RPCBPROC_INDIRECT])</span>
<span id="cb7-1362"><a href="#cb7-1362" aria-hidden="true"></a>    {</span>
<span id="cb7-1363"><a href="#cb7-1363" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1364"><a href="#cb7-1364" aria-hidden="true"></a>      printf (<span class="st">&quot;RPCB_RMTCALL (version 4) call statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1365"><a href="#cb7-1365" aria-hidden="true"></a>      print_rmtcallstat (RPCBVERS_4_STAT, &amp;inf[RPCBVERS_4_STAT]);</span>
<span id="cb7-1366"><a href="#cb7-1366" aria-hidden="true"></a>    }</span>
<span id="cb7-1367"><a href="#cb7-1367" aria-hidden="true"></a></span>
<span id="cb7-1368"><a href="#cb7-1368" aria-hidden="true"></a>  <span class="cf">if</span> (inf[RPCBVERS_4_STAT].info[RPCBPROC_GETADDR])</span>
<span id="cb7-1369"><a href="#cb7-1369" aria-hidden="true"></a>    {</span>
<span id="cb7-1370"><a href="#cb7-1370" aria-hidden="true"></a>      printf (<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1371"><a href="#cb7-1371" aria-hidden="true"></a>      printf (<span class="st">&quot;RPCB_GETADDR (version 4) call statistics</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1372"><a href="#cb7-1372" aria-hidden="true"></a>      print_getaddrstat (RPCBVERS_4_STAT, &amp;inf[RPCBVERS_4_STAT]);</span>
<span id="cb7-1373"><a href="#cb7-1373" aria-hidden="true"></a>    }</span>
<span id="cb7-1374"><a href="#cb7-1374" aria-hidden="true"></a>  clnt_destroy (client);</span>
<span id="cb7-1375"><a href="#cb7-1375" aria-hidden="true"></a>}</span>
<span id="cb7-1376"><a href="#cb7-1376" aria-hidden="true"></a></span>
<span id="cb7-1377"><a href="#cb7-1377" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-1378"><a href="#cb7-1378" aria-hidden="true"></a><span class="co"> * Delete registeration for this (prog, vers, netid)</span></span>
<span id="cb7-1379"><a href="#cb7-1379" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-1380"><a href="#cb7-1380" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1381"><a href="#cb7-1381" aria-hidden="true"></a>deletereg (netid, argc, argv)</span>
<span id="cb7-1382"><a href="#cb7-1382" aria-hidden="true"></a>     <span class="dt">char</span> *netid;</span>
<span id="cb7-1383"><a href="#cb7-1383" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-1384"><a href="#cb7-1384" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-1385"><a href="#cb7-1385" aria-hidden="true"></a>{</span>
<span id="cb7-1386"><a href="#cb7-1386" aria-hidden="true"></a>  <span class="kw">struct</span> netconfig *nconf = NULL;</span>
<span id="cb7-1387"><a href="#cb7-1387" aria-hidden="true"></a></span>
<span id="cb7-1388"><a href="#cb7-1388" aria-hidden="true"></a>  <span class="cf">if</span> (argc != <span class="dv">2</span>)</span>
<span id="cb7-1389"><a href="#cb7-1389" aria-hidden="true"></a>    {</span>
<span id="cb7-1390"><a href="#cb7-1390" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-1391"><a href="#cb7-1391" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1392"><a href="#cb7-1392" aria-hidden="true"></a>    }</span>
<span id="cb7-1393"><a href="#cb7-1393" aria-hidden="true"></a>  <span class="cf">if</span> (netid)</span>
<span id="cb7-1394"><a href="#cb7-1394" aria-hidden="true"></a>    {</span>
<span id="cb7-1395"><a href="#cb7-1395" aria-hidden="true"></a>      nconf = getnetconfigent (netid);</span>
<span id="cb7-1396"><a href="#cb7-1396" aria-hidden="true"></a>      <span class="cf">if</span> (nconf == NULL)</span>
<span id="cb7-1397"><a href="#cb7-1397" aria-hidden="true"></a>    {</span>
<span id="cb7-1398"><a href="#cb7-1398" aria-hidden="true"></a>      fprintf (stderr, <span class="st">&quot;rpcinfo: netid %s not supported</span><span class="sc">\n</span><span class="st">&quot;</span>, netid);</span>
<span id="cb7-1399"><a href="#cb7-1399" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1400"><a href="#cb7-1400" aria-hidden="true"></a>    }</span>
<span id="cb7-1401"><a href="#cb7-1401" aria-hidden="true"></a>    }</span>
<span id="cb7-1402"><a href="#cb7-1402" aria-hidden="true"></a>  <span class="cf">if</span> ((rpcb_unset (getprognum (argv[<span class="dv">0</span>]), getvers (argv[<span class="dv">1</span>]), nconf)) == <span class="dv">0</span>)</span>
<span id="cb7-1403"><a href="#cb7-1403" aria-hidden="true"></a>    {</span>
<span id="cb7-1404"><a href="#cb7-1404" aria-hidden="true"></a>      fprintf (stderr,</span>
<span id="cb7-1405"><a href="#cb7-1405" aria-hidden="true"></a>           <span class="st">&quot;rpcinfo: Could not delete registration for prog %s version %s</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb7-1406"><a href="#cb7-1406" aria-hidden="true"></a>           argv[<span class="dv">0</span>], argv[<span class="dv">1</span>]);</span>
<span id="cb7-1407"><a href="#cb7-1407" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1408"><a href="#cb7-1408" aria-hidden="true"></a>    }</span>
<span id="cb7-1409"><a href="#cb7-1409" aria-hidden="true"></a>}</span>
<span id="cb7-1410"><a href="#cb7-1410" aria-hidden="true"></a></span>
<span id="cb7-1411"><a href="#cb7-1411" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-1412"><a href="#cb7-1412" aria-hidden="true"></a><span class="co"> * Create and return a handle for the given nconf.</span></span>
<span id="cb7-1413"><a href="#cb7-1413" aria-hidden="true"></a><span class="co"> * Exit if cannot create handle.</span></span>
<span id="cb7-1414"><a href="#cb7-1414" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-1415"><a href="#cb7-1415" aria-hidden="true"></a><span class="dt">static</span> CLIENT *</span>
<span id="cb7-1416"><a href="#cb7-1416" aria-hidden="true"></a>clnt_addr_create (address, nconf, prog, vers)</span>
<span id="cb7-1417"><a href="#cb7-1417" aria-hidden="true"></a>     <span class="dt">char</span> *address;</span>
<span id="cb7-1418"><a href="#cb7-1418" aria-hidden="true"></a>     <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-1419"><a href="#cb7-1419" aria-hidden="true"></a>     u_long prog;</span>
<span id="cb7-1420"><a href="#cb7-1420" aria-hidden="true"></a>     u_long vers;</span>
<span id="cb7-1421"><a href="#cb7-1421" aria-hidden="true"></a>{</span>
<span id="cb7-1422"><a href="#cb7-1422" aria-hidden="true"></a>  CLIENT *client;</span>
<span id="cb7-1423"><a href="#cb7-1423" aria-hidden="true"></a>  <span class="dt">static</span> <span class="kw">struct</span> netbuf *nbuf;</span>
<span id="cb7-1424"><a href="#cb7-1424" aria-hidden="true"></a>  <span class="dt">static</span> <span class="dt">int</span> fd = RPC_ANYFD;</span>
<span id="cb7-1425"><a href="#cb7-1425" aria-hidden="true"></a></span>
<span id="cb7-1426"><a href="#cb7-1426" aria-hidden="true"></a>  <span class="cf">if</span> (fd == RPC_ANYFD)</span>
<span id="cb7-1427"><a href="#cb7-1427" aria-hidden="true"></a>    {</span>
<span id="cb7-1428"><a href="#cb7-1428" aria-hidden="true"></a>      <span class="cf">if</span> ((fd = __rpc_nconf2fd (nconf)) == -<span class="dv">1</span>)</span>
<span id="cb7-1429"><a href="#cb7-1429" aria-hidden="true"></a>    {</span>
<span id="cb7-1430"><a href="#cb7-1430" aria-hidden="true"></a>      rpc_createerr.cf_stat = RPC_TLIERROR;</span>
<span id="cb7-1431"><a href="#cb7-1431" aria-hidden="true"></a>      clnt_pcreateerror (<span class="st">&quot;rpcinfo&quot;</span>);</span>
<span id="cb7-1432"><a href="#cb7-1432" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1433"><a href="#cb7-1433" aria-hidden="true"></a>    }</span>
<span id="cb7-1434"><a href="#cb7-1434" aria-hidden="true"></a>      <span class="co">/* Convert the uaddr to taddr */</span></span>
<span id="cb7-1435"><a href="#cb7-1435" aria-hidden="true"></a>      nbuf = uaddr2taddr (nconf, address);</span>
<span id="cb7-1436"><a href="#cb7-1436" aria-hidden="true"></a>      <span class="cf">if</span> (nbuf == NULL)</span>
<span id="cb7-1437"><a href="#cb7-1437" aria-hidden="true"></a>    {</span>
<span id="cb7-1438"><a href="#cb7-1438" aria-hidden="true"></a>      errx (<span class="dv">1</span>, <span class="st">&quot;rpcinfo: no address for client handle&quot;</span>);</span>
<span id="cb7-1439"><a href="#cb7-1439" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1440"><a href="#cb7-1440" aria-hidden="true"></a>    }</span>
<span id="cb7-1441"><a href="#cb7-1441" aria-hidden="true"></a>    }</span>
<span id="cb7-1442"><a href="#cb7-1442" aria-hidden="true"></a>  client = clnt_tli_create (fd, nconf, nbuf, prog, vers, <span class="dv">0</span>, <span class="dv">0</span>);</span>
<span id="cb7-1443"><a href="#cb7-1443" aria-hidden="true"></a>  <span class="cf">if</span> (client == (CLIENT *) NULL)</span>
<span id="cb7-1444"><a href="#cb7-1444" aria-hidden="true"></a>    {</span>
<span id="cb7-1445"><a href="#cb7-1445" aria-hidden="true"></a>      clnt_pcreateerror (<span class="st">&quot;rpcinfo&quot;</span>);</span>
<span id="cb7-1446"><a href="#cb7-1446" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1447"><a href="#cb7-1447" aria-hidden="true"></a>    }</span>
<span id="cb7-1448"><a href="#cb7-1448" aria-hidden="true"></a>  <span class="cf">return</span> (client);</span>
<span id="cb7-1449"><a href="#cb7-1449" aria-hidden="true"></a>}</span>
<span id="cb7-1450"><a href="#cb7-1450" aria-hidden="true"></a></span>
<span id="cb7-1451"><a href="#cb7-1451" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-1452"><a href="#cb7-1452" aria-hidden="true"></a><span class="co"> * If the version number is given, ping that (prog, vers); else try to find</span></span>
<span id="cb7-1453"><a href="#cb7-1453" aria-hidden="true"></a><span class="co"> * the version numbers supported for that prog and ping all the versions.</span></span>
<span id="cb7-1454"><a href="#cb7-1454" aria-hidden="true"></a><span class="co"> * Remote rpcbind is not contacted for this service. The requests are</span></span>
<span id="cb7-1455"><a href="#cb7-1455" aria-hidden="true"></a><span class="co"> * sent directly to the services themselves.</span></span>
<span id="cb7-1456"><a href="#cb7-1456" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-1457"><a href="#cb7-1457" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1458"><a href="#cb7-1458" aria-hidden="true"></a>addrping (address, netid, argc, argv)</span>
<span id="cb7-1459"><a href="#cb7-1459" aria-hidden="true"></a>     <span class="dt">char</span> *address;</span>
<span id="cb7-1460"><a href="#cb7-1460" aria-hidden="true"></a>     <span class="dt">char</span> *netid;</span>
<span id="cb7-1461"><a href="#cb7-1461" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-1462"><a href="#cb7-1462" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-1463"><a href="#cb7-1463" aria-hidden="true"></a>{</span>
<span id="cb7-1464"><a href="#cb7-1464" aria-hidden="true"></a>  CLIENT *client;</span>
<span id="cb7-1465"><a href="#cb7-1465" aria-hidden="true"></a>  <span class="kw">struct</span> timeval to;</span>
<span id="cb7-1466"><a href="#cb7-1466" aria-hidden="true"></a>  <span class="kw">enum</span> clnt_stat rpc_stat;</span>
<span id="cb7-1467"><a href="#cb7-1467" aria-hidden="true"></a>  u_int32_t prognum, versnum, minvers, maxvers;</span>
<span id="cb7-1468"><a href="#cb7-1468" aria-hidden="true"></a>  <span class="kw">struct</span> rpc_err rpcerr;</span>
<span id="cb7-1469"><a href="#cb7-1469" aria-hidden="true"></a>  <span class="dt">int</span> failure = <span class="dv">0</span>;</span>
<span id="cb7-1470"><a href="#cb7-1470" aria-hidden="true"></a>  <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-1471"><a href="#cb7-1471" aria-hidden="true"></a>  <span class="dt">int</span> fd;</span>
<span id="cb7-1472"><a href="#cb7-1472" aria-hidden="true"></a></span>
<span id="cb7-1473"><a href="#cb7-1473" aria-hidden="true"></a>  <span class="cf">if</span> (argc &lt; <span class="dv">1</span> || argc &gt; <span class="dv">2</span> || (netid == NULL))</span>
<span id="cb7-1474"><a href="#cb7-1474" aria-hidden="true"></a>    {</span>
<span id="cb7-1475"><a href="#cb7-1475" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-1476"><a href="#cb7-1476" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1477"><a href="#cb7-1477" aria-hidden="true"></a>    }</span>
<span id="cb7-1478"><a href="#cb7-1478" aria-hidden="true"></a>  nconf = getnetconfigent (netid);</span>
<span id="cb7-1479"><a href="#cb7-1479" aria-hidden="true"></a>  <span class="cf">if</span> (nconf == (<span class="kw">struct</span> netconfig *) NULL)</span>
<span id="cb7-1480"><a href="#cb7-1480" aria-hidden="true"></a>    {</span>
<span id="cb7-1481"><a href="#cb7-1481" aria-hidden="true"></a>      fprintf (stderr, <span class="st">&quot;rpcinfo: Could not find %s</span><span class="sc">\n</span><span class="st">&quot;</span>, netid);</span>
<span id="cb7-1482"><a href="#cb7-1482" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1483"><a href="#cb7-1483" aria-hidden="true"></a>    }</span>
<span id="cb7-1484"><a href="#cb7-1484" aria-hidden="true"></a>  to.tv_sec = <span class="dv">10</span>;</span>
<span id="cb7-1485"><a href="#cb7-1485" aria-hidden="true"></a>  to.tv_usec = <span class="dv">0</span>;</span>
<span id="cb7-1486"><a href="#cb7-1486" aria-hidden="true"></a>  prognum = getprognum (argv[<span class="dv">0</span>]);</span>
<span id="cb7-1487"><a href="#cb7-1487" aria-hidden="true"></a>  <span class="cf">if</span> (argc == <span class="dv">1</span>)</span>
<span id="cb7-1488"><a href="#cb7-1488" aria-hidden="true"></a>    {               <span class="co">/* Version number not known */</span></span>
<span id="cb7-1489"><a href="#cb7-1489" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1490"><a href="#cb7-1490" aria-hidden="true"></a><span class="co">       * A call to version 0 should fail with a program/version</span></span>
<span id="cb7-1491"><a href="#cb7-1491" aria-hidden="true"></a><span class="co">       * mismatch, and give us the range of versions supported.</span></span>
<span id="cb7-1492"><a href="#cb7-1492" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1493"><a href="#cb7-1493" aria-hidden="true"></a>      versnum = MIN_VERS;</span>
<span id="cb7-1494"><a href="#cb7-1494" aria-hidden="true"></a>    }</span>
<span id="cb7-1495"><a href="#cb7-1495" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1496"><a href="#cb7-1496" aria-hidden="true"></a>    {</span>
<span id="cb7-1497"><a href="#cb7-1497" aria-hidden="true"></a>      versnum = getvers (argv[<span class="dv">1</span>]);</span>
<span id="cb7-1498"><a href="#cb7-1498" aria-hidden="true"></a>    }</span>
<span id="cb7-1499"><a href="#cb7-1499" aria-hidden="true"></a>  client = clnt_addr_create (address, nconf, prognum, versnum);</span>
<span id="cb7-1500"><a href="#cb7-1500" aria-hidden="true"></a>  rpc_stat = CLNT_CALL (client, NULLPROC, (xdrproc_t) xdr_void,</span>
<span id="cb7-1501"><a href="#cb7-1501" aria-hidden="true"></a>            (<span class="dt">char</span> *) NULL, (xdrproc_t) xdr_void,</span>
<span id="cb7-1502"><a href="#cb7-1502" aria-hidden="true"></a>            (<span class="dt">char</span> *) NULL, to);</span>
<span id="cb7-1503"><a href="#cb7-1503" aria-hidden="true"></a>  <span class="cf">if</span> (argc == <span class="dv">2</span>)</span>
<span id="cb7-1504"><a href="#cb7-1504" aria-hidden="true"></a>    {</span>
<span id="cb7-1505"><a href="#cb7-1505" aria-hidden="true"></a>      <span class="co">/* Version number was known */</span></span>
<span id="cb7-1506"><a href="#cb7-1506" aria-hidden="true"></a>      <span class="cf">if</span> (pstatus (client, prognum, versnum) &lt; <span class="dv">0</span>)</span>
<span id="cb7-1507"><a href="#cb7-1507" aria-hidden="true"></a>    failure = <span class="dv">1</span>;</span>
<span id="cb7-1508"><a href="#cb7-1508" aria-hidden="true"></a>      (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-1509"><a href="#cb7-1509" aria-hidden="true"></a>      <span class="cf">if</span> (failure)</span>
<span id="cb7-1510"><a href="#cb7-1510" aria-hidden="true"></a>    exit (<span class="dv">1</span>);</span>
<span id="cb7-1511"><a href="#cb7-1511" aria-hidden="true"></a>      <span class="cf">return</span>;</span>
<span id="cb7-1512"><a href="#cb7-1512" aria-hidden="true"></a>    }</span>
<span id="cb7-1513"><a href="#cb7-1513" aria-hidden="true"></a>  <span class="co">/* Version number not known */</span></span>
<span id="cb7-1514"><a href="#cb7-1514" aria-hidden="true"></a>  (<span class="dt">void</span>) CLNT_CONTROL (client, CLSET_FD_NCLOSE, (<span class="dt">char</span> *) NULL);</span>
<span id="cb7-1515"><a href="#cb7-1515" aria-hidden="true"></a>  (<span class="dt">void</span>) CLNT_CONTROL (client, CLGET_FD, (<span class="dt">char</span> *) &amp;fd);</span>
<span id="cb7-1516"><a href="#cb7-1516" aria-hidden="true"></a>  <span class="cf">if</span> (rpc_stat == RPC_PROGVERSMISMATCH)</span>
<span id="cb7-1517"><a href="#cb7-1517" aria-hidden="true"></a>    {</span>
<span id="cb7-1518"><a href="#cb7-1518" aria-hidden="true"></a>      clnt_geterr (client, &amp;rpcerr);</span>
<span id="cb7-1519"><a href="#cb7-1519" aria-hidden="true"></a>      minvers = rpcerr.re_vers.low;</span>
<span id="cb7-1520"><a href="#cb7-1520" aria-hidden="true"></a>      maxvers = rpcerr.re_vers.high;</span>
<span id="cb7-1521"><a href="#cb7-1521" aria-hidden="true"></a>    }</span>
<span id="cb7-1522"><a href="#cb7-1522" aria-hidden="true"></a>  <span class="cf">else</span> <span class="cf">if</span> (rpc_stat == RPC_SUCCESS)</span>
<span id="cb7-1523"><a href="#cb7-1523" aria-hidden="true"></a>    {</span>
<span id="cb7-1524"><a href="#cb7-1524" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1525"><a href="#cb7-1525" aria-hidden="true"></a><span class="co">       * Oh dear, it DOES support version 0.</span></span>
<span id="cb7-1526"><a href="#cb7-1526" aria-hidden="true"></a><span class="co">       * Let&#39;s try version MAX_VERS.</span></span>
<span id="cb7-1527"><a href="#cb7-1527" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1528"><a href="#cb7-1528" aria-hidden="true"></a>      (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-1529"><a href="#cb7-1529" aria-hidden="true"></a>      client = clnt_addr_create (address, nconf, prognum, MAX_VERS);</span>
<span id="cb7-1530"><a href="#cb7-1530" aria-hidden="true"></a>      rpc_stat = CLNT_CALL (client, NULLPROC, (xdrproc_t) xdr_void,</span>
<span id="cb7-1531"><a href="#cb7-1531" aria-hidden="true"></a>                (<span class="dt">char</span> *) NULL, (xdrproc_t) xdr_void,</span>
<span id="cb7-1532"><a href="#cb7-1532" aria-hidden="true"></a>                (<span class="dt">char</span> *) NULL, to);</span>
<span id="cb7-1533"><a href="#cb7-1533" aria-hidden="true"></a>      <span class="cf">if</span> (rpc_stat == RPC_PROGVERSMISMATCH)</span>
<span id="cb7-1534"><a href="#cb7-1534" aria-hidden="true"></a>    {</span>
<span id="cb7-1535"><a href="#cb7-1535" aria-hidden="true"></a>      clnt_geterr (client, &amp;rpcerr);</span>
<span id="cb7-1536"><a href="#cb7-1536" aria-hidden="true"></a>      minvers = rpcerr.re_vers.low;</span>
<span id="cb7-1537"><a href="#cb7-1537" aria-hidden="true"></a>      maxvers = rpcerr.re_vers.high;</span>
<span id="cb7-1538"><a href="#cb7-1538" aria-hidden="true"></a>    }</span>
<span id="cb7-1539"><a href="#cb7-1539" aria-hidden="true"></a>      <span class="cf">else</span> <span class="cf">if</span> (rpc_stat == RPC_SUCCESS)</span>
<span id="cb7-1540"><a href="#cb7-1540" aria-hidden="true"></a>    {</span>
<span id="cb7-1541"><a href="#cb7-1541" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1542"><a href="#cb7-1542" aria-hidden="true"></a><span class="co">       * It also supports version MAX_VERS.</span></span>
<span id="cb7-1543"><a href="#cb7-1543" aria-hidden="true"></a><span class="co">       * Looks like we have a wise guy.</span></span>
<span id="cb7-1544"><a href="#cb7-1544" aria-hidden="true"></a><span class="co">       * OK, we give them information on all</span></span>
<span id="cb7-1545"><a href="#cb7-1545" aria-hidden="true"></a><span class="co">       * 4 billion versions they support...</span></span>
<span id="cb7-1546"><a href="#cb7-1546" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1547"><a href="#cb7-1547" aria-hidden="true"></a>      minvers = <span class="dv">0</span>;</span>
<span id="cb7-1548"><a href="#cb7-1548" aria-hidden="true"></a>      maxvers = MAX_VERS;</span>
<span id="cb7-1549"><a href="#cb7-1549" aria-hidden="true"></a>    }</span>
<span id="cb7-1550"><a href="#cb7-1550" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1551"><a href="#cb7-1551" aria-hidden="true"></a>    {</span>
<span id="cb7-1552"><a href="#cb7-1552" aria-hidden="true"></a>      (<span class="dt">void</span>) pstatus (client, prognum, MAX_VERS);</span>
<span id="cb7-1553"><a href="#cb7-1553" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1554"><a href="#cb7-1554" aria-hidden="true"></a>    }</span>
<span id="cb7-1555"><a href="#cb7-1555" aria-hidden="true"></a>    }</span>
<span id="cb7-1556"><a href="#cb7-1556" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1557"><a href="#cb7-1557" aria-hidden="true"></a>    {</span>
<span id="cb7-1558"><a href="#cb7-1558" aria-hidden="true"></a>      (<span class="dt">void</span>) pstatus (client, prognum, (u_long) <span class="dv">0</span>);</span>
<span id="cb7-1559"><a href="#cb7-1559" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1560"><a href="#cb7-1560" aria-hidden="true"></a>    }</span>
<span id="cb7-1561"><a href="#cb7-1561" aria-hidden="true"></a>  (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-1562"><a href="#cb7-1562" aria-hidden="true"></a>  <span class="cf">for</span> (versnum = minvers; versnum &lt;= maxvers; versnum++)</span>
<span id="cb7-1563"><a href="#cb7-1563" aria-hidden="true"></a>    {</span>
<span id="cb7-1564"><a href="#cb7-1564" aria-hidden="true"></a>      client = clnt_addr_create (address, nconf, prognum, versnum);</span>
<span id="cb7-1565"><a href="#cb7-1565" aria-hidden="true"></a>      rpc_stat = CLNT_CALL (client, NULLPROC, (xdrproc_t) xdr_void,</span>
<span id="cb7-1566"><a href="#cb7-1566" aria-hidden="true"></a>                (<span class="dt">char</span> *) NULL, (xdrproc_t) xdr_void,</span>
<span id="cb7-1567"><a href="#cb7-1567" aria-hidden="true"></a>                (<span class="dt">char</span> *) NULL, to);</span>
<span id="cb7-1568"><a href="#cb7-1568" aria-hidden="true"></a>      <span class="cf">if</span> (pstatus (client, prognum, versnum) &lt; <span class="dv">0</span>)</span>
<span id="cb7-1569"><a href="#cb7-1569" aria-hidden="true"></a>    failure = <span class="dv">1</span>;</span>
<span id="cb7-1570"><a href="#cb7-1570" aria-hidden="true"></a>      (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-1571"><a href="#cb7-1571" aria-hidden="true"></a>    }</span>
<span id="cb7-1572"><a href="#cb7-1572" aria-hidden="true"></a>  (<span class="dt">void</span>) close (fd);</span>
<span id="cb7-1573"><a href="#cb7-1573" aria-hidden="true"></a>  <span class="cf">if</span> (failure)</span>
<span id="cb7-1574"><a href="#cb7-1574" aria-hidden="true"></a>    exit (<span class="dv">1</span>);</span>
<span id="cb7-1575"><a href="#cb7-1575" aria-hidden="true"></a>  <span class="cf">return</span>;</span>
<span id="cb7-1576"><a href="#cb7-1576" aria-hidden="true"></a>}</span>
<span id="cb7-1577"><a href="#cb7-1577" aria-hidden="true"></a></span>
<span id="cb7-1578"><a href="#cb7-1578" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-1579"><a href="#cb7-1579" aria-hidden="true"></a><span class="co"> * If the version number is given, ping that (prog, vers); else try to find</span></span>
<span id="cb7-1580"><a href="#cb7-1580" aria-hidden="true"></a><span class="co"> * the version numbers supported for that prog and ping all the versions.</span></span>
<span id="cb7-1581"><a href="#cb7-1581" aria-hidden="true"></a><span class="co"> * Remote rpcbind is *contacted* for this service. The requests are</span></span>
<span id="cb7-1582"><a href="#cb7-1582" aria-hidden="true"></a><span class="co"> * then sent directly to the services themselves.</span></span>
<span id="cb7-1583"><a href="#cb7-1583" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-1584"><a href="#cb7-1584" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1585"><a href="#cb7-1585" aria-hidden="true"></a>progping (netid, argc, argv)</span>
<span id="cb7-1586"><a href="#cb7-1586" aria-hidden="true"></a>     <span class="dt">char</span> *netid;</span>
<span id="cb7-1587"><a href="#cb7-1587" aria-hidden="true"></a>     <span class="dt">int</span> argc;</span>
<span id="cb7-1588"><a href="#cb7-1588" aria-hidden="true"></a>     <span class="dt">char</span> **argv;</span>
<span id="cb7-1589"><a href="#cb7-1589" aria-hidden="true"></a>{</span>
<span id="cb7-1590"><a href="#cb7-1590" aria-hidden="true"></a>  CLIENT *client;</span>
<span id="cb7-1591"><a href="#cb7-1591" aria-hidden="true"></a>  <span class="kw">struct</span> timeval to;</span>
<span id="cb7-1592"><a href="#cb7-1592" aria-hidden="true"></a>  <span class="kw">enum</span> clnt_stat rpc_stat;</span>
<span id="cb7-1593"><a href="#cb7-1593" aria-hidden="true"></a>  u_int32_t prognum, versnum, minvers, maxvers;</span>
<span id="cb7-1594"><a href="#cb7-1594" aria-hidden="true"></a>  <span class="kw">struct</span> rpc_err rpcerr;</span>
<span id="cb7-1595"><a href="#cb7-1595" aria-hidden="true"></a>  <span class="dt">int</span> failure = <span class="dv">0</span>;</span>
<span id="cb7-1596"><a href="#cb7-1596" aria-hidden="true"></a>  <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-1597"><a href="#cb7-1597" aria-hidden="true"></a></span>
<span id="cb7-1598"><a href="#cb7-1598" aria-hidden="true"></a>  <span class="cf">if</span> (argc &lt; <span class="dv">2</span> || argc &gt; <span class="dv">3</span> || (netid == NULL))</span>
<span id="cb7-1599"><a href="#cb7-1599" aria-hidden="true"></a>    {</span>
<span id="cb7-1600"><a href="#cb7-1600" aria-hidden="true"></a>      usage ();</span>
<span id="cb7-1601"><a href="#cb7-1601" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1602"><a href="#cb7-1602" aria-hidden="true"></a>    }</span>
<span id="cb7-1603"><a href="#cb7-1603" aria-hidden="true"></a>  prognum = getprognum (argv[<span class="dv">1</span>]);</span>
<span id="cb7-1604"><a href="#cb7-1604" aria-hidden="true"></a>  <span class="cf">if</span> (argc == <span class="dv">2</span>)</span>
<span id="cb7-1605"><a href="#cb7-1605" aria-hidden="true"></a>    {               <span class="co">/* Version number not known */</span></span>
<span id="cb7-1606"><a href="#cb7-1606" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1607"><a href="#cb7-1607" aria-hidden="true"></a><span class="co">       * A call to version 0 should fail with a program/version</span></span>
<span id="cb7-1608"><a href="#cb7-1608" aria-hidden="true"></a><span class="co">       * mismatch, and give us the range of versions supported.</span></span>
<span id="cb7-1609"><a href="#cb7-1609" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1610"><a href="#cb7-1610" aria-hidden="true"></a>      versnum = MIN_VERS;</span>
<span id="cb7-1611"><a href="#cb7-1611" aria-hidden="true"></a>    }</span>
<span id="cb7-1612"><a href="#cb7-1612" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1613"><a href="#cb7-1613" aria-hidden="true"></a>    {</span>
<span id="cb7-1614"><a href="#cb7-1614" aria-hidden="true"></a>      versnum = getvers (argv[<span class="dv">2</span>]);</span>
<span id="cb7-1615"><a href="#cb7-1615" aria-hidden="true"></a>    }</span>
<span id="cb7-1616"><a href="#cb7-1616" aria-hidden="true"></a>  <span class="cf">if</span> (netid)</span>
<span id="cb7-1617"><a href="#cb7-1617" aria-hidden="true"></a>    {</span>
<span id="cb7-1618"><a href="#cb7-1618" aria-hidden="true"></a>      nconf = getnetconfigent (netid);</span>
<span id="cb7-1619"><a href="#cb7-1619" aria-hidden="true"></a>      <span class="cf">if</span> (nconf == (<span class="kw">struct</span> netconfig *) NULL)</span>
<span id="cb7-1620"><a href="#cb7-1620" aria-hidden="true"></a>    {</span>
<span id="cb7-1621"><a href="#cb7-1621" aria-hidden="true"></a>      fprintf (stderr, <span class="st">&quot;rpcinfo: Could not find %s</span><span class="sc">\n</span><span class="st">&quot;</span>, netid);</span>
<span id="cb7-1622"><a href="#cb7-1622" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1623"><a href="#cb7-1623" aria-hidden="true"></a>    }</span>
<span id="cb7-1624"><a href="#cb7-1624" aria-hidden="true"></a>      client = clnt_tp_create (argv[<span class="dv">0</span>], prognum, versnum, nconf);</span>
<span id="cb7-1625"><a href="#cb7-1625" aria-hidden="true"></a>    }</span>
<span id="cb7-1626"><a href="#cb7-1626" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1627"><a href="#cb7-1627" aria-hidden="true"></a>    {</span>
<span id="cb7-1628"><a href="#cb7-1628" aria-hidden="true"></a>      client = clnt_create (argv[<span class="dv">0</span>], prognum, versnum, <span class="st">&quot;NETPATH&quot;</span>);</span>
<span id="cb7-1629"><a href="#cb7-1629" aria-hidden="true"></a>    }</span>
<span id="cb7-1630"><a href="#cb7-1630" aria-hidden="true"></a>  <span class="cf">if</span> (client == (CLIENT *) NULL)</span>
<span id="cb7-1631"><a href="#cb7-1631" aria-hidden="true"></a>    {</span>
<span id="cb7-1632"><a href="#cb7-1632" aria-hidden="true"></a>      clnt_pcreateerror (<span class="st">&quot;rpcinfo&quot;</span>);</span>
<span id="cb7-1633"><a href="#cb7-1633" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1634"><a href="#cb7-1634" aria-hidden="true"></a>    }</span>
<span id="cb7-1635"><a href="#cb7-1635" aria-hidden="true"></a>  to.tv_sec = <span class="dv">10</span>;</span>
<span id="cb7-1636"><a href="#cb7-1636" aria-hidden="true"></a>  to.tv_usec = <span class="dv">0</span>;</span>
<span id="cb7-1637"><a href="#cb7-1637" aria-hidden="true"></a>  rpc_stat = CLNT_CALL (client, NULLPROC, (xdrproc_t) xdr_void,</span>
<span id="cb7-1638"><a href="#cb7-1638" aria-hidden="true"></a>            (<span class="dt">char</span> *) NULL, (xdrproc_t) xdr_void,</span>
<span id="cb7-1639"><a href="#cb7-1639" aria-hidden="true"></a>            (<span class="dt">char</span> *) NULL, to);</span>
<span id="cb7-1640"><a href="#cb7-1640" aria-hidden="true"></a>  <span class="cf">if</span> (argc == <span class="dv">3</span>)</span>
<span id="cb7-1641"><a href="#cb7-1641" aria-hidden="true"></a>    {</span>
<span id="cb7-1642"><a href="#cb7-1642" aria-hidden="true"></a>      <span class="co">/* Version number was known */</span></span>
<span id="cb7-1643"><a href="#cb7-1643" aria-hidden="true"></a>      <span class="cf">if</span> (pstatus (client, prognum, versnum) &lt; <span class="dv">0</span>)</span>
<span id="cb7-1644"><a href="#cb7-1644" aria-hidden="true"></a>    failure = <span class="dv">1</span>;</span>
<span id="cb7-1645"><a href="#cb7-1645" aria-hidden="true"></a>      (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-1646"><a href="#cb7-1646" aria-hidden="true"></a>      <span class="cf">if</span> (failure)</span>
<span id="cb7-1647"><a href="#cb7-1647" aria-hidden="true"></a>    exit (<span class="dv">1</span>);</span>
<span id="cb7-1648"><a href="#cb7-1648" aria-hidden="true"></a>      <span class="cf">return</span>;</span>
<span id="cb7-1649"><a href="#cb7-1649" aria-hidden="true"></a>    }</span>
<span id="cb7-1650"><a href="#cb7-1650" aria-hidden="true"></a>  <span class="co">/* Version number not known */</span></span>
<span id="cb7-1651"><a href="#cb7-1651" aria-hidden="true"></a>  <span class="cf">if</span> (rpc_stat == RPC_PROGVERSMISMATCH)</span>
<span id="cb7-1652"><a href="#cb7-1652" aria-hidden="true"></a>    {</span>
<span id="cb7-1653"><a href="#cb7-1653" aria-hidden="true"></a>      clnt_geterr (client, &amp;rpcerr);</span>
<span id="cb7-1654"><a href="#cb7-1654" aria-hidden="true"></a>      minvers = rpcerr.re_vers.low;</span>
<span id="cb7-1655"><a href="#cb7-1655" aria-hidden="true"></a>      maxvers = rpcerr.re_vers.high;</span>
<span id="cb7-1656"><a href="#cb7-1656" aria-hidden="true"></a>    }</span>
<span id="cb7-1657"><a href="#cb7-1657" aria-hidden="true"></a>  <span class="cf">else</span> <span class="cf">if</span> (rpc_stat == RPC_SUCCESS)</span>
<span id="cb7-1658"><a href="#cb7-1658" aria-hidden="true"></a>    {</span>
<span id="cb7-1659"><a href="#cb7-1659" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1660"><a href="#cb7-1660" aria-hidden="true"></a><span class="co">       * Oh dear, it DOES support version 0.</span></span>
<span id="cb7-1661"><a href="#cb7-1661" aria-hidden="true"></a><span class="co">       * Let&#39;s try version MAX_VERS.</span></span>
<span id="cb7-1662"><a href="#cb7-1662" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1663"><a href="#cb7-1663" aria-hidden="true"></a>      versnum = MAX_VERS;</span>
<span id="cb7-1664"><a href="#cb7-1664" aria-hidden="true"></a>      (<span class="dt">void</span>) CLNT_CONTROL (client, CLSET_VERS, (<span class="dt">char</span> *) &amp;versnum);</span>
<span id="cb7-1665"><a href="#cb7-1665" aria-hidden="true"></a>      rpc_stat = CLNT_CALL (client, NULLPROC,</span>
<span id="cb7-1666"><a href="#cb7-1666" aria-hidden="true"></a>                (xdrproc_t) xdr_void, (<span class="dt">char</span> *) NULL,</span>
<span id="cb7-1667"><a href="#cb7-1667" aria-hidden="true"></a>                (xdrproc_t) xdr_void, (<span class="dt">char</span> *) NULL, to);</span>
<span id="cb7-1668"><a href="#cb7-1668" aria-hidden="true"></a>      <span class="cf">if</span> (rpc_stat == RPC_PROGVERSMISMATCH)</span>
<span id="cb7-1669"><a href="#cb7-1669" aria-hidden="true"></a>    {</span>
<span id="cb7-1670"><a href="#cb7-1670" aria-hidden="true"></a>      clnt_geterr (client, &amp;rpcerr);</span>
<span id="cb7-1671"><a href="#cb7-1671" aria-hidden="true"></a>      minvers = rpcerr.re_vers.low;</span>
<span id="cb7-1672"><a href="#cb7-1672" aria-hidden="true"></a>      maxvers = rpcerr.re_vers.high;</span>
<span id="cb7-1673"><a href="#cb7-1673" aria-hidden="true"></a>    }</span>
<span id="cb7-1674"><a href="#cb7-1674" aria-hidden="true"></a>      <span class="cf">else</span> <span class="cf">if</span> (rpc_stat == RPC_SUCCESS)</span>
<span id="cb7-1675"><a href="#cb7-1675" aria-hidden="true"></a>    {</span>
<span id="cb7-1676"><a href="#cb7-1676" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1677"><a href="#cb7-1677" aria-hidden="true"></a><span class="co">       * It also supports version MAX_VERS.</span></span>
<span id="cb7-1678"><a href="#cb7-1678" aria-hidden="true"></a><span class="co">       * Looks like we have a wise guy.</span></span>
<span id="cb7-1679"><a href="#cb7-1679" aria-hidden="true"></a><span class="co">       * OK, we give them information on all</span></span>
<span id="cb7-1680"><a href="#cb7-1680" aria-hidden="true"></a><span class="co">       * 4 billion versions they support...</span></span>
<span id="cb7-1681"><a href="#cb7-1681" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1682"><a href="#cb7-1682" aria-hidden="true"></a>      minvers = <span class="dv">0</span>;</span>
<span id="cb7-1683"><a href="#cb7-1683" aria-hidden="true"></a>      maxvers = MAX_VERS;</span>
<span id="cb7-1684"><a href="#cb7-1684" aria-hidden="true"></a>    }</span>
<span id="cb7-1685"><a href="#cb7-1685" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1686"><a href="#cb7-1686" aria-hidden="true"></a>    {</span>
<span id="cb7-1687"><a href="#cb7-1687" aria-hidden="true"></a>      (<span class="dt">void</span>) pstatus (client, prognum, MAX_VERS);</span>
<span id="cb7-1688"><a href="#cb7-1688" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1689"><a href="#cb7-1689" aria-hidden="true"></a>    }</span>
<span id="cb7-1690"><a href="#cb7-1690" aria-hidden="true"></a>    }</span>
<span id="cb7-1691"><a href="#cb7-1691" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1692"><a href="#cb7-1692" aria-hidden="true"></a>    {</span>
<span id="cb7-1693"><a href="#cb7-1693" aria-hidden="true"></a>      (<span class="dt">void</span>) pstatus (client, prognum, (u_long) <span class="dv">0</span>);</span>
<span id="cb7-1694"><a href="#cb7-1694" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1695"><a href="#cb7-1695" aria-hidden="true"></a>    }</span>
<span id="cb7-1696"><a href="#cb7-1696" aria-hidden="true"></a>  <span class="cf">for</span> (versnum = minvers; versnum &lt;= maxvers; versnum++)</span>
<span id="cb7-1697"><a href="#cb7-1697" aria-hidden="true"></a>    {</span>
<span id="cb7-1698"><a href="#cb7-1698" aria-hidden="true"></a>      (<span class="dt">void</span>) CLNT_CONTROL (client, CLSET_VERS, (<span class="dt">char</span> *) &amp;versnum);</span>
<span id="cb7-1699"><a href="#cb7-1699" aria-hidden="true"></a>      rpc_stat = CLNT_CALL (client, NULLPROC, (xdrproc_t) xdr_void,</span>
<span id="cb7-1700"><a href="#cb7-1700" aria-hidden="true"></a>                (<span class="dt">char</span> *) NULL, (xdrproc_t) xdr_void,</span>
<span id="cb7-1701"><a href="#cb7-1701" aria-hidden="true"></a>                (<span class="dt">char</span> *) NULL, to);</span>
<span id="cb7-1702"><a href="#cb7-1702" aria-hidden="true"></a>      <span class="cf">if</span> (pstatus (client, prognum, versnum) &lt; <span class="dv">0</span>)</span>
<span id="cb7-1703"><a href="#cb7-1703" aria-hidden="true"></a>    failure = <span class="dv">1</span>;</span>
<span id="cb7-1704"><a href="#cb7-1704" aria-hidden="true"></a>    }</span>
<span id="cb7-1705"><a href="#cb7-1705" aria-hidden="true"></a>  (<span class="dt">void</span>) CLNT_DESTROY (client);</span>
<span id="cb7-1706"><a href="#cb7-1706" aria-hidden="true"></a>  <span class="cf">if</span> (failure)</span>
<span id="cb7-1707"><a href="#cb7-1707" aria-hidden="true"></a>    exit (<span class="dv">1</span>);</span>
<span id="cb7-1708"><a href="#cb7-1708" aria-hidden="true"></a>  <span class="cf">return</span>;</span>
<span id="cb7-1709"><a href="#cb7-1709" aria-hidden="true"></a>}</span>
<span id="cb7-1710"><a href="#cb7-1710" aria-hidden="true"></a></span>
<span id="cb7-1711"><a href="#cb7-1711" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1712"><a href="#cb7-1712" aria-hidden="true"></a>usage ()</span>
<span id="cb7-1713"><a href="#cb7-1713" aria-hidden="true"></a>{</span>
<span id="cb7-1714"><a href="#cb7-1714" aria-hidden="true"></a>  fprintf (stderr, <span class="st">&quot;Usage: rpcinfo [-m | -s] [host]</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1715"><a href="#cb7-1715" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-1716"><a href="#cb7-1716" aria-hidden="true"></a>  fprintf (stderr, <span class="st">&quot;       rpcinfo -p [host]</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1717"><a href="#cb7-1717" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-1718"><a href="#cb7-1718" aria-hidden="true"></a>  fprintf (stderr, <span class="st">&quot;       rpcinfo -T netid host prognum [versnum]</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1719"><a href="#cb7-1719" aria-hidden="true"></a>  fprintf (stderr, <span class="st">&quot;       rpcinfo -l host prognum versnum</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1720"><a href="#cb7-1720" aria-hidden="true"></a><span class="pp">#ifdef PORTMAP</span></span>
<span id="cb7-1721"><a href="#cb7-1721" aria-hidden="true"></a>  fprintf (stderr,</span>
<span id="cb7-1722"><a href="#cb7-1722" aria-hidden="true"></a>       <span class="st">&quot;       rpcinfo [-n portnum] -u | -t host prognum [versnum]</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1723"><a href="#cb7-1723" aria-hidden="true"></a><span class="pp">#endif</span></span>
<span id="cb7-1724"><a href="#cb7-1724" aria-hidden="true"></a>  fprintf (stderr,</span>
<span id="cb7-1725"><a href="#cb7-1725" aria-hidden="true"></a>       <span class="st">&quot;       rpcinfo -a serv_address -T netid prognum [version]</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1726"><a href="#cb7-1726" aria-hidden="true"></a>  fprintf (stderr, <span class="st">&quot;       rpcinfo -b prognum versnum</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1727"><a href="#cb7-1727" aria-hidden="true"></a>  fprintf (stderr, <span class="st">&quot;       rpcinfo -d [-T netid] prognum versnum</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1728"><a href="#cb7-1728" aria-hidden="true"></a>}</span>
<span id="cb7-1729"><a href="#cb7-1729" aria-hidden="true"></a></span>
<span id="cb7-1730"><a href="#cb7-1730" aria-hidden="true"></a><span class="dt">static</span> u_long</span>
<span id="cb7-1731"><a href="#cb7-1731" aria-hidden="true"></a>getprognum (arg)</span>
<span id="cb7-1732"><a href="#cb7-1732" aria-hidden="true"></a>     <span class="dt">char</span> *arg;</span>
<span id="cb7-1733"><a href="#cb7-1733" aria-hidden="true"></a>{</span>
<span id="cb7-1734"><a href="#cb7-1734" aria-hidden="true"></a>  <span class="dt">char</span> *strptr;</span>
<span id="cb7-1735"><a href="#cb7-1735" aria-hidden="true"></a>  <span class="dt">register</span> <span class="kw">struct</span> rpcent *rpc;</span>
<span id="cb7-1736"><a href="#cb7-1736" aria-hidden="true"></a>  <span class="dt">register</span> u_long prognum;</span>
<span id="cb7-1737"><a href="#cb7-1737" aria-hidden="true"></a>  <span class="dt">char</span> *tptr = arg;</span>
<span id="cb7-1738"><a href="#cb7-1738" aria-hidden="true"></a></span>
<span id="cb7-1739"><a href="#cb7-1739" aria-hidden="true"></a>  <span class="cf">while</span> (*tptr &amp;&amp; isdigit (*tptr++));</span>
<span id="cb7-1740"><a href="#cb7-1740" aria-hidden="true"></a>  <span class="cf">if</span> (*tptr || isalpha (*(tptr - <span class="dv">1</span>)))</span>
<span id="cb7-1741"><a href="#cb7-1741" aria-hidden="true"></a>    {</span>
<span id="cb7-1742"><a href="#cb7-1742" aria-hidden="true"></a>      rpc = getrpcbyname (arg);</span>
<span id="cb7-1743"><a href="#cb7-1743" aria-hidden="true"></a>      <span class="cf">if</span> (rpc == NULL)</span>
<span id="cb7-1744"><a href="#cb7-1744" aria-hidden="true"></a>    {</span>
<span id="cb7-1745"><a href="#cb7-1745" aria-hidden="true"></a>      fprintf (stderr, <span class="st">&quot;rpcinfo: %s is unknown service</span><span class="sc">\n</span><span class="st">&quot;</span>, arg);</span>
<span id="cb7-1746"><a href="#cb7-1746" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1747"><a href="#cb7-1747" aria-hidden="true"></a>    }</span>
<span id="cb7-1748"><a href="#cb7-1748" aria-hidden="true"></a>      prognum = rpc-&gt;r_number;</span>
<span id="cb7-1749"><a href="#cb7-1749" aria-hidden="true"></a>    }</span>
<span id="cb7-1750"><a href="#cb7-1750" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1751"><a href="#cb7-1751" aria-hidden="true"></a>    {</span>
<span id="cb7-1752"><a href="#cb7-1752" aria-hidden="true"></a>      prognum = strtol (arg, &amp;strptr, <span class="dv">10</span>);</span>
<span id="cb7-1753"><a href="#cb7-1753" aria-hidden="true"></a>      <span class="cf">if</span> (strptr == arg || *strptr != <span class="ch">&#39;\0&#39;</span>)</span>
<span id="cb7-1754"><a href="#cb7-1754" aria-hidden="true"></a>    {</span>
<span id="cb7-1755"><a href="#cb7-1755" aria-hidden="true"></a>      fprintf (stderr, <span class="st">&quot;rpcinfo: %s is illegal program number</span><span class="sc">\n</span><span class="st">&quot;</span>, arg);</span>
<span id="cb7-1756"><a href="#cb7-1756" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1757"><a href="#cb7-1757" aria-hidden="true"></a>    }</span>
<span id="cb7-1758"><a href="#cb7-1758" aria-hidden="true"></a>    }</span>
<span id="cb7-1759"><a href="#cb7-1759" aria-hidden="true"></a>  <span class="cf">return</span> (prognum);</span>
<span id="cb7-1760"><a href="#cb7-1760" aria-hidden="true"></a>}</span>
<span id="cb7-1761"><a href="#cb7-1761" aria-hidden="true"></a></span>
<span id="cb7-1762"><a href="#cb7-1762" aria-hidden="true"></a><span class="dt">static</span> u_long</span>
<span id="cb7-1763"><a href="#cb7-1763" aria-hidden="true"></a>getvers (arg)</span>
<span id="cb7-1764"><a href="#cb7-1764" aria-hidden="true"></a>     <span class="dt">char</span> *arg;</span>
<span id="cb7-1765"><a href="#cb7-1765" aria-hidden="true"></a>{</span>
<span id="cb7-1766"><a href="#cb7-1766" aria-hidden="true"></a>  <span class="dt">char</span> *strptr;</span>
<span id="cb7-1767"><a href="#cb7-1767" aria-hidden="true"></a>  <span class="dt">register</span> u_long vers;</span>
<span id="cb7-1768"><a href="#cb7-1768" aria-hidden="true"></a></span>
<span id="cb7-1769"><a href="#cb7-1769" aria-hidden="true"></a>  vers = (<span class="dt">int</span>) strtol (arg, &amp;strptr, <span class="dv">10</span>);</span>
<span id="cb7-1770"><a href="#cb7-1770" aria-hidden="true"></a>  <span class="cf">if</span> (strptr == arg || *strptr != <span class="ch">&#39;\0&#39;</span>)</span>
<span id="cb7-1771"><a href="#cb7-1771" aria-hidden="true"></a>    {</span>
<span id="cb7-1772"><a href="#cb7-1772" aria-hidden="true"></a>      fprintf (stderr, <span class="st">&quot;rpcinfo: %s is illegal version number</span><span class="sc">\n</span><span class="st">&quot;</span>, arg);</span>
<span id="cb7-1773"><a href="#cb7-1773" aria-hidden="true"></a>      exit (<span class="dv">1</span>);</span>
<span id="cb7-1774"><a href="#cb7-1774" aria-hidden="true"></a>    }</span>
<span id="cb7-1775"><a href="#cb7-1775" aria-hidden="true"></a>  <span class="cf">return</span> (vers);</span>
<span id="cb7-1776"><a href="#cb7-1776" aria-hidden="true"></a>}</span>
<span id="cb7-1777"><a href="#cb7-1777" aria-hidden="true"></a></span>
<span id="cb7-1778"><a href="#cb7-1778" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb7-1779"><a href="#cb7-1779" aria-hidden="true"></a><span class="co"> * This routine should take a pointer to an &quot;rpc_err&quot; structure, rather than</span></span>
<span id="cb7-1780"><a href="#cb7-1780" aria-hidden="true"></a><span class="co"> * a pointer to a CLIENT structure, but &quot;clnt_perror&quot; takes a pointer to</span></span>
<span id="cb7-1781"><a href="#cb7-1781" aria-hidden="true"></a><span class="co"> * a CLIENT structure rather than a pointer to an &quot;rpc_err&quot; structure.</span></span>
<span id="cb7-1782"><a href="#cb7-1782" aria-hidden="true"></a><span class="co"> * As such, we have to keep the CLIENT structure around in order to print</span></span>
<span id="cb7-1783"><a href="#cb7-1783" aria-hidden="true"></a><span class="co"> * a good error message.</span></span>
<span id="cb7-1784"><a href="#cb7-1784" aria-hidden="true"></a><span class="co"> */</span></span>
<span id="cb7-1785"><a href="#cb7-1785" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">int</span></span>
<span id="cb7-1786"><a href="#cb7-1786" aria-hidden="true"></a>pstatus (client, prog, vers)</span>
<span id="cb7-1787"><a href="#cb7-1787" aria-hidden="true"></a>     <span class="dt">register</span> CLIENT *client;</span>
<span id="cb7-1788"><a href="#cb7-1788" aria-hidden="true"></a>     u_long prog;</span>
<span id="cb7-1789"><a href="#cb7-1789" aria-hidden="true"></a>     u_long vers;</span>
<span id="cb7-1790"><a href="#cb7-1790" aria-hidden="true"></a>{</span>
<span id="cb7-1791"><a href="#cb7-1791" aria-hidden="true"></a>  <span class="kw">struct</span> rpc_err rpcerr;</span>
<span id="cb7-1792"><a href="#cb7-1792" aria-hidden="true"></a></span>
<span id="cb7-1793"><a href="#cb7-1793" aria-hidden="true"></a>  clnt_geterr (client, &amp;rpcerr);</span>
<span id="cb7-1794"><a href="#cb7-1794" aria-hidden="true"></a>  <span class="cf">if</span> (rpcerr.re_status != RPC_SUCCESS)</span>
<span id="cb7-1795"><a href="#cb7-1795" aria-hidden="true"></a>    {</span>
<span id="cb7-1796"><a href="#cb7-1796" aria-hidden="true"></a>      clnt_perror (client, <span class="st">&quot;rpcinfo&quot;</span>);</span>
<span id="cb7-1797"><a href="#cb7-1797" aria-hidden="true"></a>      printf (<span class="st">&quot;program %lu version %lu is not available</span><span class="sc">\n</span><span class="st">&quot;</span>, prog, vers);</span>
<span id="cb7-1798"><a href="#cb7-1798" aria-hidden="true"></a>      <span class="cf">return</span> (-<span class="dv">1</span>);</span>
<span id="cb7-1799"><a href="#cb7-1799" aria-hidden="true"></a>    }</span>
<span id="cb7-1800"><a href="#cb7-1800" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1801"><a href="#cb7-1801" aria-hidden="true"></a>    {</span>
<span id="cb7-1802"><a href="#cb7-1802" aria-hidden="true"></a>      printf (<span class="st">&quot;program %lu version %lu ready and waiting</span><span class="sc">\n</span><span class="st">&quot;</span>, prog, vers);</span>
<span id="cb7-1803"><a href="#cb7-1803" aria-hidden="true"></a>      <span class="cf">return</span> (<span class="dv">0</span>);</span>
<span id="cb7-1804"><a href="#cb7-1804" aria-hidden="true"></a>    }</span>
<span id="cb7-1805"><a href="#cb7-1805" aria-hidden="true"></a>}</span>
<span id="cb7-1806"><a href="#cb7-1806" aria-hidden="true"></a></span>
<span id="cb7-1807"><a href="#cb7-1807" aria-hidden="true"></a><span class="dt">static</span> CLIENT *</span>
<span id="cb7-1808"><a href="#cb7-1808" aria-hidden="true"></a>clnt_rpcbind_create (host, rpcbversnum, targaddr)</span>
<span id="cb7-1809"><a href="#cb7-1809" aria-hidden="true"></a>     <span class="dt">char</span> *host;</span>
<span id="cb7-1810"><a href="#cb7-1810" aria-hidden="true"></a>     <span class="dt">int</span> rpcbversnum;</span>
<span id="cb7-1811"><a href="#cb7-1811" aria-hidden="true"></a>     <span class="kw">struct</span> netbuf **targaddr;</span>
<span id="cb7-1812"><a href="#cb7-1812" aria-hidden="true"></a>{</span>
<span id="cb7-1813"><a href="#cb7-1813" aria-hidden="true"></a>  <span class="dt">static</span> <span class="dt">char</span> *tlist[<span class="dv">3</span>] = {</span>
<span id="cb7-1814"><a href="#cb7-1814" aria-hidden="true"></a>    <span class="st">&quot;circuit_n&quot;</span>, <span class="st">&quot;circuit_v&quot;</span>, <span class="st">&quot;datagram_v&quot;</span></span>
<span id="cb7-1815"><a href="#cb7-1815" aria-hidden="true"></a>  };</span>
<span id="cb7-1816"><a href="#cb7-1816" aria-hidden="true"></a>  <span class="dt">int</span> i;</span>
<span id="cb7-1817"><a href="#cb7-1817" aria-hidden="true"></a>  <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-1818"><a href="#cb7-1818" aria-hidden="true"></a>  CLIENT *clnt = NULL;</span>
<span id="cb7-1819"><a href="#cb7-1819" aria-hidden="true"></a>  <span class="dt">void</span> *handle;</span>
<span id="cb7-1820"><a href="#cb7-1820" aria-hidden="true"></a></span>
<span id="cb7-1821"><a href="#cb7-1821" aria-hidden="true"></a>  rpc_createerr.cf_stat = RPC_SUCCESS;</span>
<span id="cb7-1822"><a href="#cb7-1822" aria-hidden="true"></a>  <span class="cf">for</span> (i = <span class="dv">0</span>; i &lt; <span class="dv">3</span>; i++)</span>
<span id="cb7-1823"><a href="#cb7-1823" aria-hidden="true"></a>    {</span>
<span id="cb7-1824"><a href="#cb7-1824" aria-hidden="true"></a>      <span class="cf">if</span> ((handle = __rpc_setconf (tlist[i])) == NULL)</span>
<span id="cb7-1825"><a href="#cb7-1825" aria-hidden="true"></a>    <span class="cf">continue</span>;</span>
<span id="cb7-1826"><a href="#cb7-1826" aria-hidden="true"></a>      <span class="cf">while</span> (clnt == (CLIENT *) NULL)</span>
<span id="cb7-1827"><a href="#cb7-1827" aria-hidden="true"></a>    {</span>
<span id="cb7-1828"><a href="#cb7-1828" aria-hidden="true"></a>      <span class="cf">if</span> ((nconf = __rpc_getconf (handle)) == NULL)</span>
<span id="cb7-1829"><a href="#cb7-1829" aria-hidden="true"></a>        {</span>
<span id="cb7-1830"><a href="#cb7-1830" aria-hidden="true"></a>          <span class="cf">if</span> (rpc_createerr.cf_stat == RPC_SUCCESS)</span>
<span id="cb7-1831"><a href="#cb7-1831" aria-hidden="true"></a>        rpc_createerr.cf_stat = RPC_UNKNOWNPROTO;</span>
<span id="cb7-1832"><a href="#cb7-1832" aria-hidden="true"></a>          <span class="cf">break</span>;</span>
<span id="cb7-1833"><a href="#cb7-1833" aria-hidden="true"></a>        }</span>
<span id="cb7-1834"><a href="#cb7-1834" aria-hidden="true"></a>      clnt = getclnthandle (host, nconf, rpcbversnum, targaddr);</span>
<span id="cb7-1835"><a href="#cb7-1835" aria-hidden="true"></a>    }</span>
<span id="cb7-1836"><a href="#cb7-1836" aria-hidden="true"></a>      <span class="cf">if</span> (clnt)</span>
<span id="cb7-1837"><a href="#cb7-1837" aria-hidden="true"></a>    <span class="cf">break</span>;</span>
<span id="cb7-1838"><a href="#cb7-1838" aria-hidden="true"></a>      __rpc_endconf (handle);</span>
<span id="cb7-1839"><a href="#cb7-1839" aria-hidden="true"></a>    }</span>
<span id="cb7-1840"><a href="#cb7-1840" aria-hidden="true"></a>  <span class="cf">return</span> (clnt);</span>
<span id="cb7-1841"><a href="#cb7-1841" aria-hidden="true"></a>}</span>
<span id="cb7-1842"><a href="#cb7-1842" aria-hidden="true"></a></span>
<span id="cb7-1843"><a href="#cb7-1843" aria-hidden="true"></a><span class="dt">static</span> CLIENT *</span>
<span id="cb7-1844"><a href="#cb7-1844" aria-hidden="true"></a>getclnthandle (host, nconf, rpcbversnum, targaddr)</span>
<span id="cb7-1845"><a href="#cb7-1845" aria-hidden="true"></a>     <span class="dt">char</span> *host;</span>
<span id="cb7-1846"><a href="#cb7-1846" aria-hidden="true"></a>     <span class="kw">struct</span> netconfig *nconf;</span>
<span id="cb7-1847"><a href="#cb7-1847" aria-hidden="true"></a>     u_long rpcbversnum;</span>
<span id="cb7-1848"><a href="#cb7-1848" aria-hidden="true"></a>     <span class="kw">struct</span> netbuf **targaddr;</span>
<span id="cb7-1849"><a href="#cb7-1849" aria-hidden="true"></a>{</span>
<span id="cb7-1850"><a href="#cb7-1850" aria-hidden="true"></a>  <span class="kw">struct</span> netbuf addr;</span>
<span id="cb7-1851"><a href="#cb7-1851" aria-hidden="true"></a>  <span class="kw">struct</span> addrinfo hints, *res;</span>
<span id="cb7-1852"><a href="#cb7-1852" aria-hidden="true"></a>  CLIENT *client = NULL;</span>
<span id="cb7-1853"><a href="#cb7-1853" aria-hidden="true"></a></span>
<span id="cb7-1854"><a href="#cb7-1854" aria-hidden="true"></a>  <span class="co">/* Get the address of the rpcbind */</span></span>
<span id="cb7-1855"><a href="#cb7-1855" aria-hidden="true"></a>  memset (&amp;hints, <span class="dv">0</span>, <span class="kw">sizeof</span> hints);</span>
<span id="cb7-1856"><a href="#cb7-1856" aria-hidden="true"></a>  <span class="cf">if</span> ((getaddrinfo (host, <span class="st">&quot;rpcbind&quot;</span>, &amp;hints, &amp;res) != <span class="dv">0</span>) &amp;&amp;</span>
<span id="cb7-1857"><a href="#cb7-1857" aria-hidden="true"></a>      (getaddrinfo (host, <span class="st">&quot;portmapper&quot;</span>,&amp;hints, &amp;res) != <span class="dv">0</span>))</span>
<span id="cb7-1858"><a href="#cb7-1858" aria-hidden="true"></a>    {</span>
<span id="cb7-1859"><a href="#cb7-1859" aria-hidden="true"></a>      rpc_createerr.cf_stat = RPC_N2AXLATEFAILURE;</span>
<span id="cb7-1860"><a href="#cb7-1860" aria-hidden="true"></a>      <span class="cf">return</span> (NULL);</span>
<span id="cb7-1861"><a href="#cb7-1861" aria-hidden="true"></a>    }</span>
<span id="cb7-1862"><a href="#cb7-1862" aria-hidden="true"></a>  addr.len = addr.maxlen = res-&gt;ai_addrlen;</span>
<span id="cb7-1863"><a href="#cb7-1863" aria-hidden="true"></a>  addr.buf = res-&gt;ai_addr;</span>
<span id="cb7-1864"><a href="#cb7-1864" aria-hidden="true"></a>  client = clnt_tli_create (RPC_ANYFD, nconf, &amp;addr, RPCBPROG,</span>
<span id="cb7-1865"><a href="#cb7-1865" aria-hidden="true"></a>                rpcbversnum, <span class="dv">0</span>, <span class="dv">0</span>);</span>
<span id="cb7-1866"><a href="#cb7-1866" aria-hidden="true"></a>  <span class="cf">if</span> (client)</span>
<span id="cb7-1867"><a href="#cb7-1867" aria-hidden="true"></a>    {</span>
<span id="cb7-1868"><a href="#cb7-1868" aria-hidden="true"></a>      <span class="cf">if</span> (targaddr != NULL)</span>
<span id="cb7-1869"><a href="#cb7-1869" aria-hidden="true"></a>    {</span>
<span id="cb7-1870"><a href="#cb7-1870" aria-hidden="true"></a>      *targaddr = (<span class="kw">struct</span> netbuf *) malloc (<span class="kw">sizeof</span> (<span class="kw">struct</span> netbuf));</span>
<span id="cb7-1871"><a href="#cb7-1871" aria-hidden="true"></a>      <span class="cf">if</span> (*targaddr != NULL)</span>
<span id="cb7-1872"><a href="#cb7-1872" aria-hidden="true"></a>        {</span>
<span id="cb7-1873"><a href="#cb7-1873" aria-hidden="true"></a>          (*targaddr)-&gt;maxlen = addr.maxlen;</span>
<span id="cb7-1874"><a href="#cb7-1874" aria-hidden="true"></a>          (*targaddr)-&gt;len = addr.len;</span>
<span id="cb7-1875"><a href="#cb7-1875" aria-hidden="true"></a>          (*targaddr)-&gt;buf = (<span class="dt">char</span> *) malloc (addr.len);</span>
<span id="cb7-1876"><a href="#cb7-1876" aria-hidden="true"></a>          <span class="cf">if</span> ((*targaddr)-&gt;buf != NULL)</span>
<span id="cb7-1877"><a href="#cb7-1877" aria-hidden="true"></a>        {</span>
<span id="cb7-1878"><a href="#cb7-1878" aria-hidden="true"></a>          memcpy ((*targaddr)-&gt;buf, addr.buf, addr.len);</span>
<span id="cb7-1879"><a href="#cb7-1879" aria-hidden="true"></a>        }</span>
<span id="cb7-1880"><a href="#cb7-1880" aria-hidden="true"></a>        }</span>
<span id="cb7-1881"><a href="#cb7-1881" aria-hidden="true"></a>    }</span>
<span id="cb7-1882"><a href="#cb7-1882" aria-hidden="true"></a>    }</span>
<span id="cb7-1883"><a href="#cb7-1883" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1884"><a href="#cb7-1884" aria-hidden="true"></a>    {</span>
<span id="cb7-1885"><a href="#cb7-1885" aria-hidden="true"></a>      <span class="cf">if</span> (rpc_createerr.cf_stat == RPC_TLIERROR)</span>
<span id="cb7-1886"><a href="#cb7-1886" aria-hidden="true"></a>    {</span>
<span id="cb7-1887"><a href="#cb7-1887" aria-hidden="true"></a>      <span class="co">/*</span></span>
<span id="cb7-1888"><a href="#cb7-1888" aria-hidden="true"></a><span class="co">       * Assume that the other system is dead; this is a</span></span>
<span id="cb7-1889"><a href="#cb7-1889" aria-hidden="true"></a><span class="co">       * better error to display to the user.</span></span>
<span id="cb7-1890"><a href="#cb7-1890" aria-hidden="true"></a><span class="co">       */</span></span>
<span id="cb7-1891"><a href="#cb7-1891" aria-hidden="true"></a>      rpc_createerr.cf_stat = RPC_RPCBFAILURE;</span>
<span id="cb7-1892"><a href="#cb7-1892" aria-hidden="true"></a>      rpc_createerr.cf_error.re_status = RPC_FAILED;</span>
<span id="cb7-1893"><a href="#cb7-1893" aria-hidden="true"></a>    }</span>
<span id="cb7-1894"><a href="#cb7-1894" aria-hidden="true"></a>    }</span>
<span id="cb7-1895"><a href="#cb7-1895" aria-hidden="true"></a>  freeaddrinfo (res);</span>
<span id="cb7-1896"><a href="#cb7-1896" aria-hidden="true"></a>  <span class="cf">return</span> (client);</span>
<span id="cb7-1897"><a href="#cb7-1897" aria-hidden="true"></a>}</span>
<span id="cb7-1898"><a href="#cb7-1898" aria-hidden="true"></a></span>
<span id="cb7-1899"><a href="#cb7-1899" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1900"><a href="#cb7-1900" aria-hidden="true"></a>print_rmtcallstat (rtype, infp)</span>
<span id="cb7-1901"><a href="#cb7-1901" aria-hidden="true"></a>     <span class="dt">int</span> rtype;</span>
<span id="cb7-1902"><a href="#cb7-1902" aria-hidden="true"></a>     rpcb_stat *infp;</span>
<span id="cb7-1903"><a href="#cb7-1903" aria-hidden="true"></a>{</span>
<span id="cb7-1904"><a href="#cb7-1904" aria-hidden="true"></a>  <span class="dt">register</span> rpcbs_rmtcalllist_ptr pr;</span>
<span id="cb7-1905"><a href="#cb7-1905" aria-hidden="true"></a>  <span class="kw">struct</span> rpcent *rpc;</span>
<span id="cb7-1906"><a href="#cb7-1906" aria-hidden="true"></a></span>
<span id="cb7-1907"><a href="#cb7-1907" aria-hidden="true"></a>  <span class="cf">if</span> (rtype == RPCBVERS_4_STAT)</span>
<span id="cb7-1908"><a href="#cb7-1908" aria-hidden="true"></a>    printf (<span class="st">&quot;prog</span><span class="sc">\t\t</span><span class="st">vers</span><span class="sc">\t</span><span class="st">proc</span><span class="sc">\t</span><span class="st">netid</span><span class="sc">\t</span><span class="st">indirect success failure</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1909"><a href="#cb7-1909" aria-hidden="true"></a>  <span class="cf">else</span></span>
<span id="cb7-1910"><a href="#cb7-1910" aria-hidden="true"></a>    printf (<span class="st">&quot;prog</span><span class="sc">\t\t</span><span class="st">vers</span><span class="sc">\t</span><span class="st">proc</span><span class="sc">\t</span><span class="st">netid</span><span class="sc">\t</span><span class="st">success</span><span class="sc">\t</span><span class="st">failure</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1911"><a href="#cb7-1911" aria-hidden="true"></a>  <span class="cf">for</span> (pr = infp-&gt;rmtinfo; pr; pr = pr-&gt;next)</span>
<span id="cb7-1912"><a href="#cb7-1912" aria-hidden="true"></a>    {</span>
<span id="cb7-1913"><a href="#cb7-1913" aria-hidden="true"></a>      rpc = getrpcbynumber (pr-&gt;prog);</span>
<span id="cb7-1914"><a href="#cb7-1914" aria-hidden="true"></a>      <span class="cf">if</span> (rpc)</span>
<span id="cb7-1915"><a href="#cb7-1915" aria-hidden="true"></a>    printf (<span class="st">&quot;%-16s&quot;</span>, rpc-&gt;r_name);</span>
<span id="cb7-1916"><a href="#cb7-1916" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1917"><a href="#cb7-1917" aria-hidden="true"></a>    printf (<span class="st">&quot;%-16d&quot;</span>, pr-&gt;prog);</span>
<span id="cb7-1918"><a href="#cb7-1918" aria-hidden="true"></a>      printf (<span class="st">&quot;%d</span><span class="sc">\t</span><span class="st">%d</span><span class="sc">\t</span><span class="st">%s</span><span class="sc">\t</span><span class="st">&quot;</span>, pr-&gt;vers, pr-&gt;proc, pr-&gt;netid);</span>
<span id="cb7-1919"><a href="#cb7-1919" aria-hidden="true"></a>      <span class="cf">if</span> (rtype == RPCBVERS_4_STAT)</span>
<span id="cb7-1920"><a href="#cb7-1920" aria-hidden="true"></a>    printf (<span class="st">&quot;%d</span><span class="sc">\t</span><span class="st"> &quot;</span>, pr-&gt;indirect);</span>
<span id="cb7-1921"><a href="#cb7-1921" aria-hidden="true"></a>      printf (<span class="st">&quot;%d</span><span class="sc">\t</span><span class="st">%d</span><span class="sc">\n</span><span class="st">&quot;</span>, pr-&gt;success, pr-&gt;failure);</span>
<span id="cb7-1922"><a href="#cb7-1922" aria-hidden="true"></a>    }</span>
<span id="cb7-1923"><a href="#cb7-1923" aria-hidden="true"></a>}</span>
<span id="cb7-1924"><a href="#cb7-1924" aria-hidden="true"></a></span>
<span id="cb7-1925"><a href="#cb7-1925" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb7-1926"><a href="#cb7-1926" aria-hidden="true"></a>print_getaddrstat (rtype, infp)</span>
<span id="cb7-1927"><a href="#cb7-1927" aria-hidden="true"></a>     <span class="dt">int</span> rtype;</span>
<span id="cb7-1928"><a href="#cb7-1928" aria-hidden="true"></a>     rpcb_stat *infp;</span>
<span id="cb7-1929"><a href="#cb7-1929" aria-hidden="true"></a>{</span>
<span id="cb7-1930"><a href="#cb7-1930" aria-hidden="true"></a>  rpcbs_addrlist_ptr al;</span>
<span id="cb7-1931"><a href="#cb7-1931" aria-hidden="true"></a>  <span class="dt">register</span> <span class="kw">struct</span> rpcent *rpc;</span>
<span id="cb7-1932"><a href="#cb7-1932" aria-hidden="true"></a></span>
<span id="cb7-1933"><a href="#cb7-1933" aria-hidden="true"></a>  printf (<span class="st">&quot;prog</span><span class="sc">\t\t</span><span class="st">vers</span><span class="sc">\t</span><span class="st">netid</span><span class="sc">\t</span><span class="st">  success</span><span class="sc">\t</span><span class="st">failure</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb7-1934"><a href="#cb7-1934" aria-hidden="true"></a>  <span class="cf">for</span> (al = infp-&gt;addrinfo; al; al = al-&gt;next)</span>
<span id="cb7-1935"><a href="#cb7-1935" aria-hidden="true"></a>    {</span>
<span id="cb7-1936"><a href="#cb7-1936" aria-hidden="true"></a>      rpc = getrpcbynumber (al-&gt;prog);</span>
<span id="cb7-1937"><a href="#cb7-1937" aria-hidden="true"></a>      <span class="cf">if</span> (rpc)</span>
<span id="cb7-1938"><a href="#cb7-1938" aria-hidden="true"></a>    printf (<span class="st">&quot;%-16s&quot;</span>, rpc-&gt;r_name);</span>
<span id="cb7-1939"><a href="#cb7-1939" aria-hidden="true"></a>      <span class="cf">else</span></span>
<span id="cb7-1940"><a href="#cb7-1940" aria-hidden="true"></a>    printf (<span class="st">&quot;%-16d&quot;</span>, al-&gt;prog);</span>
<span id="cb7-1941"><a href="#cb7-1941" aria-hidden="true"></a>      printf (<span class="st">&quot;%d</span><span class="sc">\t</span><span class="st">%s</span><span class="sc">\t</span><span class="st">  %-12d</span><span class="sc">\t</span><span class="st">%d</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb7-1942"><a href="#cb7-1942" aria-hidden="true"></a>          al-&gt;vers, al-&gt;netid, al-&gt;success, al-&gt;failure);</span>
<span id="cb7-1943"><a href="#cb7-1943" aria-hidden="true"></a>    }</span>
<span id="cb7-1944"><a href="#cb7-1944" aria-hidden="true"></a>}</span>
<span id="cb7-1945"><a href="#cb7-1945" aria-hidden="true"></a></span>
<span id="cb7-1946"><a href="#cb7-1946" aria-hidden="true"></a><span class="dt">static</span> <span class="dt">char</span> *</span>
<span id="cb7-1947"><a href="#cb7-1947" aria-hidden="true"></a>spaces (howmany)</span>
<span id="cb7-1948"><a href="#cb7-1948" aria-hidden="true"></a>     <span class="dt">int</span> howmany;</span>
<span id="cb7-1949"><a href="#cb7-1949" aria-hidden="true"></a>{</span>
<span id="cb7-1950"><a href="#cb7-1950" aria-hidden="true"></a>  <span class="dt">static</span> <span class="dt">char</span> space_array[] =   <span class="co">/* 64 spaces */</span></span>
<span id="cb7-1951"><a href="#cb7-1951" aria-hidden="true"></a>    <span class="st">&quot;                                                                &quot;</span>;</span>
<span id="cb7-1952"><a href="#cb7-1952" aria-hidden="true"></a></span>
<span id="cb7-1953"><a href="#cb7-1953" aria-hidden="true"></a>  <span class="cf">if</span> (howmany &lt;= <span class="dv">0</span> || howmany &gt; <span class="kw">sizeof</span> (space_array))</span>
<span id="cb7-1954"><a href="#cb7-1954" aria-hidden="true"></a>    {</span>
<span id="cb7-1955"><a href="#cb7-1955" aria-hidden="true"></a>      <span class="cf">return</span> (<span class="st">&quot;&quot;</span>);</span>
<span id="cb7-1956"><a href="#cb7-1956" aria-hidden="true"></a>    }</span>
<span id="cb7-1957"><a href="#cb7-1957" aria-hidden="true"></a>  <span class="cf">return</span> (&amp;space_array[<span class="kw">sizeof</span> (space_array) - howmany - <span class="dv">1</span>]);</span>
<span id="cb7-1958"><a href="#cb7-1958" aria-hidden="true"></a>}</span></code></pre></div>
</body>
</html>
