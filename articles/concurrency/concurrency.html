<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>
/f0c1s/blog/articles/concurrency
</title>
<link rel="stylesheet" href="../../index.css"/>
<link rel="stylesheet" href="../../highlight/styles/monokai.min.css"/>
<script src="../../setup.js"></script>
<script src="../../highlight/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body>
<h1>
/f0c1s/blog/articles/concurrency
</h1>
<nav>
<a href="../../index.html">/blog</a>
<a href="../../articles/index.html">articles</a>
<a href="../../articles/concurrency/concurrency.html">+ concurrency</a>
</nav>
<h2 id="definitions">Definitions</h2>
<dl>
<dt>
concurrency
</dt>
<dd>
Ability to have multiple things happen at one time.
</dd>
<dt>
concurrent application
</dt>
<dd>
An application that can deal with multiple things happening at one time.
</dd>
<dt>
process
</dt>
<dd>
A process is an instance of a running program that is isolated from
other processes on the same machine.
</dd>
<dt>
thread
</dt>
<dd>
An execution sequence of a part of a program
</dd>
<dt>
asynchronous function
</dt>
<dd>
A function that can return early, by setting up a callback which does
the heavy work later.
</dd>
<dt>
synchronous function
</dt>
<dd>
A function that run to completion, or throw an error, or never return
</dd>
<dt>
single threaded process
</dt>
<dd>
Process which has only one thread of execution, if thread sleeps, the
process sleeps
</dd>
<dt>
multi-threaded process
</dt>
<dd>
Process which has multiple threads of execution; threads can step on
one-another’s toes
</dd>
</dl>
<p>Now read these and may be scratch you head, while saying “huh?”</p>
<blockquote>
Concurrency is the simultaneous occurrence of events.
</blockquote>
<blockquote>
Concurrency means multiple tasks which start, run, and complete in
overlapping time periods, in no specific order.
</blockquote>
<blockquote>
acting in conjunction, contributing to the same effect or event
</blockquote>
<blockquote>
A thread is a locus of control inside a running program.
</blockquote>
<blockquote>
A function that can be suspended while it’s partway through execution.
</blockquote>
<h3 id="sample-multi-thread-example-in-c">Sample multi-thread example in
C</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Threading</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> threading_samples</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">internal</span> <span class="kw">class</span> Program</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span><span class="op">[]</span> args<span class="op">)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> t <span class="op">=</span> <span class="kw">new</span> <span class="fu">Thread</span><span class="op">(</span>WriteX<span class="op">);</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span><span class="fu">Start</span><span class="op">();</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">Write_</span><span class="op">();</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Write_</span><span class="op">()</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span> Console<span class="op">.</span><span class="fu">Write</span><span class="op">(</span><span class="st">&quot;_&quot;</span><span class="op">);</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">WriteX</span><span class="op">()</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span> Console<span class="op">.</span><span class="fu">Write</span><span class="op">(</span><span class="st">&quot;X&quot;</span><span class="op">);</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<p>Contrast the two output from two back-to-back executions of the code
above:</p>
<figure>
<img src="1.csharp-multi-thread-output-1.png"
alt="1.csharp-multi-thread-output-1" />
<figcaption
aria-hidden="true">1.csharp-multi-thread-output-1</figcaption>
</figure>
<figure>
<img src="2.csharp-multi-thread-output-2.png"
alt="2.csharp-multi-thread-output-2" />
<figcaption
aria-hidden="true">2.csharp-multi-thread-output-2</figcaption>
</figure>
<p>This should tell you that the threads are independent of each other
and may be scheduled at any point of time.</p>
<h3 id="increment-decrement-example">Increment Decrement example</h3>
<p>In this example we are going to decrement a number 100 times and then
increment it. The output should be 0 at the end, always. But this
doesn’t happen.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Threading</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> threading_samples</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">internal</span> <span class="kw">static</span> <span class="kw">class</span> IncrementDecrement</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">int</span> _value<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span><span class="op">[]</span> args<span class="op">)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> loop <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> loop <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> loop<span class="op">++)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                _value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> straw <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> straw <span class="op">&lt;</span> <span class="dv">123456</span><span class="op">;</span> straw<span class="op">++)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> t <span class="op">=</span> <span class="kw">new</span> <span class="fu">Thread</span><span class="op">(</span>Decrement<span class="op">);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span><span class="fu">Start</span><span class="op">();</span> <span class="co">// decrease by 100</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">Increment</span><span class="op">();</span> <span class="co">// increase by 100</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span><span class="fu">Join</span><span class="op">();</span> <span class="co">// wait for the decrement thread to finish</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>_value <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;value: {0}, straw that broke camel&#39;s back: {1}, loop #: {2}&quot;</span><span class="op">,</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                            _value<span class="op">,</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                            straw<span class="op">,</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                            loop<span class="op">);</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">break</span><span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Increment</span><span class="op">()</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span> _value<span class="op">++;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Decrement</span><span class="op">()</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span> _value<span class="op">--;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<pre><code>value: -67, straw that broke camel&#39;s back: 19562, loop #: 0
value: -26, straw that broke camel&#39;s back: 63075, loop #: 1
value: -9, straw that broke camel&#39;s back: 10, loop #: 2
value: -14, straw that broke camel&#39;s back: 2825, loop #: 3
value: -30, straw that broke camel&#39;s back: 50750, loop #: 4
value: -32, straw that broke camel&#39;s back: 23053, loop #: 5
value: -69, straw that broke camel&#39;s back: 31660, loop #: 7
value: -43, straw that broke camel&#39;s back: 7767, loop #: 9
</code></pre>
<p>If you notice, loop#6 and #8 are missing, that is when the loop ended
with a value of 0.</p>
<figure>
<img src="3.csharp-multi-thread-increment-decrement-example.png"
alt="3.csharp-multi-thread-increment-decrement-example" />
<figcaption
aria-hidden="true">3.csharp-multi-thread-increment-decrement-example</figcaption>
</figure>
<p>If I decrease the Increment/Decrement loop count to 10, the execution
becomes stabler.</p>
<pre><code>value: -10, straw that broke camel&#39;s back: 41654, loop #: 1
value: 10, straw that broke camel&#39;s back: 26690, loop #: 2
value: 7, straw that broke camel&#39;s back: 23717, loop #: 3
value: 6, straw that broke camel&#39;s back: 58597, loop #: 5
</code></pre>
<p>Notice how the inner loop count has jumped to five digits in every
case.</p>
<p>Let’s decrease the number of inner loop (straw).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Threading</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> threading_samples</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">internal</span> <span class="kw">static</span> <span class="kw">class</span> IncrementDecrement</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">int</span> _value<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span><span class="op">[]</span> args<span class="op">)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> loop <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> loop <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> loop<span class="op">++)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                _value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> straw <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> straw <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> straw<span class="op">++)</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> t <span class="op">=</span> <span class="kw">new</span> <span class="fu">Thread</span><span class="op">(</span>Decrement<span class="op">);</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span><span class="fu">Start</span><span class="op">();</span> <span class="co">// decrease by 2</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">Increment</span><span class="op">();</span> <span class="co">// increase by 2</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span><span class="fu">Join</span><span class="op">();</span> <span class="co">// wait for the decrement thread to finish</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>_value <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;value: {0}, straw that broke camel&#39;s back: {1}, loop #: {2}&quot;</span><span class="op">,</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                            _value<span class="op">,</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                            straw<span class="op">,</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                            loop<span class="op">);</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">break</span><span class="op">;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Increment</span><span class="op">()</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> i<span class="op">++)</span> _value<span class="op">++;</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Decrement</span><span class="op">()</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> i<span class="op">++)</span> _value<span class="op">--;</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Nothing. No errors.</p>
<p>That’s because computers are fast. Notice, Increment/Decrement loops
are running only twice. Inner loop(straw) is running only 100 times,
outer loop only 10 times. And there are no errors.</p>
<p>If I increase outer loop (loop) invocations, then we see some errors
again. I made condition <code>loop &lt; 10000;</code> and it shows some
errors:</p>
<pre><code>value: 2, straw that broke camel&#39;s back: 44, loop #: 1038
value: -2, straw that broke camel&#39;s back: 19, loop #: 2416
value: 2, straw that broke camel&#39;s back: 47, loop #: 6999
</code></pre>
<p>And that’s it. This is the reason why concurrency/multi-threading
errors are hard to figure out. The code can be incorrect logically, but
still execute really well.</p>
<p>For example, the following code is logically wrong, but it will
almost never show you the error.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Threading</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> threading_samples</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">internal</span> <span class="kw">static</span> <span class="kw">class</span> IncrementDecrement</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">int</span> _value<span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span><span class="op">[]</span> args<span class="op">)</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> loop <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> loop <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> loop<span class="op">++)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                _value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> straw <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> straw <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> straw<span class="op">++)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> t <span class="op">=</span> <span class="kw">new</span> <span class="fu">Thread</span><span class="op">(</span>Decrement<span class="op">);</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span><span class="fu">Start</span><span class="op">();</span> <span class="co">// decrease by 2</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">Increment</span><span class="op">();</span> <span class="co">// increase by 2</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                    t<span class="op">.</span><span class="fu">Join</span><span class="op">();</span> <span class="co">// wait for the decrement thread to finish</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>_value <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;value: {0}, straw that broke camel&#39;s back: {1}, loop #: {2}&quot;</span><span class="op">,</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                            _value<span class="op">,</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                            straw<span class="op">,</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                            loop<span class="op">);</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">break</span><span class="op">;</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Increment</span><span class="op">()</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> i<span class="op">++)</span> _value<span class="op">++;</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Decrement</span><span class="op">()</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> i<span class="op">++)</span> _value<span class="op">--;</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="references">References</h2>
<ol type="1">
<li><a
href="https://www.andrew.cmu.edu/user/nbier/15110/lectures/lec24-concurrency.pdf">cmu.edu
pdf</a></li>
<li><a
href="https://www.geeksforgeeks.org/concurrency-in-operating-system/">concurrency-in-operating-system/</a></li>
<li><a
href="https://www.geeksforgeeks.org/difference-between-concurrency-and-parallelism/">difference-between-concurrency-and-parallelism/</a></li>
<li><a
href="https://stackoverflow.com/questions/4844637/what-is-the-difference-between-concurrency-parallelism-and-asynchronous-methods">difference
between concurrency, parallelism, and asynchronous methods</a></li>
<li><a href="https://www.etymonline.com/word/concurrent">etymology
concurrent</a></li>
<li><a href="https://www.etymonline.com/search?q=Concurrency">etymology
Concurrency</a></li>
<li><a
href="https://web.mit.edu/6.005/www/fa14/classes/17-concurrency/">mit.edu
6.005</a></li>
<li><a
href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html">swift</a></li>
<li><a
href="https://docs.python.org/3/library/concurrency.html">python</a></li>
</ol>
</body>
</html>
