<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>
/f0c1s/blog/redis/redis-fulltext
</title>
<link rel="stylesheet" href="../../index.css"/>
<script src="../../setup.js"></script>
</head>
<body onload="setup()">
<h1>
/f0c1s/blog/redis/redis-fulltext
</h1>
<nav>
<a href="../../index.html">/blog</a> <a href="../index.html">redis</a> <a href="../../redis/redis-fulltext/redis-fulltext.html">+ redis fulltext search app</a>
</nav>
<h2 id="setting-up-redis">setting up redis</h2>
<p>Read <a href="../setup/setup-redis-in-docker.html" class="in">setup redis in docker</a></p>
<h2 id="setup-nextjs-app">Setup nextjs app</h2>
<pre class="shell"><code>yarn create next-app redis-fulltext --typescript
cd redis-fulltext
yarn add redis-om</code></pre>
<h2 id="code">code</h2>
<h3 id="libredis.ts">/lib/redis.ts</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="im">import</span> {Client} from <span class="st">&#39;redis-om&#39;</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>const redisClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">Client</span>()<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>async <span class="kw">function</span> <span class="fu">connectToRedis</span>() {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>    <span class="fu">if</span> (<span class="op">!</span>redisClient<span class="op">.</span><span class="fu">isOpen</span>()) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>        await redisClient<span class="op">.</span><span class="fu">open</span>(<span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">REDIS_HOST</span>)<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>    }</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>}</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>export {connectToRedis<span class="op">,</span> redisClient}<span class="op">;</span></span></code></pre></div>
<h3 id="libcar.ts">/lib/car.ts</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="im">import</span> {Entity<span class="op">,</span> EntityCreationData<span class="op">,</span> Repository<span class="op">,</span> Schema} from <span class="st">&quot;redis-om&quot;</span><span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="im">import</span> {redisClient<span class="op">,</span> connectToRedis} from <span class="st">&quot;./redis&quot;</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>class CarEntity extends Entity {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>let carSchema <span class="op">=</span> <span class="kw">new</span> <span class="fu">Schema</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    CarEntity<span class="op">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>        make<span class="op">:</span> {type<span class="op">:</span> <span class="st">&quot;string&quot;</span>}<span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>        model<span class="op">:</span> {type<span class="op">:</span> <span class="st">&quot;string&quot;</span>}<span class="op">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>        image<span class="op">:</span> {type<span class="op">:</span> <span class="st">&quot;string&quot;</span>}<span class="op">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>        description<span class="op">:</span> {type<span class="op">:</span> <span class="st">&quot;string&quot;</span>}<span class="op">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>    }<span class="op">,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>    {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>        dataStructure<span class="op">:</span> <span class="st">&quot;JSON&quot;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>    }</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>)<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a>async <span class="kw">function</span> <span class="fu">createCar</span>(data<span class="op">:</span> EntityCreationData <span class="op">|</span> <span class="dt">undefined</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> {</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a>    await <span class="fu">connectToRedis</span>()<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a>    const repo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Repository</span>(carSchema<span class="op">,</span> redisClient)<span class="op">;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a>    const car <span class="op">=</span> repo<span class="op">.</span><span class="fu">createEntity</span>(data)<span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a>    const id <span class="op">=</span> await repo<span class="op">.</span><span class="fu">save</span>(car)<span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a>    return id<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a>}</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true"></a>export {CarEntity<span class="op">,</span> createCar<span class="op">,</span> carSchema}<span class="op">;</span></span></code></pre></div>
<h3 id="pagescar.tsx">/pages/Car.tsx</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="im">import</span> {FormEvent} from <span class="st">&quot;react&quot;</span><span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>export default <span class="kw">function</span> <span class="fu">CarForm</span>() {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    async <span class="kw">function</span> <span class="fu">handleSubmit</span>(event<span class="op">:</span> FormEvent<span class="op">&lt;</span>HTMLFormElement<span class="op">&gt;</span>) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>        event<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>        const form <span class="op">=</span> <span class="kw">new</span> <span class="fu">FormData</span>(event<span class="op">.</span><span class="at">target</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>        const formData <span class="op">=</span> Object<span class="op">.</span><span class="fu">fromEntries</span>(form<span class="op">.</span><span class="fu">entries</span>())<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(formData)<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>        const res <span class="op">=</span> await <span class="fu">fetch</span>(<span class="st">&#39;/api/cars&#39;</span><span class="op">,</span> {</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>            body<span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(formData)<span class="op">,</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>            headers<span class="op">:</span> {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>                <span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;application/json&quot;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>            }<span class="op">,</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>            method<span class="op">:</span> <span class="st">&quot;POST&quot;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>        })<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>        const result <span class="op">=</span> await res<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(result)<span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a>    }</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a>    <span class="fu">return</span> (</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a>        <span class="op">&lt;</span>form onSubmit<span class="op">=</span>{handleSubmit}<span class="op">&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>            <span class="op">&lt;</span>input <span class="kw">type</span><span class="op">=</span>{<span class="st">&quot;text&quot;</span>} name<span class="op">=</span>{<span class="st">&quot;make&quot;</span>}<span class="op">/&gt;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a>            <span class="op">&lt;</span>input <span class="kw">type</span><span class="op">=</span>{<span class="st">&quot;text&quot;</span>} name<span class="op">=</span>{<span class="st">&quot;model&quot;</span>}<span class="op">/&gt;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a>            <span class="op">&lt;</span>input <span class="kw">type</span><span class="op">=</span>{<span class="st">&quot;text&quot;</span>} name<span class="op">=</span>{<span class="st">&quot;image&quot;</span>}<span class="op">/&gt;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true"></a>            <span class="op">&lt;</span>input <span class="kw">type</span><span class="op">=</span>{<span class="st">&quot;text&quot;</span>} name<span class="op">=</span>{<span class="st">&quot;description&quot;</span>}<span class="op">/&gt;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true"></a>            <span class="op">&lt;</span>button <span class="kw">type</span><span class="op">=</span>{<span class="st">&quot;submit&quot;</span>}<span class="op">&gt;</span>create car<span class="op">&lt;/</span>button<span class="op">&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true"></a>        <span class="op">&lt;/</span>form<span class="op">&gt;</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true"></a>    )<span class="op">;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true"></a>}</span></code></pre></div>
<h3 id="pagesapicars.ts">/pages/api/cars.ts</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="im">import</span> {createCar} from <span class="st">&quot;../../lib/car&quot;</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>async <span class="kw">function</span> <span class="fu">handler</span>(req<span class="op">,</span> res) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    const id <span class="op">=</span> await <span class="fu">createCar</span>(req<span class="op">.</span><span class="at">body</span>)<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">json</span>({id})<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>export {handler}<span class="op">;</span></span></code></pre></div>
<figure>
<img src="1.error-while-running-app.png" alt="" /><figcaption>1.error-while-running-app</figcaption>
</figure>
<figure>
<img src="2.expanded-error.png" alt="" /><figcaption>2.expanded-error</figcaption>
</figure>
<pre class="shell"><code>yarn dev
yarn run v1.22.17
$ next dev
ready - started server on 0.0.0.0:3000, url: http://localhost:3000
info  - Loaded env from /home/f0c1s/code/learn/redis-fulltext/.env
event - compiled client and server successfully in 229 ms (125 modules)
wait  - compiling / (client and server)...
event - compiled client and server successfully in 100 ms (135 modules)
wait  - compiling /api/cars...
event - compiled client and server successfully in 46 ms (148 modules)
req.body {
  make: &#39;make&#39;,
  model: &#39;model&#39;,
  image: &#39;image&#39;,
  description: &#39;description&#39;
}
error - ReplyError: ERR unknown command `JSON.SET`, with args beginning with: `CarEntity:01FS79FFZ1JEEQVJVC60KB42M7`, `.`, `{&quot;make&quot;:&quot;make&quot;,&quot;model&quot;:&quot;model&quot;,&quot;image&quot;:&quot;image&quot;,&quot;description&quot;:&quot;description&quot;}`,
wait  - compiling /_error (client and server)...
event - compiled client and server successfully in 82 ms (149 modules)
</code></pre>
<figure>
<img src="3.server-side-error.png" alt="" /><figcaption>3.server-side-error</figcaption>
</figure>
<h2 id="success">success</h2>
<p>I had to install redislabs/redismod, stop redis-one, run redismod on port 6379 and it works!</p>
<figure>
<img src="4.works-with-redismod.png" alt="" /><figcaption>4.works-with-redismod</figcaption>
</figure>
<h2 id="create-redis-index">create redis index</h2>
<p>Update <code>description</code> field in <code>carEntity</code> schema to have another field: <code>textSearch: true</code>.</p>
<figure>
<img src="5.update-schema-for-fulltext-search.png" alt="" /><figcaption>5.update-schema-for-fulltext-search</figcaption>
</figure>
<h3 id="add-apiredisindex">Add /api/redisIndex</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="im">import</span> {createRedisIndex} from <span class="st">&quot;../../lib/redisIndex&quot;</span><span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>export default async <span class="kw">function</span> <span class="fu">handler</span>(req<span class="op">:</span> <span class="dt">any</span><span class="op">,</span> res<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    await <span class="fu">createRedisIndex</span>()<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;ok&#39;</span>)<span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>}</span></code></pre></div>
<figure>
<img src="6.create-redis-index.png" alt="" /><figcaption>6.create-redis-index</figcaption>
</figure>
<h2 id="search">search</h2>
<h3 id="add-searchcars-in-libcar.ts">Add <code>searchCars</code> in lib/car.ts</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>async <span class="kw">function</span> <span class="fu">searchCars</span>(query<span class="op">:</span> <span class="dt">string</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    await <span class="fu">connectToRedis</span>()<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    const repo <span class="op">=</span> <span class="kw">new</span> <span class="fu">Repository</span>(carSchema<span class="op">,</span> redisClient)<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    const cars <span class="op">=</span> await repo<span class="op">.</span><span class="fu">search</span>()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>        <span class="op">.</span><span class="fu">where</span>(<span class="st">&quot;make&quot;</span>)<span class="op">.</span><span class="fu">eq</span>(query)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>        <span class="op">.</span><span class="fu">or</span>(<span class="st">&quot;model&quot;</span>)<span class="op">.</span><span class="fu">eq</span>(query)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        <span class="op">.</span><span class="fu">or</span>(<span class="st">&quot;description&quot;</span>)<span class="op">.</span><span class="fu">matches</span>(query)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>        <span class="op">.</span><span class="at">return</span><span class="op">.</span><span class="fu">all</span>()<span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>    return cars<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>}</span></code></pre></div>
<h3 id="add-apisearchcars.ts">Add api/searchCars.ts</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="im">import</span> {searchCars} from <span class="st">&quot;../../lib/car&quot;</span><span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>export default async <span class="kw">function</span> <span class="fu">handler</span>(req<span class="op">:</span> <span class="dt">any</span><span class="op">,</span> res<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>    const {query} <span class="op">=</span> req<span class="op">.</span><span class="at">query</span><span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(req<span class="op">.</span><span class="at">query</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    const cars <span class="op">=</span> await <span class="fu">searchCars</span>(query)<span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">json</span>({cars})<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>}</span></code></pre></div>
<h3 id="add-pagessearch.tsx">Add pages/Search.tsx</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="im">import</span> {useState} from <span class="st">&quot;react&quot;</span><span class="op">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="kw">type</span> Car <span class="op">=</span> {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>    make<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    model<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    image<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    entityId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>}</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>export default <span class="kw">function</span> <span class="fu">Search</span>() {</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>    const [cars<span class="op">,</span> setCars] <span class="op">=</span> <span class="fu">useState</span>([] <span class="im">as</span> Car[])<span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>    async <span class="kw">function</span> <span class="fu">search</span>(query<span class="op">:</span> <span class="dt">string</span>) {</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>        <span class="fu">if</span> (query<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">2</span>) {</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>            const params <span class="op">=</span> <span class="kw">new</span> <span class="fu">URLSearchParams</span>({query})<span class="op">;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a>            const res <span class="op">=</span> await <span class="fu">fetch</span>(<span class="vs">`/api/searchCars?</span><span class="sc">${</span>params<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a>            const result <span class="op">=</span> await res<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(result)<span class="op">;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a>            <span class="fu">setCars</span>(result[<span class="st">&#39;cars&#39;</span>])<span class="op">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a>        }</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a>    }</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true"></a>    <span class="fu">return</span> (</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true"></a>        <span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true"></a>            <span class="op">&lt;</span>input <span class="kw">type</span><span class="op">=</span>{<span class="st">&quot;text&quot;</span>} onChange<span class="op">=</span>{(e) <span class="kw">=&gt;</span> <span class="fu">search</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)} placeholder<span class="op">=</span>{<span class="st">&quot;search&quot;</span>}<span class="op">/&gt;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true"></a>            {</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true"></a>                cars<span class="op">.</span><span class="fu">map</span>((hit<span class="op">:</span> Car) <span class="kw">=&gt;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true"></a>                    <span class="op">&lt;</span>div key<span class="op">=</span>{hit<span class="op">.</span><span class="at">entityId</span>}<span class="op">&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true"></a>                        {hit<span class="op">.</span><span class="at">make</span>} <span class="op">-</span> {hit<span class="op">.</span><span class="at">model</span>} <span class="op">-</span> {hit<span class="op">.</span><span class="at">image</span>} <span class="op">-</span> {hit<span class="op">.</span><span class="at">description</span>}</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true"></a>                    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true"></a>                )</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true"></a>            }</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true"></a>        <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true"></a>    )<span class="op">;</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true"></a>}</span></code></pre></div>
<figure>
<img src="7.working-search.png" alt="" /><figcaption>7.working-search</figcaption>
</figure>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/f0c1s/redis-fulltext-sample-app">Source code: https://github.com/f0c1s/redis-fulltext-sample-app</a></li>
<li><a href="https://www.youtube.com/watch?v=DOIWQddRD5M">YouTube video: https://www.youtube.com/watch?v=DOIWQddRD5M</a></li>
<li><a href="https://github.com/facebook/flow/issues/4799">https://github.com/facebook/flow/issues/4799</a></li>
<li><a href="https://stackoverflow.com/questions/52094110/err-unknown-command-json-set-rejson-redis">https://stackoverflow.com/questions/52094110/err-unknown-command-json-set-rejson-redis</a></li>
<li><a href="https://oss.redis.com/redisearch/Commands/">redisearch commands: https://oss.redis.com/redisearch/Commands/</a></li>
<li><a href="https://oss.redis.com/redisearch/Query_Syntax/">redisearch query syntax: https://oss.redis.com/redisearch/Query_Syntax/</a></li>
</ul>
</body>
</html>
