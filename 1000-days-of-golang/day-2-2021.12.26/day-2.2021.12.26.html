<html lang="en">
<head>
<meta charset="UTF-8">
<title>
blog.f0c1s.com/1000-days-of-golang/day 2
</title>
<script src="../../setup.js" async></script>
<link rel="stylesheet" href="../../index.css" /> <link rel="stylesheet" href="../../highlight/styles/monokai.min.css"/>
<script src="../../highlight/highlight.min.js"></script>
</head>
<body onload="setup()">
<h1>
/f0c1s/blog/1000-days-of-golang/Day 2
</h1>
<p>2021.12.26 Sunday</p>
<p>
<a href="../../index.html">blog</a> <a href="../../1000-days-of-golang/1000-days-of-golang.html">1000-days-of-golang</a> <a href="../../1000-days-of-golang/day-2-2021.12.26/day-2.2021.12.26.html">+ Day 2 of 1000 days of golang 2021.12.26 Sunday</a>
</p>
<h2 id="lets-go">lets go</h2>
<h3 id="recap.">recap.</h3>
<ul>
<li>Able to print hello world.</li>
<li>Ended up using constant and function hoisting (of sorts, JS term, doesn’t really translate exactly for Go.)</li>
<li>Printed a function pointer, without specifying type or size. When I say pointer, I mean just the address via name.
<ul>
<li>Because names are pointing to an object in memory.</li>
</ul></li>
<li>Read code for Fprintln and Println.</li>
</ul>
<h2 id="writing-our-own-println-and-fprintln-function">writing our own println and fprintln function</h2>
<p>If we copy the body of the functions, and create new functions, it still will work.</p>
<p>This shows that language is truly open sourced,</p>
<p>and that if you implement correct interfaces correctly, it will just work perfectly.</p>
<h3 id="println---our-print.go">Println - our-print.go</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>    printNewLine(<span class="st">&quot;what are you doing step-coder&quot;</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>    printNewLine(printNewLine)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>}</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="co">// a copy of Println</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a><span class="kw">func</span> printNewLine(a ...<span class="kw">interface</span>{}) (n <span class="dt">int</span>, err <span class="dt">error</span>) {</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>    <span class="kw">return</span> fmt.Fprintln(os.Stdout, a...)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>}</span></code></pre></div>
<pre class="shell"><code>go run our-print.go   
what are you doing step-coder
0x47e320
</code></pre>
<p>Questions here…</p>
<ol type="1">
<li>What is interface? (here, and in Go)</li>
<li>What is <code>...</code>? It looks like a rest operator from JS.</li>
</ol>
<h3 id="fprintln---our-fprint.go">Fprintln - our-fprint.go</h3>
<p>Oh boy, it was a rabit hole.</p>
<p>In the end, I didn’t want to copy (and keep) <code>fmtSort</code> and couldn’t find what I should do with <code>reflect.Pointer</code>.</p>
<p>I started with first line of Fprinln and kept adding code, until all the missing pieces were found. Again, fmtSort and reflect.Pointer remain.</p>
<p>The files I needed to copy from were print.go and format.go.</p>
<ul>
<li><a href="https://github.com/golang/go/blob/master/src/fmt/print.go">source print.go</a></li>
<li><a href="https://github.com/golang/go/blob/master/src/fmt/format.go">source format.go</a></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    <span class="st">&quot;1000-days-day-2/fmtsort&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>    <span class="st">&quot;io&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>    <span class="st">&quot;reflect&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>    <span class="st">&quot;strconv&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    <span class="st">&quot;sync&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    <span class="st">&quot;unicode/utf8&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>}</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="co">// flags placed in a separate struct for easy clearing.</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="kw">type</span> fmtFlags <span class="kw">struct</span> {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>    widPresent  <span class="dt">bool</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a>    precPresent <span class="dt">bool</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a>    minus       <span class="dt">bool</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a>    plus        <span class="dt">bool</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a>    sharp       <span class="dt">bool</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a>    space       <span class="dt">bool</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a>    zero        <span class="dt">bool</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a>    <span class="co">// For the formats %+v %#v, we set the plusV/sharpV flags</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a>    <span class="co">// and clear the plus/sharp flags since %+v and %#v are in effect</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a>    <span class="co">// different, flagless formats set at the top level.</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a>    plusV  <span class="dt">bool</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a>    sharpV <span class="dt">bool</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true"></a>}</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true"></a><span class="co">// Use simple []byte instead of bytes.Buffer to avoid large dependency.</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true"></a><span class="kw">type</span> buffer []<span class="dt">byte</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true"></a><span class="co">// A fmt is the raw formatter used by Printf etc.</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true"></a><span class="co">// It prints into a buffer that must be set up separately.</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true"></a><span class="kw">type</span> fmt <span class="kw">struct</span> {</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true"></a>    buf *buffer</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true"></a>    fmtFlags</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true"></a>    wid  <span class="dt">int</span> <span class="co">// width</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true"></a>    prec <span class="dt">int</span> <span class="co">// precision</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true"></a>    <span class="co">// intbuf is large enough to store %b of an int64 with a sign and</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true"></a>    <span class="co">// avoids padding at the end of the struct on 32 bit architectures.</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true"></a>    intbuf [<span class="dv">68</span>]<span class="dt">byte</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true"></a>}</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) clearflags() {</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true"></a>    f.fmtFlags = fmtFlags{}</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true"></a>}</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) init(buf *buffer) {</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true"></a>    f.buf = buf</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true"></a>    f.clearflags()</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true"></a>}</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true"></a><span class="kw">type</span> pp <span class="kw">struct</span> {</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true"></a>    buf buffer</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true"></a>    <span class="co">// arg holds the current item, as an interface{}.</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true"></a>    arg <span class="kw">interface</span>{}</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true"></a>    <span class="co">// value is used instead of arg for reflect values.</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true"></a>    value reflect.Value</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true"></a></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true"></a>    <span class="co">// fmt is used to format basic items such as integers or strings.</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true"></a>    fmt fmt</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true"></a>    <span class="co">// reordered records whether the format string used argument reordering.</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true"></a>    reordered <span class="dt">bool</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true"></a>    <span class="co">// goodArgNum records whether the most recent reordering directive was valid.</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true"></a>    goodArgNum <span class="dt">bool</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true"></a>    <span class="co">// panicking is set by catchPanic to avoid infinite panic, recover, panic, ... recursion.</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true"></a>    panicking <span class="dt">bool</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true"></a>    <span class="co">// erroring is set when printing an error string to guard against calling handleMethods.</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true"></a>    erroring <span class="dt">bool</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true"></a>    <span class="co">// wrapErrs is set when the format string may contain a %w verb.</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true"></a>    wrapErrs <span class="dt">bool</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true"></a>    <span class="co">// wrappedErr records the target of the %w verb.</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true"></a>    wrappedErr <span class="dt">error</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true"></a>}</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true"></a></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true"></a><span class="kw">var</span> ppFree = sync.Pool{</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true"></a>    New: <span class="kw">func</span>() <span class="kw">interface</span>{} { <span class="kw">return</span> <span class="bu">new</span>(pp) },</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true"></a>}</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true"></a><span class="kw">func</span> newPrinter() *pp {</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true"></a>    p := ppFree.Get().(*pp)</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true"></a>    p.panicking = <span class="ot">false</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true"></a>    p.erroring = <span class="ot">false</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true"></a>    p.wrapErrs = <span class="ot">false</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true"></a>    p.fmt.init(&amp;p.buf)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true"></a>    <span class="kw">return</span> p</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true"></a>}</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true"></a></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true"></a><span class="kw">func</span> (b *buffer) writeByte(c <span class="dt">byte</span>) {</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true"></a>    *b = <span class="bu">append</span>(*b, c)</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true"></a>}</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true"></a><span class="kw">func</span> (b *buffer) writeString(s <span class="dt">string</span>) {</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true"></a>    *b = <span class="bu">append</span>(*b, s...)</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true"></a>}</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true"></a><span class="co">// padString appends s to f.buf, padded on left (!f.minus) or right (f.minus).</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) padString(s <span class="dt">string</span>) {</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true"></a>    <span class="kw">if</span> !f.widPresent || f.wid == <span class="dv">0</span> {</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true"></a>        f.buf.writeString(s)</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true"></a>    }</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true"></a>    width := f.wid - utf8.RuneCountInString(s)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true"></a>    <span class="kw">if</span> !f.minus {</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true"></a>        <span class="co">// left padding</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true"></a>        f.writePadding(width)</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true"></a>        f.buf.writeString(s)</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true"></a>    } <span class="kw">else</span> {</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true"></a>        <span class="co">// right padding</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true"></a>        f.buf.writeString(s)</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true"></a>        f.writePadding(width)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true"></a>    }</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true"></a>}</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true"></a></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true"></a><span class="co">// writePadding generates n bytes of padding.</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) writePadding(n <span class="dt">int</span>) {</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true"></a>    <span class="kw">if</span> n &lt;= <span class="dv">0</span> { <span class="co">// No padding bytes needed.</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true"></a>    }</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true"></a>    buf := *f.buf</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true"></a>    oldLen := <span class="bu">len</span>(buf)</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true"></a>    newLen := oldLen + n</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true"></a>    <span class="co">// Make enough room for padding.</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true"></a>    <span class="kw">if</span> newLen &gt; <span class="bu">cap</span>(buf) {</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true"></a>        buf = <span class="bu">make</span>(buffer, <span class="bu">cap</span>(buf)*<span class="dv">2</span>+n)</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true"></a>        <span class="bu">copy</span>(buf, *f.buf)</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true"></a>    }</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true"></a>    <span class="co">// Decide which byte the padding should be filled with.</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true"></a>    padByte := <span class="dt">byte</span>(<span class="ch">&#39; &#39;</span>)</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true"></a>    <span class="kw">if</span> f.zero {</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true"></a>        padByte = <span class="dt">byte</span>(<span class="ch">&#39;0&#39;</span>)</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true"></a>    }</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true"></a>    <span class="co">// Fill padding with padByte.</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true"></a>    padding := buf[oldLen:newLen]</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true"></a>    <span class="kw">for</span> i := <span class="kw">range</span> padding {</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true"></a>        padding[i] = padByte</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true"></a>    }</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true"></a>    *f.buf = buf[:newLen]</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true"></a>}</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true"></a></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true"></a><span class="co">// Strings for use with buffer.WriteString.</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true"></a><span class="co">// This is less overhead than using buffer.Write with byte arrays.</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true"></a><span class="kw">const</span> (</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true"></a>    commaSpaceString  = <span class="st">&quot;, &quot;</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true"></a>    nilAngleString    = <span class="st">&quot;&lt;nil&gt;&quot;</span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true"></a>    nilParenString    = <span class="st">&quot;(nil)&quot;</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true"></a>    nilString         = <span class="st">&quot;nil&quot;</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true"></a>    mapString         = <span class="st">&quot;map[&quot;</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true"></a>    percentBangString = <span class="st">&quot;%!&quot;</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true"></a>    missingString     = <span class="st">&quot;(MISSING)&quot;</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true"></a>    badIndexString    = <span class="st">&quot;(BADINDEX)&quot;</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true"></a>    panicString       = <span class="st">&quot;(PANIC=&quot;</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true"></a>    extraString       = <span class="st">&quot;%!(EXTRA &quot;</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true"></a>    badWidthString    = <span class="st">&quot;%!(BADWIDTH)&quot;</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true"></a>    badPrecString     = <span class="st">&quot;%!(BADPREC)&quot;</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true"></a>    noVerbString      = <span class="st">&quot;%!(NOVERB)&quot;</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true"></a>    invReflectString  = <span class="st">&quot;&lt;invalid reflect.Value&gt;&quot;</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true"></a>)</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true"></a></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true"></a><span class="kw">func</span> (bp *buffer) writeRune(r <span class="dt">rune</span>) {</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true"></a>    <span class="kw">if</span> r &lt; utf8.RuneSelf {</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true"></a>        *bp = <span class="bu">append</span>(*bp, <span class="dt">byte</span>(r))</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true"></a>    }</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true"></a></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true"></a>    b := *bp</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true"></a>    n := <span class="bu">len</span>(b)</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true"></a>    <span class="kw">for</span> n+utf8.UTFMax &gt; <span class="bu">cap</span>(b) {</span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true"></a>        b = <span class="bu">append</span>(b, <span class="dv">0</span>)</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true"></a>    }</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true"></a>    w := utf8.EncodeRune(b[n:n+utf8.UTFMax], r)</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true"></a>    *bp = b[:n+w]</span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true"></a>}</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true"></a><span class="kw">func</span> (p *pp) badVerb(verb <span class="dt">rune</span>) {</span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true"></a>    p.erroring = <span class="ot">true</span></span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true"></a>    p.buf.writeString(percentBangString)</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true"></a>    p.buf.writeRune(verb)</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true"></a>    p.buf.writeByte(<span class="ch">&#39;(&#39;</span>)</span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true"></a>    <span class="kw">switch</span> {</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true"></a>    <span class="kw">case</span> p.arg != <span class="ot">nil</span>:</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true"></a>        p.buf.writeString(reflect.TypeOf(p.arg).String())</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true"></a>        p.buf.writeByte(<span class="ch">&#39;=&#39;</span>)</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true"></a>        p.printArg(p.arg, <span class="ch">&#39;v&#39;</span>)</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true"></a>    <span class="kw">case</span> p.value.IsValid():</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true"></a>        p.buf.writeString(p.value.Type().String())</span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true"></a>        p.buf.writeByte(<span class="ch">&#39;=&#39;</span>)</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true"></a>        p.printValue(p.value, <span class="ch">&#39;v&#39;</span>, <span class="dv">0</span>)</span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true"></a>        p.buf.writeString(nilAngleString)</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true"></a>    }</span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true"></a>    p.buf.writeByte(<span class="ch">&#39;)&#39;</span>)</span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true"></a>    p.erroring = <span class="ot">false</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true"></a>}</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true"></a></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true"></a><span class="co">// truncateString truncates the string s to the specified precision, if present.</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) truncateString(s <span class="dt">string</span>) <span class="dt">string</span> {</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true"></a>    <span class="kw">if</span> f.precPresent {</span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true"></a>        n := f.prec</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true"></a>        <span class="kw">for</span> i := <span class="kw">range</span> s {</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true"></a>            n--</span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true"></a>            <span class="kw">if</span> n &lt; <span class="dv">0</span> {</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true"></a>                <span class="kw">return</span> s[:i]</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true"></a>            }</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true"></a>        }</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true"></a>    }</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true"></a>    <span class="kw">return</span> s</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true"></a>}</span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true"></a></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true"></a><span class="co">// fmtS formats a string.</span></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtS(s <span class="dt">string</span>) {</span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true"></a>    s = f.truncateString(s)</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true"></a>    f.padString(s)</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true"></a>}</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true"></a></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true"></a><span class="kw">func</span> (b *buffer) write(p []<span class="dt">byte</span>) {</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true"></a>    *b = <span class="bu">append</span>(*b, p...)</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true"></a>}</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true"></a></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true"></a><span class="co">// pad appends b to f.buf, padded on left (!f.minus) or right (f.minus).</span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) pad(b []<span class="dt">byte</span>) {</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true"></a>    <span class="kw">if</span> !f.widPresent || f.wid == <span class="dv">0</span> {</span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true"></a>        f.buf.write(b)</span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true"></a>    }</span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true"></a>    width := f.wid - utf8.RuneCount(b)</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true"></a>    <span class="kw">if</span> !f.minus {</span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true"></a>        <span class="co">// left padding</span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true"></a>        f.writePadding(width)</span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true"></a>        f.buf.write(b)</span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true"></a>    } <span class="kw">else</span> {</span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true"></a>        <span class="co">// right padding</span></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true"></a>        f.buf.write(b)</span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true"></a>        f.writePadding(width)</span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true"></a>    }</span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true"></a>}</span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true"></a></span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true"></a><span class="co">// fmtInteger formats signed and unsigned integers.</span></span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtInteger(u <span class="dt">uint64</span>, base <span class="dt">int</span>, isSigned <span class="dt">bool</span>, verb <span class="dt">rune</span>, digits <span class="dt">string</span>) {</span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true"></a>    negative := isSigned &amp;&amp; <span class="dt">int64</span>(u) &lt; <span class="dv">0</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true"></a>    <span class="kw">if</span> negative {</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true"></a>        u = -u</span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true"></a>    }</span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true"></a></span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true"></a>    buf := f.intbuf[<span class="dv">0</span>:]</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true"></a>    <span class="co">// The already allocated f.intbuf with a capacity of 68 bytes</span></span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true"></a>    <span class="co">// is large enough for integer formatting when no precision or width is set.</span></span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true"></a>    <span class="kw">if</span> f.widPresent || f.precPresent {</span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true"></a>        <span class="co">// Account 3 extra bytes for possible addition of a sign and &quot;0x&quot;.</span></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true"></a>        width := <span class="dv">3</span> + f.wid + f.prec <span class="co">// wid and prec are always positive.</span></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true"></a>        <span class="kw">if</span> width &gt; <span class="bu">len</span>(buf) {</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true"></a>            <span class="co">// We&#39;re going to need a bigger boat.</span></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true"></a>            buf = <span class="bu">make</span>([]<span class="dt">byte</span>, width)</span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true"></a>        }</span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true"></a>    }</span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true"></a></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true"></a>    <span class="co">// Two ways to ask for extra leading zero digits: %.3d or %03d.</span></span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true"></a>    <span class="co">// If both are specified the f.zero flag is ignored and</span></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true"></a>    <span class="co">// padding with spaces is used instead.</span></span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true"></a>    prec := <span class="dv">0</span></span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true"></a>    <span class="kw">if</span> f.precPresent {</span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true"></a>        prec = f.prec</span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true"></a>        <span class="co">// Precision of 0 and value of 0 means &quot;print nothing&quot; but padding.</span></span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true"></a>        <span class="kw">if</span> prec == <span class="dv">0</span> &amp;&amp; u == <span class="dv">0</span> {</span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true"></a>            oldZero := f.zero</span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true"></a>            f.zero = <span class="ot">false</span></span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true"></a>            f.writePadding(f.wid)</span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true"></a>            f.zero = oldZero</span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true"></a>            <span class="kw">return</span></span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true"></a>        }</span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true"></a>    } <span class="kw">else</span> <span class="kw">if</span> f.zero &amp;&amp; f.widPresent {</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true"></a>        prec = f.wid</span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true"></a>        <span class="kw">if</span> negative || f.plus || f.space {</span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true"></a>            prec-- <span class="co">// leave room for sign</span></span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true"></a>        }</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true"></a>    }</span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true"></a></span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true"></a>    <span class="co">// Because printing is easier right-to-left: format u into buf, ending at buf[i].</span></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true"></a>    <span class="co">// We could make things marginally faster by splitting the 32-bit case out</span></span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true"></a>    <span class="co">// into a separate block but it&#39;s not worth the duplication, so u has 64 bits.</span></span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true"></a>    i := <span class="bu">len</span>(buf)</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true"></a>    <span class="co">// Use constants for the division and modulo for more efficient code.</span></span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true"></a>    <span class="co">// Switch cases ordered by popularity.</span></span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true"></a>    <span class="kw">switch</span> base {</span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dv">10</span>:</span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true"></a>        <span class="kw">for</span> u &gt;= <span class="dv">10</span> {</span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true"></a>            i--</span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true"></a>            next := u / <span class="dv">10</span></span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true"></a>            buf[i] = <span class="dt">byte</span>(<span class="ch">&#39;0&#39;</span> + u - next*<span class="dv">10</span>)</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true"></a>            u = next</span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true"></a>        }</span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dv">16</span>:</span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true"></a>        <span class="kw">for</span> u &gt;= <span class="dv">16</span> {</span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true"></a>            i--</span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true"></a>            buf[i] = digits[u&amp;<span class="dv">0xF</span>]</span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true"></a>            u &gt;&gt;= <span class="dv">4</span></span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true"></a>        }</span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dv">8</span>:</span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true"></a>        <span class="kw">for</span> u &gt;= <span class="dv">8</span> {</span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true"></a>            i--</span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true"></a>            buf[i] = <span class="dt">byte</span>(<span class="ch">&#39;0&#39;</span> + u&amp;<span class="dv">7</span>)</span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true"></a>            u &gt;&gt;= <span class="dv">3</span></span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true"></a>        }</span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dv">2</span>:</span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true"></a>        <span class="kw">for</span> u &gt;= <span class="dv">2</span> {</span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true"></a>            i--</span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true"></a>            buf[i] = <span class="dt">byte</span>(<span class="ch">&#39;0&#39;</span> + u&amp;<span class="dv">1</span>)</span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true"></a>            u &gt;&gt;= <span class="dv">1</span></span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true"></a>        }</span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true"></a>        <span class="bu">panic</span>(<span class="st">&quot;fmt: unknown base; can&#39;t happen&quot;</span>)</span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true"></a>    }</span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true"></a>    i--</span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true"></a>    buf[i] = digits[u]</span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true"></a>    <span class="kw">for</span> i &gt; <span class="dv">0</span> &amp;&amp; prec &gt; <span class="bu">len</span>(buf)-i {</span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true"></a>        i--</span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;0&#39;</span></span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true"></a>    }</span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true"></a></span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true"></a>    <span class="co">// Various prefixes: 0x, -, etc.</span></span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true"></a>    <span class="kw">if</span> f.sharp {</span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true"></a>        <span class="kw">switch</span> base {</span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true"></a>        <span class="kw">case</span> <span class="dv">2</span>:</span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true"></a>            <span class="co">// Add a leading 0b.</span></span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true"></a>            i--</span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true"></a>            buf[i] = <span class="ch">&#39;b&#39;</span></span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true"></a>            i--</span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true"></a>            buf[i] = <span class="ch">&#39;0&#39;</span></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true"></a>        <span class="kw">case</span> <span class="dv">8</span>:</span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true"></a>            <span class="kw">if</span> buf[i] != <span class="ch">&#39;0&#39;</span> {</span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true"></a>                i--</span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true"></a>                buf[i] = <span class="ch">&#39;0&#39;</span></span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true"></a>            }</span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true"></a>        <span class="kw">case</span> <span class="dv">16</span>:</span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true"></a>            <span class="co">// Add a leading 0x or 0X.</span></span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true"></a>            i--</span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true"></a>            buf[i] = digits[<span class="dv">16</span>]</span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true"></a>            i--</span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true"></a>            buf[i] = <span class="ch">&#39;0&#39;</span></span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true"></a>        }</span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true"></a>    }</span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true"></a>    <span class="kw">if</span> verb == <span class="ch">&#39;O&#39;</span> {</span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true"></a>        i--</span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;o&#39;</span></span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true"></a>        i--</span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;0&#39;</span></span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true"></a>    }</span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true"></a></span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true"></a>    <span class="kw">if</span> negative {</span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true"></a>        i--</span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;-&#39;</span></span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true"></a>    } <span class="kw">else</span> <span class="kw">if</span> f.plus {</span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true"></a>        i--</span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;+&#39;</span></span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true"></a>    } <span class="kw">else</span> <span class="kw">if</span> f.space {</span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true"></a>        i--</span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39; &#39;</span></span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true"></a>    }</span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true"></a></span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true"></a>    <span class="co">// Left padding with zeros has already been handled like precision earlier</span></span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true"></a>    <span class="co">// or the f.zero flag is ignored due to an explicitly set precision.</span></span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true"></a>    oldZero := f.zero</span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true"></a>    f.zero = <span class="ot">false</span></span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true"></a>    f.pad(buf[i:])</span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true"></a>    f.zero = oldZero</span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true"></a>}</span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true"></a></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true"></a><span class="kw">const</span> (</span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true"></a>    signed   = <span class="ot">true</span></span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true"></a>    unsigned = <span class="ot">false</span></span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true"></a>)</span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true"></a></span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true"></a><span class="kw">const</span> (</span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true"></a>    ldigits = <span class="st">&quot;0123456789abcdefx&quot;</span></span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true"></a>    udigits = <span class="st">&quot;0123456789ABCDEFX&quot;</span></span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true"></a>)</span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true"></a></span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true"></a><span class="co">// fmt0x64 formats a uint64 in hexadecimal and prefixes it with 0x or</span></span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true"></a><span class="co">// not, as requested, by temporarily setting the sharp flag.</span></span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmt0x64(v <span class="dt">uint64</span>, leading0x <span class="dt">bool</span>) {</span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true"></a>    sharp := p.fmt.sharp</span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true"></a>    p.fmt.sharp = leading0x</span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true"></a>    p.fmt.fmtInteger(v, <span class="dv">16</span>, unsigned, <span class="ch">&#39;v&#39;</span>, ldigits)</span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true"></a>    p.fmt.sharp = sharp</span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true"></a>}</span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true"></a></span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true"></a><span class="co">// fmtC formats an integer as a Unicode character.</span></span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true"></a><span class="co">// If the character is not valid Unicode, it will print &#39;\ufffd&#39;.</span></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtC(c <span class="dt">uint64</span>) {</span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true"></a>    r := <span class="dt">rune</span>(c)</span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true"></a>    <span class="kw">if</span> c &gt; utf8.MaxRune {</span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true"></a>        r = utf8.RuneError</span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true"></a>    }</span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true"></a>    buf := f.intbuf[:<span class="dv">0</span>]</span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true"></a>    w := utf8.EncodeRune(buf[:utf8.UTFMax], r)</span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true"></a>    f.pad(buf[:w])</span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true"></a>}</span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true"></a></span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true"></a><span class="co">// fmtQc formats an integer as a single-quoted, escaped Go character constant.</span></span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true"></a><span class="co">// If the character is not valid Unicode, it will print &#39;\ufffd&#39;.</span></span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtQc(c <span class="dt">uint64</span>) {</span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true"></a>    r := <span class="dt">rune</span>(c)</span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true"></a>    <span class="kw">if</span> c &gt; utf8.MaxRune {</span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true"></a>        r = utf8.RuneError</span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true"></a>    }</span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true"></a>    buf := f.intbuf[:<span class="dv">0</span>]</span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true"></a>    <span class="kw">if</span> f.plus {</span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true"></a>        f.pad(strconv.AppendQuoteRuneToASCII(buf, r))</span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true"></a>    } <span class="kw">else</span> {</span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true"></a>        f.pad(strconv.AppendQuoteRune(buf, r))</span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true"></a>    }</span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true"></a>}</span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true"></a></span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true"></a><span class="co">// fmtUnicode formats a uint64 as &quot;U+0078&quot; or with f.sharp set as &quot;U+0078 &#39;x&#39;&quot;.</span></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtUnicode(u <span class="dt">uint64</span>) {</span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true"></a>    buf := f.intbuf[<span class="dv">0</span>:]</span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true"></a></span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true"></a>    <span class="co">// With default precision set the maximum needed buf length is 18</span></span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true"></a>    <span class="co">// for formatting -1 with %#U (&quot;U+FFFFFFFFFFFFFFFF&quot;) which fits</span></span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true"></a>    <span class="co">// into the already allocated intbuf with a capacity of 68 bytes.</span></span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true"></a>    prec := <span class="dv">4</span></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true"></a>    <span class="kw">if</span> f.precPresent &amp;&amp; f.prec &gt; <span class="dv">4</span> {</span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true"></a>        prec = f.prec</span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true"></a>        <span class="co">// Compute space needed for &quot;U+&quot; , number, &quot; &#39;&quot;, character, &quot;&#39;&quot;.</span></span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true"></a>        width := <span class="dv">2</span> + prec + <span class="dv">2</span> + utf8.UTFMax + <span class="dv">1</span></span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true"></a>        <span class="kw">if</span> width &gt; <span class="bu">len</span>(buf) {</span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true"></a>            buf = <span class="bu">make</span>([]<span class="dt">byte</span>, width)</span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true"></a>        }</span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true"></a>    }</span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true"></a></span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true"></a>    <span class="co">// Format into buf, ending at buf[i]. Formatting numbers is easier right-to-left.</span></span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true"></a>    i := <span class="bu">len</span>(buf)</span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true"></a></span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true"></a>    <span class="co">// For %#U we want to add a space and a quoted character at the end of the buffer.</span></span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true"></a>    <span class="kw">if</span> f.sharp &amp;&amp; u &lt;= utf8.MaxRune &amp;&amp; strconv.IsPrint(<span class="dt">rune</span>(u)) {</span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true"></a>        i--</span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;\&#39;&#39;</span></span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true"></a>        i -= utf8.RuneLen(<span class="dt">rune</span>(u))</span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true"></a>        utf8.EncodeRune(buf[i:], <span class="dt">rune</span>(u))</span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true"></a>        i--</span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;\&#39;&#39;</span></span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true"></a>        i--</span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39; &#39;</span></span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true"></a>    }</span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true"></a>    <span class="co">// Format the Unicode code point u as a hexadecimal number.</span></span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true"></a>    <span class="kw">for</span> u &gt;= <span class="dv">16</span> {</span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true"></a>        i--</span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true"></a>        buf[i] = udigits[u&amp;<span class="dv">0xF</span>]</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true"></a>        prec--</span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true"></a>        u &gt;&gt;= <span class="dv">4</span></span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true"></a>    }</span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true"></a>    i--</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true"></a>    buf[i] = udigits[u]</span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true"></a>    prec--</span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true"></a>    <span class="co">// Add zeros in front of the number until requested precision is reached.</span></span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true"></a>    <span class="kw">for</span> prec &gt; <span class="dv">0</span> {</span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true"></a>        i--</span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true"></a>        buf[i] = <span class="ch">&#39;0&#39;</span></span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true"></a>        prec--</span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true"></a>    }</span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true"></a>    <span class="co">// Add a leading &quot;U+&quot;.</span></span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true"></a>    i--</span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true"></a>    buf[i] = <span class="ch">&#39;+&#39;</span></span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true"></a>    i--</span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true"></a>    buf[i] = <span class="ch">&#39;U&#39;</span></span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true"></a></span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true"></a>    oldZero := f.zero</span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true"></a>    f.zero = <span class="ot">false</span></span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true"></a>    f.pad(buf[i:])</span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true"></a>    f.zero = oldZero</span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true"></a>}</span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true"></a></span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true"></a><span class="co">// fmtInteger formats a signed or unsigned integer.</span></span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmtInteger(v <span class="dt">uint64</span>, isSigned <span class="dt">bool</span>, verb <span class="dt">rune</span>) {</span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>:</span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV &amp;&amp; !isSigned {</span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true"></a>            p.fmt0x64(v, <span class="ot">true</span>)</span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true"></a>            p.fmt.fmtInteger(v, <span class="dv">10</span>, isSigned, verb, ldigits)</span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true"></a>        }</span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;d&#39;</span>:</span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true"></a>        p.fmt.fmtInteger(v, <span class="dv">10</span>, isSigned, verb, ldigits)</span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;b&#39;</span>:</span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true"></a>        p.fmt.fmtInteger(v, <span class="dv">2</span>, isSigned, verb, ldigits)</span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;o&#39;</span>, <span class="ch">&#39;O&#39;</span>:</span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true"></a>        p.fmt.fmtInteger(v, <span class="dv">8</span>, isSigned, verb, ldigits)</span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;x&#39;</span>:</span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true"></a>        p.fmt.fmtInteger(v, <span class="dv">16</span>, isSigned, verb, ldigits)</span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;X&#39;</span>:</span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true"></a>        p.fmt.fmtInteger(v, <span class="dv">16</span>, isSigned, verb, udigits)</span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;c&#39;</span>:</span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true"></a>        p.fmt.fmtC(v)</span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;q&#39;</span>:</span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true"></a>        p.fmt.fmtQc(v)</span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;U&#39;</span>:</span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true"></a>        p.fmt.fmtUnicode(v)</span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true"></a>        p.badVerb(verb)</span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true"></a>    }</span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true"></a>}</span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true"></a></span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmtPointer(value reflect.Value, verb <span class="dt">rune</span>) {</span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true"></a>    <span class="kw">var</span> u <span class="dt">uintptr</span></span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true"></a>    <span class="kw">switch</span> value.Kind() {</span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Chan, reflect.Func, reflect.Map, reflect.Pointer, reflect.Slice, reflect.UnsafePointer:</span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true"></a>        u = value.Pointer()</span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true"></a>        p.badVerb(verb)</span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true"></a>    }</span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true"></a></span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>:</span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;(&#39;</span>)</span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true"></a>            p.buf.writeString(value.Type().String())</span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true"></a>            p.buf.writeString(<span class="st">&quot;)(&quot;</span>)</span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true"></a>            <span class="kw">if</span> u == <span class="dv">0</span> {</span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true"></a>                p.buf.writeString(nilString)</span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true"></a>            } <span class="kw">else</span> {</span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true"></a>                p.fmt0x64(<span class="dt">uint64</span>(u), <span class="ot">true</span>)</span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true"></a>            }</span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;)&#39;</span>)</span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true"></a>            <span class="kw">if</span> u == <span class="dv">0</span> {</span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true"></a>                p.fmt.padString(nilAngleString)</span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true"></a>            } <span class="kw">else</span> {</span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true"></a>                p.fmt0x64(<span class="dt">uint64</span>(u), !p.fmt.sharp)</span>
<span id="cb3-538"><a href="#cb3-538" aria-hidden="true"></a>            }</span>
<span id="cb3-539"><a href="#cb3-539" aria-hidden="true"></a>        }</span>
<span id="cb3-540"><a href="#cb3-540" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;p&#39;</span>:</span>
<span id="cb3-541"><a href="#cb3-541" aria-hidden="true"></a>        p.fmt0x64(<span class="dt">uint64</span>(u), !p.fmt.sharp)</span>
<span id="cb3-542"><a href="#cb3-542" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;b&#39;</span>, <span class="ch">&#39;o&#39;</span>, <span class="ch">&#39;d&#39;</span>, <span class="ch">&#39;x&#39;</span>, <span class="ch">&#39;X&#39;</span>:</span>
<span id="cb3-543"><a href="#cb3-543" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(u), unsigned, verb)</span>
<span id="cb3-544"><a href="#cb3-544" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-545"><a href="#cb3-545" aria-hidden="true"></a>        p.badVerb(verb)</span>
<span id="cb3-546"><a href="#cb3-546" aria-hidden="true"></a>    }</span>
<span id="cb3-547"><a href="#cb3-547" aria-hidden="true"></a>}</span>
<span id="cb3-548"><a href="#cb3-548" aria-hidden="true"></a></span>
<span id="cb3-549"><a href="#cb3-549" aria-hidden="true"></a><span class="co">// fmtBoolean formats a boolean.</span></span>
<span id="cb3-550"><a href="#cb3-550" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtBoolean(v <span class="dt">bool</span>) {</span>
<span id="cb3-551"><a href="#cb3-551" aria-hidden="true"></a>    <span class="kw">if</span> v {</span>
<span id="cb3-552"><a href="#cb3-552" aria-hidden="true"></a>        f.padString(<span class="st">&quot;true&quot;</span>)</span>
<span id="cb3-553"><a href="#cb3-553" aria-hidden="true"></a>    } <span class="kw">else</span> {</span>
<span id="cb3-554"><a href="#cb3-554" aria-hidden="true"></a>        f.padString(<span class="st">&quot;false&quot;</span>)</span>
<span id="cb3-555"><a href="#cb3-555" aria-hidden="true"></a>    }</span>
<span id="cb3-556"><a href="#cb3-556" aria-hidden="true"></a>}</span>
<span id="cb3-557"><a href="#cb3-557" aria-hidden="true"></a></span>
<span id="cb3-558"><a href="#cb3-558" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmtBool(v <span class="dt">bool</span>, verb <span class="dt">rune</span>) {</span>
<span id="cb3-559"><a href="#cb3-559" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-560"><a href="#cb3-560" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;t&#39;</span>, <span class="ch">&#39;v&#39;</span>:</span>
<span id="cb3-561"><a href="#cb3-561" aria-hidden="true"></a>        p.fmt.fmtBoolean(v)</span>
<span id="cb3-562"><a href="#cb3-562" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true"></a>        p.badVerb(verb)</span>
<span id="cb3-564"><a href="#cb3-564" aria-hidden="true"></a>    }</span>
<span id="cb3-565"><a href="#cb3-565" aria-hidden="true"></a>}</span>
<span id="cb3-566"><a href="#cb3-566" aria-hidden="true"></a></span>
<span id="cb3-567"><a href="#cb3-567" aria-hidden="true"></a><span class="co">// fmtFloat formats a float64. It assumes that verb is a valid format specifier</span></span>
<span id="cb3-568"><a href="#cb3-568" aria-hidden="true"></a><span class="co">// for strconv.AppendFloat and therefore fits into a byte.</span></span>
<span id="cb3-569"><a href="#cb3-569" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtFloat(v <span class="dt">float64</span>, size <span class="dt">int</span>, verb <span class="dt">rune</span>, prec <span class="dt">int</span>) {</span>
<span id="cb3-570"><a href="#cb3-570" aria-hidden="true"></a>    <span class="co">// Explicit precision in format specifier overrules default precision.</span></span>
<span id="cb3-571"><a href="#cb3-571" aria-hidden="true"></a>    <span class="kw">if</span> f.precPresent {</span>
<span id="cb3-572"><a href="#cb3-572" aria-hidden="true"></a>        prec = f.prec</span>
<span id="cb3-573"><a href="#cb3-573" aria-hidden="true"></a>    }</span>
<span id="cb3-574"><a href="#cb3-574" aria-hidden="true"></a>    <span class="co">// Format number, reserving space for leading + sign if needed.</span></span>
<span id="cb3-575"><a href="#cb3-575" aria-hidden="true"></a>    num := strconv.AppendFloat(f.intbuf[:<span class="dv">1</span>], v, <span class="dt">byte</span>(verb), prec, size)</span>
<span id="cb3-576"><a href="#cb3-576" aria-hidden="true"></a>    <span class="kw">if</span> num[<span class="dv">1</span>] == <span class="ch">&#39;-&#39;</span> || num[<span class="dv">1</span>] == <span class="ch">&#39;+&#39;</span> {</span>
<span id="cb3-577"><a href="#cb3-577" aria-hidden="true"></a>        num = num[<span class="dv">1</span>:]</span>
<span id="cb3-578"><a href="#cb3-578" aria-hidden="true"></a>    } <span class="kw">else</span> {</span>
<span id="cb3-579"><a href="#cb3-579" aria-hidden="true"></a>        num[<span class="dv">0</span>] = <span class="ch">&#39;+&#39;</span></span>
<span id="cb3-580"><a href="#cb3-580" aria-hidden="true"></a>    }</span>
<span id="cb3-581"><a href="#cb3-581" aria-hidden="true"></a>    <span class="co">// f.space means to add a leading space instead of a &quot;+&quot; sign unless</span></span>
<span id="cb3-582"><a href="#cb3-582" aria-hidden="true"></a>    <span class="co">// the sign is explicitly asked for by f.plus.</span></span>
<span id="cb3-583"><a href="#cb3-583" aria-hidden="true"></a>    <span class="kw">if</span> f.space &amp;&amp; num[<span class="dv">0</span>] == <span class="ch">&#39;+&#39;</span> &amp;&amp; !f.plus {</span>
<span id="cb3-584"><a href="#cb3-584" aria-hidden="true"></a>        num[<span class="dv">0</span>] = <span class="ch">&#39; &#39;</span></span>
<span id="cb3-585"><a href="#cb3-585" aria-hidden="true"></a>    }</span>
<span id="cb3-586"><a href="#cb3-586" aria-hidden="true"></a>    <span class="co">// Special handling for infinities and NaN,</span></span>
<span id="cb3-587"><a href="#cb3-587" aria-hidden="true"></a>    <span class="co">// which don&#39;t look like a number so shouldn&#39;t be padded with zeros.</span></span>
<span id="cb3-588"><a href="#cb3-588" aria-hidden="true"></a>    <span class="kw">if</span> num[<span class="dv">1</span>] == <span class="ch">&#39;I&#39;</span> || num[<span class="dv">1</span>] == <span class="ch">&#39;N&#39;</span> {</span>
<span id="cb3-589"><a href="#cb3-589" aria-hidden="true"></a>        oldZero := f.zero</span>
<span id="cb3-590"><a href="#cb3-590" aria-hidden="true"></a>        f.zero = <span class="ot">false</span></span>
<span id="cb3-591"><a href="#cb3-591" aria-hidden="true"></a>        <span class="co">// Remove sign before NaN if not asked for.</span></span>
<span id="cb3-592"><a href="#cb3-592" aria-hidden="true"></a>        <span class="kw">if</span> num[<span class="dv">1</span>] == <span class="ch">&#39;N&#39;</span> &amp;&amp; !f.space &amp;&amp; !f.plus {</span>
<span id="cb3-593"><a href="#cb3-593" aria-hidden="true"></a>            num = num[<span class="dv">1</span>:]</span>
<span id="cb3-594"><a href="#cb3-594" aria-hidden="true"></a>        }</span>
<span id="cb3-595"><a href="#cb3-595" aria-hidden="true"></a>        f.pad(num)</span>
<span id="cb3-596"><a href="#cb3-596" aria-hidden="true"></a>        f.zero = oldZero</span>
<span id="cb3-597"><a href="#cb3-597" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-598"><a href="#cb3-598" aria-hidden="true"></a>    }</span>
<span id="cb3-599"><a href="#cb3-599" aria-hidden="true"></a>    <span class="co">// The sharp flag forces printing a decimal point for non-binary formats</span></span>
<span id="cb3-600"><a href="#cb3-600" aria-hidden="true"></a>    <span class="co">// and retains trailing zeros, which we may need to restore.</span></span>
<span id="cb3-601"><a href="#cb3-601" aria-hidden="true"></a>    <span class="kw">if</span> f.sharp &amp;&amp; verb != <span class="ch">&#39;b&#39;</span> {</span>
<span id="cb3-602"><a href="#cb3-602" aria-hidden="true"></a>        digits := <span class="dv">0</span></span>
<span id="cb3-603"><a href="#cb3-603" aria-hidden="true"></a>        <span class="kw">switch</span> verb {</span>
<span id="cb3-604"><a href="#cb3-604" aria-hidden="true"></a>        <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>, <span class="ch">&#39;g&#39;</span>, <span class="ch">&#39;G&#39;</span>, <span class="ch">&#39;x&#39;</span>:</span>
<span id="cb3-605"><a href="#cb3-605" aria-hidden="true"></a>            digits = prec</span>
<span id="cb3-606"><a href="#cb3-606" aria-hidden="true"></a>            <span class="co">// If no precision is set explicitly use a precision of 6.</span></span>
<span id="cb3-607"><a href="#cb3-607" aria-hidden="true"></a>            <span class="kw">if</span> digits == <span class="dv">-1</span> {</span>
<span id="cb3-608"><a href="#cb3-608" aria-hidden="true"></a>                digits = <span class="dv">6</span></span>
<span id="cb3-609"><a href="#cb3-609" aria-hidden="true"></a>            }</span>
<span id="cb3-610"><a href="#cb3-610" aria-hidden="true"></a>        }</span>
<span id="cb3-611"><a href="#cb3-611" aria-hidden="true"></a></span>
<span id="cb3-612"><a href="#cb3-612" aria-hidden="true"></a>        <span class="co">// Buffer pre-allocated with enough room for</span></span>
<span id="cb3-613"><a href="#cb3-613" aria-hidden="true"></a>        <span class="co">// exponent notations of the form &quot;e+123&quot; or &quot;p-1023&quot;.</span></span>
<span id="cb3-614"><a href="#cb3-614" aria-hidden="true"></a>        <span class="kw">var</span> tailBuf [<span class="dv">6</span>]<span class="dt">byte</span></span>
<span id="cb3-615"><a href="#cb3-615" aria-hidden="true"></a>        tail := tailBuf[:<span class="dv">0</span>]</span>
<span id="cb3-616"><a href="#cb3-616" aria-hidden="true"></a></span>
<span id="cb3-617"><a href="#cb3-617" aria-hidden="true"></a>        hasDecimalPoint := <span class="ot">false</span></span>
<span id="cb3-618"><a href="#cb3-618" aria-hidden="true"></a>        sawNonzeroDigit := <span class="ot">false</span></span>
<span id="cb3-619"><a href="#cb3-619" aria-hidden="true"></a>        <span class="co">// Starting from i = 1 to skip sign at num[0].</span></span>
<span id="cb3-620"><a href="#cb3-620" aria-hidden="true"></a>        <span class="kw">for</span> i := <span class="dv">1</span>; i &lt; <span class="bu">len</span>(num); i++ {</span>
<span id="cb3-621"><a href="#cb3-621" aria-hidden="true"></a>            <span class="kw">switch</span> num[i] {</span>
<span id="cb3-622"><a href="#cb3-622" aria-hidden="true"></a>            <span class="kw">case</span> <span class="ch">&#39;.&#39;</span>:</span>
<span id="cb3-623"><a href="#cb3-623" aria-hidden="true"></a>                hasDecimalPoint = <span class="ot">true</span></span>
<span id="cb3-624"><a href="#cb3-624" aria-hidden="true"></a>            <span class="kw">case</span> <span class="ch">&#39;p&#39;</span>, <span class="ch">&#39;P&#39;</span>:</span>
<span id="cb3-625"><a href="#cb3-625" aria-hidden="true"></a>                tail = <span class="bu">append</span>(tail, num[i:]...)</span>
<span id="cb3-626"><a href="#cb3-626" aria-hidden="true"></a>                num = num[:i]</span>
<span id="cb3-627"><a href="#cb3-627" aria-hidden="true"></a>            <span class="kw">case</span> <span class="ch">&#39;e&#39;</span>, <span class="ch">&#39;E&#39;</span>:</span>
<span id="cb3-628"><a href="#cb3-628" aria-hidden="true"></a>                <span class="kw">if</span> verb != <span class="ch">&#39;x&#39;</span> &amp;&amp; verb != <span class="ch">&#39;X&#39;</span> {</span>
<span id="cb3-629"><a href="#cb3-629" aria-hidden="true"></a>                    tail = <span class="bu">append</span>(tail, num[i:]...)</span>
<span id="cb3-630"><a href="#cb3-630" aria-hidden="true"></a>                    num = num[:i]</span>
<span id="cb3-631"><a href="#cb3-631" aria-hidden="true"></a>                    <span class="kw">break</span></span>
<span id="cb3-632"><a href="#cb3-632" aria-hidden="true"></a>                }</span>
<span id="cb3-633"><a href="#cb3-633" aria-hidden="true"></a>                <span class="kw">fallthrough</span></span>
<span id="cb3-634"><a href="#cb3-634" aria-hidden="true"></a>            <span class="kw">default</span>:</span>
<span id="cb3-635"><a href="#cb3-635" aria-hidden="true"></a>                <span class="kw">if</span> num[i] != <span class="ch">&#39;0&#39;</span> {</span>
<span id="cb3-636"><a href="#cb3-636" aria-hidden="true"></a>                    sawNonzeroDigit = <span class="ot">true</span></span>
<span id="cb3-637"><a href="#cb3-637" aria-hidden="true"></a>                }</span>
<span id="cb3-638"><a href="#cb3-638" aria-hidden="true"></a>                <span class="co">// Count significant digits after the first non-zero digit.</span></span>
<span id="cb3-639"><a href="#cb3-639" aria-hidden="true"></a>                <span class="kw">if</span> sawNonzeroDigit {</span>
<span id="cb3-640"><a href="#cb3-640" aria-hidden="true"></a>                    digits--</span>
<span id="cb3-641"><a href="#cb3-641" aria-hidden="true"></a>                }</span>
<span id="cb3-642"><a href="#cb3-642" aria-hidden="true"></a>            }</span>
<span id="cb3-643"><a href="#cb3-643" aria-hidden="true"></a>        }</span>
<span id="cb3-644"><a href="#cb3-644" aria-hidden="true"></a>        <span class="kw">if</span> !hasDecimalPoint {</span>
<span id="cb3-645"><a href="#cb3-645" aria-hidden="true"></a>            <span class="co">// Leading digit 0 should contribute once to digits.</span></span>
<span id="cb3-646"><a href="#cb3-646" aria-hidden="true"></a>            <span class="kw">if</span> <span class="bu">len</span>(num) == <span class="dv">2</span> &amp;&amp; num[<span class="dv">1</span>] == <span class="ch">&#39;0&#39;</span> {</span>
<span id="cb3-647"><a href="#cb3-647" aria-hidden="true"></a>                digits--</span>
<span id="cb3-648"><a href="#cb3-648" aria-hidden="true"></a>            }</span>
<span id="cb3-649"><a href="#cb3-649" aria-hidden="true"></a>            num = <span class="bu">append</span>(num, <span class="ch">&#39;.&#39;</span>)</span>
<span id="cb3-650"><a href="#cb3-650" aria-hidden="true"></a>        }</span>
<span id="cb3-651"><a href="#cb3-651" aria-hidden="true"></a>        <span class="kw">for</span> digits &gt; <span class="dv">0</span> {</span>
<span id="cb3-652"><a href="#cb3-652" aria-hidden="true"></a>            num = <span class="bu">append</span>(num, <span class="ch">&#39;0&#39;</span>)</span>
<span id="cb3-653"><a href="#cb3-653" aria-hidden="true"></a>            digits--</span>
<span id="cb3-654"><a href="#cb3-654" aria-hidden="true"></a>        }</span>
<span id="cb3-655"><a href="#cb3-655" aria-hidden="true"></a>        num = <span class="bu">append</span>(num, tail...)</span>
<span id="cb3-656"><a href="#cb3-656" aria-hidden="true"></a>    }</span>
<span id="cb3-657"><a href="#cb3-657" aria-hidden="true"></a>    <span class="co">// We want a sign if asked for and if the sign is not positive.</span></span>
<span id="cb3-658"><a href="#cb3-658" aria-hidden="true"></a>    <span class="kw">if</span> f.plus || num[<span class="dv">0</span>] != <span class="ch">&#39;+&#39;</span> {</span>
<span id="cb3-659"><a href="#cb3-659" aria-hidden="true"></a>        <span class="co">// If we&#39;re zero padding to the left we want the sign before the leading zeros.</span></span>
<span id="cb3-660"><a href="#cb3-660" aria-hidden="true"></a>        <span class="co">// Achieve this by writing the sign out and then padding the unsigned number.</span></span>
<span id="cb3-661"><a href="#cb3-661" aria-hidden="true"></a>        <span class="kw">if</span> f.zero &amp;&amp; f.widPresent &amp;&amp; f.wid &gt; <span class="bu">len</span>(num) {</span>
<span id="cb3-662"><a href="#cb3-662" aria-hidden="true"></a>            f.buf.writeByte(num[<span class="dv">0</span>])</span>
<span id="cb3-663"><a href="#cb3-663" aria-hidden="true"></a>            f.writePadding(f.wid - <span class="bu">len</span>(num))</span>
<span id="cb3-664"><a href="#cb3-664" aria-hidden="true"></a>            f.buf.write(num[<span class="dv">1</span>:])</span>
<span id="cb3-665"><a href="#cb3-665" aria-hidden="true"></a>            <span class="kw">return</span></span>
<span id="cb3-666"><a href="#cb3-666" aria-hidden="true"></a>        }</span>
<span id="cb3-667"><a href="#cb3-667" aria-hidden="true"></a>        f.pad(num)</span>
<span id="cb3-668"><a href="#cb3-668" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-669"><a href="#cb3-669" aria-hidden="true"></a>    }</span>
<span id="cb3-670"><a href="#cb3-670" aria-hidden="true"></a>    <span class="co">// No sign to show and the number is positive; just print the unsigned number.</span></span>
<span id="cb3-671"><a href="#cb3-671" aria-hidden="true"></a>    f.pad(num[<span class="dv">1</span>:])</span>
<span id="cb3-672"><a href="#cb3-672" aria-hidden="true"></a>}</span>
<span id="cb3-673"><a href="#cb3-673" aria-hidden="true"></a></span>
<span id="cb3-674"><a href="#cb3-674" aria-hidden="true"></a><span class="co">// fmtFloat formats a float. The default precision for each verb</span></span>
<span id="cb3-675"><a href="#cb3-675" aria-hidden="true"></a><span class="co">// is specified as last argument in the call to fmt_float.</span></span>
<span id="cb3-676"><a href="#cb3-676" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmtFloat(v <span class="dt">float64</span>, size <span class="dt">int</span>, verb <span class="dt">rune</span>) {</span>
<span id="cb3-677"><a href="#cb3-677" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-678"><a href="#cb3-678" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>:</span>
<span id="cb3-679"><a href="#cb3-679" aria-hidden="true"></a>        p.fmt.fmtFloat(v, size, <span class="ch">&#39;g&#39;</span>, <span class="dv">-1</span>)</span>
<span id="cb3-680"><a href="#cb3-680" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;b&#39;</span>, <span class="ch">&#39;g&#39;</span>, <span class="ch">&#39;G&#39;</span>, <span class="ch">&#39;x&#39;</span>, <span class="ch">&#39;X&#39;</span>:</span>
<span id="cb3-681"><a href="#cb3-681" aria-hidden="true"></a>        p.fmt.fmtFloat(v, size, verb, <span class="dv">-1</span>)</span>
<span id="cb3-682"><a href="#cb3-682" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;f&#39;</span>, <span class="ch">&#39;e&#39;</span>, <span class="ch">&#39;E&#39;</span>:</span>
<span id="cb3-683"><a href="#cb3-683" aria-hidden="true"></a>        p.fmt.fmtFloat(v, size, verb, <span class="dv">6</span>)</span>
<span id="cb3-684"><a href="#cb3-684" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;F&#39;</span>:</span>
<span id="cb3-685"><a href="#cb3-685" aria-hidden="true"></a>        p.fmt.fmtFloat(v, size, <span class="ch">&#39;f&#39;</span>, <span class="dv">6</span>)</span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true"></a>        p.badVerb(verb)</span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true"></a>    }</span>
<span id="cb3-689"><a href="#cb3-689" aria-hidden="true"></a>}</span>
<span id="cb3-690"><a href="#cb3-690" aria-hidden="true"></a></span>
<span id="cb3-691"><a href="#cb3-691" aria-hidden="true"></a><span class="co">// fmtComplex formats a complex number v with</span></span>
<span id="cb3-692"><a href="#cb3-692" aria-hidden="true"></a><span class="co">// r = real(v) and j = imag(v) as (r+ji) using</span></span>
<span id="cb3-693"><a href="#cb3-693" aria-hidden="true"></a><span class="co">// fmtFloat for r and j formatting.</span></span>
<span id="cb3-694"><a href="#cb3-694" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmtComplex(v <span class="dt">complex128</span>, size <span class="dt">int</span>, verb <span class="dt">rune</span>) {</span>
<span id="cb3-695"><a href="#cb3-695" aria-hidden="true"></a>    <span class="co">// Make sure any unsupported verbs are found before the</span></span>
<span id="cb3-696"><a href="#cb3-696" aria-hidden="true"></a>    <span class="co">// calls to fmtFloat to not generate an incorrect error string.</span></span>
<span id="cb3-697"><a href="#cb3-697" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-698"><a href="#cb3-698" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>, <span class="ch">&#39;b&#39;</span>, <span class="ch">&#39;g&#39;</span>, <span class="ch">&#39;G&#39;</span>, <span class="ch">&#39;x&#39;</span>, <span class="ch">&#39;X&#39;</span>, <span class="ch">&#39;f&#39;</span>, <span class="ch">&#39;F&#39;</span>, <span class="ch">&#39;e&#39;</span>, <span class="ch">&#39;E&#39;</span>:</span>
<span id="cb3-699"><a href="#cb3-699" aria-hidden="true"></a>        oldPlus := p.fmt.plus</span>
<span id="cb3-700"><a href="#cb3-700" aria-hidden="true"></a>        p.buf.writeByte(<span class="ch">&#39;(&#39;</span>)</span>
<span id="cb3-701"><a href="#cb3-701" aria-hidden="true"></a>        p.fmtFloat(<span class="bu">real</span>(v), size/<span class="dv">2</span>, verb)</span>
<span id="cb3-702"><a href="#cb3-702" aria-hidden="true"></a>        <span class="co">// Imaginary part always has a sign.</span></span>
<span id="cb3-703"><a href="#cb3-703" aria-hidden="true"></a>        p.fmt.plus = <span class="ot">true</span></span>
<span id="cb3-704"><a href="#cb3-704" aria-hidden="true"></a>        p.fmtFloat(<span class="bu">imag</span>(v), size/<span class="dv">2</span>, verb)</span>
<span id="cb3-705"><a href="#cb3-705" aria-hidden="true"></a>        p.buf.writeString(<span class="st">&quot;i)&quot;</span>)</span>
<span id="cb3-706"><a href="#cb3-706" aria-hidden="true"></a>        p.fmt.plus = oldPlus</span>
<span id="cb3-707"><a href="#cb3-707" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-708"><a href="#cb3-708" aria-hidden="true"></a>        p.badVerb(verb)</span>
<span id="cb3-709"><a href="#cb3-709" aria-hidden="true"></a>    }</span>
<span id="cb3-710"><a href="#cb3-710" aria-hidden="true"></a>}</span>
<span id="cb3-711"><a href="#cb3-711" aria-hidden="true"></a></span>
<span id="cb3-712"><a href="#cb3-712" aria-hidden="true"></a><span class="co">// fmtQ formats a string as a double-quoted, escaped Go string constant.</span></span>
<span id="cb3-713"><a href="#cb3-713" aria-hidden="true"></a><span class="co">// If f.sharp is set a raw (backquoted) string may be returned instead</span></span>
<span id="cb3-714"><a href="#cb3-714" aria-hidden="true"></a><span class="co">// if the string does not contain any control characters other than tab.</span></span>
<span id="cb3-715"><a href="#cb3-715" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtQ(s <span class="dt">string</span>) {</span>
<span id="cb3-716"><a href="#cb3-716" aria-hidden="true"></a>    s = f.truncateString(s)</span>
<span id="cb3-717"><a href="#cb3-717" aria-hidden="true"></a>    <span class="kw">if</span> f.sharp &amp;&amp; strconv.CanBackquote(s) {</span>
<span id="cb3-718"><a href="#cb3-718" aria-hidden="true"></a>        f.padString(<span class="st">&quot;`&quot;</span> + s + <span class="st">&quot;`&quot;</span>)</span>
<span id="cb3-719"><a href="#cb3-719" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-720"><a href="#cb3-720" aria-hidden="true"></a>    }</span>
<span id="cb3-721"><a href="#cb3-721" aria-hidden="true"></a>    buf := f.intbuf[:<span class="dv">0</span>]</span>
<span id="cb3-722"><a href="#cb3-722" aria-hidden="true"></a>    <span class="kw">if</span> f.plus {</span>
<span id="cb3-723"><a href="#cb3-723" aria-hidden="true"></a>        f.pad(strconv.AppendQuoteToASCII(buf, s))</span>
<span id="cb3-724"><a href="#cb3-724" aria-hidden="true"></a>    } <span class="kw">else</span> {</span>
<span id="cb3-725"><a href="#cb3-725" aria-hidden="true"></a>        f.pad(strconv.AppendQuote(buf, s))</span>
<span id="cb3-726"><a href="#cb3-726" aria-hidden="true"></a>    }</span>
<span id="cb3-727"><a href="#cb3-727" aria-hidden="true"></a>}</span>
<span id="cb3-728"><a href="#cb3-728" aria-hidden="true"></a></span>
<span id="cb3-729"><a href="#cb3-729" aria-hidden="true"></a><span class="co">// fmtSbx formats a string or byte slice as a hexadecimal encoding of its bytes.</span></span>
<span id="cb3-730"><a href="#cb3-730" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtSbx(s <span class="dt">string</span>, b []<span class="dt">byte</span>, digits <span class="dt">string</span>) {</span>
<span id="cb3-731"><a href="#cb3-731" aria-hidden="true"></a>    length := <span class="bu">len</span>(b)</span>
<span id="cb3-732"><a href="#cb3-732" aria-hidden="true"></a>    <span class="kw">if</span> b == <span class="ot">nil</span> {</span>
<span id="cb3-733"><a href="#cb3-733" aria-hidden="true"></a>        <span class="co">// No byte slice present. Assume string s should be encoded.</span></span>
<span id="cb3-734"><a href="#cb3-734" aria-hidden="true"></a>        length = <span class="bu">len</span>(s)</span>
<span id="cb3-735"><a href="#cb3-735" aria-hidden="true"></a>    }</span>
<span id="cb3-736"><a href="#cb3-736" aria-hidden="true"></a>    <span class="co">// Set length to not process more bytes than the precision demands.</span></span>
<span id="cb3-737"><a href="#cb3-737" aria-hidden="true"></a>    <span class="kw">if</span> f.precPresent &amp;&amp; f.prec &lt; length {</span>
<span id="cb3-738"><a href="#cb3-738" aria-hidden="true"></a>        length = f.prec</span>
<span id="cb3-739"><a href="#cb3-739" aria-hidden="true"></a>    }</span>
<span id="cb3-740"><a href="#cb3-740" aria-hidden="true"></a>    <span class="co">// Compute width of the encoding taking into account the f.sharp and f.space flag.</span></span>
<span id="cb3-741"><a href="#cb3-741" aria-hidden="true"></a>    width := <span class="dv">2</span> * length</span>
<span id="cb3-742"><a href="#cb3-742" aria-hidden="true"></a>    <span class="kw">if</span> width &gt; <span class="dv">0</span> {</span>
<span id="cb3-743"><a href="#cb3-743" aria-hidden="true"></a>        <span class="kw">if</span> f.space {</span>
<span id="cb3-744"><a href="#cb3-744" aria-hidden="true"></a>            <span class="co">// Each element encoded by two hexadecimals will get a leading 0x or 0X.</span></span>
<span id="cb3-745"><a href="#cb3-745" aria-hidden="true"></a>            <span class="kw">if</span> f.sharp {</span>
<span id="cb3-746"><a href="#cb3-746" aria-hidden="true"></a>                width *= <span class="dv">2</span></span>
<span id="cb3-747"><a href="#cb3-747" aria-hidden="true"></a>            }</span>
<span id="cb3-748"><a href="#cb3-748" aria-hidden="true"></a>            <span class="co">// Elements will be separated by a space.</span></span>
<span id="cb3-749"><a href="#cb3-749" aria-hidden="true"></a>            width += length - <span class="dv">1</span></span>
<span id="cb3-750"><a href="#cb3-750" aria-hidden="true"></a>        } <span class="kw">else</span> <span class="kw">if</span> f.sharp {</span>
<span id="cb3-751"><a href="#cb3-751" aria-hidden="true"></a>            <span class="co">// Only a leading 0x or 0X will be added for the whole string.</span></span>
<span id="cb3-752"><a href="#cb3-752" aria-hidden="true"></a>            width += <span class="dv">2</span></span>
<span id="cb3-753"><a href="#cb3-753" aria-hidden="true"></a>        }</span>
<span id="cb3-754"><a href="#cb3-754" aria-hidden="true"></a>    } <span class="kw">else</span> { <span class="co">// The byte slice or string that should be encoded is empty.</span></span>
<span id="cb3-755"><a href="#cb3-755" aria-hidden="true"></a>        <span class="kw">if</span> f.widPresent {</span>
<span id="cb3-756"><a href="#cb3-756" aria-hidden="true"></a>            f.writePadding(f.wid)</span>
<span id="cb3-757"><a href="#cb3-757" aria-hidden="true"></a>        }</span>
<span id="cb3-758"><a href="#cb3-758" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-759"><a href="#cb3-759" aria-hidden="true"></a>    }</span>
<span id="cb3-760"><a href="#cb3-760" aria-hidden="true"></a>    <span class="co">// Handle padding to the left.</span></span>
<span id="cb3-761"><a href="#cb3-761" aria-hidden="true"></a>    <span class="kw">if</span> f.widPresent &amp;&amp; f.wid &gt; width &amp;&amp; !f.minus {</span>
<span id="cb3-762"><a href="#cb3-762" aria-hidden="true"></a>        f.writePadding(f.wid - width)</span>
<span id="cb3-763"><a href="#cb3-763" aria-hidden="true"></a>    }</span>
<span id="cb3-764"><a href="#cb3-764" aria-hidden="true"></a>    <span class="co">// Write the encoding directly into the output buffer.</span></span>
<span id="cb3-765"><a href="#cb3-765" aria-hidden="true"></a>    buf := *f.buf</span>
<span id="cb3-766"><a href="#cb3-766" aria-hidden="true"></a>    <span class="kw">if</span> f.sharp {</span>
<span id="cb3-767"><a href="#cb3-767" aria-hidden="true"></a>        <span class="co">// Add leading 0x or 0X.</span></span>
<span id="cb3-768"><a href="#cb3-768" aria-hidden="true"></a>        buf = <span class="bu">append</span>(buf, <span class="ch">&#39;0&#39;</span>, digits[<span class="dv">16</span>])</span>
<span id="cb3-769"><a href="#cb3-769" aria-hidden="true"></a>    }</span>
<span id="cb3-770"><a href="#cb3-770" aria-hidden="true"></a>    <span class="kw">var</span> c <span class="dt">byte</span></span>
<span id="cb3-771"><a href="#cb3-771" aria-hidden="true"></a>    <span class="kw">for</span> i := <span class="dv">0</span>; i &lt; length; i++ {</span>
<span id="cb3-772"><a href="#cb3-772" aria-hidden="true"></a>        <span class="kw">if</span> f.space &amp;&amp; i &gt; <span class="dv">0</span> {</span>
<span id="cb3-773"><a href="#cb3-773" aria-hidden="true"></a>            <span class="co">// Separate elements with a space.</span></span>
<span id="cb3-774"><a href="#cb3-774" aria-hidden="true"></a>            buf = <span class="bu">append</span>(buf, <span class="ch">&#39; &#39;</span>)</span>
<span id="cb3-775"><a href="#cb3-775" aria-hidden="true"></a>            <span class="kw">if</span> f.sharp {</span>
<span id="cb3-776"><a href="#cb3-776" aria-hidden="true"></a>                <span class="co">// Add leading 0x or 0X for each element.</span></span>
<span id="cb3-777"><a href="#cb3-777" aria-hidden="true"></a>                buf = <span class="bu">append</span>(buf, <span class="ch">&#39;0&#39;</span>, digits[<span class="dv">16</span>])</span>
<span id="cb3-778"><a href="#cb3-778" aria-hidden="true"></a>            }</span>
<span id="cb3-779"><a href="#cb3-779" aria-hidden="true"></a>        }</span>
<span id="cb3-780"><a href="#cb3-780" aria-hidden="true"></a>        <span class="kw">if</span> b != <span class="ot">nil</span> {</span>
<span id="cb3-781"><a href="#cb3-781" aria-hidden="true"></a>            c = b[i] <span class="co">// Take a byte from the input byte slice.</span></span>
<span id="cb3-782"><a href="#cb3-782" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-783"><a href="#cb3-783" aria-hidden="true"></a>            c = s[i] <span class="co">// Take a byte from the input string.</span></span>
<span id="cb3-784"><a href="#cb3-784" aria-hidden="true"></a>        }</span>
<span id="cb3-785"><a href="#cb3-785" aria-hidden="true"></a>        <span class="co">// Encode each byte as two hexadecimal digits.</span></span>
<span id="cb3-786"><a href="#cb3-786" aria-hidden="true"></a>        buf = <span class="bu">append</span>(buf, digits[c&gt;&gt;<span class="dv">4</span>], digits[c&amp;<span class="dv">0xF</span>])</span>
<span id="cb3-787"><a href="#cb3-787" aria-hidden="true"></a>    }</span>
<span id="cb3-788"><a href="#cb3-788" aria-hidden="true"></a>    *f.buf = buf</span>
<span id="cb3-789"><a href="#cb3-789" aria-hidden="true"></a>    <span class="co">// Handle padding to the right.</span></span>
<span id="cb3-790"><a href="#cb3-790" aria-hidden="true"></a>    <span class="kw">if</span> f.widPresent &amp;&amp; f.wid &gt; width &amp;&amp; f.minus {</span>
<span id="cb3-791"><a href="#cb3-791" aria-hidden="true"></a>        f.writePadding(f.wid - width)</span>
<span id="cb3-792"><a href="#cb3-792" aria-hidden="true"></a>    }</span>
<span id="cb3-793"><a href="#cb3-793" aria-hidden="true"></a>}</span>
<span id="cb3-794"><a href="#cb3-794" aria-hidden="true"></a></span>
<span id="cb3-795"><a href="#cb3-795" aria-hidden="true"></a><span class="co">// fmtSx formats a string as a hexadecimal encoding of its bytes.</span></span>
<span id="cb3-796"><a href="#cb3-796" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtSx(s, digits <span class="dt">string</span>) {</span>
<span id="cb3-797"><a href="#cb3-797" aria-hidden="true"></a>    f.fmtSbx(s, <span class="ot">nil</span>, digits)</span>
<span id="cb3-798"><a href="#cb3-798" aria-hidden="true"></a>}</span>
<span id="cb3-799"><a href="#cb3-799" aria-hidden="true"></a></span>
<span id="cb3-800"><a href="#cb3-800" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmtString(v <span class="dt">string</span>, verb <span class="dt">rune</span>) {</span>
<span id="cb3-801"><a href="#cb3-801" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-802"><a href="#cb3-802" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>:</span>
<span id="cb3-803"><a href="#cb3-803" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-804"><a href="#cb3-804" aria-hidden="true"></a>            p.fmt.fmtQ(v)</span>
<span id="cb3-805"><a href="#cb3-805" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-806"><a href="#cb3-806" aria-hidden="true"></a>            p.fmt.fmtS(v)</span>
<span id="cb3-807"><a href="#cb3-807" aria-hidden="true"></a>        }</span>
<span id="cb3-808"><a href="#cb3-808" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;s&#39;</span>:</span>
<span id="cb3-809"><a href="#cb3-809" aria-hidden="true"></a>        p.fmt.fmtS(v)</span>
<span id="cb3-810"><a href="#cb3-810" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;x&#39;</span>:</span>
<span id="cb3-811"><a href="#cb3-811" aria-hidden="true"></a>        p.fmt.fmtSx(v, ldigits)</span>
<span id="cb3-812"><a href="#cb3-812" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;X&#39;</span>:</span>
<span id="cb3-813"><a href="#cb3-813" aria-hidden="true"></a>        p.fmt.fmtSx(v, udigits)</span>
<span id="cb3-814"><a href="#cb3-814" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;q&#39;</span>:</span>
<span id="cb3-815"><a href="#cb3-815" aria-hidden="true"></a>        p.fmt.fmtQ(v)</span>
<span id="cb3-816"><a href="#cb3-816" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-817"><a href="#cb3-817" aria-hidden="true"></a>        p.badVerb(verb)</span>
<span id="cb3-818"><a href="#cb3-818" aria-hidden="true"></a>    }</span>
<span id="cb3-819"><a href="#cb3-819" aria-hidden="true"></a>}</span>
<span id="cb3-820"><a href="#cb3-820" aria-hidden="true"></a></span>
<span id="cb3-821"><a href="#cb3-821" aria-hidden="true"></a><span class="co">// truncate truncates the byte slice b as a string of the specified precision, if present.</span></span>
<span id="cb3-822"><a href="#cb3-822" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) truncate(b []<span class="dt">byte</span>) []<span class="dt">byte</span> {</span>
<span id="cb3-823"><a href="#cb3-823" aria-hidden="true"></a>    <span class="kw">if</span> f.precPresent {</span>
<span id="cb3-824"><a href="#cb3-824" aria-hidden="true"></a>        n := f.prec</span>
<span id="cb3-825"><a href="#cb3-825" aria-hidden="true"></a>        <span class="kw">for</span> i := <span class="dv">0</span>; i &lt; <span class="bu">len</span>(b); {</span>
<span id="cb3-826"><a href="#cb3-826" aria-hidden="true"></a>            n--</span>
<span id="cb3-827"><a href="#cb3-827" aria-hidden="true"></a>            <span class="kw">if</span> n &lt; <span class="dv">0</span> {</span>
<span id="cb3-828"><a href="#cb3-828" aria-hidden="true"></a>                <span class="kw">return</span> b[:i]</span>
<span id="cb3-829"><a href="#cb3-829" aria-hidden="true"></a>            }</span>
<span id="cb3-830"><a href="#cb3-830" aria-hidden="true"></a>            wid := <span class="dv">1</span></span>
<span id="cb3-831"><a href="#cb3-831" aria-hidden="true"></a>            <span class="kw">if</span> b[i] &gt;= utf8.RuneSelf {</span>
<span id="cb3-832"><a href="#cb3-832" aria-hidden="true"></a>                _, wid = utf8.DecodeRune(b[i:])</span>
<span id="cb3-833"><a href="#cb3-833" aria-hidden="true"></a>            }</span>
<span id="cb3-834"><a href="#cb3-834" aria-hidden="true"></a>            i += wid</span>
<span id="cb3-835"><a href="#cb3-835" aria-hidden="true"></a>        }</span>
<span id="cb3-836"><a href="#cb3-836" aria-hidden="true"></a>    }</span>
<span id="cb3-837"><a href="#cb3-837" aria-hidden="true"></a>    <span class="kw">return</span> b</span>
<span id="cb3-838"><a href="#cb3-838" aria-hidden="true"></a>}</span>
<span id="cb3-839"><a href="#cb3-839" aria-hidden="true"></a></span>
<span id="cb3-840"><a href="#cb3-840" aria-hidden="true"></a><span class="co">// fmtBs formats the byte slice b as if it was formatted as string with fmtS.</span></span>
<span id="cb3-841"><a href="#cb3-841" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtBs(b []<span class="dt">byte</span>) {</span>
<span id="cb3-842"><a href="#cb3-842" aria-hidden="true"></a>    b = f.truncate(b)</span>
<span id="cb3-843"><a href="#cb3-843" aria-hidden="true"></a>    f.pad(b)</span>
<span id="cb3-844"><a href="#cb3-844" aria-hidden="true"></a>}</span>
<span id="cb3-845"><a href="#cb3-845" aria-hidden="true"></a></span>
<span id="cb3-846"><a href="#cb3-846" aria-hidden="true"></a><span class="co">// fmtBx formats a byte slice as a hexadecimal encoding of its bytes.</span></span>
<span id="cb3-847"><a href="#cb3-847" aria-hidden="true"></a><span class="kw">func</span> (f *fmt) fmtBx(b []<span class="dt">byte</span>, digits <span class="dt">string</span>) {</span>
<span id="cb3-848"><a href="#cb3-848" aria-hidden="true"></a>    f.fmtSbx(<span class="st">&quot;&quot;</span>, b, digits)</span>
<span id="cb3-849"><a href="#cb3-849" aria-hidden="true"></a>}</span>
<span id="cb3-850"><a href="#cb3-850" aria-hidden="true"></a></span>
<span id="cb3-851"><a href="#cb3-851" aria-hidden="true"></a><span class="co">// State represents the printer state passed to custom formatters.</span></span>
<span id="cb3-852"><a href="#cb3-852" aria-hidden="true"></a><span class="co">// It provides access to the io.Writer interface plus information about</span></span>
<span id="cb3-853"><a href="#cb3-853" aria-hidden="true"></a><span class="co">// the flags and options for the operand&#39;s format specifier.</span></span>
<span id="cb3-854"><a href="#cb3-854" aria-hidden="true"></a><span class="kw">type</span> State <span class="kw">interface</span> {</span>
<span id="cb3-855"><a href="#cb3-855" aria-hidden="true"></a>    <span class="co">// Write is the function to call to emit formatted output to be printed.</span></span>
<span id="cb3-856"><a href="#cb3-856" aria-hidden="true"></a>    Write(b []<span class="dt">byte</span>) (n <span class="dt">int</span>, err <span class="dt">error</span>)</span>
<span id="cb3-857"><a href="#cb3-857" aria-hidden="true"></a>    <span class="co">// Width returns the value of the width option and whether it has been set.</span></span>
<span id="cb3-858"><a href="#cb3-858" aria-hidden="true"></a>    Width() (wid <span class="dt">int</span>, ok <span class="dt">bool</span>)</span>
<span id="cb3-859"><a href="#cb3-859" aria-hidden="true"></a>    <span class="co">// Precision returns the value of the precision option and whether it has been set.</span></span>
<span id="cb3-860"><a href="#cb3-860" aria-hidden="true"></a>    Precision() (prec <span class="dt">int</span>, ok <span class="dt">bool</span>)</span>
<span id="cb3-861"><a href="#cb3-861" aria-hidden="true"></a></span>
<span id="cb3-862"><a href="#cb3-862" aria-hidden="true"></a>    <span class="co">// Flag reports whether the flag c, a character, has been set.</span></span>
<span id="cb3-863"><a href="#cb3-863" aria-hidden="true"></a>    Flag(c <span class="dt">int</span>) <span class="dt">bool</span></span>
<span id="cb3-864"><a href="#cb3-864" aria-hidden="true"></a>}</span>
<span id="cb3-865"><a href="#cb3-865" aria-hidden="true"></a></span>
<span id="cb3-866"><a href="#cb3-866" aria-hidden="true"></a><span class="co">// Formatter is implemented by any value that has a Format method.</span></span>
<span id="cb3-867"><a href="#cb3-867" aria-hidden="true"></a><span class="co">// The implementation controls how State and rune are interpreted,</span></span>
<span id="cb3-868"><a href="#cb3-868" aria-hidden="true"></a><span class="co">// and may call Sprint(f) or Fprint(f) etc. to generate its output.</span></span>
<span id="cb3-869"><a href="#cb3-869" aria-hidden="true"></a><span class="kw">type</span> Formatter <span class="kw">interface</span> {</span>
<span id="cb3-870"><a href="#cb3-870" aria-hidden="true"></a>    Format(f State, verb <span class="dt">rune</span>)</span>
<span id="cb3-871"><a href="#cb3-871" aria-hidden="true"></a>}</span>
<span id="cb3-872"><a href="#cb3-872" aria-hidden="true"></a></span>
<span id="cb3-873"><a href="#cb3-873" aria-hidden="true"></a><span class="kw">func</span> (p *pp) catchPanic(arg <span class="kw">interface</span>{}, verb <span class="dt">rune</span>, method <span class="dt">string</span>) {</span>
<span id="cb3-874"><a href="#cb3-874" aria-hidden="true"></a>    <span class="kw">if</span> err := <span class="bu">recover</span>(); err != <span class="ot">nil</span> {</span>
<span id="cb3-875"><a href="#cb3-875" aria-hidden="true"></a>        <span class="co">// If it&#39;s a nil pointer, just say &quot;&lt;nil&gt;&quot;. The likeliest causes are a</span></span>
<span id="cb3-876"><a href="#cb3-876" aria-hidden="true"></a>        <span class="co">// Stringer that fails to guard against nil or a nil pointer for a</span></span>
<span id="cb3-877"><a href="#cb3-877" aria-hidden="true"></a>        <span class="co">// value receiver, and in either case, &quot;&lt;nil&gt;&quot; is a nice result.</span></span>
<span id="cb3-878"><a href="#cb3-878" aria-hidden="true"></a>        <span class="kw">if</span> v := reflect.ValueOf(arg); v.Kind() == reflect.Pointer &amp;&amp; v.IsNil() {</span>
<span id="cb3-879"><a href="#cb3-879" aria-hidden="true"></a>            p.buf.writeString(nilAngleString)</span>
<span id="cb3-880"><a href="#cb3-880" aria-hidden="true"></a>            <span class="kw">return</span></span>
<span id="cb3-881"><a href="#cb3-881" aria-hidden="true"></a>        }</span>
<span id="cb3-882"><a href="#cb3-882" aria-hidden="true"></a>        <span class="co">// Otherwise print a concise panic message. Most of the time the panic</span></span>
<span id="cb3-883"><a href="#cb3-883" aria-hidden="true"></a>        <span class="co">// value will print itself nicely.</span></span>
<span id="cb3-884"><a href="#cb3-884" aria-hidden="true"></a>        <span class="kw">if</span> p.panicking {</span>
<span id="cb3-885"><a href="#cb3-885" aria-hidden="true"></a>            <span class="co">// Nested panics; the recursion in printArg cannot succeed.</span></span>
<span id="cb3-886"><a href="#cb3-886" aria-hidden="true"></a>            <span class="bu">panic</span>(err)</span>
<span id="cb3-887"><a href="#cb3-887" aria-hidden="true"></a>        }</span>
<span id="cb3-888"><a href="#cb3-888" aria-hidden="true"></a></span>
<span id="cb3-889"><a href="#cb3-889" aria-hidden="true"></a>        oldFlags := p.fmt.fmtFlags</span>
<span id="cb3-890"><a href="#cb3-890" aria-hidden="true"></a>        <span class="co">// For this output we want default behavior.</span></span>
<span id="cb3-891"><a href="#cb3-891" aria-hidden="true"></a>        p.fmt.clearflags()</span>
<span id="cb3-892"><a href="#cb3-892" aria-hidden="true"></a></span>
<span id="cb3-893"><a href="#cb3-893" aria-hidden="true"></a>        p.buf.writeString(percentBangString)</span>
<span id="cb3-894"><a href="#cb3-894" aria-hidden="true"></a>        p.buf.writeRune(verb)</span>
<span id="cb3-895"><a href="#cb3-895" aria-hidden="true"></a>        p.buf.writeString(panicString)</span>
<span id="cb3-896"><a href="#cb3-896" aria-hidden="true"></a>        p.buf.writeString(method)</span>
<span id="cb3-897"><a href="#cb3-897" aria-hidden="true"></a>        p.buf.writeString(<span class="st">&quot; method: &quot;</span>)</span>
<span id="cb3-898"><a href="#cb3-898" aria-hidden="true"></a>        p.panicking = <span class="ot">true</span></span>
<span id="cb3-899"><a href="#cb3-899" aria-hidden="true"></a>        p.printArg(err, <span class="ch">&#39;v&#39;</span>)</span>
<span id="cb3-900"><a href="#cb3-900" aria-hidden="true"></a>        p.panicking = <span class="ot">false</span></span>
<span id="cb3-901"><a href="#cb3-901" aria-hidden="true"></a>        p.buf.writeByte(<span class="ch">&#39;)&#39;</span>)</span>
<span id="cb3-902"><a href="#cb3-902" aria-hidden="true"></a></span>
<span id="cb3-903"><a href="#cb3-903" aria-hidden="true"></a>        p.fmt.fmtFlags = oldFlags</span>
<span id="cb3-904"><a href="#cb3-904" aria-hidden="true"></a>    }</span>
<span id="cb3-905"><a href="#cb3-905" aria-hidden="true"></a>}</span>
<span id="cb3-906"><a href="#cb3-906" aria-hidden="true"></a></span>
<span id="cb3-907"><a href="#cb3-907" aria-hidden="true"></a><span class="co">// GoStringer is implemented by any value that has a GoString method,</span></span>
<span id="cb3-908"><a href="#cb3-908" aria-hidden="true"></a><span class="co">// which defines the Go syntax for that value.</span></span>
<span id="cb3-909"><a href="#cb3-909" aria-hidden="true"></a><span class="co">// The GoString method is used to print values passed as an operand</span></span>
<span id="cb3-910"><a href="#cb3-910" aria-hidden="true"></a><span class="co">// to a %#v format.</span></span>
<span id="cb3-911"><a href="#cb3-911" aria-hidden="true"></a><span class="kw">type</span> GoStringer <span class="kw">interface</span> {</span>
<span id="cb3-912"><a href="#cb3-912" aria-hidden="true"></a>    GoString() <span class="dt">string</span></span>
<span id="cb3-913"><a href="#cb3-913" aria-hidden="true"></a>}</span>
<span id="cb3-914"><a href="#cb3-914" aria-hidden="true"></a></span>
<span id="cb3-915"><a href="#cb3-915" aria-hidden="true"></a><span class="co">// Stringer is implemented by any value that has a String method,</span></span>
<span id="cb3-916"><a href="#cb3-916" aria-hidden="true"></a><span class="co">// which defines the ``native&#39;&#39; format for that value.</span></span>
<span id="cb3-917"><a href="#cb3-917" aria-hidden="true"></a><span class="co">// The String method is used to print values passed as an operand</span></span>
<span id="cb3-918"><a href="#cb3-918" aria-hidden="true"></a><span class="co">// to any format that accepts a string or to an unformatted printer</span></span>
<span id="cb3-919"><a href="#cb3-919" aria-hidden="true"></a><span class="co">// such as Print.</span></span>
<span id="cb3-920"><a href="#cb3-920" aria-hidden="true"></a><span class="kw">type</span> Stringer <span class="kw">interface</span> {</span>
<span id="cb3-921"><a href="#cb3-921" aria-hidden="true"></a>    String() <span class="dt">string</span></span>
<span id="cb3-922"><a href="#cb3-922" aria-hidden="true"></a>}</span>
<span id="cb3-923"><a href="#cb3-923" aria-hidden="true"></a></span>
<span id="cb3-924"><a href="#cb3-924" aria-hidden="true"></a><span class="kw">func</span> (p *pp) handleMethods(verb <span class="dt">rune</span>) (handled <span class="dt">bool</span>) {</span>
<span id="cb3-925"><a href="#cb3-925" aria-hidden="true"></a>    <span class="kw">if</span> p.erroring {</span>
<span id="cb3-926"><a href="#cb3-926" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-927"><a href="#cb3-927" aria-hidden="true"></a>    }</span>
<span id="cb3-928"><a href="#cb3-928" aria-hidden="true"></a>    <span class="kw">if</span> verb == <span class="ch">&#39;w&#39;</span> {</span>
<span id="cb3-929"><a href="#cb3-929" aria-hidden="true"></a>        <span class="co">// It is invalid to use %w other than with Errorf, more than once,</span></span>
<span id="cb3-930"><a href="#cb3-930" aria-hidden="true"></a>        <span class="co">// or with a non-error arg.</span></span>
<span id="cb3-931"><a href="#cb3-931" aria-hidden="true"></a>        err, ok := p.arg.(<span class="dt">error</span>)</span>
<span id="cb3-932"><a href="#cb3-932" aria-hidden="true"></a>        <span class="kw">if</span> !ok || !p.wrapErrs || p.wrappedErr != <span class="ot">nil</span> {</span>
<span id="cb3-933"><a href="#cb3-933" aria-hidden="true"></a>            p.wrappedErr = <span class="ot">nil</span></span>
<span id="cb3-934"><a href="#cb3-934" aria-hidden="true"></a>            p.wrapErrs = <span class="ot">false</span></span>
<span id="cb3-935"><a href="#cb3-935" aria-hidden="true"></a>            p.badVerb(verb)</span>
<span id="cb3-936"><a href="#cb3-936" aria-hidden="true"></a>            <span class="kw">return</span> <span class="ot">true</span></span>
<span id="cb3-937"><a href="#cb3-937" aria-hidden="true"></a>        }</span>
<span id="cb3-938"><a href="#cb3-938" aria-hidden="true"></a>        p.wrappedErr = err</span>
<span id="cb3-939"><a href="#cb3-939" aria-hidden="true"></a>        <span class="co">// If the arg is a Formatter, pass &#39;v&#39; as the verb to it.</span></span>
<span id="cb3-940"><a href="#cb3-940" aria-hidden="true"></a>        verb = <span class="ch">&#39;v&#39;</span></span>
<span id="cb3-941"><a href="#cb3-941" aria-hidden="true"></a>    }</span>
<span id="cb3-942"><a href="#cb3-942" aria-hidden="true"></a></span>
<span id="cb3-943"><a href="#cb3-943" aria-hidden="true"></a>    <span class="co">// Is it a Formatter?</span></span>
<span id="cb3-944"><a href="#cb3-944" aria-hidden="true"></a>    <span class="kw">if</span> formatter, ok := p.arg.(Formatter); ok {</span>
<span id="cb3-945"><a href="#cb3-945" aria-hidden="true"></a>        handled = <span class="ot">true</span></span>
<span id="cb3-946"><a href="#cb3-946" aria-hidden="true"></a>        <span class="kw">defer</span> p.catchPanic(p.arg, verb, <span class="st">&quot;Format&quot;</span>)</span>
<span id="cb3-947"><a href="#cb3-947" aria-hidden="true"></a>        formatter.Format(p, verb)</span>
<span id="cb3-948"><a href="#cb3-948" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-949"><a href="#cb3-949" aria-hidden="true"></a>    }</span>
<span id="cb3-950"><a href="#cb3-950" aria-hidden="true"></a></span>
<span id="cb3-951"><a href="#cb3-951" aria-hidden="true"></a>    <span class="co">// If we&#39;re doing Go syntax and the argument knows how to supply it, take care of it now.</span></span>
<span id="cb3-952"><a href="#cb3-952" aria-hidden="true"></a>    <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-953"><a href="#cb3-953" aria-hidden="true"></a>        <span class="kw">if</span> stringer, ok := p.arg.(GoStringer); ok {</span>
<span id="cb3-954"><a href="#cb3-954" aria-hidden="true"></a>            handled = <span class="ot">true</span></span>
<span id="cb3-955"><a href="#cb3-955" aria-hidden="true"></a>            <span class="kw">defer</span> p.catchPanic(p.arg, verb, <span class="st">&quot;GoString&quot;</span>)</span>
<span id="cb3-956"><a href="#cb3-956" aria-hidden="true"></a>            <span class="co">// Print the result of GoString unadorned.</span></span>
<span id="cb3-957"><a href="#cb3-957" aria-hidden="true"></a>            p.fmt.fmtS(stringer.GoString())</span>
<span id="cb3-958"><a href="#cb3-958" aria-hidden="true"></a>            <span class="kw">return</span></span>
<span id="cb3-959"><a href="#cb3-959" aria-hidden="true"></a>        }</span>
<span id="cb3-960"><a href="#cb3-960" aria-hidden="true"></a>    } <span class="kw">else</span> {</span>
<span id="cb3-961"><a href="#cb3-961" aria-hidden="true"></a>        <span class="co">// If a string is acceptable according to the format, see if</span></span>
<span id="cb3-962"><a href="#cb3-962" aria-hidden="true"></a>        <span class="co">// the value satisfies one of the string-valued interfaces.</span></span>
<span id="cb3-963"><a href="#cb3-963" aria-hidden="true"></a>        <span class="co">// Println etc. set verb to %v, which is &quot;stringable&quot;.</span></span>
<span id="cb3-964"><a href="#cb3-964" aria-hidden="true"></a>        <span class="kw">switch</span> verb {</span>
<span id="cb3-965"><a href="#cb3-965" aria-hidden="true"></a>        <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>, <span class="ch">&#39;s&#39;</span>, <span class="ch">&#39;x&#39;</span>, <span class="ch">&#39;X&#39;</span>, <span class="ch">&#39;q&#39;</span>:</span>
<span id="cb3-966"><a href="#cb3-966" aria-hidden="true"></a>            <span class="co">// Is it an error or Stringer?</span></span>
<span id="cb3-967"><a href="#cb3-967" aria-hidden="true"></a>            <span class="co">// The duplication in the bodies is necessary:</span></span>
<span id="cb3-968"><a href="#cb3-968" aria-hidden="true"></a>            <span class="co">// setting handled and deferring catchPanic</span></span>
<span id="cb3-969"><a href="#cb3-969" aria-hidden="true"></a>            <span class="co">// must happen before calling the method.</span></span>
<span id="cb3-970"><a href="#cb3-970" aria-hidden="true"></a>            <span class="kw">switch</span> v := p.arg.(<span class="kw">type</span>) {</span>
<span id="cb3-971"><a href="#cb3-971" aria-hidden="true"></a>            <span class="kw">case</span> <span class="dt">error</span>:</span>
<span id="cb3-972"><a href="#cb3-972" aria-hidden="true"></a>                handled = <span class="ot">true</span></span>
<span id="cb3-973"><a href="#cb3-973" aria-hidden="true"></a>                <span class="kw">defer</span> p.catchPanic(p.arg, verb, <span class="st">&quot;Error&quot;</span>)</span>
<span id="cb3-974"><a href="#cb3-974" aria-hidden="true"></a>                p.fmtString(v.Error(), verb)</span>
<span id="cb3-975"><a href="#cb3-975" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-976"><a href="#cb3-976" aria-hidden="true"></a></span>
<span id="cb3-977"><a href="#cb3-977" aria-hidden="true"></a>            <span class="kw">case</span> Stringer:</span>
<span id="cb3-978"><a href="#cb3-978" aria-hidden="true"></a>                handled = <span class="ot">true</span></span>
<span id="cb3-979"><a href="#cb3-979" aria-hidden="true"></a>                <span class="kw">defer</span> p.catchPanic(p.arg, verb, <span class="st">&quot;String&quot;</span>)</span>
<span id="cb3-980"><a href="#cb3-980" aria-hidden="true"></a>                p.fmtString(v.String(), verb)</span>
<span id="cb3-981"><a href="#cb3-981" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-982"><a href="#cb3-982" aria-hidden="true"></a>            }</span>
<span id="cb3-983"><a href="#cb3-983" aria-hidden="true"></a>        }</span>
<span id="cb3-984"><a href="#cb3-984" aria-hidden="true"></a>    }</span>
<span id="cb3-985"><a href="#cb3-985" aria-hidden="true"></a>    <span class="kw">return</span> <span class="ot">false</span></span>
<span id="cb3-986"><a href="#cb3-986" aria-hidden="true"></a>}</span>
<span id="cb3-987"><a href="#cb3-987" aria-hidden="true"></a></span>
<span id="cb3-988"><a href="#cb3-988" aria-hidden="true"></a><span class="co">// getField gets the i&#39;th field of the struct value.</span></span>
<span id="cb3-989"><a href="#cb3-989" aria-hidden="true"></a><span class="co">// If the field is itself is an interface, return a value for</span></span>
<span id="cb3-990"><a href="#cb3-990" aria-hidden="true"></a><span class="co">// the thing inside the interface, not the interface itself.</span></span>
<span id="cb3-991"><a href="#cb3-991" aria-hidden="true"></a><span class="kw">func</span> getField(v reflect.Value, i <span class="dt">int</span>) reflect.Value {</span>
<span id="cb3-992"><a href="#cb3-992" aria-hidden="true"></a>    val := v.Field(i)</span>
<span id="cb3-993"><a href="#cb3-993" aria-hidden="true"></a>    <span class="kw">if</span> val.Kind() == reflect.Interface &amp;&amp; !val.IsNil() {</span>
<span id="cb3-994"><a href="#cb3-994" aria-hidden="true"></a>        val = val.Elem()</span>
<span id="cb3-995"><a href="#cb3-995" aria-hidden="true"></a>    }</span>
<span id="cb3-996"><a href="#cb3-996" aria-hidden="true"></a>    <span class="kw">return</span> val</span>
<span id="cb3-997"><a href="#cb3-997" aria-hidden="true"></a>}</span>
<span id="cb3-998"><a href="#cb3-998" aria-hidden="true"></a></span>
<span id="cb3-999"><a href="#cb3-999" aria-hidden="true"></a><span class="kw">func</span> (p *pp) unknownType(v reflect.Value) {</span>
<span id="cb3-1000"><a href="#cb3-1000" aria-hidden="true"></a>    <span class="kw">if</span> !v.IsValid() {</span>
<span id="cb3-1001"><a href="#cb3-1001" aria-hidden="true"></a>        p.buf.writeString(nilAngleString)</span>
<span id="cb3-1002"><a href="#cb3-1002" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-1003"><a href="#cb3-1003" aria-hidden="true"></a>    }</span>
<span id="cb3-1004"><a href="#cb3-1004" aria-hidden="true"></a>    p.buf.writeByte(<span class="ch">&#39;?&#39;</span>)</span>
<span id="cb3-1005"><a href="#cb3-1005" aria-hidden="true"></a>    p.buf.writeString(v.Type().String())</span>
<span id="cb3-1006"><a href="#cb3-1006" aria-hidden="true"></a>    p.buf.writeByte(<span class="ch">&#39;?&#39;</span>)</span>
<span id="cb3-1007"><a href="#cb3-1007" aria-hidden="true"></a>}</span>
<span id="cb3-1008"><a href="#cb3-1008" aria-hidden="true"></a></span>
<span id="cb3-1009"><a href="#cb3-1009" aria-hidden="true"></a><span class="co">// printValue is similar to printArg but starts with a reflect value, not an interface{} value.</span></span>
<span id="cb3-1010"><a href="#cb3-1010" aria-hidden="true"></a><span class="co">// It does not handle &#39;p&#39; and &#39;T&#39; verbs because these should have been already handled by printArg.</span></span>
<span id="cb3-1011"><a href="#cb3-1011" aria-hidden="true"></a><span class="kw">func</span> (p *pp) printValue(value reflect.Value, verb <span class="dt">rune</span>, depth <span class="dt">int</span>) {</span>
<span id="cb3-1012"><a href="#cb3-1012" aria-hidden="true"></a>    <span class="co">// Handle values with special methods if not already handled by printArg (depth == 0).</span></span>
<span id="cb3-1013"><a href="#cb3-1013" aria-hidden="true"></a>    <span class="kw">if</span> depth &gt; <span class="dv">0</span> &amp;&amp; value.IsValid() &amp;&amp; value.CanInterface() {</span>
<span id="cb3-1014"><a href="#cb3-1014" aria-hidden="true"></a>        p.arg = value.Interface()</span>
<span id="cb3-1015"><a href="#cb3-1015" aria-hidden="true"></a>        <span class="kw">if</span> p.handleMethods(verb) {</span>
<span id="cb3-1016"><a href="#cb3-1016" aria-hidden="true"></a>            <span class="kw">return</span></span>
<span id="cb3-1017"><a href="#cb3-1017" aria-hidden="true"></a>        }</span>
<span id="cb3-1018"><a href="#cb3-1018" aria-hidden="true"></a>    }</span>
<span id="cb3-1019"><a href="#cb3-1019" aria-hidden="true"></a>    p.arg = <span class="ot">nil</span></span>
<span id="cb3-1020"><a href="#cb3-1020" aria-hidden="true"></a>    p.value = value</span>
<span id="cb3-1021"><a href="#cb3-1021" aria-hidden="true"></a></span>
<span id="cb3-1022"><a href="#cb3-1022" aria-hidden="true"></a>    <span class="kw">switch</span> f := value; value.Kind() {</span>
<span id="cb3-1023"><a href="#cb3-1023" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Invalid:</span>
<span id="cb3-1024"><a href="#cb3-1024" aria-hidden="true"></a>        <span class="kw">if</span> depth == <span class="dv">0</span> {</span>
<span id="cb3-1025"><a href="#cb3-1025" aria-hidden="true"></a>            p.buf.writeString(invReflectString)</span>
<span id="cb3-1026"><a href="#cb3-1026" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-1027"><a href="#cb3-1027" aria-hidden="true"></a>            <span class="kw">switch</span> verb {</span>
<span id="cb3-1028"><a href="#cb3-1028" aria-hidden="true"></a>            <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>:</span>
<span id="cb3-1029"><a href="#cb3-1029" aria-hidden="true"></a>                p.buf.writeString(nilAngleString)</span>
<span id="cb3-1030"><a href="#cb3-1030" aria-hidden="true"></a>            <span class="kw">default</span>:</span>
<span id="cb3-1031"><a href="#cb3-1031" aria-hidden="true"></a>                p.badVerb(verb)</span>
<span id="cb3-1032"><a href="#cb3-1032" aria-hidden="true"></a>            }</span>
<span id="cb3-1033"><a href="#cb3-1033" aria-hidden="true"></a>        }</span>
<span id="cb3-1034"><a href="#cb3-1034" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Bool:</span>
<span id="cb3-1035"><a href="#cb3-1035" aria-hidden="true"></a>        p.fmtBool(f.Bool(), verb)</span>
<span id="cb3-1036"><a href="#cb3-1036" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:</span>
<span id="cb3-1037"><a href="#cb3-1037" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f.Int()), signed, verb)</span>
<span id="cb3-1038"><a href="#cb3-1038" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64, reflect.Uintptr:</span>
<span id="cb3-1039"><a href="#cb3-1039" aria-hidden="true"></a>        p.fmtInteger(f.Uint(), unsigned, verb)</span>
<span id="cb3-1040"><a href="#cb3-1040" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Float32:</span>
<span id="cb3-1041"><a href="#cb3-1041" aria-hidden="true"></a>        p.fmtFloat(f.Float(), <span class="dv">32</span>, verb)</span>
<span id="cb3-1042"><a href="#cb3-1042" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Float64:</span>
<span id="cb3-1043"><a href="#cb3-1043" aria-hidden="true"></a>        p.fmtFloat(f.Float(), <span class="dv">64</span>, verb)</span>
<span id="cb3-1044"><a href="#cb3-1044" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Complex64:</span>
<span id="cb3-1045"><a href="#cb3-1045" aria-hidden="true"></a>        p.fmtComplex(f.Complex(), <span class="dv">64</span>, verb)</span>
<span id="cb3-1046"><a href="#cb3-1046" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Complex128:</span>
<span id="cb3-1047"><a href="#cb3-1047" aria-hidden="true"></a>        p.fmtComplex(f.Complex(), <span class="dv">128</span>, verb)</span>
<span id="cb3-1048"><a href="#cb3-1048" aria-hidden="true"></a>    <span class="kw">case</span> reflect.String:</span>
<span id="cb3-1049"><a href="#cb3-1049" aria-hidden="true"></a>        p.fmtString(f.String(), verb)</span>
<span id="cb3-1050"><a href="#cb3-1050" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Map:</span>
<span id="cb3-1051"><a href="#cb3-1051" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1052"><a href="#cb3-1052" aria-hidden="true"></a>            p.buf.writeString(f.Type().String())</span>
<span id="cb3-1053"><a href="#cb3-1053" aria-hidden="true"></a>            <span class="kw">if</span> f.IsNil() {</span>
<span id="cb3-1054"><a href="#cb3-1054" aria-hidden="true"></a>                p.buf.writeString(nilParenString)</span>
<span id="cb3-1055"><a href="#cb3-1055" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-1056"><a href="#cb3-1056" aria-hidden="true"></a>            }</span>
<span id="cb3-1057"><a href="#cb3-1057" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;{&#39;</span>)</span>
<span id="cb3-1058"><a href="#cb3-1058" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-1059"><a href="#cb3-1059" aria-hidden="true"></a>            p.buf.writeString(mapString)</span>
<span id="cb3-1060"><a href="#cb3-1060" aria-hidden="true"></a>        }</span>
<span id="cb3-1061"><a href="#cb3-1061" aria-hidden="true"></a>        sorted := fmtsort.Sort(f)</span>
<span id="cb3-1062"><a href="#cb3-1062" aria-hidden="true"></a>        <span class="kw">for</span> i, key := <span class="kw">range</span> sorted.Key {</span>
<span id="cb3-1063"><a href="#cb3-1063" aria-hidden="true"></a>            <span class="kw">if</span> i &gt; <span class="dv">0</span> {</span>
<span id="cb3-1064"><a href="#cb3-1064" aria-hidden="true"></a>                <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1065"><a href="#cb3-1065" aria-hidden="true"></a>                    p.buf.writeString(commaSpaceString)</span>
<span id="cb3-1066"><a href="#cb3-1066" aria-hidden="true"></a>                } <span class="kw">else</span> {</span>
<span id="cb3-1067"><a href="#cb3-1067" aria-hidden="true"></a>                    p.buf.writeByte(<span class="ch">&#39; &#39;</span>)</span>
<span id="cb3-1068"><a href="#cb3-1068" aria-hidden="true"></a>                }</span>
<span id="cb3-1069"><a href="#cb3-1069" aria-hidden="true"></a>            }</span>
<span id="cb3-1070"><a href="#cb3-1070" aria-hidden="true"></a>            p.printValue(key, verb, depth+<span class="dv">1</span>)</span>
<span id="cb3-1071"><a href="#cb3-1071" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;:&#39;</span>)</span>
<span id="cb3-1072"><a href="#cb3-1072" aria-hidden="true"></a>            p.printValue(sorted.Value[i], verb, depth+<span class="dv">1</span>)</span>
<span id="cb3-1073"><a href="#cb3-1073" aria-hidden="true"></a>        }</span>
<span id="cb3-1074"><a href="#cb3-1074" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1075"><a href="#cb3-1075" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;}&#39;</span>)</span>
<span id="cb3-1076"><a href="#cb3-1076" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-1077"><a href="#cb3-1077" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;]&#39;</span>)</span>
<span id="cb3-1078"><a href="#cb3-1078" aria-hidden="true"></a>        }</span>
<span id="cb3-1079"><a href="#cb3-1079" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Struct:</span>
<span id="cb3-1080"><a href="#cb3-1080" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1081"><a href="#cb3-1081" aria-hidden="true"></a>            p.buf.writeString(f.Type().String())</span>
<span id="cb3-1082"><a href="#cb3-1082" aria-hidden="true"></a>        }</span>
<span id="cb3-1083"><a href="#cb3-1083" aria-hidden="true"></a>        p.buf.writeByte(<span class="ch">&#39;{&#39;</span>)</span>
<span id="cb3-1084"><a href="#cb3-1084" aria-hidden="true"></a>        <span class="kw">for</span> i := <span class="dv">0</span>; i &lt; f.NumField(); i++ {</span>
<span id="cb3-1085"><a href="#cb3-1085" aria-hidden="true"></a>            <span class="kw">if</span> i &gt; <span class="dv">0</span> {</span>
<span id="cb3-1086"><a href="#cb3-1086" aria-hidden="true"></a>                <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1087"><a href="#cb3-1087" aria-hidden="true"></a>                    p.buf.writeString(commaSpaceString)</span>
<span id="cb3-1088"><a href="#cb3-1088" aria-hidden="true"></a>                } <span class="kw">else</span> {</span>
<span id="cb3-1089"><a href="#cb3-1089" aria-hidden="true"></a>                    p.buf.writeByte(<span class="ch">&#39; &#39;</span>)</span>
<span id="cb3-1090"><a href="#cb3-1090" aria-hidden="true"></a>                }</span>
<span id="cb3-1091"><a href="#cb3-1091" aria-hidden="true"></a>            }</span>
<span id="cb3-1092"><a href="#cb3-1092" aria-hidden="true"></a>            <span class="kw">if</span> p.fmt.plusV || p.fmt.sharpV {</span>
<span id="cb3-1093"><a href="#cb3-1093" aria-hidden="true"></a>                <span class="kw">if</span> name := f.Type().Field(i).Name; name != <span class="st">&quot;&quot;</span> {</span>
<span id="cb3-1094"><a href="#cb3-1094" aria-hidden="true"></a>                    p.buf.writeString(name)</span>
<span id="cb3-1095"><a href="#cb3-1095" aria-hidden="true"></a>                    p.buf.writeByte(<span class="ch">&#39;:&#39;</span>)</span>
<span id="cb3-1096"><a href="#cb3-1096" aria-hidden="true"></a>                }</span>
<span id="cb3-1097"><a href="#cb3-1097" aria-hidden="true"></a>            }</span>
<span id="cb3-1098"><a href="#cb3-1098" aria-hidden="true"></a>            p.printValue(getField(f, i), verb, depth+<span class="dv">1</span>)</span>
<span id="cb3-1099"><a href="#cb3-1099" aria-hidden="true"></a>        }</span>
<span id="cb3-1100"><a href="#cb3-1100" aria-hidden="true"></a>        p.buf.writeByte(<span class="ch">&#39;}&#39;</span>)</span>
<span id="cb3-1101"><a href="#cb3-1101" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Interface:</span>
<span id="cb3-1102"><a href="#cb3-1102" aria-hidden="true"></a>        value := f.Elem()</span>
<span id="cb3-1103"><a href="#cb3-1103" aria-hidden="true"></a>        <span class="kw">if</span> !value.IsValid() {</span>
<span id="cb3-1104"><a href="#cb3-1104" aria-hidden="true"></a>            <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1105"><a href="#cb3-1105" aria-hidden="true"></a>                p.buf.writeString(f.Type().String())</span>
<span id="cb3-1106"><a href="#cb3-1106" aria-hidden="true"></a>                p.buf.writeString(nilParenString)</span>
<span id="cb3-1107"><a href="#cb3-1107" aria-hidden="true"></a>            } <span class="kw">else</span> {</span>
<span id="cb3-1108"><a href="#cb3-1108" aria-hidden="true"></a>                p.buf.writeString(nilAngleString)</span>
<span id="cb3-1109"><a href="#cb3-1109" aria-hidden="true"></a>            }</span>
<span id="cb3-1110"><a href="#cb3-1110" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-1111"><a href="#cb3-1111" aria-hidden="true"></a>            p.printValue(value, verb, depth+<span class="dv">1</span>)</span>
<span id="cb3-1112"><a href="#cb3-1112" aria-hidden="true"></a>        }</span>
<span id="cb3-1113"><a href="#cb3-1113" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Array, reflect.Slice:</span>
<span id="cb3-1114"><a href="#cb3-1114" aria-hidden="true"></a>        <span class="kw">switch</span> verb {</span>
<span id="cb3-1115"><a href="#cb3-1115" aria-hidden="true"></a>        <span class="kw">case</span> <span class="ch">&#39;s&#39;</span>, <span class="ch">&#39;q&#39;</span>, <span class="ch">&#39;x&#39;</span>, <span class="ch">&#39;X&#39;</span>:</span>
<span id="cb3-1116"><a href="#cb3-1116" aria-hidden="true"></a>            <span class="co">// Handle byte and uint8 slices and arrays special for the above verbs.</span></span>
<span id="cb3-1117"><a href="#cb3-1117" aria-hidden="true"></a>            t := f.Type()</span>
<span id="cb3-1118"><a href="#cb3-1118" aria-hidden="true"></a>            <span class="kw">if</span> t.Elem().Kind() == reflect.Uint8 {</span>
<span id="cb3-1119"><a href="#cb3-1119" aria-hidden="true"></a>                <span class="kw">var</span> bytes []<span class="dt">byte</span></span>
<span id="cb3-1120"><a href="#cb3-1120" aria-hidden="true"></a>                <span class="kw">if</span> f.Kind() == reflect.Slice {</span>
<span id="cb3-1121"><a href="#cb3-1121" aria-hidden="true"></a>                    bytes = f.Bytes()</span>
<span id="cb3-1122"><a href="#cb3-1122" aria-hidden="true"></a>                } <span class="kw">else</span> <span class="kw">if</span> f.CanAddr() {</span>
<span id="cb3-1123"><a href="#cb3-1123" aria-hidden="true"></a>                    bytes = f.Slice(<span class="dv">0</span>, f.Len()).Bytes()</span>
<span id="cb3-1124"><a href="#cb3-1124" aria-hidden="true"></a>                } <span class="kw">else</span> {</span>
<span id="cb3-1125"><a href="#cb3-1125" aria-hidden="true"></a>                    <span class="co">// We have an array, but we cannot Slice() a non-addressable array,</span></span>
<span id="cb3-1126"><a href="#cb3-1126" aria-hidden="true"></a>                    <span class="co">// so we build a slice by hand. This is a rare case but it would be nice</span></span>
<span id="cb3-1127"><a href="#cb3-1127" aria-hidden="true"></a>                    <span class="co">// if reflection could help a little more.</span></span>
<span id="cb3-1128"><a href="#cb3-1128" aria-hidden="true"></a>                    bytes = <span class="bu">make</span>([]<span class="dt">byte</span>, f.Len())</span>
<span id="cb3-1129"><a href="#cb3-1129" aria-hidden="true"></a>                    <span class="kw">for</span> i := <span class="kw">range</span> bytes {</span>
<span id="cb3-1130"><a href="#cb3-1130" aria-hidden="true"></a>                        bytes[i] = <span class="dt">byte</span>(f.Index(i).Uint())</span>
<span id="cb3-1131"><a href="#cb3-1131" aria-hidden="true"></a>                    }</span>
<span id="cb3-1132"><a href="#cb3-1132" aria-hidden="true"></a>                }</span>
<span id="cb3-1133"><a href="#cb3-1133" aria-hidden="true"></a>                p.fmtBytes(bytes, verb, t.String())</span>
<span id="cb3-1134"><a href="#cb3-1134" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-1135"><a href="#cb3-1135" aria-hidden="true"></a>            }</span>
<span id="cb3-1136"><a href="#cb3-1136" aria-hidden="true"></a>        }</span>
<span id="cb3-1137"><a href="#cb3-1137" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1138"><a href="#cb3-1138" aria-hidden="true"></a>            p.buf.writeString(f.Type().String())</span>
<span id="cb3-1139"><a href="#cb3-1139" aria-hidden="true"></a>            <span class="kw">if</span> f.Kind() == reflect.Slice &amp;&amp; f.IsNil() {</span>
<span id="cb3-1140"><a href="#cb3-1140" aria-hidden="true"></a>                p.buf.writeString(nilParenString)</span>
<span id="cb3-1141"><a href="#cb3-1141" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-1142"><a href="#cb3-1142" aria-hidden="true"></a>            }</span>
<span id="cb3-1143"><a href="#cb3-1143" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;{&#39;</span>)</span>
<span id="cb3-1144"><a href="#cb3-1144" aria-hidden="true"></a>            <span class="kw">for</span> i := <span class="dv">0</span>; i &lt; f.Len(); i++ {</span>
<span id="cb3-1145"><a href="#cb3-1145" aria-hidden="true"></a>                <span class="kw">if</span> i &gt; <span class="dv">0</span> {</span>
<span id="cb3-1146"><a href="#cb3-1146" aria-hidden="true"></a>                    p.buf.writeString(commaSpaceString)</span>
<span id="cb3-1147"><a href="#cb3-1147" aria-hidden="true"></a>                }</span>
<span id="cb3-1148"><a href="#cb3-1148" aria-hidden="true"></a>                p.printValue(f.Index(i), verb, depth+<span class="dv">1</span>)</span>
<span id="cb3-1149"><a href="#cb3-1149" aria-hidden="true"></a>            }</span>
<span id="cb3-1150"><a href="#cb3-1150" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;}&#39;</span>)</span>
<span id="cb3-1151"><a href="#cb3-1151" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-1152"><a href="#cb3-1152" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;[&#39;</span>)</span>
<span id="cb3-1153"><a href="#cb3-1153" aria-hidden="true"></a>            <span class="kw">for</span> i := <span class="dv">0</span>; i &lt; f.Len(); i++ {</span>
<span id="cb3-1154"><a href="#cb3-1154" aria-hidden="true"></a>                <span class="kw">if</span> i &gt; <span class="dv">0</span> {</span>
<span id="cb3-1155"><a href="#cb3-1155" aria-hidden="true"></a>                    p.buf.writeByte(<span class="ch">&#39; &#39;</span>)</span>
<span id="cb3-1156"><a href="#cb3-1156" aria-hidden="true"></a>                }</span>
<span id="cb3-1157"><a href="#cb3-1157" aria-hidden="true"></a>                p.printValue(f.Index(i), verb, depth+<span class="dv">1</span>)</span>
<span id="cb3-1158"><a href="#cb3-1158" aria-hidden="true"></a>            }</span>
<span id="cb3-1159"><a href="#cb3-1159" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;]&#39;</span>)</span>
<span id="cb3-1160"><a href="#cb3-1160" aria-hidden="true"></a>        }</span>
<span id="cb3-1161"><a href="#cb3-1161" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Pointer:</span>
<span id="cb3-1162"><a href="#cb3-1162" aria-hidden="true"></a>        <span class="co">// pointer to array or slice or struct? ok at top level</span></span>
<span id="cb3-1163"><a href="#cb3-1163" aria-hidden="true"></a>        <span class="co">// but not embedded (avoid loops)</span></span>
<span id="cb3-1164"><a href="#cb3-1164" aria-hidden="true"></a>        <span class="kw">if</span> depth == <span class="dv">0</span> &amp;&amp; f.Pointer() != <span class="dv">0</span> {</span>
<span id="cb3-1165"><a href="#cb3-1165" aria-hidden="true"></a>            <span class="kw">switch</span> a := f.Elem(); a.Kind() {</span>
<span id="cb3-1166"><a href="#cb3-1166" aria-hidden="true"></a>            <span class="kw">case</span> reflect.Array, reflect.Slice, reflect.Struct, reflect.Map:</span>
<span id="cb3-1167"><a href="#cb3-1167" aria-hidden="true"></a>                p.buf.writeByte(<span class="ch">&#39;&amp;&#39;</span>)</span>
<span id="cb3-1168"><a href="#cb3-1168" aria-hidden="true"></a>                p.printValue(a, verb, depth+<span class="dv">1</span>)</span>
<span id="cb3-1169"><a href="#cb3-1169" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-1170"><a href="#cb3-1170" aria-hidden="true"></a>            }</span>
<span id="cb3-1171"><a href="#cb3-1171" aria-hidden="true"></a>        }</span>
<span id="cb3-1172"><a href="#cb3-1172" aria-hidden="true"></a>        <span class="kw">fallthrough</span></span>
<span id="cb3-1173"><a href="#cb3-1173" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Chan, reflect.Func, reflect.UnsafePointer:</span>
<span id="cb3-1174"><a href="#cb3-1174" aria-hidden="true"></a>        p.fmtPointer(f, verb)</span>
<span id="cb3-1175"><a href="#cb3-1175" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-1176"><a href="#cb3-1176" aria-hidden="true"></a>        p.unknownType(f)</span>
<span id="cb3-1177"><a href="#cb3-1177" aria-hidden="true"></a>    }</span>
<span id="cb3-1178"><a href="#cb3-1178" aria-hidden="true"></a>}</span>
<span id="cb3-1179"><a href="#cb3-1179" aria-hidden="true"></a></span>
<span id="cb3-1180"><a href="#cb3-1180" aria-hidden="true"></a><span class="kw">func</span> (p *pp) fmtBytes(v []<span class="dt">byte</span>, verb <span class="dt">rune</span>, typeString <span class="dt">string</span>) {</span>
<span id="cb3-1181"><a href="#cb3-1181" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-1182"><a href="#cb3-1182" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;v&#39;</span>, <span class="ch">&#39;d&#39;</span>:</span>
<span id="cb3-1183"><a href="#cb3-1183" aria-hidden="true"></a>        <span class="kw">if</span> p.fmt.sharpV {</span>
<span id="cb3-1184"><a href="#cb3-1184" aria-hidden="true"></a>            p.buf.writeString(typeString)</span>
<span id="cb3-1185"><a href="#cb3-1185" aria-hidden="true"></a>            <span class="kw">if</span> v == <span class="ot">nil</span> {</span>
<span id="cb3-1186"><a href="#cb3-1186" aria-hidden="true"></a>                p.buf.writeString(nilParenString)</span>
<span id="cb3-1187"><a href="#cb3-1187" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-1188"><a href="#cb3-1188" aria-hidden="true"></a>            }</span>
<span id="cb3-1189"><a href="#cb3-1189" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;{&#39;</span>)</span>
<span id="cb3-1190"><a href="#cb3-1190" aria-hidden="true"></a>            <span class="kw">for</span> i, c := <span class="kw">range</span> v {</span>
<span id="cb3-1191"><a href="#cb3-1191" aria-hidden="true"></a>                <span class="kw">if</span> i &gt; <span class="dv">0</span> {</span>
<span id="cb3-1192"><a href="#cb3-1192" aria-hidden="true"></a>                    p.buf.writeString(commaSpaceString)</span>
<span id="cb3-1193"><a href="#cb3-1193" aria-hidden="true"></a>                }</span>
<span id="cb3-1194"><a href="#cb3-1194" aria-hidden="true"></a>                p.fmt0x64(<span class="dt">uint64</span>(c), <span class="ot">true</span>)</span>
<span id="cb3-1195"><a href="#cb3-1195" aria-hidden="true"></a>            }</span>
<span id="cb3-1196"><a href="#cb3-1196" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;}&#39;</span>)</span>
<span id="cb3-1197"><a href="#cb3-1197" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb3-1198"><a href="#cb3-1198" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;[&#39;</span>)</span>
<span id="cb3-1199"><a href="#cb3-1199" aria-hidden="true"></a>            <span class="kw">for</span> i, c := <span class="kw">range</span> v {</span>
<span id="cb3-1200"><a href="#cb3-1200" aria-hidden="true"></a>                <span class="kw">if</span> i &gt; <span class="dv">0</span> {</span>
<span id="cb3-1201"><a href="#cb3-1201" aria-hidden="true"></a>                    p.buf.writeByte(<span class="ch">&#39; &#39;</span>)</span>
<span id="cb3-1202"><a href="#cb3-1202" aria-hidden="true"></a>                }</span>
<span id="cb3-1203"><a href="#cb3-1203" aria-hidden="true"></a>                p.fmt.fmtInteger(<span class="dt">uint64</span>(c), <span class="dv">10</span>, unsigned, verb, ldigits)</span>
<span id="cb3-1204"><a href="#cb3-1204" aria-hidden="true"></a>            }</span>
<span id="cb3-1205"><a href="#cb3-1205" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39;]&#39;</span>)</span>
<span id="cb3-1206"><a href="#cb3-1206" aria-hidden="true"></a>        }</span>
<span id="cb3-1207"><a href="#cb3-1207" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;s&#39;</span>:</span>
<span id="cb3-1208"><a href="#cb3-1208" aria-hidden="true"></a>        p.fmt.fmtBs(v)</span>
<span id="cb3-1209"><a href="#cb3-1209" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;x&#39;</span>:</span>
<span id="cb3-1210"><a href="#cb3-1210" aria-hidden="true"></a>        p.fmt.fmtBx(v, ldigits)</span>
<span id="cb3-1211"><a href="#cb3-1211" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;X&#39;</span>:</span>
<span id="cb3-1212"><a href="#cb3-1212" aria-hidden="true"></a>        p.fmt.fmtBx(v, udigits)</span>
<span id="cb3-1213"><a href="#cb3-1213" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;q&#39;</span>:</span>
<span id="cb3-1214"><a href="#cb3-1214" aria-hidden="true"></a>        p.fmt.fmtQ(<span class="dt">string</span>(v))</span>
<span id="cb3-1215"><a href="#cb3-1215" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-1216"><a href="#cb3-1216" aria-hidden="true"></a>        p.printValue(reflect.ValueOf(v), verb, <span class="dv">0</span>)</span>
<span id="cb3-1217"><a href="#cb3-1217" aria-hidden="true"></a>    }</span>
<span id="cb3-1218"><a href="#cb3-1218" aria-hidden="true"></a>}</span>
<span id="cb3-1219"><a href="#cb3-1219" aria-hidden="true"></a></span>
<span id="cb3-1220"><a href="#cb3-1220" aria-hidden="true"></a><span class="kw">func</span> (p *pp) printArg(arg <span class="kw">interface</span>{}, verb <span class="dt">rune</span>) {</span>
<span id="cb3-1221"><a href="#cb3-1221" aria-hidden="true"></a>    p.arg = arg</span>
<span id="cb3-1222"><a href="#cb3-1222" aria-hidden="true"></a>    p.value = reflect.Value{}</span>
<span id="cb3-1223"><a href="#cb3-1223" aria-hidden="true"></a></span>
<span id="cb3-1224"><a href="#cb3-1224" aria-hidden="true"></a>    <span class="kw">if</span> arg == <span class="ot">nil</span> {</span>
<span id="cb3-1225"><a href="#cb3-1225" aria-hidden="true"></a>        <span class="kw">switch</span> verb {</span>
<span id="cb3-1226"><a href="#cb3-1226" aria-hidden="true"></a>        <span class="kw">case</span> <span class="ch">&#39;T&#39;</span>, <span class="ch">&#39;v&#39;</span>:</span>
<span id="cb3-1227"><a href="#cb3-1227" aria-hidden="true"></a>            p.fmt.padString(nilAngleString)</span>
<span id="cb3-1228"><a href="#cb3-1228" aria-hidden="true"></a>        <span class="kw">default</span>:</span>
<span id="cb3-1229"><a href="#cb3-1229" aria-hidden="true"></a>            p.badVerb(verb)</span>
<span id="cb3-1230"><a href="#cb3-1230" aria-hidden="true"></a>        }</span>
<span id="cb3-1231"><a href="#cb3-1231" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-1232"><a href="#cb3-1232" aria-hidden="true"></a>    }</span>
<span id="cb3-1233"><a href="#cb3-1233" aria-hidden="true"></a></span>
<span id="cb3-1234"><a href="#cb3-1234" aria-hidden="true"></a>    <span class="co">// Special processing considerations.</span></span>
<span id="cb3-1235"><a href="#cb3-1235" aria-hidden="true"></a>    <span class="co">// %T (the value&#39;s type) and %p (its address) are special; we always do them first.</span></span>
<span id="cb3-1236"><a href="#cb3-1236" aria-hidden="true"></a>    <span class="kw">switch</span> verb {</span>
<span id="cb3-1237"><a href="#cb3-1237" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;T&#39;</span>:</span>
<span id="cb3-1238"><a href="#cb3-1238" aria-hidden="true"></a>        p.fmt.fmtS(reflect.TypeOf(arg).String())</span>
<span id="cb3-1239"><a href="#cb3-1239" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-1240"><a href="#cb3-1240" aria-hidden="true"></a>    <span class="kw">case</span> <span class="ch">&#39;p&#39;</span>:</span>
<span id="cb3-1241"><a href="#cb3-1241" aria-hidden="true"></a>        p.fmtPointer(reflect.ValueOf(arg), <span class="ch">&#39;p&#39;</span>)</span>
<span id="cb3-1242"><a href="#cb3-1242" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-1243"><a href="#cb3-1243" aria-hidden="true"></a>    }</span>
<span id="cb3-1244"><a href="#cb3-1244" aria-hidden="true"></a></span>
<span id="cb3-1245"><a href="#cb3-1245" aria-hidden="true"></a>    <span class="co">// Some types can be done without reflection.</span></span>
<span id="cb3-1246"><a href="#cb3-1246" aria-hidden="true"></a>    <span class="kw">switch</span> f := arg.(<span class="kw">type</span>) {</span>
<span id="cb3-1247"><a href="#cb3-1247" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">bool</span>:</span>
<span id="cb3-1248"><a href="#cb3-1248" aria-hidden="true"></a>        p.fmtBool(f, verb)</span>
<span id="cb3-1249"><a href="#cb3-1249" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">float32</span>:</span>
<span id="cb3-1250"><a href="#cb3-1250" aria-hidden="true"></a>        p.fmtFloat(<span class="dt">float64</span>(f), <span class="dv">32</span>, verb)</span>
<span id="cb3-1251"><a href="#cb3-1251" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">float64</span>:</span>
<span id="cb3-1252"><a href="#cb3-1252" aria-hidden="true"></a>        p.fmtFloat(f, <span class="dv">64</span>, verb)</span>
<span id="cb3-1253"><a href="#cb3-1253" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">complex64</span>:</span>
<span id="cb3-1254"><a href="#cb3-1254" aria-hidden="true"></a>        p.fmtComplex(<span class="dt">complex128</span>(f), <span class="dv">64</span>, verb)</span>
<span id="cb3-1255"><a href="#cb3-1255" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">complex128</span>:</span>
<span id="cb3-1256"><a href="#cb3-1256" aria-hidden="true"></a>        p.fmtComplex(f, <span class="dv">128</span>, verb)</span>
<span id="cb3-1257"><a href="#cb3-1257" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">int</span>:</span>
<span id="cb3-1258"><a href="#cb3-1258" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), signed, verb)</span>
<span id="cb3-1259"><a href="#cb3-1259" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">int8</span>:</span>
<span id="cb3-1260"><a href="#cb3-1260" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), signed, verb)</span>
<span id="cb3-1261"><a href="#cb3-1261" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">int16</span>:</span>
<span id="cb3-1262"><a href="#cb3-1262" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), signed, verb)</span>
<span id="cb3-1263"><a href="#cb3-1263" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">int32</span>:</span>
<span id="cb3-1264"><a href="#cb3-1264" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), signed, verb)</span>
<span id="cb3-1265"><a href="#cb3-1265" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">int64</span>:</span>
<span id="cb3-1266"><a href="#cb3-1266" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), signed, verb)</span>
<span id="cb3-1267"><a href="#cb3-1267" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">uint</span>:</span>
<span id="cb3-1268"><a href="#cb3-1268" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), unsigned, verb)</span>
<span id="cb3-1269"><a href="#cb3-1269" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">uint8</span>:</span>
<span id="cb3-1270"><a href="#cb3-1270" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), unsigned, verb)</span>
<span id="cb3-1271"><a href="#cb3-1271" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">uint16</span>:</span>
<span id="cb3-1272"><a href="#cb3-1272" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), unsigned, verb)</span>
<span id="cb3-1273"><a href="#cb3-1273" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">uint32</span>:</span>
<span id="cb3-1274"><a href="#cb3-1274" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), unsigned, verb)</span>
<span id="cb3-1275"><a href="#cb3-1275" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">uint64</span>:</span>
<span id="cb3-1276"><a href="#cb3-1276" aria-hidden="true"></a>        p.fmtInteger(f, unsigned, verb)</span>
<span id="cb3-1277"><a href="#cb3-1277" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">uintptr</span>:</span>
<span id="cb3-1278"><a href="#cb3-1278" aria-hidden="true"></a>        p.fmtInteger(<span class="dt">uint64</span>(f), unsigned, verb)</span>
<span id="cb3-1279"><a href="#cb3-1279" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">string</span>:</span>
<span id="cb3-1280"><a href="#cb3-1280" aria-hidden="true"></a>        p.fmtString(f, verb)</span>
<span id="cb3-1281"><a href="#cb3-1281" aria-hidden="true"></a>    <span class="kw">case</span> []<span class="dt">byte</span>:</span>
<span id="cb3-1282"><a href="#cb3-1282" aria-hidden="true"></a>        p.fmtBytes(f, verb, <span class="st">&quot;[]byte&quot;</span>)</span>
<span id="cb3-1283"><a href="#cb3-1283" aria-hidden="true"></a>    <span class="kw">case</span> reflect.Value:</span>
<span id="cb3-1284"><a href="#cb3-1284" aria-hidden="true"></a>        <span class="co">// Handle extractable values with special methods</span></span>
<span id="cb3-1285"><a href="#cb3-1285" aria-hidden="true"></a>        <span class="co">// since printValue does not handle them at depth 0.</span></span>
<span id="cb3-1286"><a href="#cb3-1286" aria-hidden="true"></a>        <span class="kw">if</span> f.IsValid() &amp;&amp; f.CanInterface() {</span>
<span id="cb3-1287"><a href="#cb3-1287" aria-hidden="true"></a>            p.arg = f.Interface()</span>
<span id="cb3-1288"><a href="#cb3-1288" aria-hidden="true"></a>            <span class="kw">if</span> p.handleMethods(verb) {</span>
<span id="cb3-1289"><a href="#cb3-1289" aria-hidden="true"></a>                <span class="kw">return</span></span>
<span id="cb3-1290"><a href="#cb3-1290" aria-hidden="true"></a>            }</span>
<span id="cb3-1291"><a href="#cb3-1291" aria-hidden="true"></a>        }</span>
<span id="cb3-1292"><a href="#cb3-1292" aria-hidden="true"></a>        p.printValue(f, verb, <span class="dv">0</span>)</span>
<span id="cb3-1293"><a href="#cb3-1293" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb3-1294"><a href="#cb3-1294" aria-hidden="true"></a>        <span class="co">// If the type is not simple, it might have methods.</span></span>
<span id="cb3-1295"><a href="#cb3-1295" aria-hidden="true"></a>        <span class="kw">if</span> !p.handleMethods(verb) {</span>
<span id="cb3-1296"><a href="#cb3-1296" aria-hidden="true"></a>            <span class="co">// Need to use reflection, since the type had no</span></span>
<span id="cb3-1297"><a href="#cb3-1297" aria-hidden="true"></a>            <span class="co">// interface methods that could be used for formatting.</span></span>
<span id="cb3-1298"><a href="#cb3-1298" aria-hidden="true"></a>            p.printValue(reflect.ValueOf(f), verb, <span class="dv">0</span>)</span>
<span id="cb3-1299"><a href="#cb3-1299" aria-hidden="true"></a>        }</span>
<span id="cb3-1300"><a href="#cb3-1300" aria-hidden="true"></a>    }</span>
<span id="cb3-1301"><a href="#cb3-1301" aria-hidden="true"></a>}</span>
<span id="cb3-1302"><a href="#cb3-1302" aria-hidden="true"></a></span>
<span id="cb3-1303"><a href="#cb3-1303" aria-hidden="true"></a><span class="co">// doPrintln is like doPrint but always adds a space between arguments</span></span>
<span id="cb3-1304"><a href="#cb3-1304" aria-hidden="true"></a><span class="co">// and a newline after the last argument.</span></span>
<span id="cb3-1305"><a href="#cb3-1305" aria-hidden="true"></a><span class="kw">func</span> (p *pp) doPrintln(a []<span class="kw">interface</span>{}) {</span>
<span id="cb3-1306"><a href="#cb3-1306" aria-hidden="true"></a>    <span class="kw">for</span> argNum, arg := <span class="kw">range</span> a {</span>
<span id="cb3-1307"><a href="#cb3-1307" aria-hidden="true"></a>        <span class="kw">if</span> argNum &gt; <span class="dv">0</span> {</span>
<span id="cb3-1308"><a href="#cb3-1308" aria-hidden="true"></a>            p.buf.writeByte(<span class="ch">&#39; &#39;</span>)</span>
<span id="cb3-1309"><a href="#cb3-1309" aria-hidden="true"></a>        }</span>
<span id="cb3-1310"><a href="#cb3-1310" aria-hidden="true"></a>        p.printArg(arg, <span class="ch">&#39;v&#39;</span>)</span>
<span id="cb3-1311"><a href="#cb3-1311" aria-hidden="true"></a>    }</span>
<span id="cb3-1312"><a href="#cb3-1312" aria-hidden="true"></a>    p.buf.writeByte(<span class="ch">&#39;\n&#39;</span>)</span>
<span id="cb3-1313"><a href="#cb3-1313" aria-hidden="true"></a>}</span>
<span id="cb3-1314"><a href="#cb3-1314" aria-hidden="true"></a></span>
<span id="cb3-1315"><a href="#cb3-1315" aria-hidden="true"></a><span class="co">// free saves used pp structs in ppFree; avoids an allocation per invocation.</span></span>
<span id="cb3-1316"><a href="#cb3-1316" aria-hidden="true"></a><span class="kw">func</span> (p *pp) free() {</span>
<span id="cb3-1317"><a href="#cb3-1317" aria-hidden="true"></a>    <span class="co">// Proper usage of a sync.Pool requires each entry to have approximately</span></span>
<span id="cb3-1318"><a href="#cb3-1318" aria-hidden="true"></a>    <span class="co">// the same memory cost. To obtain this property when the stored type</span></span>
<span id="cb3-1319"><a href="#cb3-1319" aria-hidden="true"></a>    <span class="co">// contains a variably-sized buffer, we add a hard limit on the maximum buffer</span></span>
<span id="cb3-1320"><a href="#cb3-1320" aria-hidden="true"></a>    <span class="co">// to place back in the pool.</span></span>
<span id="cb3-1321"><a href="#cb3-1321" aria-hidden="true"></a>    <span class="co">//</span></span>
<span id="cb3-1322"><a href="#cb3-1322" aria-hidden="true"></a>    <span class="co">// See https://golang.org/issue/23199</span></span>
<span id="cb3-1323"><a href="#cb3-1323" aria-hidden="true"></a>    <span class="kw">if</span> <span class="bu">cap</span>(p.buf) &gt; <span class="dv">64</span>&lt;&lt;<span class="dv">10</span> {</span>
<span id="cb3-1324"><a href="#cb3-1324" aria-hidden="true"></a>        <span class="kw">return</span></span>
<span id="cb3-1325"><a href="#cb3-1325" aria-hidden="true"></a>    }</span>
<span id="cb3-1326"><a href="#cb3-1326" aria-hidden="true"></a></span>
<span id="cb3-1327"><a href="#cb3-1327" aria-hidden="true"></a>    p.buf = p.buf[:<span class="dv">0</span>]</span>
<span id="cb3-1328"><a href="#cb3-1328" aria-hidden="true"></a>    p.arg = <span class="ot">nil</span></span>
<span id="cb3-1329"><a href="#cb3-1329" aria-hidden="true"></a>    p.value = reflect.Value{}</span>
<span id="cb3-1330"><a href="#cb3-1330" aria-hidden="true"></a>    p.wrappedErr = <span class="ot">nil</span></span>
<span id="cb3-1331"><a href="#cb3-1331" aria-hidden="true"></a>    ppFree.Put(p)</span>
<span id="cb3-1332"><a href="#cb3-1332" aria-hidden="true"></a>}</span>
<span id="cb3-1333"><a href="#cb3-1333" aria-hidden="true"></a></span>
<span id="cb3-1334"><a href="#cb3-1334" aria-hidden="true"></a><span class="co">// what started all of this</span></span>
<span id="cb3-1335"><a href="#cb3-1335" aria-hidden="true"></a><span class="kw">func</span> fprintln(w io.Writer, a ...<span class="kw">interface</span>{}) (n <span class="dt">int</span>, err <span class="dt">error</span>) {</span>
<span id="cb3-1336"><a href="#cb3-1336" aria-hidden="true"></a>    p := newPrinter()</span>
<span id="cb3-1337"><a href="#cb3-1337" aria-hidden="true"></a>    p.doPrintln(a)</span>
<span id="cb3-1338"><a href="#cb3-1338" aria-hidden="true"></a>    n, err = w.Write(p.buf)</span>
<span id="cb3-1339"><a href="#cb3-1339" aria-hidden="true"></a>    p.free()</span>
<span id="cb3-1340"><a href="#cb3-1340" aria-hidden="true"></a>    <span class="kw">return</span></span>
<span id="cb3-1341"><a href="#cb3-1341" aria-hidden="true"></a>}</span></code></pre></div>
<p>Things learnt from this exercise</p>
<ul>
<li>IO has a lot of moving parts.</li>
<li>any is used to mean interface{}</li>
<li>go has structs</li>
<li>go functions can be implemented against specific objects.</li>
<li></li>
</ul>
<h3 id="interface"><code>interface{}</code></h3>
<ul>
<li><a href="https://stackoverflow.com/questions/59976812/empty-interfaces-in-golang">https://stackoverflow.com/questions/59976812/empty-interfaces-in-golang</a></li>
<li><a href="https://go.dev/tour/methods/14">https://go.dev/tour/methods/14</a></li>
<li>At runtime, any value can be assigned to the variable that is marked <code>interface{}</code>.
<ul>
<li>This is similar to JS, where you can assign any value to any variable at execution time.</li>
</ul></li>
</ul>
<h4 id="empty-interface.go">empty-interface.go</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="kw">import</span> <span class="st">&quot;fmt&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    <span class="kw">var</span> i <span class="kw">interface</span>{}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>    describe(i)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>    i = <span class="dv">42</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>    describe(i)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>    i = <span class="st">&quot;hello&quot;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>    describe(i)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>}</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a><span class="kw">func</span> describe(i <span class="kw">interface</span>{}) {</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>    fmt.Printf(<span class="st">&quot;(%v, %T)</span><span class="ch">\n</span><span class="st">&quot;</span>, i, i)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>}</span></code></pre></div>
<figure>
<img src="1.empty-interface.png" alt="" /><figcaption>1.empty-interface</figcaption>
</figure>
<p><a href="https://stackoverflow.com/questions/23148812/whats-the-meaning-of-interface">https://stackoverflow.com/questions/23148812/whats-the-meaning-of-interface</a></p>
<h3 id="struct">struct</h3>
<p><code>type name struct{ }</code> is what creates a struct named “name”.</p>
<h2 id="write-some-code">write some code</h2>
<h3 id="echo-function-1">echo function #1</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>    echo()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a><span class="kw">func</span> echo() {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>    <span class="kw">for</span> _, arg := <span class="kw">range</span> os.Args[<span class="dv">1</span>:] {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>        fmt.Println(arg)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>    }</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a></span></code></pre></div>
<pre class="shell"><code>./echo-one third second first                                     
third
second
first
</code></pre>
<p>Basically we are ranging over Slice of arguments.</p>
<p>I do not know what a Slice is, but it feels like that it is basically a JavaScript style array, that is, it is dynamically sized.</p>
<h3 id="echo-function-2">echo function #2</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>    echo2()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>}</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a><span class="kw">func</span> echo2() {</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a>    <span class="kw">var</span> str, sep <span class="dt">string</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>    <span class="kw">for</span> i := <span class="dv">1</span>; i &lt; <span class="bu">len</span>(os.Args); i++ {</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>        str += sep + os.Args[i]</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>        sep += <span class="st">&quot; &quot;</span> <span class="co">// lol this logic... deliberate though</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>    }</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a>    fmt.Println(str)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a>}</span></code></pre></div>
<pre class="shell"><code>./echo-two oompa loompa goomba zumba roomba harambe bombay tomboy ohboy yayyayyay
oompa loompa  goomba   zumba    roomba     harambe      bombay       tomboy        ohboy         yayyayyay
</code></pre>
<figure>
<img src="2.the-universe-is-expanding.png" alt="" /><figcaption>2.the-universe-is-expanding</figcaption>
</figure>
<p>In this function, we are dealing with the Slice in a more hands-on way, where we have to write logic for access and increment of index.</p>
<p>In the example #1, we were using in-build feature to do this automagically for us.</p>
<p>Also, note that when we say <code>var str, sep string</code> we are not providing any value to str or sep. These variables end up receiving default values.</p>
<p>These are called zero values in go, such as 0 for int and empty string "" for string types.</p>
<h2 id="other-interesting-things-in-os-package">Other interesting things in os package</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>    fmt.Println(os.Environ())</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>}</span></code></pre></div>
<pre class="shell"><code>./env                                                                            
[PATH=/usr/lib/go-1.17/bin:/home/f0c1s/go/bin:
... so on...</code></pre>
<p>There are bunch of things that I think I will be using soon enough…</p>
<h2 id="reading-a-file-in-go">Reading a file in go</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>    data, err := os.ReadFile(os.Args[<span class="dv">1</span>])</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>    <span class="kw">if</span> err != <span class="ot">nil</span> {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>        <span class="bu">panic</span>(err)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>    }</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>    fmt.Println(data)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>    fmt.Println(<span class="dt">string</span>(data))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>}</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a></span></code></pre></div>
<pre class="shell"><code>go build read-file.go
./read-file read-file.go
[112 97 99 107 97 103 101 32 109 97 105 110 10 10 105 109 112 111 114 116 32 40 10 9 34 102 109 116 34 10 9 34 111 115 34 10 41 10 10 102 117 110 99 32 109 97 105 110 40 41 32 123 10 9 100 97 116 97 44 32 101 114 114 32 58 61 32 111 115 46 82 101 97 100 70 105 108 101 40 111 115 46 65 114 103 115 91 49 93 41 10 9 105 102 32 101 114 114 32 33 61 32 110 105 108 32 123 10 9 9 112 97 110 105 99 40 101 114 114 41 10 9 125 10 9 102 109 116 46 80 114 105 110 116 108 110 40 100 97 116 97 41 10 9 102 109 116 46 80 114 105 110 116 108 110 40 115 116 114 105 110 103 40 100 97 116 97 41 41 10 125 10]
package main

import (
        &quot;fmt&quot;
        &quot;os&quot;
)

func main() {
        data, err := os.ReadFile(os.Args[1])
        if err != nil {
                panic(err)
        }
        fmt.Println(data)
        fmt.Println(string(data))
}
</code></pre>
<h3 id="reading-a-file-and-reversing-the-input-linewise">Reading a file and reversing the input linewise</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>    <span class="st">&quot;strings&quot;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>    fileData, err := os.ReadFile(os.Args[<span class="dv">1</span>])</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>    <span class="kw">if</span> err != <span class="ot">nil</span> {</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a>        <span class="bu">panic</span>(err)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>    }</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a>    fileLines := strings.Split(<span class="dt">string</span>(fileData), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a>    <span class="co">// only way to reverse a slice in Go: wut?</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a>    <span class="kw">for</span> i, j := <span class="dv">0</span>, <span class="bu">len</span>(fileLines)-<span class="dv">1</span>; i &lt; j; i, j = i+<span class="dv">1</span>, j<span class="dv">-1</span> {</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a>        fileLines[i], fileLines[j] = fileLines[j], fileLines[i]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>    }</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a>    <span class="kw">for</span> _, line := <span class="kw">range</span> fileLines {</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true"></a>        fmt.Println(line)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true"></a>    }</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true"></a>}</span></code></pre></div>
<pre class="shell"><code>go build split-lines.go
./split-lines split-lines.go

}
        }
                fmt.Println(line)
        for _, line := range fileLines {

        }
                fileLines[i], fileLines[j] = fileLines[j], fileLines[i]
        for i, j := 0, len(fileLines)-1; i &lt; j; i, j = i+1, j-1 {
        // only way to reverse a slice in Go: wut?

        fileLines := strings.Split(string(fileData), &quot;\n&quot;)
        }
                panic(err)
        if err != nil {
        fileData, err := os.ReadFile(os.Args[1])
func main() {

)
        &quot;strings&quot;
        &quot;os&quot;
        &quot;fmt&quot;
import (

package main
</code></pre>
<h4 id="now-reverse-each-string-too">now reverse each string too…</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="kw">import</span> (</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>    <span class="st">&quot;strings&quot;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>    fileData, err := os.ReadFile(os.Args[<span class="dv">1</span>])</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>    <span class="kw">if</span> err != <span class="ot">nil</span> {</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>        <span class="bu">panic</span>(err)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a>    }</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>    fileLines := strings.Split(<span class="dt">string</span>(fileData), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a>    <span class="co">// reverse the whole file, first to last, second to second-last...</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a>    <span class="kw">for</span> i, j := <span class="dv">0</span>, <span class="bu">len</span>(fileLines)-<span class="dv">1</span>; i &lt; j; i, j = i+<span class="dv">1</span>, j<span class="dv">-1</span> {</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a>        <span class="co">// reverse ith line</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a>        ith := []<span class="dt">rune</span>(fileLines[i])</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>        <span class="kw">for</span> k, l := <span class="dv">0</span>, <span class="bu">len</span>(ith)-<span class="dv">1</span>; k &lt; l; k, l = k+<span class="dv">1</span>, l<span class="dv">-1</span> {</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a>            ith[k], ith[l] = ith[l], ith[k]</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true"></a>        }</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true"></a>        <span class="co">// reverse jth line</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true"></a>        jth := []<span class="dt">rune</span>(fileLines[j])</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true"></a>        <span class="kw">for</span> k, l := <span class="dv">0</span>, <span class="bu">len</span>(jth)-<span class="dv">1</span>; k &lt; l; k, l = k+<span class="dv">1</span>, l<span class="dv">-1</span> {</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true"></a>            jth[k], jth[l] = jth[l], jth[k]</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true"></a>        }</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true"></a>        fileLines[i], fileLines[j] = <span class="dt">string</span>(jth), <span class="dt">string</span>(ith)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true"></a>    }</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true"></a>    <span class="kw">for</span> _, line := <span class="kw">range</span> fileLines {</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true"></a>        fmt.Println(line)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true"></a>    }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true"></a>}</span></code></pre></div>
<pre class="shell"><code>go build reversed-lines.go
./reversed-lines reversed-lines.go

}
}       
)enil(nltnirP.tmf               
{ seniLelif egnar =: enil ,_ rof        

}       
)hti(gnirts ,)htj(gnirts = ]j[seniLelif ,]i[seniLelif           
}               
]k[htj ,]l[htj = ]l[htj ,]k[htj                 
{ 1-l ,1+k = l ,k ;l &lt; k ;1-)htj(nel ,0 =: l ,k rof             
}               
]k[hti ,]l[hti = ]l[hti ,]k[hti                 
{ 1-l ,1+k = l ,k ;l &lt; k ;1-)hti(nel ,0 =: l ,k rof             
)]j[seniLelif(enur][ =: htj             
)]i[seniLelif(enur][ =: hti             
        for i, j := 0, len(fileLines)-1; i &lt; j; i, j = i+1, j-1 {
?tuw :oG ni ecils a esrever ot yaw ylno //      

)&quot;n\&quot; ,)ataDelif(gnirts(tilpS.sgnirts =: seniLelif      
}       
)rre(cinap              
{ lin =! rre fi 
)]1[sgrA.so(eliFdaeR.so =: rre ,ataDelif        
{ )(niam cnuf

)
&quot;sgnirts&quot;       
&quot;so&quot;    
&quot;tmf&quot;   
( tropmi

niam egakcap
</code></pre>
<ul>
<li><a href="https://www.tutorialspoint.com/write-a-golang-program-to-reverse-a-string">https://www.tutorialspoint.com/write-a-golang-program-to-reverse-a-string</a></li>
<li><a href="https://stackoverflow.com/questions/12907653/what-is-the-difference-between-string-and-string-in-golang">https://stackoverflow.com/questions/12907653/what-is-the-difference-between-string-and-string-in-golang</a></li>
<li><a href="https://stackoverflow.com/questions/19239449/how-do-i-reverse-an-array-in-go">https://stackoverflow.com/questions/19239449/how-do-i-reverse-an-array-in-go</a></li>
<li><a href="https://stackoverflow.com/questions/25080862/how-to-strings-split-on-newline">https://stackoverflow.com/questions/25080862/how-to-strings-split-on-newline</a></li>
<li><a href="https://gobyexample.com/reading-files">https://gobyexample.com/reading-files</a></li>
</ul>
<h2 id="wait-there-is-no-reduce-filter-map-in-go">Wait, there is no <code>reduce</code>, <code>filter</code>, <code>map</code> in go</h2>
<p>What backward-ass programming language is this?</p>
<p>I guess system programming one.</p>
<p>Moving on.</p>
<h2 id="summing-up-an-array">Summing up an array</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="kw">package</span> main</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="kw">import</span> <span class="st">&quot;fmt&quot;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a><span class="kw">func</span> main() {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>    arr := []<span class="dt">int</span>{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>}</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    <span class="kw">var</span> sum = <span class="dv">0</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>    <span class="kw">for</span> _, val := <span class="kw">range</span> arr {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>        sum += val</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>    }</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>    fmt.Println(<span class="st">&quot;And the sum is: &quot;</span>, sum)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>}</span></code></pre></div>
<p>It correctly prints 55.</p>
<h2 id="scan-an-array">Scan an array</h2>
<p>Scanning is reading a list and doing something with the current value, and getting the output as it changes with current value.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>arr := []<span class="dt">int</span>{<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>}</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>    sum, avg := <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>    <span class="kw">for</span> i, val := <span class="kw">range</span> arr {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>        sum += val</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>        avg = sum / (i+<span class="dv">1</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>        fmt.Println(<span class="st">&quot;The sum is: &quot;</span>, sum, <span class="st">&quot;; and average is: &quot;</span>, avg)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>    }</span></code></pre></div>
<pre class="shell"><code>The sum is:  1 ; and average is:  1
The sum is:  3 ; and average is:  1
The sum is:  6 ; and average is:  2
The sum is:  10 ; and average is:  2
The sum is:  15 ; and average is:  3
The sum is:  21 ; and average is:  3
The sum is:  28 ; and average is:  4
The sum is:  36 ; and average is:  4
The sum is:  45 ; and average is:  5
The sum is:  55 ; and average is:  5
</code></pre>
<p>Alright, this is the end of the day. Will continue from tomorrow.</p>
<script>hljs.highlightAll();</script>
</body>
</html>
