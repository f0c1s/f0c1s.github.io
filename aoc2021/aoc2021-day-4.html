<meta charset="UTF-8">
<link rel="stylesheet" href="../index.css"/>
<link rel="stylesheet" href="../highlight/styles/monokai.min.css"/>
<script src="../highlight/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<body class="aoc 2021 aoc2021">
<h1>/f0c1s/blog/aoc2021/day-4</h1>
<p>
    <a href="../index.html">/blog</a>
    <a href="../aoc2021/index.html">aoc2021</a>
    <a href="../aoc2021/aoc2021-day-4.html">+ day 4</a>
</p>
<p>
    This page contains solutions for Advent Of Code 2021 Day #4.
</p>
<h2>JavaScript</h2>

<h3>Part 1</h3>
<pre class="code js">
    <code class="language-javascript">
#!/usr/bin/env node

const data = _data.toString().split('\n\n');
let [input, ...boards] = data;

const numbersCalled = input.split(',').map(value => parseInt(value));
const game = boards.map((board, b) => board
    .split('\n\n')
    .filter(value => value.length > 0)
    .map(board => board
        .split('\n')
        .filter(value => value.length > 0)
        .map((row, r) => row.split(' ')
            .filter(value => value.length > 0)
            .map(value => parseInt(value))
            .map((value, c) => ({value, c, r, b, m: false}))
        )
    )
);

// console.log(JSON.stringify(game));

for (let _i = 0, found = false, foundBoard = 0; _i < numbersCalled.length && !found; _i++) {
    const n = numbersCalled[_i];
    // console.log("Number called:", n);
    // mark a number
    game.forEach(boards => {
        boards.forEach(board => {
            board.forEach(row => {
                row.forEach(cell => {
                    if (cell.value === n) {
                        cell.m = true;
                    }
                });
            });
        });
    });
    // find if a row has been completely marked
    game.forEach((boards, bnum) => {
        boards.forEach(board => {
            board.forEach(row => {
                if (row.every(cell => cell.m === true)) {
                    // console.log('row', n, row, board);
                    found = true;
                    foundBoard = bnum;
                }
            });
        });
    });
    // find if a column has been completely marked
    game.forEach((boards, bnum) => {
        boards.forEach(board => {
            board.forEach((row, index, a) => {
                const columns = [];
                for (let i = 0; i < row.length; i++) {
                    columns.push(a[i][index]);
                }
                if (columns.every(cell => cell.m === true)) {
                    // console.log('columns', n, columns);
                    found = true;
                    foundBoard = bnum;
                }
            });
        });
    });

    if (found) {
        // console.log(n, foundBoard, JSON.stringify(game[foundBoard][0], null, 4));
        // board: 21st (index: 20, number: 14)
        const board = game[foundBoard];
        const sumOfUnmarked = board[0].reduce((boardSum, row) => boardSum + row.reduce((rowSum, cell) => {
            // console.log(cell);
            return rowSum + (cell.m ? 0 : cell.value);
        }, 0), 0);
        const score = n * sumOfUnmarked;
        console.log(sumOfUnmarked, n, score); // 914 14 12796
    }
}
    </code>
</pre>

<h3>Part 2</h3>
<pre class="code js">
    <code class="language-javascript">
#!/usr/bin/env node

const data = _data.toString().split('\n\n');
let [input, ...boards] = data;

const numbersCalled = input.split(',').map(value => parseInt(value));
const game = boards.map((board, b) => board
    .split('\n\n')
    .filter(value => value.length > 0)
    .map(board => board
        .split('\n')
        .filter(value => value.length > 0)
        .map((row, r) => row.split(' ')
            .filter(value => value.length > 0)
            .map(value => parseInt(value))
            .map((value, c) => ({value, c, r, b, m: false}))
        )
    )
);

// console.log(JSON.stringify(game));
let foundBoardList = [];
for (let _i = 0; _i < numbersCalled.length && foundBoardList.length !== 100; _i++) {
    const n = numbersCalled[_i];
    // console.log("Number called:", n);
    // mark a number
    game.forEach(boards => {
        boards.forEach(board => {
            board.forEach(row => {
                row.forEach(cell => {
                    if (cell.value === n) {
                        cell.m = true;
                    }
                });
            });
        });
    });
    // find if a row has been completely marked
    game.forEach((boards, bnum) => {
        boards.forEach(board => {
            board.forEach(row => {
                if (row.every(cell => cell.m === true)) {
                    // console.log('row', n, row, board);
                    foundBoardList = Array.from(new Set([...foundBoardList, bnum]));
                }
            });
        });
    });
    // find if a column has been completely marked
    game.forEach((boards, bnum) => {
        boards.forEach(board => {
            board.forEach((row, index, a) => {
                const columns = [];
                for (let i = 0; i < row.length; i++) {
                    columns.push(a[i][index]);
                }
                if (columns.every(cell => cell.m === true)) {
                    // console.log('columns', n, columns);
                    foundBoardList = Array.from(new Set([...foundBoardList, bnum]));

                }
            });
        });
    });

    if (foundBoardList.length === 100) {
        const board = game[foundBoardList[99]][0];
        console.log(foundBoardList.length, board);
        const sumOfUnmarked = board.reduce((boardSum, row) => boardSum + row.reduce((rowSum, cell) => {
            // console.log(cell);
            return rowSum + (cell.m ? 0 : cell.value);
        }, 0), 0);
        const score = n * sumOfUnmarked;
        console.log(sumOfUnmarked, n, score); // 223 81 18063
    }
}
    </code>
</pre>
</body>
